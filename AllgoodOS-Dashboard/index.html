<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Allgood Academy Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInAnonymously, onAuthStateChanged, updateProfile, signOut, GoogleAuthProvider, signInWithPopup, signInWithCustomToken } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, addDoc, collection, serverTimestamp, onSnapshot, query, where } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Set Firebase logging level for debugging
        setLogLevel('Debug');
        
        // --- CONFIGURATION (Environment or Fallback) ---
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "AIzaSyAf2SO8xovrApl52udUUoR1n9WBnERr_ko",
            authDomain: "allgood-academy.firebaseapp.com",
            projectId: "allgood-academy",
            storageBucket: "allgood-academy.firebasestorage.app",
            messagingSenderId: "978829044870",
            appId: "1:978829044870:web:6c780f64230a77ad0ab507",
            measurementId: "G-EN4M7T3BLQ"
        };
        
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'allgood-academy';
        
        let auth, db;

        // --- FIREBASE INITIALIZATION ---
        const app = initializeApp(firebaseConfig);
        auth = getAuth(app);
        db = getFirestore(app);

        // --- AUTH INIT (Custom Token Support) ---
        (async function initAuth() {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                try {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } catch (e) {
                    console.warn("Auth token failed, falling back", e);
                }
            }
        })();

        // --- GLOBAL EXPORTS ---
        window.auth = auth; 
        window.db = db;

        // TRACKING STATE
        let launchCount = parseInt(localStorage.getItem('aa_launch_count') || '0');
        let currentLevel = 1;
        let unsubscribeLaunches = null;

        // --- UTILITY: Writes essential user data to Firestore ---
        async function writeUserDataToFirestore(user, name, email, isGuest) {
             const userRef = doc(db, 'artifacts', appId, 'users', user.uid);
             
             if (isGuest && user.displayName !== name) {
                await updateProfile(user, { displayName: name });
             }

             await setDoc(userRef, {
                 displayName: name,
                 email: email || (isGuest ? null : user.email || null),
                 isGuest: isGuest,
                 lastLogin: serverTimestamp(),
                 onboardingComplete: true
             }, { merge: true });

             localStorage.setItem('aa_is_guest', isGuest);
             localStorage.setItem('aa_username', name);
             localStorage.setItem('aa_uid', user.uid);
             
             window.updateUI(name); 
             document.getElementById('page-dashboard').classList.add('active');
             document.getElementById('page-dashboard').style.display = 'block'; 
             closeLoginModal();
             
             // FIX: Only attach listener if not a guest to prevent permission errors
             if (!isGuest) {
                 window.startLaunchListener(user.uid); 
             }
        }

        // --- AUTH HANDLERS ---
        window.handleGuestLogin = async () => {
            sfx.click();
            const btn = document.getElementById('btn-guest-login');
            
            const nameInput = document.getElementById('user-name-input').value.trim();
            const emailInput = document.getElementById('user-email-input').value.trim();

            const finalName = nameInput || "Guest";
            const finalEmail = emailInput || null;
            const isGuest = true;
            
            btn.innerText = "Connecting...";
            btn.disabled = true;
            btn.classList.add('opacity-70', 'cursor-wait');

            try {
                const userCredential = await signInAnonymously(auth);
                const user = userCredential.user;
                await writeUserDataToFirestore(user, finalName, finalEmail, isGuest);
            } catch (error) {
                console.error("Anonymous Login Error:", error);
                showStatusMessage("Connection failed. Check network or rules.", 'error'); 
            } finally {
                btn.innerText = "Enter Dashboard"; 
                btn.disabled = false;
                btn.classList.remove('opacity-70', 'cursor-wait');
            }
        };

        window.handleGoogleLogin = async () => {
            sfx.click();
            const btnContainer = document.getElementById('google-icon-container');
            btnContainer.classList.add('opacity-50', 'cursor-wait');
            
            const provider = new GoogleAuthProvider();
            const isGuest = false;

            try {
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                const finalName = user.displayName || 'Agent';
                const finalEmail = user.email || null;
                await writeUserDataToFirestore(user, finalName, finalEmail, isGuest);
            } catch (error) {
                console.error("Google Sign-In Error:", error);
                let message = "Sign-in failed. Please try again.";
                if (error.code === 'auth/popup-closed-by-user') {
                    message = "Sign-in canceled. Please try again.";
                }
                showStatusMessage(message, 'error');
            } finally {
                btnContainer.classList.remove('opacity-50', 'cursor-wait');
            }
        };

        window.launchCourse = async (courseName, url, element) => {
            window.open(url, '_blank');
            sfx.confirm();
            
            if (auth.currentUser) {
                // 1. Log to Firestore
                addDoc(collection(db, 'artifacts', appId, 'users', auth.currentUser.uid, 'launches'), {
                    courseName: courseName,
                    targetUrl: url,
                    timestamp: serverTimestamp()
                }).catch(e => console.log("Log failed (Firebase). Continuing navigation."));

                // 2. Visual Update: Change Status to LAUNCHED
                if (element) {
                    const badge = element.querySelector('span.rounded'); // Finds the status badge
                    if (badge) {
                        badge.textContent = "LAUNCHED";
                        // Switch to Blue styling for visual feedback
                        badge.className = "bg-blue-100 text-blue-700 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide transition-all duration-500 animate-pulse";
                        // Remove pulse after a few seconds
                        setTimeout(() => badge.classList.remove('animate-pulse'), 2000);
                    }
                }
            }
        };

        // --- MESSAGING LOGIC ---
        window.openMessageModal = () => {
            const menu = document.getElementById('menu-modal');
            if(menu) { menu.classList.add('hidden-modal'); menu.classList.remove('visible-modal'); }
            
            const modal = document.getElementById('message-modal');
            modal.classList.remove('hidden-modal');
            modal.classList.add('visible-modal');
            sfx.click();
            setTimeout(() => document.getElementById('message-input').focus(), 100);
        }

        window.closeMessageModal = () => {
            const modal = document.getElementById('message-modal');
            modal.classList.add('hidden-modal');
            modal.classList.remove('visible-modal');
            sfx.click();
        }

        window.submitMessage = async () => {
            const input = document.getElementById('message-input');
            const text = input.value.trim();
            const btn = document.getElementById('btn-send-message');
            
            if (!text) return;
            
            const user = auth.currentUser;
            if (!user) {
                showStatusMessage("Please sign in to send messages.", 'error');
                return;
            }

            btn.disabled = true;
            btn.innerHTML = "Sending...";

            try {
                // FIXED: Write to private user collection to guarantee permission
                // Was: collection(db, 'artifacts', appId, 'public', 'data', 'feedback_inbox')
                const targetCollection = collection(db, 'artifacts', appId, 'users', user.uid, 'feedback_inbox');
                
                await addDoc(targetCollection, {
                    senderName: user.displayName || "Guest Agent",
                    senderEmail: user.email || "Anonymous",
                    message: text,
                    timestamp: serverTimestamp(),
                    isGuest: user.isAnonymous
                });
                
                sfx.confirm();
                input.value = "";
                closeMessageModal();
                showStatusMessage("Message Sent. Thank you, Agent.", 'info');
            } catch (e) {
                console.error("Message failed", e);
                showStatusMessage("Transmission failed. Try again.", 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = `<i data-lucide="send" class="w-3 h-3"></i> Send Transmission`;
                lucide.createIcons();
            }
        }

        window.handleLogout = async () => {
            sfx.powerOff();
            localStorage.removeItem('aa_username');
            localStorage.removeItem('aa_is_guest'); 
            localStorage.removeItem('aa_launch_count');
            localStorage.removeItem('aa_uid');

            launchCount = 0; 
            currentLevel = 1;
            
            if (auth.currentUser) {
                try { await signOut(auth); } catch(e) { console.log("Signout error", e); }
            }
            
            if (unsubscribeLaunches) {
                unsubscribeLaunches();
                unsubscribeLaunches = null;
            }
            
            document.querySelectorAll('.visible-modal').forEach(el => {
                el.classList.remove('visible-modal');
                el.classList.add('hidden-modal');
            });

            const dashboard = document.getElementById('page-dashboard');
            if (dashboard) {
                dashboard.classList.remove('active');
                dashboard.style.display = 'none';
            }
            
            window.updateUI('Agent'); 
            window.updateBadges(); 

            const startup = document.getElementById('startup-screen');
            if(startup) {
                // RESET MESSAGE ON LOGOUT
                document.getElementById('startup-message').textContent = "CLICK TO POWER UP";
                startup.style.display = 'flex';
                setTimeout(() => { startup.style.opacity = '1'; }, 10);
            }
        };

        // --- FIRESTORE LISTENERS ---
        window.startLaunchListener = function(uid) {
            if (unsubscribeLaunches) unsubscribeLaunches();
            
            const launchesCollectionRef = collection(db, 'artifacts', appId, 'users', uid, 'launches');
            unsubscribeLaunches = onSnapshot(launchesCollectionRef, (snapshot) => {
                const totalLaunches = snapshot.size;
                launchCount = totalLaunches; 
                localStorage.setItem('aa_launch_count', launchCount); 
                window.updateBadges();

                const statElement = document.getElementById('stat-total-launches');
                if (statElement) statElement.textContent = totalLaunches;
            }, (error) => {
                console.error("Error listening to launches:", error);
            });
        }

        // --- UI/BADGE LOGIC ---
        window.updateUI = function(name) { 
            const els = document.querySelectorAll('.user-name-display');
            els.forEach(el => el.textContent = name);
            window.updateBadges();
        }
        
        window.updateBadges = function() { 
            launchCount = parseInt(localStorage.getItem('aa_launch_count') || '0');
            const isGuest = localStorage.getItem('aa_is_guest') === 'true';
            const name = localStorage.getItem('aa_username');
            const isGenericName = !name || name === 'Guest' || name === 'Learner';
            
            currentLevel = 1;
            if (!isGuest && name && !isGenericName) currentLevel = 2;
            if (currentLevel >= 2 && launchCount >= 1) currentLevel = 3; 
            else if (currentLevel >= 2) currentLevel = 2; 
            
            for(let i=1; i<=3; i++) {
                const badge = document.getElementById(`badge-${i}`);
                if(!badge) continue;
                
                if (i <= currentLevel) {
                    badge.classList.remove('opacity-30', 'grayscale');
                    if (i === 3) badge.classList.add('animate-pulse-glow-badge');
                    else badge.classList.remove('animate-pulse-glow-badge');
                    
                    badge.classList.add('cursor-pointer', 'hover:scale-110', 'shadow-badge-active');
                    badge.classList.remove('shadow-badge-locked');

                    const lock = badge.querySelector('.lock-icon');
                    if(lock) lock.style.display = 'none';
                } else {
                    badge.classList.add('opacity-30', 'grayscale', 'shadow-badge-locked');
                    badge.classList.remove('cursor-pointer', 'hover:scale-110', 'shadow-badge-active', 'animate-pulse-glow-badge');
                    const lock = badge.querySelector('.lock-icon');
                    if(lock) lock.style.display = 'block';
                }
            }
            
            const label = document.getElementById('clearance-label');
            const titles = ["OBSERVER", "AGENT", "OPERATOR"];
            if(label) label.textContent = `LEVEL ${currentLevel}: ${titles[currentLevel-1]}`;

            const launchStat = document.getElementById('stat-total-launches');
            if (launchStat) launchStat.textContent = launchCount;
        }
        
        window.showBadgeInfo = (level) => {
            const titles = ["Observer", "Agent", "Operator"];
            const descs = [
                "You are observing the academy. Sign in to track your progress.",
                "Identity confirmed. You are authorized to access mission files.",
                "Field Operator status confirmed. You have moved from theory to action."
            ];
            const reqs = [
                "None (Guest/Anonymous Access)",
                "Sign In with Persistent Identity (Google or SSO)",
                "Agent Status + Complete 1 Mission Module"
            ];
            
            const modal = document.getElementById('badge-modal');
            document.getElementById('badge-title').textContent = `Level ${level}: ${titles[level-1]}`;
            document.getElementById('badge-desc').textContent = descs[level-1];
            document.getElementById('badge-req').textContent = `Requirement: ${reqs[level-1]}`;
            
            const statusEl = document.getElementById('badge-status');
            if (level <= currentLevel) {
                statusEl.textContent = "STATUS: UNLOCKED";
                statusEl.className = "text-xs font-bold text-green-600 uppercase tracking-widest";
            } else {
                statusEl.textContent = "STATUS: CLASSIFIED (LOCKED)";
                statusEl.className = "text-xs font-bold text-red-500 uppercase tracking-widest";
            }
            
            modal.classList.remove('hidden-modal');
            modal.classList.add('visible-modal');
            sfx.click();
        }
        
        window.closeBadgeModal = () => {
            const modal = document.getElementById('badge-modal');
            modal.classList.add('hidden-modal');
            modal.classList.remove('visible-modal');
            sfx.click();
        }

        window.openAboutModal = () => {
            // Close the system menu first to prevent double-backdrop overlap
            const menu = document.getElementById('menu-modal');
            if (menu) {
                menu.classList.add('hidden-modal');
                menu.classList.remove('visible-modal');
            }

            const modal = document.getElementById('about-modal');
            modal.classList.remove('hidden-modal');
            modal.classList.add('visible-modal');
            sfx.click();
        }

        window.closeAboutModal = () => {
            const modal = document.getElementById('about-modal');
            modal.classList.add('hidden-modal');
            modal.classList.remove('visible-modal');
            sfx.click();
        }

        function closeLoginModal() {
            const modal = document.getElementById('login-modal');
            if(modal) {
                modal.classList.add('hidden-modal');
                modal.classList.remove('visible-modal');
            }
        }
        
        function showStatusMessage(message, type = 'info') {
            const modal = document.getElementById('status-modal');
            const content = document.getElementById('status-content');
            const icon = document.getElementById('status-icon');
            const classes = {
                'info': { bg: 'bg-blue-100', text: 'text-blue-800', icon: 'info' },
                'error': { bg: 'bg-red-100', text: 'text-red-800', icon: 'alert-triangle' }
            };

            const style = classes[type] || classes['info'];
            modal.querySelector('.modal-content-base').className = `modal-content-base rounded-lg shadow-2xl p-6 max-w-sm w-full text-center border-t-4 ${style.bg} relative`;
            content.textContent = message;
            content.className = `text-sm font-body ${style.text}`;
            icon.setAttribute('data-lucide', style.icon);
            lucide.createIcons();

            modal.classList.remove('hidden-modal');
            modal.classList.add('visible-modal');
            setTimeout(() => {
                modal.classList.add('hidden-modal');
                modal.classList.remove('visible-modal');
            }, 3000);
        }
        
        window.restoreSessionState = function() {
            const storedName = localStorage.getItem('aa_username');
            const storedUID = localStorage.getItem('aa_uid');
            const dashboard = document.getElementById('page-dashboard');

            if (storedName && storedUID) {
                window.updateUI(storedName);
                if (dashboard) {
                    dashboard.classList.add('active');
                    dashboard.style.display = 'block'; 
                }
                window.startLaunchListener(storedUID);
                return true; 
            }
            return false; 
        }

        window.initDashboard = function() { 
            onAuthStateChanged(auth, async (user) => {
                const dashboard = document.getElementById('page-dashboard');
                if (user) {
                    if (dashboard.style.display === 'block') {
                        window.startLaunchListener(user.uid);
                        return;
                    }
                    
                    const userRef = doc(db, 'artifacts', appId, 'users', user.uid);
                    const docSnap = await getDoc(userRef);

                    let displayName = user.displayName || 'Agent';
                    let isGuest = true; 

                    if (docSnap.exists()) {
                        const userData = docSnap.data();
                        displayName = userData.displayName || user.displayName || 'Agent';
                        isGuest = userData.isGuest || false;
                    }

                    localStorage.setItem('aa_username', displayName);
                    localStorage.setItem('aa_uid', user.uid);
                    localStorage.setItem('aa_is_guest', isGuest);

                    window.updateUI(displayName);
                    dashboard.classList.add('active');
                    dashboard.style.display = 'block'; 
                    closeLoginModal(); // Auto-close login if auth state restored
                    window.startLaunchListener(user.uid);
                } else {
                    if (dashboard.style.display === 'block') {
                         window.handleLogout(); 
                    }
                }
            });
        }
        
    </script>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'allgood-primary': '#D34716',
                        'allgood-secondary': '#357889',
                        'allgood-dark': '#4C4C4C',
                        'allgood-light': '#F7F7F7',
                        'allgood-hover': '#EB8D69',
                        'allgood-accent': '#2D6473',
                    },
                    fontFamily: {
                        'heading': ['Georgia', 'serif'],
                        'body': ['Verdana', 'sans-serif'],
                    },
                },
            },
        }
    </script>

    <style>
        /* =============================================
           FIXED CHASSIS MANDATE: Industrial Design
           ============================================= 
        */
        body {
            font-family: Verdana, sans-serif;
            background-color: #1a1a1a;
            /* Industrial grid pattern */
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
            background-attachment: fixed;
            min-height: 100vh;
            position: relative;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        h1, h2, h3, h4, h5, h6 { font-family: Georgia, serif; }

        /* Neon Glow Effects */
        .static-neon-glow {
            text-shadow: 
                0 0 5px rgba(211, 71, 22, 0.2),
                0 0 10px rgba(211, 71, 22, 0.4),
                0 0 20px rgba(211, 71, 22, 0.6);
        }

        @keyframes pulse-glow {
            0%, 100% { text-shadow: 0 0 10px rgba(211, 71, 22, 0.4); transform: scale(1); }
            50% { text-shadow: 0 0 30px rgba(211, 71, 22, 0.9), 0 0 15px rgba(211, 71, 22, 0.6); transform: scale(1.02); }
        }
        .animate-pulse-glow { animation: pulse-glow 2.5s infinite ease-in-out; will-change: transform, text-shadow; }

        @keyframes pulse-glow-badge {
            0%, 100% { box-shadow: 0 0 0px rgba(211, 71, 22, 0.0); }
            50% { box-shadow: 0 0 12px rgba(211, 71, 22, 0.7); }
        }
        .animate-pulse-glow-badge { animation: pulse-glow-badge 3s infinite ease-in-out; }

        .shadow-badge-locked { box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5), 0 1px 1px rgba(255, 255, 255, 0.2); }
        .shadow-badge-active { box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2), 0 0 1px #FFF; }

        /* --- TABLET FRAME (FIXED CHASSIS MANDATE) --- */
        .tablet-frame {
            height: 80vh;
            width: auto;
            aspect-ratio: 16/10;
            max-width: 1100px;
            max-height: 95vh;
            min-height: 0;
            min-width: 0;
            /* Brushed Aluminum & Depth Gradients */
            background-image: 
                radial-gradient(circle at 0% 0%, rgba(211, 71, 22, 0.35) 0%, transparent 30%),
                radial-gradient(circle at 100% 100%, rgba(211, 71, 22, 0.35) 0%, transparent 30%),
                linear-gradient(135deg, #5c5c5c 0%, #d6d6d6 25%, #8a8a8a 50%, #e0e0e0 75%, #5c5c5c 100%);
            border-radius: 12px;
            padding: 12px; 
            box-shadow: 
                inset 1px 1px 2px rgba(255,255,255, 0.6), 
                inset -1px -1px 2px rgba(0,0,0, 0.8), 
                0 30px 60px -12px rgba(0, 0, 0, 0.8), 
                0 0 0 1px #111;
            border: 1px solid #333;
            position: relative;
            margin: 20px auto;
            transition: width 0.3s, height 0.3s, padding 0.3s;
        }

        /* The Inner Bezel (Deep Black Frame) */
        .tablet-frame::before {
            content: ''; position: absolute; top: 10px; left: 10px; right: 10px; bottom: 10px;
            border-radius: 6px; background: #111; z-index: 0;
        }

        .screen-container {
            width: 100%; height: 100%; background-color: #F7F7F7;
            position: relative; z-index: 1; overflow: hidden;
            display: flex; flex-direction: column; 
            border-radius: 4px; box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }
        
        /* --- MISSION CARD (EMBOSSED LOOK) --- */
        .mission-file {
            background: white;
            border: 1px solid #d1d5db; /* Neutral border */
            border-left-width: 4px;
            border-radius: 6px;
            /* Embossed/Durable Shadow */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1), inset 0 1px 0 rgba(255,255,255,0.8);
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        /* Copper Glow on Hover */
        .mission-file::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            opacity: 0;
            border-radius: 6px;
            box-shadow: 0 0 10px #EB8D69, inset 0 0 5px #EB8D69; 
            transition: opacity 0.2s ease;
            pointer-events: none;
            z-index: 5;
        }
        .mission-file:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        .mission-file:hover::after {
            opacity: 0.5;
        }

        /* Status colors */
        .status-active { border-left-color: #D34716; } /* Burnt Orange */
        .status-ready { border-left-color: #357889; } /* Deep Cyan */
        .status-locked { border-left-color: #757575; opacity: 0.7; cursor: not-allowed; }
        
        /* Tab Styling */
        .tab-btn {
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            font-weight: 500;
        }
        .active-tab {
            background-color: white;
            border-bottom-color: #D34716;
            color: #D34716;
            font-weight: bold;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.05);
        }

        /* --- MOBILE ADAPTATION --- */
        @media (max-width: 640px) {
            body {
                padding: 0;
                align-items: flex-start;
                background-image: none;
                background-color: #F7F7F7;
            }
            .tablet-frame {
                width: 100vw !important;
                height: 100vh !important;
                max-width: none !important;
                max-height: none !important;
                border-radius: 0 !important;
                border: none !important;
                padding: 0 !important;
                margin: 0 !important;
                box-shadow: none !important;
                background-image: none !important;
                aspect-ratio: auto !important;
            }
            .tablet-frame::before { display: none; }
            .screen-container {
                border-radius: 0 !important;
                box-shadow: none !important;
            }
            main { padding: 0 !important; }
        }

        /* --- BLUEPRINT MODE (Dark Mode) --- */
        .blueprint-mode .screen-container { background-color: #0f172a; color: #94a3b8; }
        .blueprint-mode .mission-file { background-color: #1e293b; border-color: #334155; }
        .blueprint-mode h1, .blueprint-mode h2, .blueprint-mode h3, .blueprint-mode strong { color: #38bdf8 !important; }
        .blueprint-mode .text-slate-500, .blueprint-mode .text-slate-700 { color: #94a3b8 !important; }
        .blueprint-mode .section-header { border-bottom-color: #334155; }
        .blueprint-mode .bg-white { background-color: #1e293b; border-color: #334155; }
        .blueprint-mode .status-active { border-left-color: #D34716; background-color: #1e293b; }
        .blueprint-mode .tab-btn { background-color: #1e293b; color: #94a3b8; border-color: #334155; }
        .blueprint-mode .tab-btn.active-tab { background-color: #0f172a; color: #38bdf8; border-color: #38bdf8; }
        .blueprint-mode .mission-file:hover::after { opacity: 0.1; }

        /* --- FOCUS MODE --- */
        .focus-mode .tablet-frame {
            position: absolute !important; top: 0 !important; left: 0 !important; right: 0 !important; bottom: 0 !important; 
            width: 100% !important; height: 100% !important;
            aspect-ratio: auto !important; max-width: none !important; max-height: none !important; 
            min-height: 0 !important;
            margin: 0 !important; padding: 0 !important; 
            background: #F7F7F7 !important; border: none !important; border-radius: 0 !important; 
            box-shadow: none !important; z-index: 99999 !important;
            background-image: none !important;
        }
        .focus-mode .tablet-frame::before { display: none; }
        .focus-mode .screen-container { border-radius: 0; box-shadow: none; height: 100%; }

        /* --- SCROLLBARS --- */
        .page::-webkit-scrollbar { width: 14px; }
        .page::-webkit-scrollbar-track { background: #e5e5e5; border-left: 1px solid #d1d5db; }
        .page::-webkit-scrollbar-thumb { background-color: #D34716; border-radius: 7px; border: 3px solid #e5e5e5; }
        .page::-webkit-scrollbar-thumb:hover { background-color: #EB8D69; }

        /* --- MODALS --- */
        .modal-transition { transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out; }
        .hidden-modal { opacity: 0; pointer-events: none; transform: translateY(-10px); }
        .visible-modal { opacity: 1; pointer-events: auto; transform: translateY(0); }

        /* --- LAYOUT --- */
        .navbar-content { flex: 0 0 60px; z-index: 20; background: #357889; border-bottom: 2px solid #2D6473; color: white; }
        .footer-content { flex: 0 0 50px; z-index: 20; background: white; border-top: 1px solid #e2e8f0; }
        .page { flex: 1 1 auto; overflow-y: auto; padding: 24px; position: relative; display: none; width: 100%; background-color: #F7F7F7; }
        .page.active { display: block; }
        
        .modal-content-base { background: white; }
        
        .tooltip-container { position: relative; display: inline-block; }
        .tooltip-text {
            visibility: hidden; width: 250px; background-color: #4C4C4C; color: #fff;
            text-align: left; border-radius: 6px; padding: 10px; position: absolute; z-index: 10;
            bottom: 125%; left: 50%; margin-left: -125px; opacity: 0; transition: opacity 0.3s; font-size: 0.75rem;
        }
        .tooltip-container:hover .tooltip-text { visibility: visible; opacity: 1; }
        .tooltip-text::after {
            content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px;
            border-width: 5px; border-style: solid; border-color: #4C4C4C transparent transparent transparent;
        }

    </style>
</head>
<body class="flex flex-col min-h-screen text-allgood-dark font-body">

    <main class="flex-grow flex items-center justify-center py-8">
        <div class="tablet-frame">
            <div class="screen-container" id="screen">

                <!-- 1. STARTUP SCREEN -->
                <div id="startup-screen" class="absolute inset-0 z-[300] flex flex-col items-center justify-center cursor-pointer transition-opacity duration-700 ease-in-out bg-slate-900">
                    <div class="group flex flex-col items-center justify-center text-center h-full w-full relative">
                        <div class="relative">
                            <div class="absolute inset-0 bg-allgood-primary/20 blur-3xl rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                            <h2 class="text-xl md:text-2xl font-heading text-slate-400 mb-2 uppercase">WELCOME TO THE</h2>
                            <h1 class="text-4xl md:text-6xl font-heading font-bold text-allgood-primary tracking-tighter relative z-10 drop-shadow-md static-neon-glow uppercase">ALLGOOD<span class="text-white">ACADEMY</span></h1>
                        </div>
                        <p id="startup-message" class="mt-8 text-slate-500 text-xs tracking-[0.3em] uppercase font-medium group-hover:text-white transition-colors animate-pulse font-body">CLICK TO POWER UP</p>
                    </div>
                </div>

                <!-- 2. LOGIN MODAL -->
                <div id="login-modal" class="absolute inset-0 z-[200] bg-allgood-dark/95 flex items-center justify-center p-6 hidden-modal modal-transition backdrop-blur-sm">
                    <div class="bg-white rounded-lg shadow-2xl p-8 max-w-sm w-full text-center border-t-4 border-allgood-primary">
                        <div class="mb-6"><h2 class="text-3xl font-heading font-bold text-allgood-dark">Allgood<span class="text-allgood-primary">Academy</span></h2></div>
                        <h2 class="text-xl font-bold text-allgood-dark mb-2 font-heading">Welcome</h2>
                        
                        <div class="flex items-center justify-center gap-2 mb-6 relative">
                            <p class="text-gray-500 text-sm font-body">Please sign in to start.</p>
                            <button id="policy-trigger" class="group relative flex items-center text-allgood-primary hover:text-allgood-hover transition-colors focus:outline-none">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                                <span class="text-xs font-bold underline decoration-dotted underline-offset-2">Why?</span>
                                
                                <!-- Tooltip -->
                                <div class="absolute top-full left-1/2 transform -translate-x-1/2 mt-3 w-64 p-3 bg-gray-800 text-white text-xs text-left rounded shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible group-focus:opacity-100 group-focus:visible transition-all duration-200 z-50 font-body leading-relaxed border border-gray-700 pointer-events-none">
                                    <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-800"></div>
                                    <strong class="block text-allgood-primary mb-1 uppercase tracking-wide text-[10px]">Why do we ask?</strong>
                                    <p class="mb-2 text-gray-300">We use your name to personalize your badge. Performance data is logged in real-time to improve the GoodBlock experience. All personal data is kept confidential and never sold.</p>
                                    <div class="border-t border-gray-700 my-1 pt-1"></div>
                                    <p class="text-gray-300"><strong>Email (Optional):</strong> Enter to join the Allgood Academy community.</p>
                                </div>
                            </button>
                        </div>

                        <input type="text" id="user-name-input" placeholder="Your Name (Optional)" class="w-full border border-gray-300 rounded p-3 mb-3 focus:ring-2 focus:ring-allgood-primary focus:border-transparent outline-none transition-all font-body">
                        <input type="email" id="user-email-input" placeholder="Your Email (Optional)" class="w-full border border-gray-300 rounded p-3 mb-6 focus:ring-2 focus:ring-allgood-primary focus:border-transparent outline-none transition-all font-body">
                        
                        <button id="btn-guest-login" onclick="window.handleGuestLogin()" class="w-full bg-allgood-primary hover:bg-allgood-hover text-white font-bold py-3 rounded shadow-md transition-transform transform hover:scale-[1.02] active:scale-[0.98] font-body uppercase">
                            Enter Dashboard
                        </button>

                        <div class="mt-4 flex items-center justify-center space-x-2">
                             <div class="h-px w-10 bg-gray-200"></div>
                             <p class="text-xs text-gray-500 uppercase font-bold">OR</p>
                             <div class="h-px w-10 bg-gray-200"></div>
                        </div>

                        <button id="google-icon-container" onclick="window.handleGoogleLogin()" 
                                class="mt-4 p-2 rounded-full border border-gray-300 shadow-md hover:shadow-lg transition-all duration-200 hover:scale-105 active:scale-95 bg-white flex items-center justify-center mx-auto">
                            <!-- Clean Google G Logo -->
                            <svg class="w-6 h-6" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                                <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                                <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                                <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- 2.5 STATUS MODAL -->
                <div id="status-modal" class="hidden-modal fixed top-4 right-4 z-[500] flex items-center justify-center p-4 modal-transition pointer-events-none">
                    <div class="bg-white rounded-lg shadow-xl p-4 max-w-xs w-full text-left border-l-4 border-blue-500 flex items-center space-x-3 modal-content-base">
                        <i id="status-icon" data-lucide="info" class="w-5 h-5 text-blue-500 flex-shrink-0"></i>
                        <p id="status-content" class="text-sm font-body text-blue-800"></p>
                    </div>
                </div>

                <!-- 3. TOP NAVBAR -->
                <header class="navbar-content flex items-center justify-between px-6 shadow-md relative z-30">
                    <div class="flex items-center overflow-hidden">
                        <div class="flex-shrink-0 text-white font-heading font-bold text-lg tracking-tight truncate mr-4 select-none uppercase">
                            ALLGOOD ACADEMY <span class="opacity-60 text-sm font-normal">| DASHBOARD</span>
                        </div>
                    </div>
                    <!-- Control Cluster -->
                    <div class="flex items-center space-x-1 shrink-0 relative">
                        <!-- HOME ICON -->
                        <button id="btn-home" class="text-gray-200 hover:text-white transition-colors p-2 rounded-full hover:bg-white/10" title="Home (Hold to Reset)">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
                        </button>
                        
                        <div class="h-6 w-px bg-white/20 mx-1"></div>
                        
                        <!-- BLUEPRINT (DARK MODE) ICON -->
                        <button id="btn-blueprint" class="text-gray-200 hover:text-cyan-300 transition-colors p-2 rounded-full hover:bg-white/10" title="Blueprint Mode">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
                        </button>
                        
                        <!-- FULLSCREEN ICON -->
                        <button id="btn-fullscreen" class="text-gray-200 hover:text-green-300 transition-colors p-2 rounded-full hover:bg-white/10" title="Focus Mode">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" /></svg>
                        </button>
                        
                        <!-- CHAT ICON (Kept Lucide for now as no exact SVG in reference, but styled to match) -->
                        <button id="btn-message" class="text-gray-200 hover:text-allgood-primary transition-colors p-2 rounded-full hover:bg-white/10" title="Direct Message HQ" onclick="window.openMessageModal()">
                            <i data-lucide="message-square" class="w-5 h-5"></i>
                        </button>
                        
                        <!-- MENU ICON -->
                        <button id="btn-menu" class="text-gray-200 hover:text-white transition-colors p-2 rounded-full hover:bg-white/10" title="Menu">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                        </button>
                    </div>
                </header>

                <!-- Sidebar Menu -->
                <div id="menu-modal" class="hidden-modal absolute inset-0 z-[100] bg-slate-900/50 flex justify-end modal-transition backdrop-blur-sm">
                    <div class="w-64 h-full bg-white shadow-2xl flex flex-col border-l border-slate-200">
                        <div class="p-5 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                            <span class="font-bold text-slate-700 font-heading uppercase">System Menu</span>
                            <button id="close-menu" class="text-slate-400 hover:text-red-500 transition-colors"><i data-lucide="x" class="w-5 h-5"></i></button>
                        </div>
                        <div class="p-3 space-y-1">
                            <button class="w-full text-left px-4 py-3 rounded-lg hover:bg-slate-100 text-slate-600 font-bold flex items-center transition-colors uppercase" onclick="showStatusMessage('Dashboard Active', 'info')">
                                <i data-lucide="layout-grid" class="w-4 h-4 mr-3 text-allgood-primary"></i>Dashboard
                            </button>
                            <button class="w-full text-left px-4 py-3 rounded-lg hover:bg-slate-100 text-slate-600 font-bold flex items-center transition-colors uppercase" onclick="showStatusMessage('Profile Module: Coming Soon', 'info')">
                                <i data-lucide="user" class="w-4 h-4 mr-3 text-allgood-secondary"></i>My Profile
                            </button>
                            <button class="w-full text-left px-4 py-3 rounded-lg hover:bg-slate-100 text-slate-600 font-bold flex items-center transition-colors uppercase" onclick="window.openAboutModal()">
                                <i data-lucide="info" class="w-4 h-4 mr-3 text-slate-500"></i>About Us
                            </button>
                            <div class="border-t border-slate-100 my-2"></div>
                             <button class="w-full text-left px-4 py-3 rounded-lg hover:bg-red-50 text-red-600 font-bold flex items-center transition-colors uppercase" onclick="window.handleLogout()">
                                <i data-lucide="log-out" class="w-4 h-4 mr-3"></i>Log Out
                            </button>
                        </div>
                        <div class="mt-auto p-4 bg-slate-50 border-t border-slate-200 text-center">
                            <p class="text-xs text-slate-500 font-body">Allgood Academy &copy; 2025</p>
                        </div>
                    </div>
                </div>

                <!-- 4. DASHBOARD CONTENT -->
                <div class="page" id="page-dashboard">
                    
                    <!-- Status Bar -->
                    <div class="flex items-center justify-between bg-white p-4 rounded-lg shadow-md border border-slate-200 mb-6">
                        <div>
                            <h1 class="text-xl font-heading font-bold text-slate-700 uppercase">Welcome, <span class="user-name-display text-allgood-primary">Agent</span>.</h1>
                            <!-- Interactive Badge Row -->
                            <div class="flex items-center mt-2 space-x-3">
                                <div class="text-xs text-slate-500 font-bold uppercase tracking-wide mr-2" id="clearance-label">LEVEL 1: OBSERVER</div>
                                <div id="badge-1" class="w-8 h-8 bg-slate-200 rounded-full flex items-center justify-center text-slate-600 transition-all shadow-sm" onclick="showBadgeInfo(1)">
                                    <i data-lucide="eye" class="w-4 h-4"></i>
                                </div>
                                <div id="badge-2" class="w-8 h-8 bg-allgood-secondary text-white rounded-full flex items-center justify-center transition-all opacity-30 grayscale shadow-badge-locked relative" onclick="showBadgeInfo(2)">
                                    <i data-lucide="id-card" class="w-4 h-4"></i>
                                    <i data-lucide="lock" class="w-3 h-3 absolute -top-1 -right-1 text-slate-400 bg-white rounded-full p-0.5 lock-icon"></i>
                                </div>
                                <div id="badge-3" class="w-8 h-8 bg-allgood-primary text-white rounded-full flex items-center justify-center transition-all opacity-30 grayscale shadow-badge-locked relative" onclick="showBadgeInfo(3)">
                                    <i data-lucide="medal" class="w-4 h-4"></i>
                                    <i data-lucide="lock" class="w-3 h-3 absolute -top-1 -right-1 text-slate-400 bg-white rounded-full p-0.5 lock-icon"></i>
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-4 text-right">
                            <div>
                                <span class="block text-2xl font-bold text-allgood-secondary leading-none">13</span>
                                <span class="text-[10px] uppercase text-slate-400 font-bold">MODULES</span>
                            </div>
                            <div>
                                <span class="block text-2xl font-bold text-emerald-600 leading-none" id="stat-total-launches">0</span>
                                <span class="text-[10px] uppercase text-slate-400 font-bold">LAUNCHED</span>
                            </div>
                        </div>
                    </div>

                    <!-- TAB NAVIGATION -->
                    <div class="flex space-x-2 mb-6 border-b border-slate-200 px-2 overflow-x-auto">
                        <button id="tab-btn-goodblocks" onclick="switchTab('goodblocks')" class="tab-btn active-tab flex items-center px-4 py-3 rounded-t-lg text-sm uppercase">
                            <i data-lucide="box" class="w-4 h-4 mr-2"></i> GOODBLOCKS
                        </button>
                        <button id="tab-btn-games" onclick="switchTab('games')" class="tab-btn inactive-tab flex items-center px-4 py-3 rounded-t-lg text-sm uppercase">
                            <i data-lucide="gamepad-2" class="w-4 h-4 mr-2"></i> GAMES & SIMS
                        </button>
                        <button id="tab-btn-courses" onclick="switchTab('courses')" class="tab-btn inactive-tab flex items-center px-4 py-3 rounded-t-lg text-sm uppercase">
                            <i data-lucide="book-open" class="w-4 h-4 mr-2"></i> COURSES
                        </button>
                    </div>

                    <!-- TAB 1: GOODBLOCKS (ALPHABETIZED) -->
                    <div id="tab-goodblocks" class="tab-content grid grid-cols-1 md:grid-cols-2 gap-4">
                        
                        <!-- 1. Airport Navigator (A) -->
                        <div onclick="window.launchCourse('Airport Navigator', 'https://www.allgoodacademy.com/goodblocks/airport-navigator', this)" 
                             class="mission-file status-ready p-5 flex items-start gap-4 group">
                            <div class="w-16 h-16 bg-sky-50 rounded flex items-center justify-center border border-sky-100 flex-shrink-0 group-hover:bg-sky-100 transition-colors">
                                <i data-lucide="plane" class="w-8 h-8 text-sky-600"></i>
                            </div>
                            <div class="flex-grow">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-slate-800 text-lg mb-1 uppercase">Airport Navigator</h3>
                                    <span class="bg-sky-100 text-sky-700 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">Ready</span>
                                </div>
                                <p class="text-xs text-slate-500 mb-3 leading-relaxed"><strong>Action:</strong> Master the logistical flow from curb to gate with zero friction.</p>
                            </div>
                        </div>

                        <!-- 2. Countdown to Keys (C) -->
                        <div class="mission-file status-locked p-5 flex items-start gap-4 group opacity-50">
                            <div class="w-16 h-16 bg-slate-50 rounded flex items-center justify-center border border-slate-100 flex-shrink-0">
                                <i data-lucide="key" class="w-8 h-8 text-slate-400"></i>
                            </div>
                            <div class="flex-grow">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-slate-500 text-lg mb-1 uppercase">Countdown to Keys</h3>
                                    <span class="bg-slate-200 text-slate-700 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">Coming Soon</span>
                                </div>
                                <p class="text-xs text-slate-500 mb-3 leading-relaxed"><strong>Action:</strong> Execute the 100-day protocol to secure your first home.</p>
                            </div>
                        </div>

                        <!-- 3. Digital Asset Defense (D) -->
                        <div onclick="window.launchCourse('Digital Asset Defense', 'https://www.allgoodacademy.com/goodblocks/digital-asset-defense', this)" 
                             class="mission-file status-ready p-5 flex items-start gap-4 group">
                            <div class="w-16 h-16 bg-blue-50 rounded flex items-center justify-center border border-blue-100 flex-shrink-0 group-hover:bg-blue-100 transition-colors">
                                <i data-lucide="shield-check" class="w-8 h-8 text-blue-600"></i>
                            </div>
                            <div class="flex-grow">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-slate-800 text-lg mb-1 uppercase">Digital Asset Defense</h3>
                                    <span class="bg-blue-100 text-blue-700 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">Ready</span>
                                </div>
                                <p class="text-xs text-slate-500 mb-3 leading-relaxed"><strong>Action:</strong> Secure wealth via wallet protocols and threat avoidance.</p>
                            </div>
                        </div>

                        <!-- 4. Mastering the Sincere Apology (M) -->
                        <div onclick="window.launchCourse('Mastering the Apology', 'https://www.allgoodacademy.com/goodblocks/mastering-the-sincere-apology', this)" 
                             class="mission-file status-ready p-5 flex items-start gap-4 group">
                            <div class="w-16 h-16 bg-emerald-50 rounded flex items-center justify-center border border-emerald-100 flex-shrink-0 group-hover:bg-emerald-100 transition-colors">
                                <i data-lucide="heart-handshake" class="w-8 h-8 text-emerald-600"></i>
                            </div>
                            <div class="flex-grow">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-slate-800 text-lg mb-1 uppercase">Mastering the Apology</h3>
                                    <span class="bg-emerald-100 text-emerald-700 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">Ready</span>
                                </div>
                                <p class="text-xs text-slate-500 mb-3 leading-relaxed"><strong>Action:</strong> Deploy the 4-part structure to de-escalate conflict instantly.</p>
                            </div>
                        </div>

                        <!-- 5. Your Digital Identity (Y) -->
                        <div onclick="window.launchCourse('Your Digital Identity', 'https://www.allgoodacademy.com/goodblocks/your-digital-identity', this)" 
                             class="mission-file status-ready p-5 flex items-start gap-4 group">
                            <div class="w-16 h-16 bg-purple-50 rounded flex items-center justify-center border border-purple-100 flex-shrink-0 group-hover:bg-purple-100 transition-colors">
                                <i data-lucide="fingerprint" class="w-8 h-8 text-purple-600"></i>
                            </div>
                            <div class="flex-grow">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-slate-800 text-lg mb-1 uppercase">Your Digital Identity</h3>
                                    <span class="bg-purple-100 text-purple-700 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">Ready</span>
                                </div>
                                <p class="text-xs text-slate-500 mb-3 leading-relaxed"><strong>Action:</strong> Audit your online footprint and secure your personal perimeter.</p>
                            </div>
                        </div>
                    </div>

                    <!-- TAB 2: GAMES & SIMS (Update Click Handlers) -->
                    <div id="tab-games" class="tab-content grid grid-cols-1 md:grid-cols-2 gap-4 hidden">
                        <!-- 1. Jolene's Lemonade -->
                        <div onclick="window.launchCourse('Jolene\'s Lemonade', 'https://www.allgoodacademy.com/educational-games/jolenes-lemonade-challenge', this)" 
                             class="mission-file status-ready p-5 flex items-start gap-4 group">
                            <div class="w-16 h-16 bg-yellow-50 rounded flex items-center justify-center border border-yellow-100 flex-shrink-0 group-hover:bg-yellow-100 transition-colors">
                                <i data-lucide="store" class="w-8 h-8 text-yellow-600"></i>
                            </div>
                            <div class="flex-grow">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-slate-800 text-lg mb-1 uppercase">Jolene's Lemonade</h3>
                                    <span class="bg-yellow-100 text-yellow-700 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">Ready</span>
                                </div>
                                <p class="text-xs text-slate-500 mb-3 leading-relaxed"><strong>Action:</strong> Manage supply, demand, and profit margins in a live market.</p>
                            </div>
                        </div>

                        <!-- 2. Digital Decisions -->
                        <div onclick="window.launchCourse('Digital Decisions', 'https://www.allgoodacademy.com/educational-games/digital-decisions', this)" 
                             class="mission-file status-active p-5 flex items-start gap-4 group">
                            <div class="w-16 h-16 bg-indigo-50 rounded flex items-center justify-center border border-indigo-100 flex-shrink-0 group-hover:bg-indigo-100 transition-colors">
                                <i data-lucide="smartphone" class="w-8 h-8 text-indigo-600"></i>
                            </div>
                            <div class="flex-grow">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-slate-800 text-lg mb-1 uppercase">Digital Decisions</h3>
                                    <span class="bg-indigo-100 text-indigo-700 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">Active</span>
                                </div>
                                <p class="text-xs text-slate-500 mb-3 leading-relaxed"><strong>Action:</strong> Make high-stakes choices in simulated online conflict scenarios.</p>
                            </div>
                        </div>

                        <!-- 3. Conflict Resolution -->
                        <div onclick="window.launchCourse('Conflict Resolution', 'https://www.allgoodacademy.com/educational-games/conflict-resolution-challenge', this)" 
                             class="mission-file status-ready p-5 flex items-start gap-4 group">
                            <div class="w-16 h-16 bg-red-50 rounded flex items-center justify-center border border-red-100 flex-shrink-0 group-hover:bg-red-100 transition-colors">
                                <i data-lucide="swords" class="w-8 h-8 text-red-600"></i>
                            </div>
                            <div class="flex-grow">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-slate-800 text-lg mb-1 uppercase">Conflict Resolution</h3>
                                    <span class="bg-red-100 text-red-700 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">Ready</span>
                                </div>
                                <p class="text-xs text-slate-500 mb-3 leading-relaxed"><strong>Action:</strong> Identify triggers and neutralize tension in high-stress interactions.</p>
                            </div>
                        </div>

                        <!-- 4. Purposeful Communicator -->
                        <div onclick="window.launchCourse('Purposeful Communicator', 'https://www.allgoodacademy.com/educational-games/purposeful-communicator-challenge', this)" 
                             class="mission-file status-ready p-5 flex items-start gap-4 group">
                            <div class="w-16 h-16 bg-teal-50 rounded flex items-center justify-center border border-teal-100 flex-shrink-0 group-hover:bg-teal-100 transition-colors">
                                <i data-lucide="message-circle" class="w-8 h-8 text-teal-600"></i>
                            </div>
                            <div class="flex-grow">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-slate-800 text-lg mb-1 uppercase">Purposeful Communicator</h3>
                                    <span class="bg-teal-100 text-teal-700 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">Ready</span>
                                </div>
                                <p class="text-xs text-slate-500 mb-3 leading-relaxed"><strong>Action:</strong> Select precise language to drive outcomes and build consensus.</p>
                            </div>
                        </div>

                        <!-- 5. Master Your Story -->
                        <div onclick="window.launchCourse('Master Your Story', 'https://www.allgoodacademy.com/educational-games/master-your-story-challenge', this)" 
                             class="mission-file status-ready p-5 flex items-start gap-4 group">
                            <div class="w-16 h-16 bg-rose-50 rounded flex items-center justify-center border border-rose-100 flex-shrink-0 group-hover:bg-rose-100 transition-colors">
                                <i data-lucide="book-open" class="w-8 h-8 text-rose-600"></i>
                            </div>
                            <div class="flex-grow">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-slate-800 text-lg mb-1 uppercase">Master Your Story</h3>
                                    <span class="bg-rose-100 text-rose-700 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">Ready</span>
                                </div>
                                <p class="text-xs text-slate-500 mb-3 leading-relaxed"><strong>Action:</strong> Craft and deliver a compelling personal narrative for business and life.</p>
                            </div>
                        </div>
                    </div>

                    <!-- TAB 3: COURSES (Update Click Handlers) -->
                    <div id="tab-courses" class="tab-content grid grid-cols-1 md:grid-cols-2 gap-4 hidden">
                        <!-- 1. Pragmatic Learning -->
                        <div onclick="window.launchCourse('Pragmatic Learning', 'https://www.allgoodacademy.com/courses/pragmatic-learning-turning-knowledge-into-action', this)" 
                             class="mission-file status-ready p-5 flex items-start gap-4 group">
                            <div class="w-16 h-16 bg-amber-50 rounded flex items-center justify-center border border-amber-100 flex-shrink-0 group-hover:bg-amber-100 transition-colors">
                                <i data-lucide="brain-circuit" class="w-8 h-8 text-amber-600"></i>
                            </div>
                            <div class="flex-grow">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-slate-800 text-lg mb-1 uppercase">Pragmatic Learning</h3>
                                    <span class="bg-amber-100 text-amber-700 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">Ready</span>
                                </div>
                                <p class="text-xs text-slate-500 mb-3 leading-relaxed"><strong>Action:</strong> Turn passive input into active output. The core philosophy of Allgood Academy.</p>
                            </div>
                        </div>

                        <!-- 2. The Unwritten Rules -->
                        <div onclick="window.launchCourse('The Unwritten Rules', 'https://www.allgoodacademy.com/courses/the-unwritten-rules-navigating-social-emotional-learning', this)" 
                             class="mission-file status-ready p-5 flex items-start gap-4 group">
                            <div class="w-16 h-16 bg-slate-100 rounded flex items-center justify-center border border-slate-200 flex-shrink-0 group-hover:bg-slate-200 transition-colors">
                                <i data-lucide="scale" class="w-8 h-8 text-slate-600"></i>
                            </div>
                            <div class="flex-grow">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-slate-800 text-lg mb-1 uppercase">The Unwritten Rules</h3>
                                    <span class="bg-slate-200 text-slate-700 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">Ready</span>
                                </div>
                                <p class="text-xs text-slate-500 mb-3 leading-relaxed"><strong>Action:</strong> Decode the hidden social contracts that govern professional environments.</p>
                            </div>
                        </div>

                        <!-- 3. The AI Co-Pilot -->
                        <div onclick="window.launchCourse('The AI Co-Pilot', 'https://www.allgoodacademy.com/courses/the-ai-co-pilot-a-15-minute-microlearning-course', this)" 
                             class="mission-file status-ready p-5 flex items-start gap-4 group">
                            <div class="w-16 h-16 bg-cyan-50 rounded flex items-center justify-center border border-cyan-100 flex-shrink-0 group-hover:bg-cyan-100 transition-colors">
                                <i data-lucide="bot" class="w-8 h-8 text-cyan-600"></i>
                            </div>
                            <div class="flex-grow">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-slate-800 text-lg mb-1 uppercase">The AI Co-Pilot</h3>
                                    <span class="bg-cyan-100 text-cyan-700 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">Ready</span>
                                </div>
                                <p class="text-xs text-slate-500 mb-3 leading-relaxed"><strong>Action:</strong> Integrate AI into your workflow in 15 minutes.</p>
                            </div>
                        </div>
                    </div>

                    <!-- FOOTER OS SIGNATURE -->
                    <div class="mt-12 mb-6 text-center">
                        <p class="text-[10px] text-slate-400 font-mono tracking-widest uppercase opacity-60">
                            ALLGOOD OS <span class="mx-2"></span> GOODBLOCK
                        </p>
                    </div>

                <!-- BADGE DETAIL MODAL -->
                <div id="badge-modal" class="hidden-modal absolute inset-0 z-[250] bg-allgood-dark/90 flex items-center justify-center p-6 modal-transition backdrop-blur-sm" onclick="closeBadgeModal()">
                    <div class="bg-white rounded-lg shadow-2xl p-6 max-w-sm w-full text-center border-t-4 border-allgood-primary relative" onclick="event.stopPropagation()">
                        <button onclick="closeBadgeModal()" class="absolute top-2 right-2 text-gray-400 hover:text-red-500"><i data-lucide="x" class="w-5 h-5"></i></button>
                        
                        <div class="mb-4">
                            <h3 id="badge-title" class="text-2xl font-heading font-bold text-allgood-dark uppercase">Level Name</h3>
                            <p id="badge-status" class="text-xs font-bold uppercase tracking-widest mt-1">STATUS</p>
                        </div>
                        
                        <p id="badge-desc" class="text-gray-600 text-sm mb-4 leading-relaxed">Description goes here.</p>
                        
                        <div class="bg-slate-50 p-3 rounded border border-slate-200 text-xs text-slate-500 font-bold">
                            <span id="badge-req">Requirement: ...</span>
                        </div>
                        
                        <button onclick="closeBadgeModal()" class="mt-6 w-full bg-allgood-secondary hover:bg-allgood-accent text-white font-bold py-2 rounded text-sm shadow-md transition-colors uppercase">
                            Continue Mission
                        </button>
                    </div>
                </div>

            </div>

            <!-- ABOUT US MODAL (Relocated to Root Screen Container) -->
            <div id="about-modal" class="hidden-modal absolute inset-0 z-[250] bg-allgood-dark/90 flex items-center justify-center p-6 modal-transition backdrop-blur-sm" onclick="closeAboutModal()">
                <div class="bg-white rounded-lg shadow-2xl p-6 max-w-sm w-full text-center border-t-4 border-allgood-primary relative" onclick="event.stopPropagation()">
                    <button onclick="closeAboutModal()" class="absolute top-2 right-2 text-gray-400 hover:text-red-500 transition-colors"><i data-lucide="x" class="w-5 h-5"></i></button>
                    
                    <div class="mb-6">
                        <h3 class="text-2xl font-heading font-bold text-allgood-dark uppercase tracking-tight">Academy Protocol</h3>
                        <p class="text-[10px] text-gray-400 uppercase tracking-widest font-bold mt-1">Mission Directive</p>
                    </div>
                    
                    <div class="space-y-4">
                        <!-- Card 1: The Lab -->
                        <div class="bg-gray-50 border-l-4 border-allgood-secondary p-4 rounded shadow-sm text-left hover:bg-white hover:shadow-md transition-all group">
                            <div class="flex items-center gap-3 mb-2">
                                <div class="p-2 bg-white rounded-full text-allgood-secondary shadow-sm group-hover:scale-110 transition-transform">
                                    <i data-lucide="flask-conical" class="w-5 h-5"></i>
                                </div>
                                <h4 class="font-bold text-allgood-dark text-sm uppercase tracking-wide">The Lab</h4>
                            </div>
                            <p class="text-gray-600 text-xs leading-relaxed font-body">Allgood Academy is a mission-driven learning hub. We use <span class="font-bold text-allgood-secondary">advanced instructional design</span> principles trusted by top corporations to create immersive, high-impact training.</p>
                        </div>
                        
                        <!-- Card 2: The Result -->
                        <div class="bg-gray-50 border-l-4 border-allgood-primary p-4 rounded shadow-sm text-left hover:bg-white hover:shadow-md transition-all group">
                            <div class="flex items-center gap-3 mb-2">
                                <div class="p-2 bg-white rounded-full text-allgood-primary shadow-sm group-hover:scale-110 transition-transform">
                                    <i data-lucide="zap" class="w-5 h-5"></i>
                                </div>
                                <h4 class="font-bold text-allgood-dark text-sm uppercase tracking-wide">The Result</h4>
                            </div>
                            <p class="text-gray-600 text-xs leading-relaxed font-body">We don't just teach; we transform. Our goal is a complete <span class="font-bold text-allgood-primary">mindset shift</span> that moves learners from passive consumption to pragmatic, real-world execution.</p>
                        </div>
                    </div>
                    
                    <button onclick="closeAboutModal()" class="mt-6 w-full bg-allgood-dark hover:bg-black text-white font-bold py-3 rounded text-xs shadow-md transition-all transform active:scale-95 uppercase tracking-wide flex items-center justify-center gap-2">
                        <i data-lucide="power-off" class="w-3 h-3"></i> Close Protocol
                    </button>
                </div>
            </div>

            <!-- NEW MESSAGE MODAL -->
            <div id="message-modal" class="hidden-modal absolute inset-0 z-[250] bg-allgood-dark/90 flex items-center justify-center p-6 modal-transition backdrop-blur-sm" onclick="closeMessageModal()">
                <div class="bg-white rounded-lg shadow-2xl p-6 max-w-sm w-full text-center border-t-4 border-allgood-primary relative" onclick="event.stopPropagation()">
                    <button onclick="closeMessageModal()" class="absolute top-2 right-2 text-gray-400 hover:text-red-500 transition-colors"><i data-lucide="x" class="w-5 h-5"></i></button>
                    
                    <div class="mb-4">
                        <div class="w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i data-lucide="message-circle" class="w-6 h-6 text-allgood-primary"></i>
                        </div>
                        <h3 class="text-xl font-heading font-bold text-allgood-dark uppercase">Direct Line</h3>
                        <p class="text-[10px] text-gray-400 uppercase tracking-widest font-bold mt-1">To: Allgood Academy HQ</p>
                    </div>
                    
                    <div class="text-left mb-4">
                        <p class="text-xs text-gray-500 italic mb-2">This is a one-way secure transmission. Use this channel to send feedback, topic requests, or field reports.</p>
                        <textarea id="message-input" rows="4" class="w-full border border-gray-300 rounded p-3 text-sm focus:ring-1 focus:ring-allgood-primary focus:border-allgood-primary outline-none resize-none bg-gray-50 font-body placeholder-gray-400" placeholder="Type your message here..."></textarea>
                    </div>
                    
                    <button id="btn-send-message" onclick="window.submitMessage()" class="w-full bg-allgood-primary hover:bg-allgood-hover text-white font-bold py-3 rounded text-xs shadow-md transition-all transform active:scale-95 uppercase tracking-wide flex items-center justify-center gap-2">
                        <i data-lucide="send" class="w-3 h-3"></i> Send Transmission
                    </button>
                </div>
            </div>

        </div>
    </main>

    <script>
        // --- AUDIO ENGINE ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new AudioContext();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume().catch(e => console.error("Audio resume failed:", e));
            }
        }

        // Updated Helper with Envelope Control (Attack/Decay)
        function playTone(freq, type, duration, vol = 0.1, attack = 0.01, decay = 0.001) {
            initAudio();
            const now = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();

            osc.type = type;
            osc.frequency.setValueAtTime(freq, now);
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            gain.gain.setValueAtTime(0, now);
            gain.gain.linearRampToValueAtTime(vol, now + attack);
            gain.gain.exponentialRampToValueAtTime(decay, now + duration);

            osc.start(now);
            osc.stop(now + duration);
        }

        const sfx = {
            tick: () => {
                initAudio();
                playTone(1000, 'sine', 0.01, 0.01);
            },
            click: () => {
                initAudio();
                playTone(1000, 'sine', 0.01, 0.01);
            },
            confirm: () => {
                initAudio();
                playTone(150, 'sine', 0.1, 0.1, 0.01, 0.01);
            },
            powerOn: () => {
                initAudio();
                const now = audioCtx.currentTime;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.type = 'triangle'; // Use triangle wave for sweeping effect
                osc.frequency.setValueAtTime(110, now);
                osc.frequency.exponentialRampToValueAtTime(220, now + 0.4);
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(0.4, now + 0.1);
                gain.gain.linearRampToValueAtTime(0, now + 0.4);
                osc.start(now); osc.stop(now + 0.4);
            },
            powerOff: () => {
                initAudio();
                playTone(80, 'triangle', 0.2, 0.5, 0.01, 0.001);
            },
            nav: () => {
                initAudio();
                playTone(200, 'sine', 0.08, 0.1, 0.01, 0.01);
            },
        };

        // --- TAB LOGIC ---
        window.switchTab = (tabName) => {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            const target = document.getElementById('tab-' + tabName);
            if(target) target.classList.remove('hidden');
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active-tab');
                btn.classList.add('inactive-tab');
            });
            const activeBtn = document.getElementById('tab-btn-' + tabName);
            if(activeBtn) {
                activeBtn.classList.remove('inactive-tab');
                activeBtn.classList.add('active-tab');
            }
            sfx.nav(); 
        };

        // --- DOM LOAD & INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            
            // Initialization Logic
            window.restoreSessionState(); 
            window.initDashboard();

            // Startup Screen
            const startupScreen = document.getElementById('startup-screen');
            const loginModal = document.getElementById('login-modal');
            const dashboard = document.getElementById('page-dashboard');
            const fullscreenBtn = document.getElementById('btn-fullscreen');

            if (startupScreen) {
                startupScreen.style.display = 'flex';
                startupScreen.style.opacity = '1';
                
                // Warm up audio
                const warmUp = () => initAudio();
                startupScreen.addEventListener('mousedown', warmUp, { once: true });
                startupScreen.addEventListener('touchstart', warmUp, { once: true });
                
                startupScreen.addEventListener('click', () => {
                    sfx.powerOn(); 
                    startupScreen.style.opacity = '0';
                    
                    const storedUID = localStorage.getItem('aa_uid');
                    const storedName = localStorage.getItem('aa_username');
                    
                    if (storedName && storedUID) {
                        window.restoreSessionState();
                        window.initDashboard(); 
                    } else if (loginModal) {
                        loginModal.classList.remove('hidden-modal');
                        loginModal.classList.add('visible-modal');
                    }
                    
                    setTimeout(() => { startupScreen.style.display = 'none'; }, 700);
                });
            }

            if (dashboard) dashboard.style.display = 'none';
            
            // UPDATED STARTUP MESSAGE LOGIC
            const storedName = localStorage.getItem('aa_username');
            const startupMsg = document.getElementById('startup-message');
            
            if (storedName && storedName !== 'Guest') {
                startupMsg.textContent = `CLICK TO POWER UP, ${storedName.toUpperCase()}`;
            } else {
                startupMsg.textContent = "CLICK TO POWER UP";
            }

            // Button Listeners
            const homeBtn = document.getElementById('btn-home');
            let homePressTimer;
            let homeIsHold = false;
            const startHomePress = (e) => {
                e.preventDefault(); 
                homeIsHold = false;
                homePressTimer = setTimeout(() => {
                    homeIsHold = true;
                    if(window.handleLogout) { sfx.powerOff(); window.handleLogout(); }
                }, 2000);
            };
            const endHomePress = (e) => {
                clearTimeout(homePressTimer);
                if(!homeIsHold) { sfx.tick(); document.getElementById('page-dashboard').scrollTop = 0; }
            };

            if(homeBtn) {
                homeBtn.addEventListener('mousedown', startHomePress);
                homeBtn.addEventListener('touchstart', startHomePress);
                homeBtn.addEventListener('mouseup', endHomePress);
                homeBtn.addEventListener('touchend', endHomePress);
                homeBtn.addEventListener('mouseleave', () => clearTimeout(homePressTimer));
            }

            document.getElementById('btn-blueprint').addEventListener('click', () => {
                document.body.classList.toggle('blueprint-mode');
                sfx.tick();
            });

            if(fullscreenBtn) {
                fullscreenBtn.addEventListener('click', () => {
                    const body = document.body;
                    // Removed icon swapping logic to support static SVG
                    if (body.classList.contains('focus-mode')) {
                        body.classList.remove('focus-mode');
                        // Visual toggle for active state
                        fullscreenBtn.classList.remove('text-green-300', 'bg-white/10');
                    } else {
                        body.classList.add('focus-mode');
                        fullscreenBtn.classList.add('text-green-300', 'bg-white/10');
                    }
                    lucide.createIcons();
                    sfx.tick();
                });
            }

            const menuModal = document.getElementById('menu-modal');
            document.getElementById('btn-menu').addEventListener('click', () => {
                menuModal.classList.remove('hidden-modal');
                menuModal.classList.add('visible-modal');
                sfx.tick();
            });

            document.getElementById('close-menu').addEventListener('click', () => {
                menuModal.classList.add('hidden-modal');
                menuModal.classList.remove('visible-modal');
                sfx.tick();
            });
        });

        window.openAboutModal = () => {
            // Close the system menu first to prevent double-backdrop overlap
            const menu = document.getElementById('menu-modal');
            if (menu) {
                menu.classList.add('hidden-modal');
                menu.classList.remove('visible-modal');
            }

            const modal = document.getElementById('about-modal');
            modal.classList.remove('hidden-modal');
            modal.classList.add('visible-modal');
            sfx.click();
        }

        window.closeAboutModal = () => {
            const modal = document.getElementById('about-modal');
            modal.classList.add('hidden-modal');
            modal.classList.remove('visible-modal');
            sfx.click();
        }
    </script>
</body>
</html>
