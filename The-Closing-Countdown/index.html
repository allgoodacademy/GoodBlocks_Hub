<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Viewport Lock: user-scalable=no helps prevent accidental zooming that breaks layout -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Jonathan Hurtado’s Countdown to Keys: The 100-Day Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Font Awesome (Legacy Support) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    
    <!-- BRAND INTEGRATION: Google Fonts for Jonathan's Brand Look-alikes -->
    <!-- Tenor Sans (~Black Mango), Outfit (~Kollektif) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700&family=Tenor+Sans&display=swap" rel="stylesheet">

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Allgood System Colors
                        'allgood-primary': '#D34716',   
                        'allgood-secondary': '#357889', 
                        'allgood-dark': '#4C4C4C',      
                        'allgood-light': '#F7F7F7',      
                        'allgood-hover': '#EB8D69',      
                        'allgood-accent': '#2D6473',
                        
                        // Jonathan's Brand Colors (Scoped)
                        'jonathan-navy': '#192f51',
                        'jonathan-orange': '#d25d23',
                    },
                    fontFamily: {
                        'heading': ['Georgia', 'serif'], // System Heading
                        'body': ['Verdana', 'sans-serif'], // System Body
                        
                        // Jonathan's Brand Fonts
                        'j-heading': ['"Tenor Sans"', 'sans-serif'],
                        'j-body': ['"Outfit"', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    
    <style>
        /* ==========================================================================
           FIXED CHASSIS MANDATE - DO NOT EDIT BELOW THIS LINE
           Core styles for the GoodBlock shell, animations, and responsiveness.
           ========================================================================== 
        */
        body {
            font-family: Verdana, sans-serif;
            /* BRAND INTEGRATION: "The Surveyor's Grid" Theme (Deep Navy Base) */
            background-color: #192f51; /* Jonathan's Navy */
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 40px 40px; /* Precise grid */
            background-attachment: fixed;
            min-height: 100vh;
            position: relative;
            margin: 0;
            padding: 0;
        }

        /* SYSTEM FONTS (Navbar, Footer, Modals) remain Georgia/Verdana */
        h1, h2, h3, h4, h5, h6 { font-family: Georgia, serif; }

        /* CONTENT SCOPING: Apply Jonathan's Fonts & Colors INSIDE the lesson pages only */
        .page h1, .page h2, .page h3, .page h4 {
            font-family: 'Tenor Sans', sans-serif !important;
            color: #192f51; /* Default headers to Navy inside pages */
        }
        
        .page p, .page li, .page span, .page div, .page button {
            font-family: 'Outfit', sans-serif !important;
        }

        /* Exception: Utility classes that explicitly set text color should override the default */
        .page .text-allgood-primary { color: #D34716 !important; }
        .page .text-white { color: #ffffff !important; }
        
        /* BRAND INTEGRATION: Custom Primary Button for Content */
        .jonathan-btn {
            background-color: #d25d23 !important; /* Jonathan Orange */
        }
        .jonathan-btn:hover {
            background-color: #b54915 !important;
        }

        @keyframes pulse-glow {
            0%, 100% { 
                text-shadow: 0 0 10px rgba(211, 71, 22, 0.4); 
                transform: scale(1);
            }
            50% { 
                text-shadow: 0 0 30px rgba(211, 71, 22, 0.9), 0 0 15px rgba(211, 71, 22, 0.6); 
                transform: scale(1.02);
            }
        }
        
        /* Keep the animation class available but unused for logo */
        .animate-pulse-glow {
            animation: pulse-glow 2.5s infinite ease-in-out;
            will-change: transform, text-shadow;
        }

        /* NEW: Static Neon Glow for Logos (No Pulse) */
        .static-neon-glow {
            text-shadow: 
                0 0 5px rgba(211, 71, 22, 0.2),
                0 0 10px rgba(211, 71, 22, 0.4),
                0 0 20px rgba(211, 71, 22, 0.6);
        }

        /* Narrative Pop Animation */
        @keyframes pop-in {
            0% { transform: scale(0.98); opacity: 0.9; }
            50% { transform: scale(1.01); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .narrator-speaking {
            animation: pop-in 0.3s ease-out forwards;
        }

        /* --- TABLET FRAME (FIXED CHASSIS MANDATE) --- */
        .tablet-frame {
            height: 80vh;
            width: auto;
            aspect-ratio: 16/10;
            max-width: 1100px;
            max-height: 95vh;
            min-height: 0;
            min-width: 0;
            background-image: 
                radial-gradient(circle at 0% 0%, rgba(211, 71, 22, 0.35) 0%, transparent 30%),
                radial-gradient(circle at 100% 100%, rgba(211, 71, 22, 0.35) 0%, transparent 30%),
                linear-gradient(135deg, #5c5c5c 0%, #d6d6d6 25%, #8a8a8a 50%, #e0e0e0 75%, #5c5c5c 100%);
            border-radius: 12px;
            padding: 12px; 
            box-shadow: 
                inset 1px 1px 2px rgba(255,255,255, 0.6), 
                inset -1px -1px 2px rgba(0,0,0, 0.8), 
                0 30px 60px -12px rgba(0, 0, 0, 0.8), 
                0 0 0 1px #111;
            border: 1px solid #333;
            position: relative;
            margin: 20px auto;
            transition: width 0.3s, height 0.3s, padding 0.3s;
        }

        .tablet-frame::before {
            content: ''; position: absolute; top: 10px; left: 10px; right: 10px; bottom: 10px;
            border-radius: 6px; background: #111; z-index: 0;
        }

        .screen-container {
            width: 100%; height: 100%; background-color: #F7F7F7;
            position: relative; z-index: 1; overflow: hidden;
            display: flex; flex-direction: column; 
            border-radius: 4px; box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }

        /* --- SCROLLBARS --- */
        .page::-webkit-scrollbar { width: 14px; }
        .page::-webkit-scrollbar-track { background: #e5e5e5; border-left: 1px solid #d1d5db; }
        .page::-webkit-scrollbar-thumb { background-color: #D34716; border-radius: 7px; border: 3px solid #e5e5e5; }
        .page::-webkit-scrollbar-thumb:hover { background-color: #EB8D69; }

        /* --- MODALS --- */
        .modal-transition { transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out; }
        .hidden-modal { opacity: 0; pointer-events: none; transform: translateY(-10px); }
        .visible-modal { opacity: 1; pointer-events: auto; transform: translateY(0); }
        
        /* --- PROGRESS BAR --- */
        #flex-progress-bar { height: 4px; width: 100%; background-color: #eee; position: absolute; top: 0; left: 0; }
        #flex-progress-fill { height: 100%; background-color: #D34716; width: 0%; transition: width 0.3s ease; }

        /* --- BLUEPRINT MODE --- */
        .blueprint-mode { background-color: #0f172a !important; color: #94a3b8 !important; }
        .blueprint-mode .page { background-color: #0f172a !important; }
        .blueprint-mode h1, .blueprint-mode h2, .blueprint-mode h3, .blueprint-mode strong { color: #38bdf8 !important; }
        .blueprint-mode .bg-white { background-color: #1e293b !important; border-color: #334155 !important; color: #cbd5e1 !important; }
        .blueprint-mode .text-allgood-dark { color: #e2e8f0 !important; }
        .blueprint-mode .bg-gray-100, .blueprint-mode .bg-gray-50, .blueprint-mode .bg-gray-50 { background-color: #0f172a !important; border-color: #1e293b !important; }
        .blueprint-mode .accordion-content { background-color: #0f172a !important; border-color: #334155 !important; color: #94a3b8 !important; }
        .blueprint-mode .footer-content { background-color: #1e293b !important; border-top-color: #334155 !important; color: #94a3b8 !important; }
        .blueprint-mode .footer-content a { color: #38bdf8 !important; }
        .blueprint-mode .footer-content #back-button { color: #94a3b8 !important; }
        .blueprint-mode .footer-content #back-button:not(:disabled):hover { color: #38bdf8 !important; }

        /* --- FOCUS MODE --- */
        .tablet-frame.focus-mode { 
            position: absolute !important; top: 0 !important; left: 0 !important; right: 0 !important; bottom: 0 !important; 
            width: 100% !important; height: 100% !important;
            aspect-ratio: auto !important; max-width: none !important; max-height: none !important; 
            min-height: 0 !important;
            margin: 0 !important; padding: 0 !important; 
            background: #F7F7F7 !important; border: none !important; border-radius: 0 !important; 
            box-shadow: none !important; z-index: 99999 !important;
            background-image: none !important;
        }
        .tablet-frame.focus-mode::before { display: none; }
        .tablet-frame.focus-mode .screen-container { border-radius: 0; box-shadow: none; height: 100%; }
        .tablet-frame.focus-mode .footer-content { padding-bottom: 0; }
        body.is-focused main { padding: 0 !important; }

        /* --- MOBILE LAYOUT LOCK (RIGOROUS iOS FIX) --- */
        @media (max-width: 768px) {
            html, body {
                width: 100%;
                height: 100%; /* Fallback */
                margin: 0;
                padding: 0 !important;
                overflow: hidden !important; /* Stop the document itself from scrolling */
                position: fixed; /* Physically pin the document */
                inset: 0;
                overscroll-behavior: none; /* Stop rubber-banding */
            }
            
            main { 
                /* The MAIN container now acts as the viewport */
                width: 100vw; 
                height: 100dvh; /* Dynamic viewport height */
                /* Fallback for browsers not supporting dvh */
                height: -webkit-fill-available; 
                position: fixed;
                inset: 0;
                padding: 0 !important; 
                display: flex;
                flex-direction: column;
                z-index: 0;
            }
            
            .tablet-frame {
                /* Strip away the tablet appearance, become a flex container */
                position: relative !important; 
                width: 100% !important; 
                height: 100% !important;
                max-width: none !important; max-height: none !important;
                min-height: 0 !important; aspect-ratio: auto !important;
                margin: 0 !important; padding: 0 !important;
                border: none !important; border-radius: 0 !important;
                background-image: none !important; box-shadow: none !important;
                display: flex;
                flex-direction: column;
            }
            
            .tablet-frame::before { display: none; }
            
            .screen-container { 
                flex: 1; /* Grow to fill all available vertical space */
                width: 100%;
                height: 100%;
                display: flex;
                flex-direction: column;
                border-radius: 0 !important; 
                box-shadow: none !important; 
                overflow: hidden; /* Don't let this container scroll */
            }
            
            /* THE BUNS: Fixed Height Items */
            .navbar-content {
                flex: 0 0 auto; /* Do not grow or shrink */
                width: 100%;
                z-index: 50;
                padding-top: max(env(safe-area-inset-top), 5px);
            }
            
            #narrator-strip {
                flex: 0 0 auto;
                width: 100%;
                z-index: 40;
            }
            
            .footer-content { 
                flex: 0 0 auto; /* Do not grow or shrink */
                width: 100%;
                z-index: 100; /* Highest Z-index to sit on top */
                padding-bottom: max(env(safe-area-inset-bottom), 15px); 
                background-color: white;
                border-top: 1px solid #e5e7eb;
                position: relative; /* Ensure stacking context */
            }

            /* THE MEAT: Scrolling Content */
            .page {
                flex: 1 1 auto; /* Grow to occupy remaining space */
                overflow-y: auto; /* Internal vertical scrollbar */
                -webkit-overflow-scrolling: touch; /* Momentum scrolling */
                height: 100%; 
                min-height: 0; /* Crucial for nested flex scrolling */
                padding-bottom: 40px; /* Extra space for scroll clearance */
            }
        }

        /* --- LAYOUT --- */
        .navbar-content { flex: 0 0 60px; z-index: 20; }
        /* Flow: Aim for no scrolling within this element. */
        .page { flex: 1 1 auto; overflow-y: auto; padding: 20px; position: relative; display: none; width: 100%; }
        .page.active { display: block; }
        .footer-content { flex: 0 0 60px; z-index: 20; background-color: white; border-top: 1px solid #e5e7eb; position: relative; }
        
        /* ==========================================================================
           END FIXED CHASSIS STYLES
           Variable Content Styles follow below.
           ========================================================================== 
        */

        /* Custom Styles for Jonathan's Guide Interactions */
        .profile-card { transition: all 0.3s; cursor: pointer; border: 2px solid transparent; }
        .profile-card.selected { border-color: #D34716; background-color: #fff7ed; transform: translateY(-2px); box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        
        /* FLIP CARD STYLES - RESTORED PER-CARD COLORS */
        .flip-card { background-color: transparent; width: 100%; height: 160px; perspective: 1000px; cursor: pointer; }
        .flip-card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; }
        .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
        .flip-card-front, .flip-card-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 1rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .flip-card-front { background-color: white; border: 1px solid #e5e7eb; }
        /* Note: Removed global .flip-card-back override to allow utility classes (bg-allgood-primary, etc.) to work */
        .flip-card-back { color: white; transform: rotateY(180deg); border: 1px solid transparent; }

        /* Custom UI for Decisions */
        .decision-card { border: 2px solid #e5e7eb; transition: all 0.2s; }
        .decision-card:hover { border-color: #357889; transform: translateY(-1px); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .decision-card.pass { border-color: #10b981; background-color: #f0fdf4; }
        .decision-card.fail { border-color: #ef4444; background-color: #fef2f2; }
        
        /* Drag and Drop Styles */
        .draggable { cursor: grab; }
        .draggable:active { cursor: grabbing; }
        .drop-zone { transition: all 0.3s; }
        .drop-zone.drag-over { background-color: #e0f2fe; border-color: #357889; transform: scale(1.02); }

        /* --- PERMANENT NARRATOR STRIP (GLASS UPDATE) --- */
        #narrator-strip {
            /* Glass Effect */
            background: rgba(255, 255, 255, 0.9); /* High opacity white */
            backdrop-filter: saturate(120%) blur(10px); /* The "Frost" */
            -webkit-backdrop-filter: saturate(120%) blur(10px); /* Safari support */
            
            /* Depth & Separation */
            border-bottom: 1px solid rgba(255, 255, 255, 0.6); /* Subtle reflection */
            box-shadow: 
                0 4px 6px -1px rgba(0, 0, 0, 0.02), /* Tiny structural shadow */
                0 10px 15px -3px rgba(211, 71, 22, 0.08); /* Allgood Orange glow */
            
            /* Layout adjustments */
            padding: 12px 16px;
            display: none; /* Hidden by default */
            align-items: center; /* Vertically center */
            gap: 16px;
            width: 100%;
            z-index: 40;
            transition: all 0.3s ease;
        }

        #narrator-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            /* AVATAR UPGRADE */
            border: 2px solid white; /* Inner white definition */
            box-shadow: 
                0 0 0 2px #D34716, /* Brand Primary Ring */
                0 4px 6px rgba(0,0,0,0.1); /* Lift off the glass */
            flex-shrink: 0;
            /* INTERACTIVITY UPGRADE */
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        #narrator-avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 0 0 3px #D34716, 0 6px 12px rgba(211, 71, 22, 0.2);
        }

        #narrator-message {
            font-family: Verdana, sans-serif;
            font-size: 0.85rem;
            /* TEXT UPGRADE */
            color: #1f2937; /* Darker, richer gray for contrast */
            font-weight: 500; /* Slightly bolder */
            text-shadow: 0 1px 0 rgba(255,255,255,0.5); /* Engraved look */
            font-style: italic;
            line-height: 1.4;
            flex-grow: 1;
        }

        /* Responsive adjustment for small screens */
        @media (max-width: 640px) {
            #narrator-strip {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            #narrator-avatar {
                width: 32px;
                height: 32px;
            }
            #narrator-message {
                font-size: 0.8rem;
            }
        }

        /* Blueprint Mode Override for Strip */
        .blueprint-mode #narrator-strip {
            background-color: #1e293b !important;
            border-bottom-color: #334155 !important;
        }
        .blueprint-mode #narrator-message { color: #94a3b8 !important; }
        .blueprint-mode #narrator-avatar { border-color: #334155 !important; }

        /* --- STRATEGY CARDS & TABS (New) --- */
        .strategy-pill {
            transition: all 0.2s ease;
        }
        .strategy-pill:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .tab-btn.active {
            position: relative;
        }
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: #D34716; /* match allgood-primary */
        }

        /* --- MOTIVATION ANCHOR PILLS (Fixed for Mobile Clipping) --- */
        .anchor-pill {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        .anchor-pill:hover, .anchor-pill.active {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            filter: brightness(1.02);
            z-index: 50; 
        }
        
        /* TOOLTIP LOGIC UPDATE: Mobile-Optimized */
        .anchor-tooltip {
            opacity: 0;
            visibility: hidden;
            transform: translateY(8px) translateX(-50%);
            transition: all 0.2s ease-out;
            position: absolute;
            bottom: 100%;
            left: 50%;
            z-index: 50;
            pointer-events: none;
            width: max-content;
            max-width: 240px;
        }

        /* DESKTOP ONLY: Show floating tooltip */
        @media (min-width: 769px) {
            .anchor-pill:hover .anchor-tooltip,
            .anchor-pill.active .anchor-tooltip {
                opacity: 1;
                visibility: visible;
                transform: translateY(-8px) translateX(-50%);
            }
        }

        /* MOBILE ONLY: Hide tooltip completely to rely on Narrator Strip */
        @media (max-width: 768px) {
            .anchor-tooltip {
                display: none !important;
            }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen text-allgood-dark font-body overflow-y-auto">

    <main class="flex-grow flex items-center justify-center py-8">
        <div class="tablet-frame">
            <div class="screen-container" id="screen">

                <!-- 
                    ==========================================================================
                    FIXED CHASSIS START: Startup Screen
                    ========================================================================== 
                -->
                <div id="startup-screen" class="absolute inset-0 z-[300] flex flex-col items-center justify-center cursor-pointer transition-opacity duration-700 ease-in-out bg-gradient-to-br from-allgood-secondary to-allgood-accent">
                    <div class="group flex flex-col items-center justify-center text-center h-full w-full relative">
                        <div class="flex-grow flex flex-col items-center justify-center px-4">
                            <div class="relative flex flex-col items-center">
                                <div class="absolute inset-0 bg-white/10 blur-2xl rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                                
                                <!-- HEADSHOT ADDITION -->
                                <div class="mb-6 relative z-10 transition-transform duration-500 group-hover:scale-105">
                                    <img 
                                        src="https://github.com/allgoodacademy/ImageAndAssets/blob/main/J.Hurtado_HeadShot.jpg?raw=true" 
                                        alt="Jonathan Hurtado" 
                                        class="w-24 h-24 rounded-full object-cover border-4 border-white/30 shadow-xl"
                                    >
                                </div>

                                <h2 class="text-xl md:text-3xl font-heading font-bold text-white mb-2 relative z-10">Jonathan Hurtado's Countdown to Keys</h2>
                                <!-- CHANGED: Replaced animate-pulse-glow with static-neon-glow -->
                                <h1 class="text-4xl md:text-6xl font-heading font-bold text-allgood-primary tracking-tighter relative z-10 drop-shadow-md static-neon-glow">GoodBlock</h1>
                            </div>
                            <p class="mt-12 text-white/80 text-xs tracking-[0.3em] uppercase font-medium group-hover:text-white transition-colors animate-pulse font-body">Click to Power Up</p>
                        </div>
                        <div class="absolute bottom-10 w-full text-center">
                            <p class="text-white/40 text-xs font-body tracking-wide">
                                Powered by the 
                                <a href="https://www.allgoodacademy.com" target="_blank" class="font-bold hover:text-white transition-colors">Allgood Academy</a>
                            </p>
                        </div>
                    </div>
                </div>
                <!-- FIXED CHASSIS END: Startup Screen -->

                <!-- 
                    ==========================================================================
                    FIXED CHASSIS START: Header & Navigation
                    ========================================================================== 
                -->
                <header class="bg-allgood-secondary shadow-md navbar-content flex items-center z-30 relative">
                    <div class="w-full px-4 flex items-center justify-between h-full">
                        <div class="flex items-center overflow-hidden">
                            <div id="header-welcome-text" class="flex-shrink-0 text-white font-heading font-bold text-lg tracking-tight truncate mr-4 select-none">Welcome: Learner</div>
                            <div class="hidden sm:flex items-center bg-black/20 rounded-full px-3 py-1 border border-white/10 shadow-inner backdrop-blur-sm">
                                <span class="text-[10px] uppercase tracking-wider text-white/60 mr-2 font-heading font-bold">Page</span>
                                <span id="header-page-indicator" class="text-xs font-bold text-white font-body tabular-nums">1 / 28</span>
                            </div>
                        </div>
                        <div class="flex items-center space-x-1 shrink-0 relative">
                            <button id="home-button" class="text-gray-200 hover:text-white transition-colors p-2 rounded-full hover:bg-white/10"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg></button>
                            <div class="h-6 w-px bg-white/20 mx-1"></div>
                            <button id="blueprint-toggle" class="text-gray-200 hover:text-cyan-300 transition-colors p-2 rounded-full hover:bg-white/10"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg></button>
                            <button id="fullscreen-toggle" class="text-gray-200 hover:text-green-300 transition-colors p-2 rounded-full hover:bg-white/10"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" /></svg></button>
                            <button id="menu-toggle" class="text-gray-200 hover:text-white transition-colors p-2 rounded-full hover:bg-white/10"><svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg></button>
                        </div>
                    </div>
                </header>
                <!-- FIXED CHASSIS END: Header -->

                <!-- NARRATOR STRIP (Permanent Implementation) -->
                <div id="narrator-strip">
                    <img src="https://github.com/allgoodacademy/ImageAndAssets/blob/main/J.Hurtado_HeadShot.jpg?raw=true" alt="Jonathan" id="narrator-avatar">
                    <div id="narrator-message"></div>
                </div>

                <!-- 
                    ==========================================================================
                    FIXED CHASSIS START: Modals (Login & Menu)
                    ========================================================================== 
                -->
                <div id="login-modal" class="absolute inset-0 z-[200] bg-allgood-dark/95 flex items-center justify-center p-6 visible-modal modal-transition">
                    <div class="bg-white rounded-lg shadow-2xl p-8 max-w-sm w-full text-center border-t-4 border-allgood-primary">
                        <div class="mb-6"><h2 class="text-3xl font-heading font-bold text-allgood-dark">Allgood<span class="text-allgood-primary">Academy</span></h2></div>
                        <h2 class="text-xl font-bold text-allgood-dark mb-2 font-heading">Welcome</h2>
                        <div class="flex items-center justify-center gap-2 mb-6 relative">
                            <p class="text-gray-500 text-sm font-body">Please sign in to start.</p>
                            <button id="policy-trigger" class="group relative flex items-center text-allgood-primary hover:text-allgood-hover transition-colors focus:outline-none">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                                <span class="text-xs font-bold underline decoration-dotted underline-offset-2">Why?</span>
                                <div class="absolute top-full left-1/2 transform -translate-x-1/2 mt-3 w-64 p-3 bg-gray-800 text-white text-xs text-left rounded shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible group-focus:opacity-100 group-focus:visible transition-all duration-200 z-50 font-body leading-relaxed border border-gray-700 pointer-events-none">
                                    <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-800"></div>
                                    <strong class="block text-allgood-primary mb-1 uppercase tracking-wide text-[10px]">Why do we ask?</strong>
                                    <p class="mb-2 text-gray-300">We use your name to personalize your badge. Performance data is logged in real-time to improve the GoodBlock experience. All personal data is kept confidential and never sold.</p>
                                    <div class="border-t border-gray-700 my-1 pt-1"></div>
                                    <p class="text-gray-300"><strong>Email (Optional):</strong> Enter to join the Allgood Academy community.</p>
                                </div>
                            </button>
                        </div>
                        <input type="text" id="user-name-input" placeholder="Your Name (Optional)" class="w-full border border-gray-300 rounded p-3 mb-3 focus:ring-2 focus:ring-allgood-primary focus:border-transparent outline-none transition-all font-body">
                        <input type="email" id="user-email-input" placeholder="Your Email (Optional)" class="w-full border border-gray-300 rounded p-3 mb-6 focus:ring-2 focus:ring-allgood-primary focus:border-transparent outline-none transition-all font-body">
                        <button id="start-session-btn" class="w-full bg-allgood-primary hover:bg-allgood-hover text-white font-bold py-3 rounded shadow-md transition-transform transform hover:scale-[1.02] active:scale-[0.98] font-body">Start GoodBlock</button>
                    </div>
                </div>

                <div id="menu-modal" class="hidden-modal absolute inset-0 z-[100] bg-black/60 flex justify-end modal-transition">
                    <div class="w-72 h-full bg-white shadow-xl flex flex-col border-l border-gray-200">
                        <div class="p-4 border-b border-gray-200 flex justify-between items-center bg-gray-50">
                            <span class="font-bold text-allgood-dark font-heading">Jump to Page</span>
                            <button id="close-menu" class="text-gray-500 hover:text-allgood-primary"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
                        </div>
                        <div class="p-2 overflow-y-auto flex-grow space-y-1 text-sm font-body" id="toc-list">
                            <!-- Table of Contents injected via JS -->
                        </div>
                    </div>
                </div>

                <!-- QUESTION MODAL (New) -->
                <div id="question-modal" class="hidden-modal absolute inset-0 z-[150] bg-black/50 flex items-center justify-center p-4 modal-transition backdrop-blur-sm">
                    <div class="bg-white rounded-lg shadow-2xl p-6 max-w-sm w-full border-t-4 border-allgood-secondary relative overflow-hidden">
                        
                        <!-- Input State -->
                        <div id="question-input-view">
                            <div class="flex items-center gap-3 mb-4">
                                <img src="https://github.com/allgoodacademy/ImageAndAssets/blob/main/J.Hurtado_HeadShot.jpg?raw=true" class="w-10 h-10 rounded-full border border-gray-200 shadow-sm object-cover">
                                <div>
                                    <h3 class="font-heading font-bold text-allgood-secondary text-lg">Ask Jonathan</h3>
                                    <p class="text-[10px] text-gray-500 font-body">Stuck? Send a quick question.</p>
                                </div>
                            </div>
                            
                            <textarea id="question-text" rows="4" class="w-full border border-gray-300 rounded-md p-3 text-sm font-body focus:ring-1 focus:ring-allgood-secondary focus:border-allgood-secondary outline-none resize-none bg-gray-50 mb-4" placeholder="Type your question here..."></textarea>
                            
                            <div class="flex gap-2 justify-end">
                                <button onclick="closeQuestionModal()" class="px-4 py-2 text-gray-500 hover:text-gray-700 text-xs font-bold font-body transition-colors">Cancel</button>
                                <button onclick="submitQuestion()" class="bg-allgood-secondary hover:bg-allgood-accent text-white px-4 py-2 rounded shadow-md text-xs font-bold font-body transition-transform transform active:scale-95 flex items-center gap-2">
                                    <span>Send</span>
                                    <i data-lucide="send" class="w-3 h-3"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Success State (Hidden) -->
                        <div id="question-success-view" class="hidden flex-col items-center justify-center py-4 text-center animate-pop-in">
                            <div class="w-12 h-12 bg-emerald-100 rounded-full flex items-center justify-center mb-3 text-emerald-600">
                                <i data-lucide="check" class="w-6 h-6"></i>
                            </div>
                            <h3 class="font-heading font-bold text-allgood-dark mb-1">Question Sent</h3>
                            <p class="text-xs text-gray-500 font-body">Jonathan will review it shortly.</p>
                        </div>

                    </div>
                </div>
                <!-- FIXED CHASSIS END: Modals -->

                <!-- 
                    ==========================================================================
                    VARIABLE CONTENT ZONE START
                    ========================================================================== 
                -->
                <!-- Page 1: Cover (Launchpad) -->
                <div class="page active" id="page-1">
                    <div class="flex flex-col items-center justify-center min-h-full py-10 text-center px-6">
                        
                        <!-- Headshot Avatar -->
                        <div class="mb-6 relative group">
                            <div class="absolute -inset-1 bg-gradient-to-r from-allgood-primary to-allgood-secondary rounded-xl opacity-25 blur transition duration-500 group-hover:opacity-50"></div>
                            <img 
                                src="https://github.com/allgoodacademy/ImageAndAssets/blob/main/Jonathan_Headshot_Branded.png?raw=true" 
                                alt="Jonathan Hurtado" 
                                class="relative w-32 h-32 rounded-xl object-cover border-4 border-white shadow-lg mx-auto"
                            >
                        </div>

                        <div class="mb-4"><h2 class="text-xl font-bold text-jonathan-navy">Jonathan Hurtado's Buyer's Guide</h2></div>
                        <h1 class="text-4xl sm:text-5xl font-bold text-jonathan-navy mb-12 leading-tight">Countdown to Keys:<br><span class="text-jonathan-orange">The 100-Day Challenge</span></h1>
                        
                        <!-- BRAND INTEGRATION: Use Jonathan's Orange for this specific CTA -->
                        <button onclick="nextPage()" class="jonathan-btn text-white font-bold py-4 px-10 rounded-full shadow-lg transition-all transform hover:scale-105 animate-pulse mb-12 text-lg">
                            Start Phase 1
                        </button>

                        <!-- FIXED ELEMENT: How To Use Accordion -->
                        <div class="w-full max-w-lg text-left mx-auto">
                            <button class="accordion-toggle w-full bg-white border border-gray-200 p-4 rounded-lg shadow-md flex justify-between items-center hover:bg-gray-50 hover:border-allgood-primary transition-all group">
                                <span class="font-bold text-allgood-dark text-base group-hover:text-allgood-primary transition-colors font-heading">How to use this GoodBlock</span>
                                <svg class="accordion-icon h-5 w-5 text-gray-400 transform transition-transform duration-300 group-hover:text-allgood-primary" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            </button>
                            <div class="accordion-content hidden bg-gray-50 border-x border-b border-gray-200 rounded-b-lg p-5 text-gray-600 shadow-inner text-xs font-body">
                                <p class="mb-4 text-sm text-allgood-dark">This GoodBlock is your interactive workspace. Use the <strong>Control Cluster</strong> in the top right to customize your environment.</p>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div class="flex items-start"><div class="p-1.5 bg-white rounded border border-gray-300 mr-3 text-allgood-primary"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg></div><div><strong class="text-allgood-dark block mb-0.5">Home & Reset</strong><span class="text-gray-500 leading-snug">Click to return to cover. <strong>Hold for 2s</strong> to hard reset & sign out.</span></div></div>
                                    <div class="flex items-start"><div class="p-1.5 bg-white rounded border border-gray-300 mr-3 text-cyan-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg></div><div><strong class="text-allgood-dark block mb-0.5">Blueprint Mode</strong><span class="text-gray-500 leading-snug">Toggle high-contrast Dark Mode for low-light environments.</span></div></div>
                                    <div class="flex items-start"><div class="p-1.5 bg-white rounded border border-gray-300 mr-3 text-green-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" /></svg></div><div><strong class="text-allgood-dark block mb-0.5">Focus Mode</strong><span class="text-gray-500 leading-snug">Maximize workspace. Removes the frame for mobile devices.</span></div></div>
                                    <div class="flex items-start"><div class="p-1.5 bg-white rounded border border-gray-300 mr-3 text-allgood-dark"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg></div><div><strong class="text-allgood-dark block mb-0.5">Table of Contents</strong><span class="text-gray-500 leading-snug">Jump directly to any section without losing progress.</span></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Page 2: Phase 1 Intro (MEET MAX) -->
                <div class="page" id="page-2">
                    <section class="mb-4 border-b border-gray-200 pb-2"><h2 class="text-2xl font-heading font-bold text-allgood-dark">Phase 1: The Foundation</h2></section>
                    
                    <!-- Script Preview Container -->
                    <div class="p-6 bg-white border border-gray-200 rounded-lg shadow-sm relative overflow-hidden mb-6">
                        <div class="absolute top-0 left-0 bg-gray-100 px-3 py-1 rounded-br text-[10px] font-bold text-gray-500 uppercase tracking-wider border-b border-r border-gray-200">Video Script Preview</div>
                        <div class="mt-4 flex gap-4">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 bg-gray-200 rounded-full overflow-hidden border-2 border-white shadow-sm">
                                    <img src="https://github.com/allgoodacademy/ImageAndAssets/blob/main/J.Hurtado_HeadShot.jpg?raw=true" alt="Jonathan" class="w-full h-full object-cover">
                                </div>
                            </div>
                            <div class="space-y-3">
                                <p class="text-sm font-heading font-bold text-allgood-dark">Jonathan:</p>
                                <p class="text-sm text-gray-600 font-body leading-relaxed italic">"Welcome to the Challenge. To get you to the finish line, I want to introduce you to <strong>Max</strong>.</p>
                                <p class="text-sm text-gray-600 font-body leading-relaxed italic">Max is 28. He's renting a decent apartment, but he's tired of paying his landlord's mortgage. He wants to buy, but he's terrified of interest rates and making a mistake. In <strong>Phase 1</strong>, we aren't looking at houses. We are fixing Max's mindset. We need to define his 'Why' before he spends a dime. Let's build his foundation."</p>
                            </div>
                        </div>
                        <!-- Max Profile Card -->
                        <div class="mt-4 bg-blue-50 p-3 rounded border border-blue-100 flex items-center gap-3">
                            <div class="bg-white p-2 rounded-full text-blue-500 shadow-sm"><i data-lucide="user" class="w-5 h-5"></i></div>
                            <div>
                                <strong class="text-xs text-blue-900 uppercase block">Client Profile: Max</strong>
                                <p class="text-xs text-blue-800">First-Time Buyer • Stress Level: High • Budget: Tight</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Page 3: Mission Setup (3 Pillars) -->
                <div class="page" id="page-3">
                    <section class="mb-6 border-b border-gray-200 pb-2"><h2 class="text-2xl font-heading font-bold text-allgood-dark">Mission Setup: The 3 Pillars</h2></section>
                    
                    <p class="text-sm text-gray-600 mb-6 font-body leading-relaxed">
                        Every journey starts with a foundation. Motivation, preparation, and funding are the three pillars that carry you through the stress of buying a home. <strong>Flip each card to see what they mean — this is your briefing before we move forward.</strong>
                    </p>

                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <!-- Card 1 -->
                        <div class="flip-card" onclick="this.classList.toggle('flipped'); sfx.play('click')">
                            <div class="flip-card-inner">
                                <div class="flip-card-front bg-blue-50 border-blue-200">
                                    <i data-lucide="anchor" class="w-8 h-8 text-allgood-primary mb-2"></i>
                                    <h3 class="font-bold text-sm">Pillar 1: Motivation</h3>
                                </div>
                                <div class="flip-card-back bg-allgood-primary text-white p-4">
                                    <h3 class="font-bold text-sm mb-2">Your Why</h3>
                                    <p class="text-xs leading-snug">Your reason for buying must be stronger than the stress of the process.</p>
                                </div>
                            </div>
                        </div>
                        <!-- Card 2 -->
                        <div class="flip-card" onclick="this.classList.toggle('flipped'); sfx.play('click')">
                            <div class="flip-card-inner">
                                <div class="flip-card-front bg-blue-50 border-blue-200">
                                    <i data-lucide="clipboard-list" class="w-8 h-8 text-allgood-secondary mb-2"></i>
                                    <h3 class="font-bold text-sm">Pillar 2: Preparation</h3>
                                </div>
                                <div class="flip-card-back bg-allgood-secondary text-white p-4">
                                    <h3 class="font-bold text-sm mb-2">Your Readiness</h3>
                                    <p class="text-xs leading-snug">Budgeting, saving, and financial habits set the stage. Credit is part of this readiness, but not the whole story.</p>
                                </div>
                            </div>
                        </div>
                        <!-- Card 3 -->
                        <div class="flip-card" onclick="this.classList.toggle('flipped'); sfx.play('click')">
                            <div class="flip-card-inner">
                                <div class="flip-card-front bg-blue-50 border-blue-200">
                                    <i data-lucide="dollar-sign" class="w-8 h-8 text-green-600 mb-2"></i>
                                    <h3 class="font-bold text-sm">Pillar 3: Funding</h3>
                                </div>
                                <div class="flip-card-back bg-green-600 text-white p-4">
                                    <h3 class="font-bold text-sm mb-2">Your Resources</h3>
                                    <p class="text-xs leading-snug">Savings and loan options fuel the purchase. Build wisely so you can move with confidence.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Page 4: Deep Dive (Tabs) -->
                <div class="page" id="page-4">
                    <section class="mb-4 border-b border-gray-200 pb-2"><h2 class="text-2xl font-heading font-bold text-allgood-dark">Deep Dive: The Three Pillars</h2></section>
                    
                    <!-- Tabs Navigation -->
                    <div class="flex space-x-1 border-b border-gray-200 overflow-x-auto no-scrollbar">
                        <button onclick="openTab('motivation')" id="tab-btn-motivation" class="tab-btn active px-4 py-2 text-xs font-bold uppercase tracking-wide rounded-t-lg bg-allgood-primary text-white border-t border-x border-gray-200 transition-colors">Motivation</button>
                        <!-- CHANGED: Label updated to Preparation -->
                        <button onclick="openTab('credit')" id="tab-btn-credit" class="tab-btn px-4 py-2 text-xs font-bold uppercase tracking-wide rounded-t-lg bg-gray-100 text-gray-500 hover:bg-gray-200 border-t border-x border-transparent transition-colors">Preparation</button>
                        <button onclick="openTab('funding')" id="tab-btn-funding" class="tab-btn px-4 py-2 text-xs font-bold uppercase tracking-wide rounded-t-lg bg-gray-100 text-gray-500 hover:bg-gray-200 border-t border-x border-transparent transition-colors">Funding</button>
                    </div>

                    <!-- Content Container -->
                    <div class="bg-white rounded-b-lg min-h-[300px] border border-gray-200 border-t-0 shadow-sm p-6">
                        
                        <!-- Tab 1: Motivation (Refined) -->
                        <div id="tab-content-motivation" class="tab-content animate-pop-in">
                            <div class="bg-orange-50 border border-orange-100 p-5 rounded-lg mb-6">
                                <p class="text-sm text-orange-900 font-body leading-relaxed">
                                    Your motivation is your anchor. Tap on these values to see what they really mean for your home buying journey.
                                </p>
                            </div>
                            
                            <!-- Anchor Pills Container -->
                            <div class="flex flex-wrap justify-center gap-4">
                                
                                <!-- Stability Pill -->
                                <div class="anchor-pill relative group cursor-pointer" onclick="handleAnchorInteraction(this, 'Stability')">
                                    <div class="px-4 py-2 bg-gradient-to-r from-orange-100 to-orange-200 rounded-full flex items-center gap-2 border border-orange-200 text-orange-800 shadow-sm">
                                        <i data-lucide="anchor" class="w-4 h-4"></i>
                                        <span class="text-xs font-bold font-heading">Stability</span>
                                    </div>
                                    <!-- Tooltip -->
                                    <div class="anchor-tooltip bg-white p-3 rounded-lg shadow-xl border border-gray-100 text-center">
                                        <p class="text-xs text-gray-700 font-body leading-tight">"A secure base — predictable costs and long-term roots."</p>
                                        <div class="absolute -bottom-1 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-white rotate-45 border-r border-b border-gray-100"></div>
                                    </div>
                                </div>

                                <!-- Freedom Pill -->
                                <div class="anchor-pill relative group cursor-pointer" onclick="handleAnchorInteraction(this, 'Freedom')">
                                    <div class="px-4 py-2 bg-gradient-to-r from-cyan-100 to-cyan-200 rounded-full flex items-center gap-2 border border-cyan-200 text-cyan-800 shadow-sm">
                                        <i data-lucide="wind" class="w-4 h-4"></i>
                                        <span class="text-xs font-bold font-heading">Freedom</span>
                                    </div>
                                    <!-- Tooltip -->
                                    <div class="anchor-tooltip bg-white p-3 rounded-lg shadow-xl border border-gray-100 text-center">
                                        <p class="text-xs text-gray-700 font-body leading-tight">"Your rules, your space — renovate, paint, and live freely."</p>
                                        <div class="absolute -bottom-1 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-white rotate-45 border-r border-b border-gray-100"></div>
                                    </div>
                                </div>

                                <!-- Belonging Pill -->
                                <div class="anchor-pill relative group cursor-pointer" onclick="handleAnchorInteraction(this, 'Belonging')">
                                    <div class="px-4 py-2 bg-gradient-to-r from-purple-100 to-purple-200 rounded-full flex items-center gap-2 border border-purple-200 text-purple-800 shadow-sm">
                                        <i data-lucide="users" class="w-4 h-4"></i>
                                        <span class="text-xs font-bold font-heading">Belonging</span>
                                    </div>
                                    <!-- Tooltip -->
                                    <div class="anchor-tooltip bg-white p-3 rounded-lg shadow-xl border border-gray-100 text-center">
                                        <p class="text-xs text-gray-700 font-body leading-tight">"Community connection — neighbors, schools, and roots."</p>
                                        <div class="absolute -bottom-1 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-white rotate-45 border-r border-b border-gray-100"></div>
                                    </div>
                                </div>

                                <!-- Wealth Pill -->
                                <div class="anchor-pill relative group cursor-pointer" onclick="handleAnchorInteraction(this, 'Wealth')">
                                    <div class="px-4 py-2 bg-gradient-to-r from-emerald-100 to-emerald-200 rounded-full flex items-center gap-2 border border-emerald-200 text-emerald-800 shadow-sm">
                                        <i data-lucide="trending-up" class="w-4 h-4"></i>
                                        <span class="text-xs font-bold font-heading">Wealth</span>
                                    </div>
                                    <!-- Tooltip -->
                                    <div class="anchor-tooltip bg-white p-3 rounded-lg shadow-xl border border-gray-100 text-center">
                                        <p class="text-xs text-gray-700 font-body leading-tight">"Building equity — paying yourself instead of a landlord."</p>
                                        <div class="absolute -bottom-1 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-white rotate-45 border-r border-b border-gray-100"></div>
                                    </div>
                                </div>

                                <!-- Expression Pill -->
                                <div class="anchor-pill relative group cursor-pointer" onclick="handleAnchorInteraction(this, 'Expression')">
                                    <div class="px-4 py-2 bg-gradient-to-r from-pink-100 to-pink-200 rounded-full flex items-center gap-2 border border-pink-200 text-pink-800 shadow-sm">
                                        <i data-lucide="palette" class="w-4 h-4"></i>
                                        <span class="text-xs font-bold font-heading">Expression</span>
                                    </div>
                                    <!-- Tooltip -->
                                    <div class="anchor-tooltip bg-white p-3 rounded-lg shadow-xl border border-gray-100 text-center">
                                        <p class="text-xs text-gray-700 font-body leading-tight">"A canvas for your life — design and customize without limits."</p>
                                        <div class="absolute -bottom-1 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-white rotate-45 border-r border-b border-gray-100"></div>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <!-- Tab 2: Credit -->
                        <div id="tab-content-credit" class="tab-content hidden animate-pop-in">
                            <div class="bg-sky-50 border border-sky-100 p-5 rounded-lg mb-4">
                                <!-- CHANGED: Updated text to bridge Preparation -> Credit Score -->
                                <p class="text-sm text-sky-900 font-body leading-relaxed">
                                    Preparation is about financial readiness. Budgeting sets the stage, but your credit score is the "report card" lenders use to grade that history. Protect it at all costs.
                                </p>
                            </div>
                            <div class="mt-6">
                                <div class="flex justify-between text-[10px] uppercase font-bold text-gray-400 mb-1">
                                    <span>Poor (580)</span>
                                    <span>Excellent (800+)</span>
                                </div>
                                <div class="h-4 bg-gray-200 rounded-full overflow-hidden relative">
                                    <div class="absolute inset-y-0 left-0 bg-gradient-to-r from-red-400 via-yellow-400 to-green-500 w-full opacity-50"></div>
                                    <!-- Marker -->
                                    <div class="absolute top-0 bottom-0 left-[60%] w-1 bg-allgood-dark z-10"></div>
                                </div>
                                <div class="text-center mt-2 text-xs font-bold text-gray-600">Aim for 640+ for best options</div>
                            </div>
                        </div>

                        <!-- Tab 3: Funding (The Golden Formula) -->
                        <div id="tab-content-funding" class="tab-content hidden animate-pop-in">
                            <div class="bg-emerald-50 border border-emerald-100 p-5 rounded-lg mb-4">
                                <p class="text-sm text-emerald-900 font-body leading-relaxed">
                                    Savings aren’t just for the down payment. Lenders want to see reserves — funds that prove you can weather surprises. Build wisely.
                                </p>
                            </div>
                            
                            <!-- The Golden Formula: Equation Visual -->
                            <div class="flex flex-col items-center justify-center mt-8 pb-4">
                                <div class="flex items-center gap-3 sm:gap-6">
                                    
                                    <!-- Part 1: Down Payment -->
                                    <div class="flex flex-col items-center group">
                                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center border-2 border-blue-200 mb-2 transition-transform group-hover:scale-110">
                                            <i data-lucide="dollar-sign" class="w-6 h-6 text-blue-600"></i>
                                        </div>
                                        <span class="text-[10px] font-bold uppercase text-gray-500 text-center leading-tight">Down<br>Payment</span>
                                    </div>

                                    <!-- Operator -->
                                    <div class="text-2xl font-bold text-gray-300 mb-6">+</div>

                                    <!-- Part 2: Reserves -->
                                    <div class="flex flex-col items-center group">
                                        <div class="w-12 h-12 bg-emerald-100 rounded-full flex items-center justify-center border-2 border-emerald-200 mb-2 shadow-sm transition-transform group-hover:scale-110">
                                            <i data-lucide="shield" class="w-6 h-6 text-emerald-600"></i>
                                        </div>
                                        <span class="text-[10px] font-bold uppercase text-gray-500 text-center leading-tight">Reserves</span>
                                    </div>

                                    <!-- Operator -->
                                    <div class="text-2xl font-bold text-gray-300 mb-6">=</div>

                                    <!-- Result: Keys -->
                                    <div class="flex flex-col items-center group">
                                        <div class="w-14 h-14 bg-orange-100 rounded-full flex items-center justify-center border-2 border-orange-200 mb-2 shadow-md transition-transform group-hover:scale-110">
                                            <i data-lucide="key" class="w-7 h-7 text-allgood-primary"></i>
                                        </div>
                                        <span class="text-[10px] font-bold uppercase text-allgood-primary text-center leading-tight">Secure<br>Keys</span>
                                    </div>

                                </div>
                                
                                <!-- Insight Caption -->
                                <div class="mt-6 text-center max-w-xs">
                                    <p class="text-xs text-gray-400 italic">"You can buy a house with just the down payment, but you can only <strong>keep</strong> it with reserves."</p>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Page 5: Tell (Rules Accordion) - MOVED FROM P7 -->
                <div class="page" id="page-5">
                    <section class="mb-6 border-b border-gray-200 pb-2">
                        <h2 class="text-2xl font-heading font-bold text-allgood-dark">The Golden Rules of Affordability</h2>
                    </section>
                    
                    <p class="text-sm text-gray-600 mb-6 font-body leading-relaxed">
                        Lenders use strict formulas to decide how much they will lend you. Knowing these two rules prevents heartbreak later.
                    </p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        
                        <!-- Rule 1: 28/36 -->
                        <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-center gap-3 mb-4 border-b border-gray-100 pb-2">
                                <div class="bg-blue-50 p-2 rounded text-allgood-secondary"><i data-lucide="percent" class="w-5 h-5"></i></div>
                                <h3 class="font-bold text-allgood-dark">The 28/36 Rule</h3>
                            </div>
                            
                            <div class="flex justify-center items-end gap-8 h-32 mb-6 border-b border-gray-50 pb-4">
                                <!-- Bar 1 -->
                                <div class="flex flex-col items-center group w-12 h-full justify-end">
                                    <span class="text-xs font-bold text-allgood-secondary mb-1">28%</span>
                                    <div class="w-full bg-gray-100 rounded-t-lg h-[80%] relative overflow-hidden">
                                        <div class="absolute bottom-0 w-full bg-allgood-secondary h-[35%] transition-all duration-1000 group-hover:bg-allgood-accent"></div>
                                    </div>
                                    <span class="text-[10px] text-gray-500 mt-2 uppercase font-bold text-center leading-tight">Housing<br>Max</span>
                                </div>
                                <!-- Bar 2 -->
                                <div class="flex flex-col items-center group w-12 h-full justify-end">
                                    <span class="text-xs font-bold text-orange-600 mb-1">36%</span>
                                    <div class="w-full bg-gray-100 rounded-t-lg h-[80%] relative overflow-hidden">
                                        <div class="absolute bottom-0 w-full bg-orange-500 h-[45%] transition-all duration-1000 group-hover:bg-orange-600"></div>
                                    </div>
                                    <span class="text-[10px] text-gray-500 mt-2 uppercase font-bold text-center leading-tight">Total<br>Debt</span>
                                </div>
                            </div>
                            
                            <p class="text-xs text-gray-600 leading-relaxed text-center">
                                Spend max <strong>28%</strong> of gross income on housing, and max <strong>36%</strong> on total debt (including car, student loans, etc).
                            </p>
                        </div>

                        <!-- Rule 2: 3x Income -->
                        <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-center gap-3 mb-4 border-b border-gray-100 pb-2">
                                <div class="bg-green-50 p-2 rounded text-green-600"><i data-lucide="scaling" class="w-5 h-5"></i></div>
                                <h3 class="font-bold text-allgood-dark">The 3x Income Rule</h3>
                            </div>
                            
                            <div class="flex items-center justify-center h-32 mb-6 gap-2 border-b border-gray-50 pb-4">
                                <div class="flex flex-col items-center">
                                    <i data-lucide="briefcase" class="w-8 h-8 text-gray-400 mb-1"></i>
                                    <span class="text-[10px] font-bold text-gray-400 uppercase">Income</span>
                                </div>
                                <div class="text-xl font-bold text-gray-300">×</div>
                                <div class="text-5xl font-heading font-bold text-green-600">3</div>
                                <div class="text-xl font-bold text-gray-300">=</div>
                                <div class="flex flex-col items-center">
                                    <div class="bg-green-100 p-3 rounded-full mb-1 border border-green-200">
                                        <i data-lucide="home" class="w-6 h-6 text-green-700"></i>
                                    </div>
                                    <span class="text-[10px] font-bold text-green-700 uppercase">Target</span>
                                </div>
                            </div>
                            
                            <p class="text-xs text-gray-600 leading-relaxed text-center">
                                Aim for a home price roughly <strong>3x your annual gross income</strong> to ensure you have a comfortable buffer for life's surprises.
                            </p>
                        </div>

                    </div>
                </div>

                <!-- Page 6: Simulation (The Lender's Lens) - MOVED FROM P5 -->
                <div class="page" id="page-6">
                    <section class="mb-4 border-b border-gray-200 pb-2">
                        <h2 class="text-2xl font-heading font-bold text-allgood-dark">Simulation: The Lender's Lens</h2>
                    </section>
                    
                    <p class="text-sm text-gray-600 mb-6 leading-relaxed">
                        These are common hurdles, not dead ends. Lenders are trained to see risk, but <strong>I am trained to find solutions.</strong>
                        <br><br>
                        Run the analysis to see the "Lender Flag," then see how a pro realtor handles it.
                    </p>

                    <div class="grid grid-cols-1 gap-6 pb-6">
                        
                        <!-- Case 1: Income -->
                        <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm relative overflow-hidden group">
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600">
                                        <i data-lucide="briefcase" class="w-5 h-5"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-bold text-allgood-dark text-sm">Case 1: The Commission Job</h3>
                                        <p class="text-xs text-gray-500">Income Stability</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Borrower View -->
                            <div class="mb-4 p-3 bg-gray-50 rounded border-l-4 border-blue-400">
                                <p class="text-xs text-gray-700 italic">"I just started a new sales job 2 months ago. I'm already making $8k/month in commissions! I can easily afford the mortgage."</p>
                            </div>

                            <!-- Action Area -->
                            <div class="lender-action">
                                <button onclick="runLenderAnalysis(this)" class="w-full py-2 bg-allgood-secondary hover:bg-allgood-accent text-white font-bold rounded text-xs transition-colors flex items-center justify-center gap-2 shadow-sm">
                                    <i data-lucide="search" class="w-4 h-4"></i> Run Lender Check
                                </button>
                            </div>

                            <!-- Lender View (Hidden) -->
                            <div class="lender-result hidden mt-4 pt-4 border-t border-gray-100 animate-pop-in">
                                <!-- The Flag (Neutral) -->
                                <div class="flex items-start gap-3 mb-4">
                                    <div class="mt-1 text-gray-400 flex-shrink-0"><i data-lucide="flag" class="w-5 h-5"></i></div>
                                    <div>
                                        <strong class="text-xs text-gray-500 uppercase tracking-wide">Lender Flag</strong>
                                        <p class="text-sm text-gray-800 mt-1 font-bold">Variable Income History</p>
                                        <p class="text-xs text-gray-600 mt-1">Lenders typically require a 2-year history to "average" commission income.</p>
                                    </div>
                                </div>

                                <!-- The Solution (Mentor) -->
                                <div class="bg-orange-50 border border-orange-100 rounded p-3 relative">
                                    <div class="absolute -top-3 -left-2 bg-allgood-primary text-white text-[10px] font-bold px-2 py-0.5 rounded shadow-sm">Jonathan's Strategy</div>
                                    <div class="flex gap-3 pt-2">
                                        <div class="flex-shrink-0 mt-1"><i data-lucide="check-circle-2" class="w-4 h-4 text-allgood-primary"></i></div>
                                        <p class="text-xs text-gray-800 leading-snug">
                                            <strong>We pivot.</strong> If we can't wait 2 years, we qualify you based on your <em>base salary</em> alone, or we find a portfolio lender who accepts offer letters as proof of future income.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Case 2: Assets -->
                        <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm relative overflow-hidden group">
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-emerald-100 rounded-full flex items-center justify-center text-emerald-600">
                                        <i data-lucide="wallet" class="w-5 h-5"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-bold text-allgood-dark text-sm">Case 2: Cash Savings</h3>
                                        <p class="text-xs text-gray-500">Asset Sourcing</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Borrower View -->
                            <div class="mb-4 p-3 bg-gray-50 rounded border-l-4 border-emerald-400">
                                <p class="text-xs text-gray-700 italic">"I have $20,000 in cash saved in my safe at home. I'll just deposit it right before we apply."</p>
                            </div>

                            <!-- Action Area -->
                            <div class="lender-action">
                                <button onclick="runLenderAnalysis(this)" class="w-full py-2 bg-allgood-secondary hover:bg-allgood-accent text-white font-bold rounded text-xs transition-colors flex items-center justify-center gap-2 shadow-sm">
                                    <i data-lucide="search" class="w-4 h-4"></i> Run Lender Check
                                </button>
                            </div>

                            <!-- Lender View (Hidden) -->
                            <div class="lender-result hidden mt-4 pt-4 border-t border-gray-100 animate-pop-in">
                                <!-- The Flag (Neutral) -->
                                <div class="flex items-start gap-3 mb-4">
                                    <div class="mt-1 text-gray-400 flex-shrink-0"><i data-lucide="flag" class="w-5 h-5"></i></div>
                                    <div>
                                        <strong class="text-xs text-gray-500 uppercase tracking-wide">Lender Flag</strong>
                                        <p class="text-sm text-gray-800 mt-1 font-bold">Unverified Source</p>
                                        <p class="text-xs text-gray-600 mt-1">Large cash deposits trigger Anti-Money Laundering checks. "Mattress money" is hard to trace.</p>
                                    </div>
                                </div>

                                <!-- The Solution (Mentor) -->
                                <div class="bg-orange-50 border border-orange-100 rounded p-3 relative">
                                    <div class="absolute -top-3 -left-2 bg-allgood-primary text-white text-[10px] font-bold px-2 py-0.5 rounded shadow-sm">Jonathan's Strategy</div>
                                    <div class="flex gap-3 pt-2">
                                        <div class="flex-shrink-0 mt-1"><i data-lucide="check-circle-2" class="w-4 h-4 text-allgood-primary"></i></div>
                                        <p class="text-xs text-gray-800 leading-snug">
                                            <strong>We plan ahead.</strong> Deposit the cash now. After 60 days, the funds are considered "seasoned" and the lender won't ask for the source.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Case 3: Credit -->
                        <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm relative overflow-hidden group">
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center text-purple-600">
                                        <i data-lucide="ghost" class="w-5 h-5"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-bold text-allgood-dark text-sm">Case 3: The Credit Ghost</h3>
                                        <p class="text-xs text-gray-500">Credit History</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Borrower View -->
                            <div class="mb-4 p-3 bg-gray-50 rounded border-l-4 border-purple-400">
                                <p class="text-xs text-gray-700 italic">"I have zero debt. No credit cards, no loans. I pay everything in cash. My credit should be perfect."</p>
                            </div>

                            <!-- Action Area -->
                            <div class="lender-action">
                                <button onclick="runLenderAnalysis(this)" class="w-full py-2 bg-allgood-secondary hover:bg-allgood-accent text-white font-bold rounded text-xs transition-colors flex items-center justify-center gap-2 shadow-sm">
                                    <i data-lucide="search" class="w-4 h-4"></i> Run Lender Check
                                </button>
                            </div>

                            <!-- Lender View (Hidden) -->
                            <div class="lender-result hidden mt-4 pt-4 border-t border-gray-100 animate-pop-in">
                                <!-- The Flag (Neutral) -->
                                <div class="flex items-start gap-3 mb-4">
                                    <div class="mt-1 text-gray-400 flex-shrink-0"><i data-lucide="flag" class="w-5 h-5"></i></div>
                                    <div>
                                        <strong class="text-xs text-gray-500 uppercase tracking-wide">Lender Flag</strong>
                                        <p class="text-sm text-gray-800 mt-1 font-bold">Insufficient Credit Depth</p>
                                        <p class="text-xs text-gray-600 mt-1">"No score" is often treated as "Unknown Risk" by automated systems.</p>
                                    </div>
                                </div>

                                <!-- The Solution (Mentor) -->
                                <div class="bg-orange-50 border border-orange-100 rounded p-3 relative">
                                    <div class="absolute -top-3 -left-2 bg-allgood-primary text-white text-[10px] font-bold px-2 py-0.5 rounded shadow-sm">Jonathan's Strategy</div>
                                    <div class="flex gap-3 pt-2">
                                        <div class="flex-shrink-0 mt-1"><i data-lucide="check-circle-2" class="w-4 h-4 text-allgood-primary"></i></div>
                                        <p class="text-xs text-gray-800 leading-snug">
                                            <strong>Manual Underwriting.</strong> We bypass the automated score. I help you build a packet of rent, utility, and phone bills to prove you pay on time, every time.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- PHASE II: FINANCIAL PREPARATION (Days 60-31) -->

                <!-- Page 7: Phase 2 Intro (MAX'S MONEY) -->
                <div class="page" id="page-7">
                    <section class="mb-4 border-b border-gray-200 pb-2"><h2 class="text-2xl font-heading font-bold text-allgood-dark">Phase 2: Financial Prep</h2></section>
                    
                    <div class="p-6 bg-white border border-gray-200 rounded-lg shadow-sm relative overflow-hidden mb-6">
                        <div class="absolute top-0 left-0 bg-gray-100 px-3 py-1 rounded-br text-[10px] font-bold text-gray-500 uppercase tracking-wider border-b border-r border-gray-200">Video Script Preview</div>
                        <div class="mt-4 flex gap-4">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 bg-gray-200 rounded-full overflow-hidden border-2 border-white shadow-sm">
                                    <img src="https://github.com/allgoodacademy/ImageAndAssets/blob/main/J.Hurtado_HeadShot.jpg?raw=true" alt="Jonathan" class="w-full h-full object-cover">
                                </div>
                            </div>
                            <div class="space-y-3">
                                <p class="text-sm font-heading font-bold text-allgood-dark">Jonathan:</p>
                                <p class="text-sm text-gray-600 font-body leading-relaxed italic">"Max has a problem. He makes good money, but he loves expensive coffee and just leased a new car. Lenders don't care about your lifestyle; they care about your <strong>DTI</strong> (Debt-to-Income).</p>
                                <p class="text-sm text-gray-600 font-body leading-relaxed italic">In <strong>Phase 2</strong>, we have to clean up Max's financial house. We're going to run the math on his affordability and make some hard choices about his spending. If Max wants the house, the car might have to wait."</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Page 8: Do (Affordability Calculator) -->
                <div class="page" id="page-8">
                    <section class="mb-4 border-b border-gray-200 pb-2"><h2 class="text-2xl font-heading font-bold text-allgood-dark">Challenge: Can You Afford It?</h2></section>
                    <div class="bg-white p-4 rounded shadow border max-w-md mx-auto">
                        <p class="text-sm text-gray-600 mb-6 leading-relaxed">
                            This calculator is your <strong>first defense against overspending.</strong> Use your gross income and estimated monthly debts (car, student loans, credit card minimums) to see where you land on the Lender's 28/36 rule.
                        </p>

                        <label class="block text-xs font-bold mb-1 text-gray-600">Monthly Gross Income ($)</label>
                        <input type="number" id="calc-income" class="w-full border p-2 rounded mb-3 font-body text-sm focus:border-allgood-primary outline-none transition-colors" placeholder="e.g. 5000">
                        
                        <label class="block text-xs font-bold mb-1 text-gray-600">Monthly Debt Payments ($)</label>
                        <input type="number" id="calc-debt" class="w-full border p-2 rounded mb-3 font-body text-sm focus:border-allgood-primary outline-none transition-colors" placeholder="e.g. 500">
                        
                        <label class="block text-xs font-bold mb-1 text-gray-600">Est. Mortgage Payment ($)</label>
                        <input type="number" id="calc-mortgage" class="w-full border p-2 rounded mb-4 font-body text-sm focus:border-allgood-primary outline-none transition-colors" placeholder="e.g. 1500">
                        
                        <button onclick="calculateAffordability()" class="w-full bg-allgood-secondary hover:bg-allgood-accent text-white font-bold py-3 rounded shadow-sm transition-all transform active:scale-[0.98]">Check Qualification</button>
                        
                        <!-- Feedback Area -->
                        <div id="affordability-feedback" class="hidden"></div>
                    </div>
                </div>

                <!-- Page 9: Do (Trade-Offs Reflection) -->
                <div class="page" id="page-9">
                    <section class="mb-6 border-b border-gray-200 pb-2"><h2 class="text-2xl font-heading font-bold text-allgood-dark">Challenge: What Trade-Offs Could You Make?</h2></section>
                    
                    <p class="text-sm text-gray-600 mb-6 leading-relaxed">
                        Affordability isn't just math—it's about choices. If the numbers are tight, adjusting your lifestyle can sometimes bridge the gap. <br><br>
                        <strong>Flip the cards to see the impact of these common trade-offs:</strong>
                    </p>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <!-- Card 1: Dining -->
                        <div class="flip-card" onclick="this.classList.toggle('flipped'); sfx.nav()">
                            <div class="flip-card-inner">
                                <div class="flip-card-front bg-orange-50 border-orange-100">
                                    <div class="bg-white p-3 rounded-full text-orange-600 shadow-sm mb-3"><i data-lucide="coffee" class="w-6 h-6"></i></div>
                                    <h3 class="font-heading font-bold text-allgood-dark text-sm">Dining Out</h3>
                                </div>
                                <div class="flip-card-back bg-allgood-primary text-white p-4">
                                    <h3 class="font-bold text-sm mb-2 opacity-90">Cash Flow</h3>
                                    <p class="text-xs leading-snug font-body">Reducing discretionary spending can free up cash flow for housing costs.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Card 2: Car -->
                        <div class="flip-card" onclick="this.classList.toggle('flipped'); sfx.nav()">
                            <div class="flip-card-inner">
                                <div class="flip-card-front bg-cyan-50 border-cyan-100">
                                    <div class="bg-white p-3 rounded-full text-cyan-700 shadow-sm mb-3"><i data-lucide="car" class="w-6 h-6"></i></div>
                                    <h3 class="font-heading font-bold text-allgood-dark text-sm">New Vehicle</h3>
                                </div>
                                <div class="flip-card-back bg-allgood-secondary text-white p-4">
                                    <h3 class="font-bold text-sm mb-2 opacity-90">Debt Ratio</h3>
                                    <p class="text-xs leading-snug font-body">Holding off on a new loan keeps your debt-to-income ratio lower.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Card 3: Roommate -->
                        <div class="flip-card" onclick="this.classList.toggle('flipped'); sfx.nav()">
                            <div class="flip-card-inner">
                                <div class="flip-card-front bg-orange-50 border-orange-100">
                                    <div class="bg-white p-3 rounded-full text-orange-600 shadow-sm mb-3"><i data-lucide="users" class="w-6 h-6"></i></div>
                                    <h3 class="font-heading font-bold text-allgood-dark text-sm">House Hacking</h3>
                                </div>
                                <div class="flip-card-back bg-allgood-primary text-white p-4">
                                    <h3 class="font-bold text-sm mb-2 opacity-90">Income Boost</h3>
                                    <p class="text-xs leading-snug font-body">Sharing housing costs can make a higher mortgage more manageable.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Card 4: Vacation (Restored) -->
                        <div class="flip-card" onclick="this.classList.toggle('flipped'); sfx.nav()">
                            <div class="flip-card-inner">
                                <div class="flip-card-front bg-cyan-50 border-cyan-100">
                                    <div class="bg-white p-3 rounded-full text-cyan-700 shadow-sm mb-3"><i data-lucide="plane" class="w-6 h-6"></i></div>
                                    <h3 class="font-heading font-bold text-allgood-dark text-sm">Travel Budget</h3>
                                </div>
                                <div class="flip-card-back bg-allgood-secondary text-white p-4">
                                    <h3 class="font-bold text-sm mb-2 opacity-90">Obligations</h3>
                                    <p class="text-xs leading-snug font-body">Scaling back on travel helps balance monthly obligations.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Page 10: Do (Protect Your Loan - CONSOLIDATED CHALLENGE) -->
                <div class="page" id="page-10">
                    <section class="mb-4 border-b border-gray-200 pb-2"><h2 class="text-2xl font-heading font-bold text-allgood-dark">Challenge: Protect Your Loan</h2></section>
                    <p class="text-sm text-gray-600 mb-4 leading-relaxed">
                        You are "Conditionally Approved." This is the danger zone. <br>Drag <strong>or Tap</strong> Approved Moves into the <strong>Safe</strong>. Put Risky Moves into the <strong>Trash</strong> to protect your closing.
                    </p>
                    
                    <!-- Draggables Source (Merged Items) -->
                    <div id="gauntlet-source" class="grid grid-cols-2 sm:grid-cols-3 gap-2 mb-6 min-h-[80px]">
                        <!-- Financial Items -->
                        <div class="draggable bg-white border border-gray-300 p-2 rounded shadow-sm text-xs font-bold text-center cursor-grab touch-none select-none hover:border-allgood-primary transition-colors" id="drag-dp" draggable="true" data-type="safe">Down Payment</div>
                        <div class="draggable bg-white border border-gray-300 p-2 rounded shadow-sm text-xs font-bold text-center cursor-grab touch-none select-none hover:border-allgood-primary transition-colors" id="drag-closing" draggable="true" data-type="safe">Closing Costs</div>
                        <div class="draggable bg-white border border-gray-300 p-2 rounded shadow-sm text-xs font-bold text-center cursor-grab touch-none select-none hover:border-allgood-primary transition-colors" id="drag-save" draggable="true" data-type="safe">Boost Savings</div>
                        
                        <!-- Behavioral/Credit Risks -->
                        <div class="draggable bg-white border border-gray-300 p-2 rounded shadow-sm text-xs font-bold text-center cursor-grab touch-none select-none hover:border-red-500 transition-colors" id="drag-car" draggable="true" data-type="trap">New Car Loan</div>
                        <div class="draggable bg-white border border-gray-300 p-2 rounded shadow-sm text-xs font-bold text-center cursor-grab touch-none select-none hover:border-red-500 transition-colors" id="drag-furniture" draggable="true" data-type="trap">Furniture Credit</div>
                        <div class="draggable bg-white border border-gray-300 p-2 rounded shadow-sm text-xs font-bold text-center cursor-grab touch-none select-none hover:border-red-500 transition-colors" id="drag-job" draggable="true" data-type="trap">Change Jobs</div>
                        <div class="draggable bg-white border border-gray-300 p-2 rounded shadow-sm text-xs font-bold text-center cursor-grab touch-none select-none hover:border-red-500 transition-colors" id="drag-late" draggable="true" data-type="trap">Miss Payment</div>
                    </div>

                    <!-- Drop Zones -->
                    <div class="flex gap-4 h-36">
                        <!-- The Safe (Approved) -->
                        <div id="zone-safe" class="w-1/2 bg-emerald-50 border-2 border-dashed border-emerald-300 rounded-lg flex flex-col items-center justify-center p-2 drop-zone transition-all duration-200 relative group">
                            <i data-lucide="shield-check" class="w-8 h-8 text-emerald-400 mb-2 pointer-events-none group-hover:scale-110 transition-transform"></i>
                            <span class="text-xs text-emerald-600 font-bold pointer-events-none text-center">Approved Move<br>(Safe)</span>
                        </div>

                        <!-- The Trash (Risk) -->
                        <div id="zone-trap" class="w-1/2 bg-red-50 border-2 border-dashed border-red-300 rounded-lg flex flex-col items-center justify-center p-2 drop-zone transition-all duration-200 relative group">
                            <i data-lucide="alert-triangle" class="w-8 h-8 text-red-400 mb-2 pointer-events-none group-hover:scale-110 transition-transform"></i>
                            <span class="text-xs text-red-600 font-bold pointer-events-none text-center">Loan Risk<br>(Trash It)</span>
                        </div>
                    </div>
                    
                    <!-- Feedback Area -->
                    <div id="gauntlet-feedback" class="mt-4 hidden p-4 rounded-lg text-sm border shadow-sm animate-pop-in leading-relaxed font-body"></div>
                </div>

                <!-- Page 11: Tell (Credit Score) -->
                <div class="page" id="page-11">
                    <section class="mb-4 border-b border-gray-200 pb-2">
                        <h2 class="text-2xl font-heading font-bold text-allgood-dark">Briefing: The $100,000 Difference</h2>
                    </section>
                    
                    <p class="text-sm text-gray-600 mb-6 text-center">
                        Two buyers. Same house. Same price ($400k). <br><strong>One pays $96,000 more.</strong> Why?
                    </p>

                    <!-- The Comparison Grid -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                        
                        <!-- Buyer A (High Score) -->
                        <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-5 relative overflow-hidden group">
                            <div class="absolute top-0 right-0 bg-emerald-200 text-emerald-800 text-[10px] font-bold px-2 py-1 rounded-bl">Approved</div>
                            <div class="flex items-center gap-2 mb-3">
                                <div class="p-2 bg-white rounded-full text-emerald-600 shadow-sm"><i data-lucide="user-check" class="w-5 h-5"></i></div>
                                <div>
                                    <h3 class="font-bold text-emerald-900 text-sm">Buyer A</h3>
                                    <p class="text-xs text-emerald-700">Score: <strong>760+</strong></p>
                                </div>
                            </div>
                            
                            <div class="space-y-2">
                                <div class="flex justify-between items-center text-xs border-b border-emerald-200 pb-1">
                                    <span class="text-emerald-700">Interest Rate</span>
                                    <span class="font-bold text-emerald-900">6.5%</span>
                                </div>
                                <div class="flex justify-between items-center text-sm">
                                    <span class="text-emerald-700">Monthly Payment</span>
                                    <span class="font-bold text-emerald-900">$2,528</span>
                                </div>
                            </div>
                        </div>

                        <!-- Buyer B (Low Score) -->
                        <div class="bg-orange-50 border border-orange-200 rounded-lg p-5 relative overflow-hidden group">
                            <div class="absolute top-0 right-0 bg-orange-200 text-orange-800 text-[10px] font-bold px-2 py-1 rounded-bl">Costly</div>
                            <div class="flex items-center gap-2 mb-3">
                                <div class="p-2 bg-white rounded-full text-orange-600 shadow-sm"><i data-lucide="user-x" class="w-5 h-5"></i></div>
                                <div>
                                    <h3 class="font-bold text-orange-900 text-sm">Buyer B</h3>
                                    <p class="text-xs text-orange-700">Score: <strong>620</strong></p>
                                </div>
                            </div>
                            
                            <div class="space-y-2">
                                <div class="flex justify-between items-center text-xs border-b border-orange-200 pb-1">
                                    <span class="text-orange-700">Interest Rate</span>
                                    <span class="font-bold text-orange-900">7.5%</span>
                                </div>
                                <div class="flex justify-between items-center text-sm">
                                    <span class="text-orange-700">Monthly Payment</span>
                                    <span class="font-bold text-orange-900">$2,796</span>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- The Sticker Shock (Footer) -->
                    <div class="bg-allgood-dark text-white p-4 rounded-lg shadow-md text-center transform scale-100 hover:scale-[1.02] transition-transform duration-300">
                        <div class="flex items-center justify-center gap-3 mb-1">
                            <i data-lucide="alert-circle" class="w-5 h-5 text-orange-400"></i>
                            <h3 class="font-heading font-bold text-lg">The "Bad Credit" Tax</h3>
                        </div>
                        <p class="text-sm font-body text-gray-300 mb-2">Buyer B pays an extra <strong>$268/mo</strong>.</p>
                        <div class="inline-block bg-white/10 px-4 py-1 rounded border border-white/20">
                            <span class="text-xs uppercase tracking-wide opacity-80 mr-2">30-Year Cost:</span>
                            <span class="font-bold text-orange-400">+$96,480 Interest</span>
                        </div>
                    </div>

                </div>

                <!-- Page 12: Tell (Buyer Broker Agreement Briefing) - NEW CONTENT -->
                <div class="page" id="page-12">
                    <section class="mb-4 border-b border-gray-200 pb-2">
                        <h2 class="text-2xl font-heading font-bold text-allgood-dark">Briefing: The B.B.A.</h2>
                    </section>
                    
                    <p class="text-sm text-gray-600 mb-6 font-body leading-relaxed">
                        The <strong>Buyer Broker Agreement</strong> is no longer optional—it is your protection. Before we tour a single home, we formalize our team.
                    </p>

                    <div class="bg-white border border-gray-300 rounded-lg p-6 shadow-sm relative max-w-lg mx-auto">
                        <!-- Paper Effect -->
                        <div class="absolute top-0 right-0 w-8 h-8 bg-gray-100 border-l border-b border-gray-300 rounded-bl-lg"></div>
                        
                        <div class="flex items-center gap-3 mb-4">
                            <div class="bg-allgood-primary text-white p-2 rounded-lg shadow-sm"><i data-lucide="file-signature" class="w-6 h-6"></i></div>
                            <h3 class="font-bold text-allgood-dark font-heading text-lg">Buyer Representation Agreement</h3>
                        </div>

                        <div class="space-y-4">
                            <div class="flex gap-3 items-start">
                                <div class="mt-1 text-emerald-500 flex-shrink-0"><i data-lucide="check-circle-2" class="w-4 h-4"></i></div>
                                <div>
                                    <strong class="text-xs font-bold text-allgood-dark uppercase block">Fiduciary Duty</strong>
                                    <p class="text-xs text-gray-600">I am legally bound to act in <em>your</em> best interest, not the seller's. I keep your secrets and negotiate for your wallet.</p>
                                </div>
                            </div>
                            
                            <div class="flex gap-3 items-start">
                                <div class="mt-1 text-emerald-500 flex-shrink-0"><i data-lucide="check-circle-2" class="w-4 h-4"></i></div>
                                <div>
                                    <strong class="text-xs font-bold text-allgood-dark uppercase block">Transparency</strong>
                                    <p class="text-xs text-gray-600">We define my compensation upfront. No hidden fees. If the seller pays my fee (which is common), you pay nothing extra.</p>
                                </div>
                            </div>

                            <div class="flex gap-3 items-start">
                                <div class="mt-1 text-emerald-500 flex-shrink-0"><i data-lucide="check-circle-2" class="w-4 h-4"></i></div>
                                <div>
                                    <strong class="text-xs font-bold text-allgood-dark uppercase block">Commitment</strong>
                                    <p class="text-xs text-gray-600">This agreement unlocks my ability to show you homes, draft offers, and fight for you in inspections.</p>
                                </div>
                            </div>
                        </div>

                        <div class="mt-6 pt-4 border-t border-gray-100 text-center">
                            <p class="text-[10px] text-gray-400 italic">"Without this agreement, I am just a tour guide. With it, I am your advocate."</p>
                        </div>
                    </div>
                </div>

                <!-- PHASE III: LOAN TYPES (Days 30-15) -->

                <!-- Page 13: Phase 3 Intro (MAX'S LOAN) -->
                <div class="page" id="page-13">
                    <section class="mb-4 border-b border-gray-200 pb-2"><h2 class="text-2xl font-heading font-bold text-allgood-dark">Phase 3: Financing</h2></section>
                    
                    <div class="p-6 bg-white border border-gray-200 rounded-lg shadow-sm relative overflow-hidden mb-6">
                        <div class="absolute top-0 left-0 bg-gray-100 px-3 py-1 rounded-br text-[10px] font-bold text-gray-500 uppercase tracking-wider border-b border-r border-gray-200">Video Script Preview</div>
                        <div class="mt-4 flex gap-4">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 bg-gray-200 rounded-full overflow-hidden border-2 border-white shadow-sm">
                                    <img src="https://github.com/allgoodacademy/ImageAndAssets/blob/main/J.Hurtado_HeadShot.jpg?raw=true" alt="Jonathan" class="w-full h-full object-cover">
                                </div>
                            </div>
                            <div class="space-y-3">
                                <p class="text-sm font-heading font-bold text-allgood-dark">Jonathan:</p>
                                <p class="text-sm text-gray-600 font-body leading-relaxed italic">"Max thinks he needs 20% down to buy a home. That's $80,000 on a $400k house. He only has $15,000 saved. He's ready to quit.</p>
                                <p class="text-sm text-gray-600 font-body leading-relaxed italic">In <strong>Phase 3</strong>, we show Max the menu. FHA, Conventional 3%, VA. We need to find the loan that fits <em>his</em> wallet, not the one his parents used 30 years ago. Let's get him funded."</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Page 14: Tell (Loan Types Accordion) -->
                <div class="page" id="page-14">
                    <section class="mb-4 border-b border-gray-200 pb-2 flex justify-between items-end">
                        <div>
                            <h2 class="text-2xl font-heading font-bold text-allgood-dark">Briefing: The Loan Explorer</h2>
                            <p class="text-xs text-gray-500 mt-1">Explore all 5 options to unlock the next step.</p>
                        </div>
                        <!-- Progress Cue -->
                        <div class="flex flex-col items-end w-24">
                             <div class="text-[10px] font-bold text-allgood-primary mb-1" id="loan-progress-text">0/5 Explored</div>
                             <div class="w-full h-2 bg-gray-200 rounded-full overflow-hidden">
                                 <div id="loan-progress-bar" class="h-full bg-allgood-primary w-0 transition-all duration-500"></div>
                             </div>
                        </div>
                    </section>
                    
                    <p class="text-sm text-gray-600 mb-6 font-body leading-relaxed">
                        Financing isn't one-size-fits-all. Click to expand each card and find the strategy that fits your blueprint.
                    </p>

                    <div class="space-y-4" id="loan-accordion">
                        
                        <!-- FHA -->
                        <div class="border border-orange-200 rounded-xl overflow-hidden transition-all duration-300 hover:shadow-md group loan-card" data-type="fha">
                            <button onclick="toggleLoanAccordion(this)" class="w-full flex items-center justify-between p-4 bg-white hover:bg-orange-50/50 text-left transition-colors relative">
                                <div class="flex items-center gap-4">
                                    <div class="w-12 h-12 rounded-full bg-orange-100 flex items-center justify-center text-2xl shadow-sm group-hover:scale-110 transition-transform duration-300">🏠</div>
                                    <div>
                                        <h3 class="font-bold text-allgood-dark text-base">FHA Loan</h3>
                                        <span class="inline-block px-2 py-0.5 rounded text-[10px] font-bold bg-orange-100 text-orange-800 uppercase tracking-wide mt-1">Low Down Payment</span>
                                    </div>
                                </div>
                                <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 transform transition-transform duration-300 accordion-arrow"></i>
                            </button>
                            <div class="hidden bg-orange-50 border-t border-orange-100 p-5 animate-pop-in">
                                <p class="text-sm text-gray-700 leading-relaxed mb-4">
                                    Backed by the government, FHA loans help first‑time buyers with smaller savings. You can qualify with a credit score as low as 580 and 3.5% down.
                                </p>
                                <!-- Mentor Bubble -->
                                <div class="flex gap-3 bg-white p-3 rounded-lg border border-orange-200 shadow-sm relative">
                                    <div class="absolute -left-1 top-4 w-2 h-2 bg-white border-l border-b border-orange-200 transform rotate-45"></div>
                                    <img src="https://github.com/allgoodacademy/ImageAndAssets/blob/main/J.Hurtado_HeadShot.jpg?raw=true" class="w-8 h-8 rounded-full border border-orange-200 object-cover flex-shrink-0">
                                    <div>
                                        <p class="text-[10px] font-bold text-orange-800 uppercase mb-0.5">Jonathan's Tip</p>
                                        <p class="text-xs text-gray-600 italic">"Best if you’re starting out and need flexibility. It's the perfect launchpad."</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Conventional -->
                        <div class="border border-blue-200 rounded-xl overflow-hidden transition-all duration-300 hover:shadow-md group loan-card" data-type="conv">
                            <button onclick="toggleLoanAccordion(this)" class="w-full flex items-center justify-between p-4 bg-white hover:bg-blue-50/50 text-left transition-colors relative">
                                <div class="flex items-center gap-4">
                                    <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center text-2xl shadow-sm group-hover:scale-110 transition-transform duration-300">📈</div>
                                    <div>
                                        <h3 class="font-bold text-allgood-dark text-base">Conventional Loan</h3>
                                        <span class="inline-block px-2 py-0.5 rounded text-[10px] font-bold bg-blue-100 text-blue-800 uppercase tracking-wide mt-1">Flexible Terms</span>
                                    </div>
                                </div>
                                <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 transform transition-transform duration-300 accordion-arrow"></i>
                            </button>
                            <div class="hidden bg-blue-50 border-t border-blue-100 p-5 animate-pop-in">
                                <p class="text-sm text-gray-700 leading-relaxed mb-4">
                                    Private lenders offer these loans — strong credit scores (680+) unlock better rates. Plus, you can remove PMI once you hit 20% equity.
                                </p>
                                <!-- Mentor Bubble -->
                                <div class="flex gap-3 bg-white p-3 rounded-lg border border-blue-200 shadow-sm relative">
                                    <div class="absolute -left-1 top-4 w-2 h-2 bg-white border-l border-b border-blue-200 transform rotate-45"></div>
                                    <img src="https://github.com/allgoodacademy/ImageAndAssets/blob/main/J.Hurtado_HeadShot.jpg?raw=true" class="w-8 h-8 rounded-full border border-blue-200 object-cover flex-shrink-0">
                                    <div>
                                        <p class="text-[10px] font-bold text-blue-800 uppercase mb-0.5">Jonathan's Tip</p>
                                        <p class="text-xs text-gray-600 italic">"Best if you have solid credit and want options. It's the standard for a reason."</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- VA -->
                        <div class="border border-emerald-200 rounded-xl overflow-hidden transition-all duration-300 hover:shadow-md group loan-card" data-type="va">
                            <button onclick="toggleLoanAccordion(this)" class="w-full flex items-center justify-between p-4 bg-white hover:bg-emerald-50/50 text-left transition-colors relative">
                                <div class="flex items-center gap-4">
                                    <div class="w-12 h-12 rounded-full bg-emerald-100 flex items-center justify-center text-2xl shadow-sm group-hover:scale-110 transition-transform duration-300">🎖️</div>
                                    <div>
                                        <h3 class="font-bold text-allgood-dark text-base">VA Loan</h3>
                                        <span class="inline-block px-2 py-0.5 rounded text-[10px] font-bold bg-emerald-100 text-emerald-800 uppercase tracking-wide mt-1">No Down Payment</span>
                                    </div>
                                </div>
                                <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 transform transition-transform duration-300 accordion-arrow"></i>
                            </button>
                            <div class="hidden bg-emerald-50 border-t border-emerald-100 p-5 animate-pop-in">
                                <p class="text-sm text-gray-700 leading-relaxed mb-4">
                                    Exclusive to veterans and service members. Offers 0% down payment, competitive rates, and no monthly mortgage insurance.
                                </p>
                                <!-- Mentor Bubble -->
                                <div class="flex gap-3 bg-white p-3 rounded-lg border border-emerald-200 shadow-sm relative">
                                    <div class="absolute -left-1 top-4 w-2 h-2 bg-white border-l border-b border-emerald-200 transform rotate-45"></div>
                                    <img src="https://github.com/allgoodacademy/ImageAndAssets/blob/main/J.Hurtado_HeadShot.jpg?raw=true" class="w-8 h-8 rounded-full border border-emerald-200 object-cover flex-shrink-0">
                                    <div>
                                        <p class="text-[10px] font-bold text-emerald-800 uppercase mb-0.5">Jonathan's Tip</p>
                                        <p class="text-xs text-gray-600 italic">"Best if you’ve served and want maximum benefits. It is unbeatable."</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- USDA -->
                        <div class="border border-amber-200 rounded-xl overflow-hidden transition-all duration-300 hover:shadow-md group loan-card" data-type="usda">
                            <button onclick="toggleLoanAccordion(this)" class="w-full flex items-center justify-between p-4 bg-white hover:bg-amber-50/50 text-left transition-colors relative">
                                <div class="flex items-center gap-4">
                                    <div class="w-12 h-12 rounded-full bg-amber-100 flex items-center justify-center text-2xl shadow-sm group-hover:scale-110 transition-transform duration-300">🌾</div>
                                    <div>
                                        <h3 class="font-bold text-allgood-dark text-base">USDA Loan</h3>
                                        <span class="inline-block px-2 py-0.5 rounded text-[10px] font-bold bg-amber-100 text-amber-800 uppercase tracking-wide mt-1">Rural Focus</span>
                                    </div>
                                </div>
                                <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 transform transition-transform duration-300 accordion-arrow"></i>
                            </button>
                            <div class="hidden bg-amber-50 border-t border-amber-100 p-5 animate-pop-in">
                                <p class="text-sm text-gray-700 leading-relaxed mb-4">
                                    Designed for rural buyers. Income limits apply, but it offers 0% down payment options for eligible properties outside major cities.
                                </p>
                                <!-- Mentor Bubble -->
                                <div class="flex gap-3 bg-white p-3 rounded-lg border border-amber-200 shadow-sm relative">
                                    <div class="absolute -left-1 top-4 w-2 h-2 bg-white border-l border-b border-amber-200 transform rotate-45"></div>
                                    <img src="https://github.com/allgoodacademy/ImageAndAssets/blob/main/J.Hurtado_HeadShot.jpg?raw=true" class="w-8 h-8 rounded-full border border-amber-200 object-cover flex-shrink-0">
                                    <div>
                                        <p class="text-[10px] font-bold text-amber-800 uppercase mb-0.5">Jonathan's Tip</p>
                                        <p class="text-xs text-gray-600 italic">"Best if you’re buying outside the city. Great for expanding your search map."</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Creative Financing (The Secret Menu) -->
                        <div class="border border-purple-200 rounded-xl overflow-hidden transition-all duration-300 hover:shadow-md group loan-card" data-type="creative">
                            <button onclick="toggleLoanAccordion(this)" class="w-full flex items-center justify-between p-4 bg-white hover:bg-purple-50/50 text-left transition-colors relative">
                                <div class="flex items-center gap-4">
                                    <!-- Handshake Icon -->
                                    <div class="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center text-2xl shadow-sm group-hover:scale-110 transition-transform duration-300">
                                        <i data-lucide="handshake" class="w-6 h-6 text-purple-600"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-bold text-allgood-dark text-base">Creative Financing</h3>
                                        <span class="inline-block px-2 py-0.5 rounded text-[10px] font-bold bg-purple-100 text-purple-800 uppercase tracking-wide mt-1">The "Secret Menu"</span>
                                    </div>
                                </div>
                                <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 transform transition-transform duration-300 accordion-arrow"></i>
                            </button>
                            <div class="hidden bg-purple-50 border-t border-purple-100 p-5 animate-pop-in">
                                <p class="text-sm text-gray-700 leading-relaxed mb-4">
                                    When the bank says "No," we build our own deal. <strong>Owner Financing</strong> (Seller acts as the bank) or <strong>Assumable Mortgages</strong> (taking over a low-interest loan) can save deals that look dead on paper.
                                </p>
                                <!-- Mentor Bubble -->
                                <div class="flex gap-3 bg-white p-3 rounded-lg border border-purple-200 shadow-sm relative">
                                    <div class="absolute -left-1 top-4 w-2 h-2 bg-white border-l border-b border-purple-200 transform rotate-45"></div>
                                    <img src="https://github.com/allgoodacademy/ImageAndAssets/blob/main/J.Hurtado_HeadShot.jpg?raw=true" class="w-8 h-8 rounded-full border border-purple-200 object-cover flex-shrink-0">
                                    <div>
                                        <p class="text-[10px] font-bold text-purple-800 uppercase mb-0.5">Jonathan's Tip</p>
                                        <p class="text-xs text-gray-600 italic">"Banks have rigid boxes. If you don't fit, we build our own box. This is exactly why you need a pro realtor in your corner."</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Page 15: Do (Loan Quiz) -->
                <div class="page" id="page-15">
                    <section class="mb-4 border-b border-gray-200 pb-2 flex justify-between items-center">
                        <h2 class="text-2xl font-heading font-bold text-allgood-dark">Challenge: Matchmaker</h2>
                        <div class="flex items-center gap-1 bg-yellow-50 px-2 py-1 rounded border border-yellow-200" id="key-counter">
                            <i data-lucide="key" class="w-4 h-4 text-yellow-500 fill-current"></i>
                            <span class="text-xs font-bold text-yellow-700">0/3</span>
                        </div>
                    </section>
                    
                    <p class="text-sm text-gray-600 mb-6">
                        Match the buyer to the correct loan type to earn your keys.
                    </p>

                    <div id="loan-quiz-container" class="space-y-6">
                        <!-- Question 1 -->
                        <div class="quiz-item" data-id="1">
                            <p class="text-sm font-bold text-allgood-dark mb-3">1. "I have a 620 credit score and only 3.5% saved for a down payment."</p>
                            <div class="grid grid-cols-2 gap-3">
                                <button onclick="checkLoanQuiz(this, 'FHA', 1)" class="p-3 border rounded-lg text-xs font-bold hover:bg-gray-50 transition-colors text-center">FHA Loan</button>
                                <button onclick="checkLoanQuiz(this, 'Conv', 1)" class="p-3 border rounded-lg text-xs font-bold hover:bg-gray-50 transition-colors text-center">Conventional</button>
                            </div>
                        </div>

                        <!-- Question 2 -->
                        <div class="quiz-item opacity-50 pointer-events-none transition-opacity" data-id="2">
                            <p class="text-sm font-bold text-allgood-dark mb-3">2. "I am an Army Veteran and want to buy a home with $0 down."</p>
                            <div class="grid grid-cols-2 gap-3">
                                <button onclick="checkLoanQuiz(this, 'USDA', 2)" class="p-3 border rounded-lg text-xs font-bold hover:bg-gray-50 transition-colors text-center">USDA Loan</button>
                                <button onclick="checkLoanQuiz(this, 'VA', 2)" class="p-3 border rounded-lg text-xs font-bold hover:bg-gray-50 transition-colors text-center">VA Loan</button>
                            </div>
                        </div>

                        <!-- Question 3 -->
                        <div class="quiz-item opacity-50 pointer-events-none transition-opacity" data-id="3">
                            <p class="text-sm font-bold text-allgood-dark mb-3">3. "I have excellent credit (760) and want to avoid PMI in the long run."</p>
                            <div class="grid grid-cols-2 gap-3">
                                <button onclick="checkLoanQuiz(this, 'Conv', 3)" class="p-3 border rounded-lg text-xs font-bold hover:bg-gray-50 transition-colors text-center">Conventional</button>
                                <button onclick="checkLoanQuiz(this, 'FHA', 3)" class="p-3 border rounded-lg text-xs font-bold hover:bg-gray-50 transition-colors text-center">FHA Loan</button>
                            </div>
                        </div>
                    </div>

                    <div id="loan-quiz-feedback" class="mt-6 hidden text-center animate-pop-in">
                        <div class="inline-block p-4 bg-emerald-50 border border-emerald-200 rounded-full shadow-sm mb-2">
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">🎉</span>
                                <span class="font-heading font-bold text-emerald-800">Keys Secured!</span>
                                <span class="text-2xl">🔑</span>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500">You know your funding options.</p>
                        <button onclick="nextPage()" class="mt-4 text-allgood-primary font-bold text-sm hover:underline">Continue Journey &rarr;</button>
                    </div>

                </div>

                <!-- Page 16: Do (Doc Checklist) -->
                <div class="page" id="page-16">
                    <section class="mb-4 border-b border-gray-200 pb-2"><h2 class="text-2xl font-heading font-bold text-allgood-dark">Challenge: The Document Hunt</h2></section>
                    <p class="text-sm text-gray-600 mb-4">Select the 3 critical docs needed for Pre-Approval.</p>
                    <div class="space-y-2" id="doc-list">
                        <button onclick="toggleDoc(this)" class="w-full p-3 bg-white border rounded text-left text-sm font-bold doc-btn" data-valid="true">W-2s (Last 2 Years)</button>
                        <button onclick="toggleDoc(this)" class="w-full p-3 bg-white border rounded text-left text-sm font-bold doc-btn" data-valid="false">Gym Membership Contract</button>
                        <button onclick="toggleDoc(this)" class="w-full p-3 bg-white border rounded text-left text-sm font-bold doc-btn" data-valid="true">Bank Statements (Last 2 Mos)</button>
                        <button onclick="toggleDoc(this)" class="w-full p-3 bg-white border rounded text-left text-sm font-bold doc-btn" data-valid="true">Pay Stubs (Last 30 Days)</button>
                    </div>
                    <button onclick="checkDocs()" class="mt-4 w-full bg-allgood-primary text-white font-bold py-2 rounded">Submit to Lender</button>
                    <div id="doc-feedback" class="mt-2 hidden text-sm font-bold text-center"></div>
                </div>

                <!-- PHASE IV: THE SEARCH (Days 14-7) -->

                <!-- Page 17: Phase 4 Intro (MAX'S SEARCH) -->
                <div class="page" id="page-17">
                    <section class="mb-4 border-b border-gray-200 pb-2"><h2 class="text-2xl font-heading font-bold text-allgood-dark">Phase 4: The Search</h2></section>
                    
                    <div class="p-6 bg-white border border-gray-200 rounded-lg shadow-sm relative overflow-hidden mb-6">
                        <div class="absolute top-0 left-0 bg-gray-100 px-3 py-1 rounded-br text-[10px] font-bold text-gray-500 uppercase tracking-wider border-b border-r border-gray-200">Video Script Preview</div>
                        <div class="mt-4 flex gap-4">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 bg-gray-200 rounded-full overflow-hidden border-2 border-white shadow-sm">
                                    <img src="https://github.com/allgoodacademy/ImageAndAssets/blob/main/J.Hurtado_HeadShot.jpg?raw=true" alt="Jonathan" class="w-full h-full object-cover">
                                </div>
                            </div>
                            <div class="space-y-3">
                                <p class="text-sm font-heading font-bold text-allgood-dark">Jonathan:</p>
                                <p class="text-sm text-gray-600 font-body leading-relaxed italic">"Max is excited. He found a house online with a renovated kitchen. It looks perfect. But the algorithm didn't tell him the roof is 20 years old and the neighborhood is in a flood zone.</p>
                                <p class="text-sm text-gray-600 font-body leading-relaxed italic">In <strong>Phase 4</strong>, we teach Max to look past the fresh paint. We are hunting for value and safety, not just curb appeal. It's time for Max to learn the difference between a 'House' and a 'Home'."</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Page 18: Tell (Criteria) - Moved from P19 -->
                <div class="page" id="page-18">
                    <section class="mb-4 border-b border-gray-200 pb-2"><h2 class="text-2xl font-heading font-bold text-allgood-dark">Briefing: The "Unicorn" Problem</h2></section>
                    <p class="text-sm text-gray-600 mb-6 font-body leading-relaxed">
                        In real estate, you can usually pick <strong>two</strong> of these three. You rarely get all three.
                    </p>
                    <div class="grid grid-cols-1 gap-4">
                        <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg flex items-center gap-4">
                            <div class="bg-white p-2 rounded-full text-blue-600 shadow-sm"><i data-lucide="map-pin" class="w-6 h-6"></i></div>
                            <div>
                                <strong class="text-allgood-dark block">Location</strong>
                                <span class="text-xs text-gray-600">The specific neighborhood or school district.</span>
                            </div>
                        </div>
                        <div class="bg-green-50 border border-green-200 p-4 rounded-lg flex items-center gap-4">
                            <div class="bg-white p-2 rounded-full text-green-600 shadow-sm"><i data-lucide="dollar-sign" class="w-6 h-6"></i></div>
                            <div>
                                <strong class="text-allgood-dark block">Price</strong>
                                <span class="text-xs text-gray-600">Fitting your budget comfortably.</span>
                            </div>
                        </div>
                        <div class="bg-orange-50 border border-orange-200 p-4 rounded-lg flex items-center gap-4">
                            <div class="bg-white p-2 rounded-full text-orange-600 shadow-sm"><i data-lucide="sparkles" class="w-6 h-6"></i></div>
                            <div>
                                <strong class="text-allgood-dark block">Condition</strong>
                                <span class="text-xs text-gray-600">Move-in ready vs. fixer-upper.</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Page 19: Do (Needs vs Wants) - Moved from P20 -->
                <div class="page" id="page-19">
                    <section class="mb-4 border-b border-gray-200 pb-2"><h2 class="text-2xl font-heading font-bold text-allgood-dark">Challenge: Needs vs. Wants</h2></section>
                    <p class="text-sm text-gray-600 mb-4">Select your top 3 <strong>Non-Negotiables</strong>. Everything else is a bonus.</p>
                    <div class="grid grid-cols-2 gap-3" id="tradeoff-grid-p20">
                        <div class="p-3 border rounded text-xs font-bold text-center cursor-pointer hover:bg-gray-50 bg-white transition-colors" onclick="toggleTradeP20(this)">Good Schools</div>
                        <div class="p-3 border rounded text-xs font-bold text-center cursor-pointer hover:bg-gray-50 bg-white transition-colors" onclick="toggleTradeP20(this)">Pool</div>
                        <div class="p-3 border rounded text-xs font-bold text-center cursor-pointer hover:bg-gray-50 bg-white transition-colors" onclick="toggleTradeP20(this)">3+ Bedrooms</div>
                        <div class="p-3 border rounded text-xs font-bold text-center cursor-pointer hover:bg-gray-50 bg-white transition-colors" onclick="toggleTradeP20(this)">Granite Counters</div>
                        <div class="p-3 border rounded text-xs font-bold text-center cursor-pointer hover:bg-gray-50 bg-white transition-colors" onclick="toggleTradeP20(this)">Safe Neighborhood</div>
                        <div class="p-3 border rounded text-xs font-bold text-center cursor-pointer hover:bg-gray-50 bg-white transition-colors" onclick="toggleTradeP20(this)">Smart Home Tech</div>
                        <!-- NEW ITEMS ADDED BELOW -->
                        <div class="p-3 border rounded text-xs font-bold text-center cursor-pointer hover:bg-gray-50 bg-white transition-colors" onclick="toggleTradeP20(this)">Home Office</div>
                        <div class="p-3 border rounded text-xs font-bold text-center cursor-pointer hover:bg-gray-50 bg-white transition-colors" onclick="toggleTradeP20(this)">Fenced Yard</div>
                        <div class="p-3 border rounded text-xs font-bold text-center cursor-pointer hover:bg-gray-50 bg-white transition-colors" onclick="toggleTradeP20(this)">2-Car Garage</div>
                        <div class="p-3 border rounded text-xs font-bold text-center cursor-pointer hover:bg-gray-50 bg-white transition-colors" onclick="toggleTradeP20(this)">Move-in Ready</div>
                    </div>
                    <div id="tradeoff-feedback-p20" class="mt-4 text-center text-sm font-bold text-allgood-primary">Selected: 0/3</div>
                </div>

                <!-- Page 20: Tell (Online Tools) - Visual Overhaul -->
                <div class="page" id="page-20">
                    <section class="mb-4 border-b border-gray-200 pb-2"><h2 class="text-2xl font-heading font-bold text-allgood-dark">Briefing: Speed vs. Truth</h2></section>
                    
                    <p class="text-sm text-gray-600 mb-6 font-body leading-relaxed">
                        Online estimates are fast, but lenders don't trust them. Here is why the bank ignores the Zestimate® and why you should too when making an offer.
                    </p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- The Algorithm -->
                        <div class="bg-gray-50 border-2 border-gray-200 rounded-lg p-5 flex flex-col items-center text-center relative overflow-hidden transition-transform hover:shadow-md">
                            <div class="absolute top-0 right-0 bg-gray-200 text-gray-600 text-[10px] font-bold px-2 py-1 rounded-bl uppercase tracking-wide">Fast but Blind</div>
                            <div class="w-14 h-14 bg-white rounded-full flex items-center justify-center border border-gray-200 mb-3 shadow-sm">
                                <i data-lucide="clock" class="w-6 h-6 text-gray-400"></i>
                            </div>
                            <h3 class="font-bold text-lg text-gray-700 mb-1">The Algorithm</h3>
                            <p class="text-xs text-gray-500 mb-4">(Zestimate®, Redfin Est)</p>
                            
                            <ul class="text-xs text-left space-y-2 w-full bg-white p-3 rounded border border-gray-100 shadow-inner mb-3">
                                <li class="flex items-start gap-2"><i data-lucide="x-circle" class="w-3 h-3 text-red-400 mt-0.5 flex-shrink-0"></i> <span class="text-gray-600">Never saw the kitchen</span></li>
                                <li class="flex items-start gap-2"><i data-lucide="x-circle" class="w-3 h-3 text-red-400 mt-0.5 flex-shrink-0"></i> <span class="text-gray-600">Misses structural issues</span></li>
                                <li class="flex items-start gap-2"><i data-lucide="check-circle" class="w-3 h-3 text-gray-400 mt-0.5 flex-shrink-0"></i> <span class="text-gray-600">Good for rough sorting</span></li>
                            </ul>
                            
                            <div class="w-full py-2 bg-gray-200 text-gray-600 font-bold text-xs rounded uppercase tracking-wide">
                                Accuracy: Low
                            </div>
                        </div>

                        <!-- The Appraisal -->
                        <div class="bg-emerald-50 border-2 border-emerald-200 rounded-lg p-5 flex flex-col items-center text-center relative overflow-hidden shadow-sm transform md:scale-[1.05] z-10 hover:shadow-lg transition-shadow">
                            <div class="absolute top-0 right-0 bg-emerald-200 text-emerald-800 text-[10px] font-bold px-2 py-1 rounded-bl uppercase tracking-wide">The Gold Standard</div>
                            <div class="w-14 h-14 bg-white rounded-full flex items-center justify-center border border-emerald-100 mb-3 shadow-sm">
                                <i data-lucide="scale" class="w-6 h-6 text-emerald-600"></i>
                            </div>
                            <h3 class="font-bold text-lg text-emerald-900 mb-1">The Appraisal</h3>
                            <p class="text-xs text-emerald-700 mb-4">(Licensed Human Expert)</p>
                            
                            <ul class="text-xs text-left space-y-2 w-full bg-white p-3 rounded border border-emerald-100 shadow-inner mb-3">
                                <li class="flex items-start gap-2"><i data-lucide="check-circle" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> <span class="text-gray-700">Inspects inside & out</span></li>
                                <li class="flex items-start gap-2"><i data-lucide="check-circle" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> <span class="text-gray-700">Verifies recent sold comps</span></li>
                                <li class="flex items-start gap-2"><i data-lucide="check-circle" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> <span class="text-gray-700">Required by Lender</span></li>
                            </ul>
                            
                            <div class="w-full py-2 bg-emerald-600 text-white font-bold text-xs rounded uppercase tracking-wide shadow-md">
                                Accuracy: High
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Page 21: Do (The Buyer's Field Test) - CONSOLIDATED -->
                <div class="page" id="page-21">
                    <section class="mb-4 border-b border-gray-200 pb-2 flex justify-between items-center">
                        <h2 class="text-2xl font-heading font-bold text-allgood-dark">Challenge: Field Test</h2>
                        <div class="flex items-center gap-1 bg-yellow-50 px-2 py-1 rounded border border-yellow-200" id="field-score">
                            <i data-lucide="shield" class="w-4 h-4 text-yellow-600 fill-current"></i>
                            <span class="text-xs font-bold text-yellow-800">0/3</span>
                        </div>
                    </section>
                    
                    <p class="text-sm text-gray-600 mb-6">
                        Due diligence is a 3-part defense system. Pass all three checks to clear the property for an offer.
                    </p>

                    <div class="space-y-4">
                        
                        <!-- Check 1: Legal (Open House) -->
                        <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm" id="check-legal">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="bg-blue-100 p-2 rounded text-blue-600"><i data-lucide="users" class="w-5 h-5"></i></div>
                                <h3 class="font-bold text-allgood-dark text-sm">1. Legal Check</h3>
                            </div>
                            <p class="text-xs text-gray-600 mb-3 italic">"You are at an open house. The hosting agent asks: 'Are you working with an agent?'"</p>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="runFieldTest(this, 'legal', true)" class="p-2 border rounded text-xs font-bold hover:bg-gray-50 transition-colors">"Yes, I have a rep."</button>
                                <button onclick="runFieldTest(this, 'legal', false)" class="p-2 border rounded text-xs font-bold hover:bg-gray-50 transition-colors">"No, not really."</button>
                            </div>
                            <div class="feedback hidden mt-2 text-xs font-bold"></div>
                        </div>

                        <!-- Check 2: Structural (Red Flags) -->
                        <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm opacity-50 pointer-events-none transition-all" id="check-structural">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="bg-orange-100 p-2 rounded text-orange-600"><i data-lucide="alert-triangle" class="w-5 h-5"></i></div>
                                <h3 class="font-bold text-allgood-dark text-sm">2. Structural Check</h3>
                            </div>
                            <p class="text-xs text-gray-600 mb-3 italic">"You see two issues. Which one is the expensive deal-breaker?"</p>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="runFieldTest(this, 'structural', false)" class="p-2 border rounded text-xs font-bold hover:bg-gray-50 transition-colors">Ugly Wallpaper</button>
                                <button onclick="runFieldTest(this, 'structural', true)" class="p-2 border rounded text-xs font-bold hover:bg-gray-50 transition-colors">Foundation Cracks</button>
                            </div>
                            <div class="feedback hidden mt-2 text-xs font-bold"></div>
                        </div>

                        <!-- Check 3: Financial (Title) -->
                        <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm opacity-50 pointer-events-none transition-all" id="check-financial">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="bg-emerald-100 p-2 rounded text-emerald-600"><i data-lucide="file-check" class="w-5 h-5"></i></div>
                                <h3 class="font-bold text-allgood-dark text-sm">3. Financial Check</h3>
                            </div>
                            <p class="text-xs text-gray-600 mb-3 italic">"A stranger knocks and claims they inherited this land 10 years ago. What protects you?"</p>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="runFieldTest(this, 'financial', false)" class="p-2 border rounded text-xs font-bold hover:bg-gray-50 transition-colors">Home Insurance</button>
                                <button onclick="runFieldTest(this, 'financial', true)" class="p-2 border rounded text-xs font-bold hover:bg-gray-50 transition-colors">Title Insurance</button>
                            </div>
                            <div class="feedback hidden mt-2 text-xs font-bold"></div>
                        </div>

                    </div>
                    
                    <div id="field-test-complete" class="mt-6 hidden text-center animate-pop-in">
                        <div class="inline-block px-4 py-2 bg-emerald-600 text-white rounded-full text-sm font-bold shadow-md">
                            <i data-lucide="check-circle-2" class="inline w-4 h-4 mr-1"></i> Due Diligence Passed
                        </div>
                        <button onclick="nextPage()" class="block w-full mt-4 text-allgood-primary font-bold text-sm hover:underline">Proceed to Offer &rarr;</button>
                    </div>
                </div>

                <!-- PHASE V: OFFER & CLOSING (Days 7-0) -->

                <!-- Page 22: Phase 5 Intro (MAX'S OFFER) -->
                <div class="page" id="page-22">
                    <section class="mb-4 border-b border-gray-200 pb-2"><h2 class="text-2xl font-heading font-bold text-allgood-dark">Phase 5: The Offer</h2></section>
                    
                    <div class="p-6 bg-white border border-gray-200 rounded-lg shadow-sm relative overflow-hidden mb-6">
                        <div class="absolute top-0 left-0 bg-gray-100 px-3 py-1 rounded-br text-[10px] font-bold text-gray-500 uppercase tracking-wider border-b border-r border-gray-200">Video Script Preview</div>
                        <div class="mt-4 flex gap-4">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 bg-gray-200 rounded-full overflow-hidden border-2 border-white shadow-sm">
                                    <img src="https://github.com/allgoodacademy/ImageAndAssets/blob/main/J.Hurtado_HeadShot.jpg?raw=true" alt="Jonathan" class="w-full h-full object-cover">
                                </div>
                            </div>
                            <div class="space-y-3">
                                <p class="text-sm font-heading font-bold text-allgood-dark">Jonathan:</p>
                                <p class="text-sm text-gray-600 font-body leading-relaxed italic">"Max found The One. But there are 3 other offers. Max wants to offer $20k over asking price just to win. I told him to pause.</p>
                                <p class="text-sm text-gray-600 font-body leading-relaxed italic">Winning isn't just about the highest price; it's about terms. In <strong>Phase 5</strong>, we craft a strategy to get Max the keys without overpaying. We need to talk about the Appraisal Gap and Contingencies. Let's close this deal."</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Page 23: Do (The Price is Right - NEW) -->
                <div class="page" id="page-23">
                    <section class="mb-4 border-b border-gray-200 pb-2"><h2 class="text-2xl font-heading font-bold text-allgood-dark">Challenge: The Price is Right</h2></section>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Market Intel -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-5 shadow-sm">
                            <h3 class="font-bold text-blue-900 text-sm mb-3 flex items-center gap-2">
                                <i data-lucide="bar-chart-2" class="w-4 h-4"></i> Market Intel (Comps)
                            </h3>
                            <div class="space-y-3">
                                <div class="bg-white p-2 rounded border border-blue-100 text-xs shadow-sm">
                                    <strong class="block text-gray-700">Comp 1: 123 Oak St</strong>
                                    <span class="text-gray-500">Exact Match Model. Sold last week.</span>
                                    <div class="font-bold text-allgood-dark mt-1">$435,000</div>
                                </div>
                                <div class="bg-white p-2 rounded border border-blue-100 text-xs shadow-sm">
                                    <strong class="block text-gray-700">Comp 2: 125 Pine St</strong>
                                    <span class="text-gray-500">Better Kitchen. Sold 2 weeks ago.</span>
                                    <div class="font-bold text-allgood-dark mt-1">$440,000</div>
                                </div>
                                <div class="bg-blue-100 p-2 rounded border border-blue-200 text-xs mt-4">
                                    <strong class="block text-blue-900">SUBJECT PROPERTY</strong>
                                    <span class="text-blue-800">Listed 45 Days Ago.</span>
                                    <div class="font-bold text-blue-900 mt-1 text-lg">$450,000</div>
                                </div>
                            </div>
                        </div>

                        <!-- The Offer -->
                        <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm flex flex-col justify-center">
                            <h3 class="font-bold text-allgood-dark text-sm mb-4">Make Your Opening Offer</h3>
                            <div class="space-y-3">
                                <button onclick="runPricingSim(this, 'low')" class="w-full p-4 border rounded-lg text-left hover:bg-gray-50 transition-all group border-l-4 border-l-transparent hover:border-l-orange-400 shadow-sm relative overflow-hidden bg-white">
                                    <strong class="block text-sm text-gray-800 relative z-10">Offer $400k</strong>
                                    <span class="text-xs text-gray-500 relative z-10">Aggressive (-11%)</span>
                                </button>
                                <button onclick="runPricingSim(this, 'data')" class="w-full p-4 border rounded-lg text-left hover:bg-gray-50 transition-all group border-l-4 border-l-transparent hover:border-l-allgood-primary shadow-sm relative overflow-hidden bg-white">
                                    <strong class="block text-sm text-gray-800 relative z-10">Offer $435k</strong>
                                    <span class="text-xs text-gray-500 relative z-10">Data Driven (Matches Comp 1)</span>
                                </button>
                                <button onclick="runPricingSim(this, 'high')" class="w-full p-4 border rounded-lg text-left hover:bg-gray-50 transition-all group border-l-4 border-l-transparent hover:border-l-green-500 shadow-sm relative overflow-hidden bg-white">
                                    <strong class="block text-sm text-gray-800 relative z-10">Offer $450k</strong>
                                    <span class="text-xs text-gray-500 relative z-10">Full Asking Price</span>
                                </button>
                            </div>
                            <div id="pricing-feedback" class="hidden mt-4 text-xs font-bold p-3 rounded leading-relaxed animate-pop-in font-body"></div>
                        </div>
                    </div>
                </div>

                <!-- Page 24: Tell (Contracts) -->
                <div class="page" id="page-24">
                    <section class="mb-4 border-b border-gray-200 pb-2 flex justify-between items-end">
                        <div>
                            <h2 class="text-2xl font-heading font-bold text-allgood-dark">Briefing: The Safety Net</h2>
                            <p class="text-xs text-gray-500 mt-1">Master these 3 contingencies to protect your deposit.</p>
                        </div>
                    </section>
                    
                    <p class="text-sm text-gray-600 mb-6 font-body leading-relaxed">
                        Your offer is a legal contract with "trap doors." Understand exactly when you can walk away safely. Click to explore each safety net.
                    </p>
                    
                    <div class="space-y-3" id="contract-accordion">
                        
                        <!-- Inspection Contingency -->
                        <div class="border border-orange-200 rounded-lg overflow-hidden group contract-card">
                            <button onclick="toggleContractAccordion(this)" class="w-full flex items-center justify-between p-4 bg-white hover:bg-orange-50 transition-colors text-left relative">
                                <div class="flex items-center gap-3">
                                    <div class="bg-orange-100 p-2 rounded text-orange-600"><i data-lucide="search" class="w-5 h-5"></i></div>
                                    <h3 class="font-bold text-allgood-dark text-sm">1. Inspection Contingency</h3>
                                </div>
                                <i data-lucide="chevron-down" class="w-4 h-4 text-gray-400 transform transition-transform duration-300 accordion-arrow"></i>
                            </button>
                            <div class="hidden bg-orange-50 border-t border-orange-100 p-4 animate-pop-in">
                                <p class="text-xs text-gray-700 mb-3 font-bold">Standard Inspection Period: 7-15 Days</p>
                                <div class="bg-white p-3 rounded border border-orange-200 mb-3">
                                    <p class="text-[10px] font-bold text-orange-800 uppercase mb-1">Critical Checks (Florida Focus):</p>
                                    <ul class="text-xs text-gray-600 space-y-1 list-disc pl-4">
                                        <li><strong>General Home:</strong> Roof, HVAC, Electrical, Plumbing.</li>
                                        <li><strong>WDO (Termite):</strong> Wood Destroying Organisms.</li>
                                        <li><strong>Sewer Scope:</strong> Check for roots/collapse (Critical for older homes).</li>
                                        <li><strong>4-Point:</strong> Often required for insurance on homes 20+ years old.</li>
                                    </ul>
                                </div>
                                <!-- Pro Strategy -->
                                <div class="flex gap-2 items-start bg-orange-100 p-2 rounded border border-orange-200">
                                    <i data-lucide="zap" class="w-4 h-4 text-allgood-primary mt-0.5 flex-shrink-0"></i>
                                    <div>
                                        <strong class="text-xs text-allgood-primary block">Pro Strategy: Quality Control</strong>
                                        <p class="text-[10px] text-gray-700 leading-snug">
                                            Credits are usually safer (you control the hire). But if you ask the seller for repairs, you must <strong>mandate licensed professionals</strong> in the contract. Require paid receipts and lien waivers before closing to avoid "Band-Aid" fixes.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Appraisal Contingency -->
                        <div class="border border-blue-200 rounded-lg overflow-hidden group contract-card">
                            <button onclick="toggleContractAccordion(this)" class="w-full flex items-center justify-between p-4 bg-white hover:bg-blue-50 transition-colors text-left relative">
                                <div class="flex items-center gap-3">
                                    <div class="bg-blue-100 p-2 rounded text-blue-600"><i data-lucide="scale" class="w-5 h-5"></i></div>
                                    <h3 class="font-bold text-allgood-dark text-sm">2. Appraisal Contingency</h3>
                                </div>
                                <i data-lucide="chevron-down" class="w-4 h-4 text-gray-400 transform transition-transform duration-300 accordion-arrow"></i>
                            </button>
                            <div class="hidden bg-blue-50 border-t border-blue-100 p-4 animate-pop-in">
                                <p class="text-xs text-gray-700 mb-3">Ensures you don't overpay. If the bank says it's worth less than the offer price, you have options.</p>
                                <div class="grid grid-cols-2 gap-2 text-center">
                                    <div class="bg-white p-2 rounded border border-blue-200">
                                        <strong class="block text-xs text-blue-800">Low Appraisal?</strong>
                                        <span class="text-[10px] text-gray-500">Seller lowers price.</span>
                                    </div>
                                    <div class="bg-white p-2 rounded border border-blue-200">
                                        <strong class="block text-xs text-blue-800">Gap Coverage?</strong>
                                        <span class="text-[10px] text-gray-500">Buyer pays difference in cash.</span>
                                    </div>
                                </div>
                                <p class="text-[10px] text-gray-500 mt-2 italic">*If we can't agree on the gap, you walk away with your deposit.</p>
                            </div>
                        </div>

                        <!-- Finance Contingency -->
                        <div class="border border-green-200 rounded-lg overflow-hidden group contract-card">
                            <button onclick="toggleContractAccordion(this)" class="w-full flex items-center justify-between p-4 bg-white hover:bg-green-50 transition-colors text-left relative">
                                <div class="flex items-center gap-3">
                                    <div class="bg-green-100 p-2 rounded text-green-600"><i data-lucide="dollar-sign" class="w-5 h-5"></i></div>
                                    <h3 class="font-bold text-allgood-dark text-sm">3. Finance Contingency</h3>
                                </div>
                                <i data-lucide="chevron-down" class="w-4 h-4 text-gray-400 transform transition-transform duration-300 accordion-arrow"></i>
                            </button>
                            <div class="hidden bg-green-50 border-t border-green-100 p-4 animate-pop-in">
                                <p class="text-xs text-gray-700 mb-3">Protects you if the loan is denied. But remember, the "Buyer Beware" rules still apply! Don't sabotage yourself.</p>
                                
                                <div class="bg-red-50 border border-red-200 p-2 rounded mb-2">
                                    <strong class="text-xs text-red-700 flex items-center gap-1"><i data-lucide="alert-octagon" class="w-3 h-3"></i> Deal Killers (Don't Do This):</strong>
                                    <ul class="text-[10px] text-red-800 list-disc pl-4 mt-1 space-y-0.5">
                                        <li>Quitting your job or changing income structure.</li>
                                        <li>Buying a new car or furniture on credit.</li>
                                        <li>Making large, unexplained cash deposits.</li>
                                    </ul>
                                </div>
                                <p class="text-[10px] text-gray-500 italic">If the loan fails because of <strong>your</strong> actions, you could lose your deposit.</p>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Page 25: Do (The Closing Gauntlet - CONSOLIDATED) -->
                <div class="page" id="page-25">
                    <section class="mb-4 border-b border-gray-200 pb-2 flex justify-between items-center">
                        <h2 class="text-2xl font-heading font-bold text-allgood-dark">Challenge: Closing Gauntlet</h2>
                        <div class="flex items-center gap-1 bg-yellow-50 px-2 py-1 rounded border border-yellow-200" id="gauntlet-score">
                            <i data-lucide="flag" class="w-4 h-4 text-yellow-600 fill-current"></i>
                            <span class="text-xs font-bold text-yellow-800">0/4</span>
                        </div>
                    </section>
                    
                    <p class="text-sm text-gray-600 mb-6">
                        Closing is a sprint. Clear these 4 hurdles to secure the keys.
                    </p>

                    <div class="space-y-4">
                        
                        <!-- Step 1: Earnest Money -->
                        <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm" id="gauntlet-step-1">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-bold text-allgood-dark text-sm flex items-center gap-2"><i data-lucide="dollar-sign" class="w-4 h-4 text-green-600"></i> 1. Earnest Money</h3>
                                <span class="text-[10px] text-gray-400 font-bold uppercase">Day 1-3</span>
                            </div>
                            <p class="text-xs text-gray-600 mb-3">Deposit shows intent. Miss the deadline, lose the house.</p>
                            <button onclick="runGauntlet(this, 1)" class="w-full py-2 bg-green-50 hover:bg-green-100 border border-green-200 text-green-800 font-bold rounded text-xs transition-colors flex items-center justify-center gap-2">
                                <i data-lucide="send" class="w-3 h-3"></i> Wire Deposit to Title Company
                            </button>
                        </div>

                        <!-- Step 2: Inspection (Locked) -->
                        <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm opacity-50 pointer-events-none transition-all" id="gauntlet-step-2">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-bold text-allgood-dark text-sm flex items-center gap-2"><i data-lucide="search" class="w-4 h-4 text-orange-600"></i> 2. Inspection</h3>
                                <span class="text-[10px] text-gray-400 font-bold uppercase">Day 7-10</span>
                            </div>
                            <p class="text-xs text-gray-600 mb-3">Report found a broken AC unit. What is your move?</p>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="runGauntlet(this, 2, 'repair')" class="p-2 border rounded text-xs font-bold hover:bg-gray-50 transition-colors text-center">Ask Seller to Fix</button>
                                <button onclick="runGauntlet(this, 2, 'credit')" class="p-2 border rounded text-xs font-bold hover:bg-gray-50 transition-colors text-center">Ask for Credit ($)</button>
                            </div>
                            <div class="feedback hidden mt-2 text-xs font-bold"></div>
                        </div>

                        <!-- Step 3: Walkthrough (Locked) -->
                        <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm opacity-50 pointer-events-none transition-all" id="gauntlet-step-3">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-bold text-allgood-dark text-sm flex items-center gap-2"><i data-lucide="footprints" class="w-4 h-4 text-blue-600"></i> 3. Final Walkthrough</h3>
                                <span class="text-[10px] text-gray-400 font-bold uppercase">Closing Day</span>
                            </div>
                            <p class="text-xs text-gray-600 mb-3">Verify the house is empty and repairs are done.</p>
                            <button onclick="runGauntlet(this, 3)" class="w-full py-2 bg-blue-50 hover:bg-blue-100 border border-blue-200 text-blue-800 font-bold rounded text-xs transition-colors flex items-center justify-center gap-2">
                                <i data-lucide="check-circle" class="w-3 h-3"></i> Verify Condition
                            </button>
                        </div>

                        <!-- Step 4: Security (Locked) -->
                        <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm opacity-50 pointer-events-none transition-all" id="gauntlet-step-4">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-bold text-allgood-dark text-sm flex items-center gap-2"><i data-lucide="lock" class="w-4 h-4 text-red-600"></i> 4. Wire Fraud Check</h3>
                                <span class="text-[10px] text-gray-400 font-bold uppercase">CRITICAL</span>
                            </div>
                            <p class="text-xs text-gray-600 mb-3">You received an email with "Updated Wiring Instructions." Do you send the money?</p>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="runGauntlet(this, 4, 'fail')" class="p-2 border rounded text-xs font-bold hover:bg-gray-50 transition-colors text-center">Yes, Send It</button>
                                <button onclick="runGauntlet(this, 4, 'pass')" class="p-2 border rounded text-xs font-bold hover:bg-gray-50 transition-colors text-center">No, Call to Verify</button>
                            </div>
                            <div class="feedback hidden mt-2 text-xs font-bold"></div>
                        </div>

                    </div>
                    
                    <div id="gauntlet-complete" class="mt-6 hidden text-center animate-pop-in">
                        <div class="inline-block px-4 py-2 bg-emerald-600 text-white rounded-full text-sm font-bold shadow-md">
                            <i data-lucide="key" class="inline w-4 h-4 mr-1"></i> Keys Secured!
                        </div>
                        <button onclick="nextPage()" class="block w-full mt-4 text-allgood-primary font-bold text-sm hover:underline">Take Final Exam &rarr;</button>
                    </div>
                </div>

                <!-- PHASE VI: CERTIFICATION & CTA -->

                <!-- Page 26: Final Exam - Renumbered (Was P29/30) -->
                <div class="page" id="page-26">
                    <section class="mb-4 border-b border-gray-200 pb-2 flex justify-between items-end">
                        <h2 class="text-2xl font-heading font-bold text-allgood-dark">Final Exam: Live Fire</h2>
                        <div class="flex items-center gap-1 bg-allgood-dark text-white px-3 py-1 rounded-full border border-gray-600">
                            <span class="text-xs font-bold uppercase tracking-wider mr-1">Scenario</span>
                            <span id="exam-progress" class="font-mono text-sm font-bold text-allgood-primary">1/5</span>
                        </div>
                    </section>
                    
                    <p class="text-sm text-gray-600 mb-6 font-body leading-relaxed">
                        These are real-world "deal killers." Prove you have the instincts to survive. <br><strong>Goal:</strong> Survive 3/5 scenarios to Certify.
                    </p>

                    <!-- Scenario Container -->
                    <div id="scenario-card" class="bg-white border-2 border-gray-200 rounded-xl p-6 shadow-md relative overflow-hidden min-h-[300px] flex flex-col justify-between">
                        <!-- Content injected via JS -->
                    </div>

                    <!-- Hidden Button for Flow -->
                    <button id="finish-exam-btn" onclick="nextPage()" class="hidden mt-6 w-full bg-allgood-primary text-white font-bold py-3 rounded shadow-lg animate-pop-in">
                        View Results & Certify
                    </button>
                </div>

                <!-- Page 27: Certification - Renumbered (Was P30/31) -->
                <div class="page" id="page-27">
                    <div class="flex flex-col items-center justify-center min-h-full text-center">
                        <div id="badge-container" class="mb-6 transform scale-110"></div>
                        <h2 class="text-2xl font-heading font-bold text-allgood-dark mb-2">Certified Buyer Ready</h2>
                        <p class="text-sm text-gray-600">You have the knowledge. Now get the keys.</p>
                        <button onclick="nextPage()" class="mt-8 bg-allgood-secondary text-white px-6 py-2 rounded-full font-bold">Next Step</button>
                    </div>
                </div>

                <!-- Page 28: CTA - Renumbered (Was P31/32) -->
                <div class="page" id="page-28">
                    <div class="flex flex-col items-center justify-center min-h-full text-center px-6">
                        <!-- CHANGED: Switched to Full Hero Image Container -->
                        <div class="mb-6 relative group max-w-xs w-full">
                            <div class="absolute -inset-1 bg-gradient-to-r from-allgood-primary to-allgood-secondary rounded-xl opacity-20 blur transition duration-500 group-hover:opacity-40"></div>
                            <img 
                                src="https://github.com/allgoodacademy/ImageAndAssets/blob/main/Jonathan%20Hurtado%20(1).png?raw=true" 
                                alt="Jonathan Hurtado" 
                                class="relative w-full h-auto rounded-xl shadow-lg border-2 border-white object-cover"
                            >
                        </div>
                        
                        <h2 class="text-3xl font-heading font-bold text-jonathan-navy mb-4">Let's Find Your Home.</h2>
                        <p class="text-base text-gray-600 mb-8 max-w-md">You've done the work. You know the process. Now, let's execute the strategy.</p>
                        <!-- BRAND INTEGRATION: Button Color -->
                        <a href="https://calendly.com" target="_blank" class="w-full max-w-sm jonathan-btn text-white font-bold py-4 px-8 rounded-lg shadow-xl transition-transform transform hover:scale-105 flex items-center justify-center gap-2">
                            <i data-lucide="calendar-check" class="w-6 h-6"></i>
                            <span>Schedule Priority Consultation</span>
                        </a>
                        <p class="text-xs text-gray-400 mt-8">Schedule your priority consultation with Jonathan Hurtado and start your journey with confidence.</p>
                    </div>
                </div>

                <!-- Page 29: Credits (Standard) -->
                <div class="page" id="page-29">
                    <div class="flex flex-col items-center justify-start h-full text-center px-2 pt-8">
                        <div class="mb-8"><h2 class="text-2xl font-heading font-bold text-allgood-dark">Allgood<span class="text-allgood-primary">Academy</span></h2><p class="text-xs text-gray-400 font-bold tracking-widest uppercase mt-2">Pragmatic Action</p></div>
                        
                        <!-- Feedback -->
                        <div id="feedback-container" class="w-full max-w-md bg-white p-6 rounded-lg shadow-md border border-gray-200 mb-8 text-left relative">
                            <h3 class="font-bold text-allgood-dark text-sm uppercase tracking-wide mb-4 text-center">Rate this GoodBlock</h3>
                            <div class="flex justify-center space-x-2 mb-4" id="star-wrapper">
                                <button onclick="setRating(1)" class="star-btn focus:outline-none transition-transform hover:scale-110" data-val="1"><i id="star-1" class="fas fa-star text-2xl text-gray-300"></i></button>
                                <button onclick="setRating(2)" class="star-btn focus:outline-none transition-transform hover:scale-110" data-val="2"><i id="star-2" class="fas fa-star text-2xl text-gray-300"></i></button>
                                <button onclick="setRating(3)" class="star-btn focus:outline-none transition-transform hover:scale-110" data-val="3"><i id="star-3" class="fas fa-star text-2xl text-gray-300"></i></button>
                                <button onclick="setRating(4)" class="star-btn focus:outline-none transition-transform hover:scale-110" data-val="4"><i id="star-4" class="fas fa-star text-2xl text-gray-300"></i></button>
                                <button onclick="setRating(5)" class="star-btn focus:outline-none transition-transform hover:scale-110" data-val="5"><i id="star-5" class="fas fa-star text-2xl text-gray-300"></i></button>
                            </div>
                            <label class="block text-xs font-bold text-gray-500 mb-2">Your feedback sharpens our tools.</label>
                            <textarea id="feedback-text" rows="2" class="w-full border border-gray-300 rounded p-3 text-sm focus:ring-1 focus:ring-allgood-primary focus:border-allgood-primary outline-none resize-none bg-gray-50" placeholder="Optional: Share your thoughts..."></textarea>
                            <button onclick="submitFeedback()" class="w-full mt-4 bg-allgood-dark hover:bg-allgood-primary text-white font-bold py-2 rounded transition-colors text-sm">Send Feedback</button>
                        </div>

                        <!-- Success State -->
                        <div id="feedback-success" class="hidden w-full max-w-md bg-green-50 p-6 rounded-lg shadow-inner border border-green-200 mb-8 text-center">
                            <i data-lucide="check-circle" class="w-12 h-12 text-green-600 mx-auto mb-2"></i>
                            <h3 class="font-bold text-green-800">Feedback Received.</h3>
                            <p class="text-xs text-green-700 mt-1">Thank you for helping us improve.</p>
                        </div>

                        <!-- About Us -->
                        <div class="w-full max-w-md text-left mx-auto mb-8 mt-12">
                            <button class="accordion-toggle w-full bg-white border border-gray-200 p-4 rounded-lg shadow-sm flex justify-between items-center hover:bg-gray-50 hover:border-allgood-primary transition-all group">
                                <span class="font-heading font-bold text-allgood-dark text-base group-hover:text-allgood-primary transition-colors">About Us</span>
                                <svg class="accordion-icon h-5 w-5 text-gray-400 transform transition-transform duration-300 group-hover:text-allgood-primary" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            </button>
                            <div class="accordion-content hidden bg-white border-x border-b border-gray-200 rounded-b-lg p-4 text-gray-600 shadow-inner">
                                <div class="grid grid-cols-1 gap-3">
                                    <!-- Card 1: The Lab -->
                                    <div class="bg-gray-50 p-4 rounded border-l-4 border-allgood-secondary shadow-sm">
                                        <div class="flex items-center gap-2 mb-2">
                                            <i data-lucide="flask-conical" class="w-5 h-5 text-allgood-secondary"></i>
                                            <h4 class="font-bold text-allgood-dark text-sm uppercase tracking-wide">The Lab</h4>
                                        </div>
                                        <p class="text-xs leading-relaxed">
                                            Allgood Academy is a mission-driven learning hub. We use <strong>advanced instructional design</strong> principles trusted by top corporations to create immersive, high-impact training.
                                        </p>
                                    </div>

                                    <!-- Card 2: The Result -->
                                    <div class="bg-gray-50 p-4 rounded border-l-4 border-allgood-primary shadow-sm">
                                        <div class="flex items-center gap-2 mb-2">
                                            <i data-lucide="zap" class="w-5 h-5 text-allgood-primary"></i>
                                            <h4 class="font-bold text-allgood-dark text-sm uppercase tracking-wide">The Result</h4>
                                        </div>
                                        <p class="text-xs leading-relaxed">
                                            We don't just teach; we transform. Our goal is a complete <strong>mindset shift</strong> that moves learners from passive consumption to <strong>pragmatic, real-world execution</strong>.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- GoodBlock Logo/Link -->
                        <div class="text-center mt-6">
                            <a href="https://www.allgoodacademy.com/goodblocks" target="_blank" class="inline-block group">
                                <span class="font-heading font-bold text-3xl tracking-tight text-allgood-primary static-neon-glow block">
                                    GoodBlock
                                </span>
                            </a>
                        </div>
                    </div>
                </div>


                <!-- 
                    ==========================================================================
                    FIXED CHASSIS START: Footer
                    ========================================================================== 
                -->
                <footer class="footer-content flex items-center justify-between px-6 relative">
                    <div id="flex-progress-bar"><div id="flex-progress-fill"></div></div>
                    
                    <button id="back-button" class="text-allgood-primary hover:text-allgood-dark font-bold text-sm flex items-center transition-colors disabled:opacity-30 disabled:cursor-not-allowed font-body z-10">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                        Back
                    </button>

                    <!-- BRANDING RESTORED -->
                    <div class="absolute left-0 right-0 top-0 bottom-0 flex items-center justify-center pointer-events-none hidden sm:flex">
                        <p class="text-[10px] text-gray-400 font-body pointer-events-auto">
                            <a href="https://www.allgoodacademy.com/goodblocks" target="_blank" class="font-bold hover:text-allgood-primary transition-colors">GoodBlock™</a> 
                            powered by 
                            <a href="https://www.allgoodacademy.com" target="_blank" class="font-bold hover:text-allgood-primary transition-colors">Allgood Academy</a>
                        </p>
                    </div>

                    <button id="next-button" class="bg-allgood-primary text-white hover:bg-allgood-hover font-bold py-2 px-6 rounded-full shadow-md flex items-center transition-all transform hover:scale-105 active:scale-95 text-sm font-body z-10">
                        <span>Next</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                    </button>
                </footer>
            </div>
        </div>
    </main>

    <script>
        /* ==========================================================================
           FIXED CHASSIS START: Global State & Init
           ========================================================================== 
        */
        let currentPage = 0;
        const totalPages = 29;
        let userName = "Learner";
        
        // Page Titles (Restored to Max Narrative Version)
        const pageTitles = [
            "1. Cover: Launchpad", "2. Phase 1: Intro Video", "3. Mission Setup: 3 Pillars", "4. Deep Dive: Readiness", 
            "5. Tell: Affordability Rules", "6. Simulation: Lender's Lens", "7. Phase 2: Intro Video", 
            "8. Do: Affordability Calc", "9. Challenge: Trade-Offs", "10. Challenge: Protect Loan",
            "11. Tell: Credit Power", "12. Briefing: The BBA", "13. Show: Loan Types", "14. Tell: Loan Explorer", "15. Do: Loan Quiz",
            "16. Do: Doc Checklist", "17. Phase 4: Search Hero", "18. Tell: Criteria", "19. Challenge: Needs/Wants", "20. Tell: Online Tools", 
            "21. Challenge: Field Test", "22. Phase 5: Offer Strategy", "23. Challenge: Cash Equation", "24. Tell: Contracts",
            "25. Challenge: Closing Gauntlet",
            "26. Final Exam", "27. Certification", "28. Priority Access", "29. Credits & Feedback"
        ];

        // Narrator Text Map (Restored Max Narrative)
        const narratorText = {
            3: "Max is nervous. He needs to define his 'Why' before he worries about the 'How'. Help Max identify his pillars.",
            4: "Max picked 'Stability' as his anchor. Now, let's look at the rules lenders will use to judge Max's application.",
            5: "Max learns the 'Golden Rules' of affordability. These are the guardrails that will protect his financial stability.",
            6: "Max is a W-2 employee, but he has a side hustle. Run the checks to see if the lender will count his extra income.",
            8: "This calculator is your first defense against overspending. Use your gross income and estimated monthly debts to see where you land on the Lender's 28/36 rule.",
            9: "Max's DTI is too high! He needs to make a trade-off. Help Max decide what to cut to afford his dream home.",
            10: "Max is 'Conditionally Approved,' but he almost bought furniture on credit! Guide him to the safe zone.",
            11: "Max realizes his credit score is the difference between a $2,500 payment and a $2,800 payment. He commits to protecting it.",
            12: "Max hires me. We sign the BBA. Now I am legally bound to fight for Max's wallet, not the seller's.",
            14: "Max only has $15,000 saved. Expand the cards to help him find a loan that fits his savings account.",
            15: "Test Max's knowledge. Match the buyer profile to the right loan to secure his funding strategy.",
            16: "Max needs to prove he's reliable. Help him pack his 'Digital Go-Bag' for the underwriter.",
            18: "Max has champagne dreams with a beer budget. He has to pick 2: Location, Price, or Condition.",
            19: "Max is getting distracted by shiny amenities. Force him to prioritize his true 'Must-Haves'.",
            20: "Max sees a Zestimate of $450k, but I tell him to wait for the Appraisal. See why the algorithm isn't enough.",
            21: "Max is at an Open House. He almost revealed his hand! Run the Field Test to keep him safe.",
            23: "The market has shifted. This house has been sitting for 45 days. Use the 'Comps' to find the fair price. Don't overpay, but don't insult the seller.",
            24: "Max's offer was accepted! But he needs safety nets. Review the contingencies that let him sleep at night.",
            25: "It's the final sprint. Max has 3 days to close. Help him clear the final hurdles and avoid wire fraud.",
            26: "Max is ready. Are you? Prove you have the instincts to handle the real market in this live simulation.",
            27: "You did it. You guided Max to the keys, and now you are Certified Buyer Ready.",
            29: "This interactive experience is a GoodBlock™ — powered by the Allgood Academy. Rate your session below, then explore our full catalog of pragmatic learning courses."
        };

        // State Management
        let selectedTradesP20 = [];
        let walletCount = 0;

        /* ==========================================================================
           FIXED CHASSIS START: Audio Engine
           ========================================================================== 
        */
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;

        function initAudio() {
            if (!audioCtx) {    
                audioCtx = new AudioContext();    
            }
            if (audioCtx.state === 'suspended') {    
                audioCtx.resume().catch(e => console.error("Audio resume failed:", e));
            }
        }

        function playTone(freq, type, duration, vol = 0.1, attack = 0.01, decay = 0.001) {
            initAudio();    
            const now = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, now);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            gain.gain.setValueAtTime(0, now);
            gain.gain.linearRampToValueAtTime(vol, now + attack);    
            gain.gain.exponentialRampToValueAtTime(decay, now + duration);    
            osc.start(now);
            osc.stop(now + duration);
        }

        const sfx = {
            powerOn: () => {
                initAudio();
                const now = audioCtx.currentTime;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(110, now);
                osc.frequency.exponentialRampToValueAtTime(220, now + 0.4);
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(0.4, now + 0.1);
                gain.gain.linearRampToValueAtTime(0, now + 0.4);
                osc.start(now); osc.stop(now + 0.4);
            },
            powerOff: () => {
                initAudio();
                playTone(80, 'triangle', 0.2, 0.5, 0.01, 0.001);
            },
            nav: () => {
                initAudio();
                playTone(150, 'sine', 0.1, 0.1, 0.01, 0.01);
            },
            tick: () => {
                initAudio();
                playTone(1000, 'sine', 0.01, 0.01);
            },
            // NEW: Distinct, clean 'pop' for correct answers and minor achievements.
            success: () => {
                initAudio();
                // CHANGED: Reverted to simple "Tick"/Click per request. 
                // Matches the Page 3 card flip sound.
                playTone(1000, 'sine', 0.01, 0.01); 
            },
            play: (tag) => {
                if (tag === 'powerup') sfx.powerOn();
                else if (tag === 'powerdown' || tag === 'knock') sfx.powerOff();
                else if (tag === 'thunk') sfx.nav(); 
                else if (tag === 'click') sfx.tick(); 
            }
        };

        /* ==========================================================================
           FIXED CHASSIS START: Navigation System & Init
           ========================================================================== 
        */
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            buildExam();
            initWalletDragDrop(); 
            initBuyerChoicesDragDrop(); 

            const pages = document.querySelectorAll('.page');
            const progressBar = document.getElementById('flex-progress-fill');
            const nextBtn = document.getElementById('next-button');
            const backBtn = document.getElementById('back-button');
            const pageIndicator = document.getElementById('header-page-indicator');
            const narratorTextEl = document.getElementById('narrator-message');
            const narratorStrip = document.getElementById('narrator-strip');
            
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.anchor-pill')) {
                    document.querySelectorAll('.anchor-pill').forEach(p => p.classList.remove('active'));
                }
            });

            window.showPage = function(idx) {
                if (idx < 0 || idx >= totalPages) return;
                pages.forEach(p => p.classList.remove('active'));
                document.getElementById(`page-${idx + 1}`).classList.add('active');
                currentPage = idx;
                if(progressBar) progressBar.style.width = `${((idx + 1) / totalPages) * 100}%`;
                if(pageIndicator) pageIndicator.textContent = `${idx + 1} / ${totalPages}`;

                const txt = narratorText[idx + 1]; 
                
                if (narratorStrip && narratorTextEl) {
                    narratorStrip.style.backgroundColor = '#F7F7F7';
                    narratorStrip.style.borderBottom = '1px solid #e5e7eb';
                    narratorTextEl.style.color = '#4C4C4C';
                    narratorStrip.classList.remove('narrator-speaking'); 
                    
                    if (txt) {
                        narratorTextEl.textContent = txt;
                        narratorStrip.style.display = 'flex';
                    } else {
                        narratorStrip.style.display = 'none';
                    }
                }

                if (idx === 26) generateBadge(); 
                
                if(backBtn) {
                    backBtn.disabled = idx === 0;
                    backBtn.classList.toggle('opacity-0', idx === 0);
                }
                if(nextBtn) {
                    if (idx === totalPages - 1) {
                        nextBtn.style.display = 'none';
                    } else {
                        nextBtn.style.display = 'flex';
                        nextBtn.querySelector('span').textContent = 'Next';
                    }
                }
                sfx.nav(); 
            };

            window.nextPage = () => showPage(currentPage + 1);

            if(nextBtn) nextBtn.addEventListener('click', () => showPage(currentPage + 1));
            if(backBtn) backBtn.addEventListener('click', () => showPage(currentPage - 1));
            
            const homeBtn = document.getElementById('home-button');
            let pressTimer;
            let isResetting = false;

            function resetSession() {
                isResetting = true;
                sfx.powerOff(); 
                currentPage = 0;
                userName = "Learner"; 
                if(document.getElementById('user-name-input')) document.getElementById('user-name-input').value = "";
                if(document.getElementById('header-welcome-text')) document.getElementById('header-welcome-text').textContent = "Welcome: Learner";
                
                if(progressBar) progressBar.style.width = '0%';
                if(pageIndicator) pageIndicator.textContent = `1 / ${totalPages}`;
                
                pages.forEach(p => p.classList.remove('active'));
                document.getElementById('page-1').classList.add('active'); 
                
                if(narratorStrip) narratorStrip.style.display = 'none';

                if(startupScreen) {
                    startupScreen.style.display = 'flex';
                    void startupScreen.offsetWidth; 
                    startupScreen.style.opacity = '1';
                }

                const loginModal = document.getElementById('login-modal');
                if(loginModal) {
                    loginModal.classList.remove('hidden-modal');
                    loginModal.classList.add('visible-modal');
                }
            }

            if(homeBtn) {
                homeBtn.addEventListener('mousedown', () => {
                    isResetting = false;
                    pressTimer = setTimeout(resetSession, 2000);
                });
                homeBtn.addEventListener('mouseup', () => clearTimeout(pressTimer));
                homeBtn.addEventListener('mouseleave', () => clearTimeout(pressTimer));
                homeBtn.addEventListener('touchstart', (e) => {
                    e.preventDefault(); 
                    isResetting = false;
                    pressTimer = setTimeout(resetSession, 2000);
                });
                homeBtn.addEventListener('touchend', () => {
                    clearTimeout(pressTimer);
                    if (!isResetting) showPage(0); 
                });
                homeBtn.addEventListener('click', (e) => {
                    if (!isResetting) showPage(0);
                });
            }

            const startSessionBtn = document.getElementById('start-session-btn');
            if(startSessionBtn) {
                startSessionBtn.addEventListener('click', () => {
                    const nameInput = document.getElementById('user-name-input');
                    if(nameInput && nameInput.value.trim()) userName = nameInput.value.trim();
                    const welcome = document.getElementById('header-welcome-text');
                    if(welcome) welcome.textContent = `Welcome: ${userName}`;
                    const loginModal = document.getElementById('login-modal');
                    if(loginModal) {
                        loginModal.classList.add('hidden-modal');
                        loginModal.classList.remove('visible-modal');
                    }
                    showPage(0);
                });
            }

            const startupScreen = document.getElementById('startup-screen');
            if(startupScreen) {
                startupScreen.addEventListener('click', () => {
                    sfx.powerOn();
                    startupScreen.style.opacity = '0';
                    setTimeout(() => { 
                        startupScreen.style.display = 'none'; 
                        showPage(0); 
                    }, 700);
                });
            }

            // Avatar Click Listener
            const avatar = document.getElementById('narrator-avatar');
            if (avatar) {
                avatar.addEventListener('click', openQuestionModal);
                avatar.title = "Ask Jonathan a Question";
            }

            const menuToggle = document.getElementById('menu-toggle');
            const closeMenu = document.getElementById('close-menu');
            const menuModal = document.getElementById('menu-modal');
            
            if(menuToggle && menuModal) {
                menuToggle.addEventListener('click', () => {
                    sfx.tick(); 
                    menuModal.classList.remove('hidden-modal');
                    menuModal.classList.add('visible-modal');
                    const toc = document.getElementById('toc-list');
                    if(toc) {
                        toc.innerHTML = '';
                        pageTitles.forEach((t, i) => {
                            const btn = document.createElement('button');
                            // Added flex layout to align number and text neatly
                            btn.className = "w-full text-left px-4 py-2 hover:bg-gray-100 text-gray-700 rounded text-xs flex items-start group transition-colors";
                            // Added page number span with fixed width for alignment
                            btn.innerHTML = `<span class="font-bold text-gray-400 w-8 shrink-0 group-hover:text-allgood-primary transition-colors">${i + 1}.</span> <span>${t}</span>`;
                            btn.onclick = () => { showPage(i); menuModal.classList.add('hidden-modal'); menuModal.classList.remove('visible-modal'); };
                            toc.appendChild(btn);
                        });
                    }
                });
            }
            
            if(closeMenu && menuModal) {
                closeMenu.addEventListener('click', () => {
                    sfx.tick(); 
                    menuModal.classList.add('hidden-modal');
                    menuModal.classList.remove('visible-modal');
                });
            }

            const fullscreenBtn = document.getElementById('fullscreen-toggle');
            if(fullscreenBtn) {
                fullscreenBtn.addEventListener('click', () => {
                    const frame = document.querySelector('.tablet-frame');
                    const isFocus = frame.classList.contains('focus-mode');
                    if (!isFocus) {
                        const target = document.documentElement; 
                        if (target.requestFullscreen) target.requestFullscreen().catch(() => {});
                        else if (target.webkitRequestFullscreen) target.webkitRequestFullscreen();
                        frame.classList.add('focus-mode');
                        fullscreenBtn.classList.add('text-green-300', 'bg-white/10');
                    } else {
                        if (document.exitFullscreen) document.exitFullscreen().catch(() => {});
                        else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
                        frame.classList.remove('focus-mode');
                        fullscreenBtn.classList.remove('text-green-300', 'bg-white/10');
                    }
                    sfx.tick();
                });
            }

            document.body.addEventListener('click', (e) => {
                const accBtn = e.target.closest('.accordion-toggle');
                const bpToggle = e.target.closest('#blueprint-toggle');

                if (accBtn) {
                    const content = accBtn.nextElementSibling;
                    const icon = accBtn.querySelector('.accordion-icon');
                    content.classList.toggle('hidden');
                    if(icon) icon.classList.toggle('rotate-180');
                    sfx.tick();
                }

                if (bpToggle) {
                    document.getElementById('screen').classList.toggle('blueprint-mode');
                    bpToggle.classList.toggle('text-cyan-300');
                    sfx.tick();
                }
            });
        });

        /* --- INTERACTION LOGIC (Global Scope) --- */

        window.runLenderAnalysis = function(btn) {
            const parent = btn.closest('.lender-action');
            const result = parent.parentElement.querySelector('.lender-result');
            btn.classList.add('hidden');
            const doneIndicator = document.createElement('div');
            doneIndicator.className = "text-center text-xs font-bold text-gray-300 py-1";
            doneIndicator.innerHTML = '<i data-lucide="check" class="inline w-3 h-3 mr-1"></i>Analysis Complete';
            parent.appendChild(doneIndicator);
            result.classList.remove('hidden');
            lucide.createIcons();
            sfx.tick();
        }

        let currentAffordabilityZone = '';

        window.calculateAffordability = function() {
            const inc = Number(document.getElementById('calc-income').value) || 0;
            const debt = Number(document.getElementById('calc-debt').value) || 0;
            const mort = Number(document.getElementById('calc-mortgage').value) || 0;
            
            if(inc === 0) {
                document.getElementById('calc-income').classList.add('border-red-300');
                return;
            } else {
                document.getElementById('calc-income').classList.remove('border-red-300');
            }

            const housingRatio = ((mort / inc) * 100).toFixed(1);
            const totalRatio = (((mort + debt) / inc) * 100).toFixed(1);
            
            const feedbackEl = document.getElementById('affordability-feedback');
            feedbackEl.classList.remove('hidden');
            
            let message = "";
            let colorClasses = "";
            let strategies = [];

            currentAffordabilityZone = '';

            if (totalRatio >= 50) {
                currentAffordabilityZone = 'extreme';
                message = "Immediate Focus: This DTI ratio (Total Debt) is outside the lending limit for automated approval. <strong>This is our roadmap, not a wall.</strong> We're shifting immediately into <strong>Debt Strategy Mode.</strong> Your first action is clear: Let's aggressively tackle your monthly debt payments to bring that DTI under 45%—a number we can work with.";
                colorClasses = "bg-slate-50 border-slate-300 text-slate-700";
                strategies = ["Reduce Debt", "Increase Income", "Budget Coaching"];
            } else if (housingRatio <= 28 && totalRatio <= 36) {
                currentAffordabilityZone = 'comfortable';
                message = "Excellent. You are within the 'Golden Rule' (28/36). This is the Sweet Spot for best rates and stress-free approval.";
                colorClasses = "bg-emerald-50 border-emerald-100 text-emerald-900";
                strategies = ["Lock Rate", "Pre-Approval"];
            } else if (housingRatio <= 35 && totalRatio <= 45) {
                currentAffordabilityZone = 'mindful';
                message = "You are slightly above the conservative 'Golden Rule,' but still very approvable. This is common for FHA loans or competitive markets.";
                colorClasses = "bg-blue-50 border-blue-100 text-blue-900";
                strategies = ["Explore Loan Options", "Negotiate Concessions", "Revisit Debt"];
            } else {
                currentAffordabilityZone = 'planning';
                message = "You are in the 'Stretch Zone.' Lenders might approve this with high credit scores, but it leaves little room for error.";
                colorClasses = "bg-orange-50 border-orange-100 text-orange-900"; 
                strategies = ["Consider Co-Borrowing", "Budget Coaching", "Explore Loan Options"];
            }

            let strategyHTML = strategies.map(s => 
                `<button onclick="showStrategy('${s}')" class="strategy-pill px-3 py-1 bg-white border border-black/10 rounded-full text-[10px] font-bold uppercase tracking-wide text-gray-600 hover:text-allgood-primary hover:border-allgood-primary transition-colors shadow-sm">${s}</button>`
            ).join('');

            feedbackEl.className = `mt-4 p-5 rounded-lg border ${colorClasses} transition-all duration-700 ease-out opacity-0 transform translate-y-2 shadow-sm`;
            
            feedbackEl.innerHTML = `
                <div class="mb-3">
                    <p class="font-heading font-bold text-sm mb-2 leading-relaxed">${message}</p>
                    <div class="flex items-center gap-4 text-xs opacity-80 font-mono mt-3">
                        <span class="bg-white/60 px-2 py-1 rounded border border-black/5 shadow-sm">Housing: <strong>${housingRatio}%</strong> <span class="text-[10px] opacity-60">(Target: <28%)</span></span>
                        <span class="bg-white/60 px-2 py-1 rounded border border-black/5 shadow-sm">Total: <strong>${totalRatio}%</strong> <span class="text-[10px] opacity-60">(Target: <36%)</span></span>
                    </div>
                </div>
                <div class="border-t border-black/5 pt-3 mt-3">
                    <p class="text-[10px] uppercase font-bold opacity-60 mb-2">Pragmatic Moves:</p>
                    <div class="flex flex-wrap gap-2">
                        ${strategyHTML}
                    </div>
                </div>
            `;

            requestAnimationFrame(() => {
                feedbackEl.classList.remove('opacity-0', 'translate-y-2');
            });
            
            sfx.nav(); 
        }

        window.showStrategy = function(type) {
            let text = "";

            const standardStrategies = {
                "Negotiate Concessions": "Ask the seller to pay 2-3% of closing costs. This keeps cash in your pocket, increasing your liquid reserves.",
                "Revisit Debt": "Paying down a small car loan or credit card balance can drastically lower your monthly debt obligation, boosting your DTI power.",
                "Consider Co-Borrowing": "Adding a family member as a non-occupying co-borrower adds their income to yours, balancing out the debt ratio.",
                "Lock Rate": "Your ratios are solid. Focus on locking in a rate before market fluctuations change your buying power.",
                "Pre-Approval": "You are ready. Get a formal Verified Approval letter to make your offer as strong as cash."
            };

            const extremeStrategies = {
                "Reduce Debt": "Explore ways to lower monthly debt payments, such as refinancing high-interest loans or consolidating debt.",
                "Increase Income": "Consider co-borrowing or adding a co-signer to bring more qualifying income into the equation.",
                "Budget Coaching": "Work with an agent or financial advisor to build a 6-12 month plan toward qualification."
            };

            if (type === "Explore Loan Options") {
                if (currentAffordabilityZone === 'extreme') {
                    text = "Some loan types allow higher ratios, but not at this level. Revisit this option once debt is reduced or income is increased.";
                } else {
                    text = "FHA loans often allow higher debt ratios (up to 50%+) compared to Conventional loans. VA loans are also very flexible if eligible.";
                }
            } else {
                text = standardStrategies[type] || extremeStrategies[type] || "Talk to your loan officer for specific guidance on this strategy.";
            }
            
            const modal = document.createElement('div');
            modal.className = "fixed inset-0 bg-black/40 z-[9999] flex items-end sm:items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300";
            modal.innerHTML = `
                <div class="bg-white rounded-t-xl sm:rounded-xl shadow-2xl p-6 max-w-sm w-full animate-pop-in border-b-4 border-allgood-secondary">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="text-lg font-heading font-bold text-allgood-secondary">${type}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600"><i data-lucide="x" class="w-5 h-5"></i></button>
                    </div>
                    <p class="text-gray-600 text-sm leading-relaxed font-body">${text}</p>
                    <button onclick="this.closest('.fixed').remove()" class="mt-6 w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 rounded text-xs transition-colors">Got it</button>
                </div>
            `;
            document.body.appendChild(modal);
            lucide.createIcons();
            sfx.tick();
        };

        function initWalletDragDrop() {
            const draggables = document.querySelectorAll('#gauntlet-source .draggable');
            const zoneSafe = document.getElementById('zone-safe');
            const zoneTrap = document.getElementById('zone-trap');
            const feedback = document.getElementById('gauntlet-feedback');
            let selectedItem = null; // Track currently selected item for click-to-drop
            
            const feedbackMap = {
                'drag-dp': { safe: "Correct. Typically 3-20% required upfront.", trap: "Wait! You cannot close without a down payment." },
                'drag-closing': { safe: "Correct. 2-5% of the loan amount for taxes and title fees.", trap: "Hold on. These are mandatory fees required to sign." },
                'drag-save': { safe: "Smart Move. Boosting reserves strengthens your application.", trap: "Incorrect. Cash reserves are critical for stability." },
                'drag-car': { safe: "STOP! Buyer Beware #2: Do not buy a vehicle. New debt ruins your DTI.", trap: "Smart. Buying a car changes your ratios. Wait until you have the keys." },
                'drag-furniture': { safe: "STOP! Buyer Beware #6: Do not buy furniture on credit. Hard inquiries drop your score.", trap: "Good. Don't open new credit lines just before closing." },
                'drag-job': { safe: "STOP! Buyer Beware #1: Do not change jobs. Probation periods can pause your loan.", trap: "Excellent. Stability is key. Keep your employment status rock solid." },
                'drag-late': { safe: "CRITICAL STOP! A late payment can drop your score 50+ points instantly.", trap: "Correct. Always pay on time to protect your rate." }
            };

            // Unified Handler for Logic
            const handleDropOrClick = (itemId, zoneId, draggableEl) => {
                const zone = document.getElementById(zoneId);
                if (!zone || !draggableEl) return;

                zone.appendChild(draggableEl);
                
                // Clear selection styling if applicable
                draggableEl.classList.remove('ring-2', 'ring-allgood-primary', 'ring-offset-2', 'bg-blue-50');
                selectedItem = null;

                const isSafeZone = zoneId === 'zone-safe';
                const data = feedbackMap[itemId];
                
                if(feedback && data) {
                    feedback.classList.remove('hidden');
                    feedback.style.display = 'block';

                    // Determine if the action was correctly placed
                    const isCorrectPlacement = (draggableEl.getAttribute('data-type') === 'safe' && isSafeZone) || 
                                               (draggableEl.getAttribute('data-type') === 'trap' && zoneId === 'zone-trap');
                    
                    let narrativeMsg = isSafeZone ? data.safe : data.trap;
                    
                    if (isCorrectPlacement) {
                        feedback.className = "mt-4 p-4 rounded-lg text-sm border shadow-sm animate-pop-in bg-emerald-50 border-emerald-200 text-emerald-800 font-bold";
                        sfx.nav();
                    } else {
                        feedback.className = "mt-4 p-4 rounded-lg text-sm border shadow-sm animate-pop-in bg-red-50 border-red-200 text-red-800 font-bold";
                        sfx.powerOff();
                    }
                    feedback.textContent = narrativeMsg;
                }
            };

            // Setup Listeners
            draggables.forEach(drag => {
                // Drag Start
                drag.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', e.target.id);
                    e.dataTransfer.effectAllowed = "move";
                    sfx.tick();
                });

                // Click/Tap Selection (Mobile & Desktop)
                drag.addEventListener('click', (e) => {
                    // Deselect others
                    draggables.forEach(d => d.classList.remove('ring-2', 'ring-allgood-primary', 'ring-offset-2', 'bg-blue-50'));
                    
                    if (selectedItem === drag) {
                        selectedItem = null; // Toggle off
                    } else {
                        selectedItem = drag;
                        drag.classList.add('ring-2', 'ring-allgood-primary', 'ring-offset-2', 'bg-blue-50');
                        sfx.tick();
                    }
                });
            });

            if(zoneSafe && zoneTrap) {
                [zoneSafe, zoneTrap].forEach(zone => {
                    // Standard Drag Over
                    zone.addEventListener('dragover', (e) => {
                        e.preventDefault(); 
                        e.dataTransfer.dropEffect = "move";
                        zone.classList.add('drag-over');
                    });

                    zone.addEventListener('dragleave', () => {
                        zone.classList.remove('drag-over');
                    });

                    // Standard Drop
                    zone.addEventListener('drop', (e) => {
                        e.preventDefault();
                        zone.classList.remove('drag-over');
                        const id = e.dataTransfer.getData('text/plain');
                        const draggable = document.getElementById(id);
                        handleDropOrClick(id, zone.id, draggable);
                    });

                    // Click/Tap Zone to "Drop" Selected Item
                    zone.addEventListener('click', () => {
                        if (selectedItem) {
                            handleDropOrClick(selectedItem.id, zone.id, selectedItem);
                        }
                    });
                });
            }
        }


        function initBuyerChoicesDragDrop() { return; }

        window.updateUtilization = function() { return; };

        window.toggleDoc = function(el) {
            el.classList.toggle('bg-green-100');
            el.classList.toggle('border-green-500');
            sfx.tick();
        };
        window.checkDocs = function() {
            const selected = document.querySelectorAll('#doc-list .bg-green-100');
            const valid = Array.from(selected).every(el => el.getAttribute('data-valid') === 'true');
            const count = selected.length;
            const fb = document.getElementById('doc-feedback');
            fb.classList.remove('hidden');
            
            if(valid && count === 3) {
                fb.textContent = "Packet Complete. Ready for Underwriting.";
                fb.className = "mt-2 text-sm font-bold text-center text-green-600";
                sfx.nav();
            } else {
                fb.textContent = "Incomplete or Invalid Documents. Select exactly the 3 required documents.";
                fb.className = "mt-2 text-sm font-bold text-center text-red-600";
                sfx.powerOff();
            }
        };

        /* --- ASK JONATHAN LOGIC --- */
        window.openQuestionModal = function() {
            const modal = document.getElementById('question-modal');
            const inputView = document.getElementById('question-input-view');
            const successView = document.getElementById('question-success-view');
            const textArea = document.getElementById('question-text');
            
            if (modal) {
                // Reset State
                inputView.classList.remove('hidden');
                successView.classList.add('hidden');
                successView.style.display = 'none'; // Ensure fully hidden
                textArea.value = '';
                
                modal.classList.remove('hidden-modal');
                modal.classList.add('visible-modal');
                sfx.tick();
                
                // Auto-focus text area for UX
                setTimeout(() => textArea.focus(), 100);
            }
        };

        window.closeQuestionModal = function() {
            const modal = document.getElementById('question-modal');
            if (modal) {
                modal.classList.add('hidden-modal');
                modal.classList.remove('visible-modal');
            }
        };

        window.submitQuestion = function() {
            const text = document.getElementById('question-text').value;
            if (!text.trim()) return; // Prevent empty sends

            // Future Database Hook
            const payload = {
                learnerId: userName,
                page: currentPage + 1,
                timestamp: new Date().toISOString(),
                question: text
            };
            // console.log("Sending Question:", payload); 
            // fetch('/api/questions', { method: 'POST', body: JSON.stringify(payload) });

            // UI Feedback
            const inputView = document.getElementById('question-input-view');
            const successView = document.getElementById('question-success-view');
            
            inputView.classList.add('hidden');
            successView.classList.remove('hidden');
            successView.style.display = 'flex'; // Force flex display
            
            sfx.success(); // "Pop" sound
            lucide.createIcons();

            // Auto Close
            setTimeout(() => {
                closeQuestionModal();
            }, 2000);
        };

        window.toggleTradeP20 = function(el) {
            if (el.classList.contains('bg-allgood-secondary')) {
                selectedTradesP20 = selectedTradesP20.filter(i => i !== el.textContent);
                el.classList.remove('bg-allgood-secondary', 'text-white', 'border-allgood-secondary');
                el.classList.add('bg-white');
            } else {
                if (selectedTradesP20.length >= 3) return sfx.powerOff(); 
                selectedTradesP20.push(el.textContent);
                el.classList.remove('bg-white');
                el.classList.add('bg-allgood-secondary', 'text-white', 'border-allgood-secondary');
            }
            document.getElementById('tradeoff-feedback-p20').textContent = `Selected: ${selectedTradesP20.length}/3`;
            sfx.tick();
        };

        let fieldTestScore = 0;
        window.runFieldTest = function(btn, type, isCorrect) {
            const parent = btn.parentElement;
            const feedbackContainer = parent.nextElementSibling;
            
            parent.querySelectorAll('button').forEach(b => b.disabled = true);

            let feedbackTitle = "";
            let feedbackMsg = "";
            let isCoaching = !isCorrect; 

            if (type === 'legal') {
                if (isCorrect) {
                    feedbackTitle = "Smart Move";
                    feedbackMsg = "Perfect. This protects your right to representation. Remember: The hosting agent works for the <em>Seller</em>, not you.";
                } else {
                    feedbackTitle = "Coaching Moment";
                    feedbackMsg = "Careful. By saying 'No', you imply the hosting agent can represent you (Dual Agency). They maximize the seller's profit, not yours. Always declare you have a rep.";
                }
            } else if (type === 'structural') {
                if (isCorrect) {
                    feedbackTitle = "Good Eye";
                    feedbackMsg = "Spot on. Foundation cracks are a structural failure ($15,000+). Ugly wallpaper is just a cosmetic fix ($200). Never let 'pretty' hide 'broken'.";
                } else {
                    feedbackTitle = "Look Deeper";
                    feedbackMsg = "That's just cosmetic. Wallpaper is cheap to fix. Foundation cracks signal structural failure ($15k+). Don't let ugly decor scare you away from good bones.";
                }
            } else if (type === 'financial') {
                if (isCorrect) {
                    feedbackTitle = "Secure";
                    feedbackMsg = "Exactly. Title Insurance protects your <em>past</em> ownership rights. It stops hidden heirs or liens from taking your home years later.";
                } else {
                    feedbackTitle = "Critical Distinction";
                    feedbackMsg = "Not quite. Home Insurance covers future damage (fire, theft). <em>Title</em> Insurance covers the past (hidden liens, lost heirs). You need both.";
                }
            }

            const avatarUrl = "https://github.com/allgoodacademy/ImageAndAssets/blob/main/J.Hurtado_HeadShot.jpg?raw=true";
            const colorClass = isCoaching ? "border-blue-200 bg-blue-50" : "border-emerald-200 bg-emerald-50";
            const textClass = isCoaching ? "text-blue-900" : "text-emerald-900";
            const titleClass = isCoaching ? "text-allgood-secondary" : "text-emerald-700";

            feedbackContainer.innerHTML = `
                <div class="flex gap-3 p-3 rounded-lg border ${colorClass} mt-3 animate-pop-in shadow-sm">
                    <div class="flex-shrink-0">
                        <img src="${avatarUrl}" class="w-8 h-8 rounded-full border border-white shadow-sm object-cover">
                    </div>
                    <div>
                        <p class="text-[10px] font-bold uppercase tracking-wide ${titleClass} mb-1">${feedbackTitle}</p>
                        <p class="text-xs ${textClass} leading-relaxed font-body">${feedbackMsg}</p>
                    </div>
                </div>
            `;
            feedbackContainer.classList.remove('hidden');

            sfx.nav(); 
            
            if (isCorrect) {
                fieldTestScore++;
                document.querySelector('#field-score span').textContent = `${fieldTestScore}/3`;
            }

            if (type === 'legal') {
                document.getElementById('check-structural').classList.remove('opacity-50', 'pointer-events-none');
            } else if (type === 'structural') {
                document.getElementById('check-financial').classList.remove('opacity-50', 'pointer-events-none');
            }

            if (fieldTestScore === 3) {
                document.getElementById('field-test-complete').classList.remove('hidden');
                document.querySelector('#field-test-complete .inline-block').classList.remove('hidden');
            } else if (type === 'financial') {
                document.getElementById('field-test-complete').classList.remove('hidden');
                document.querySelector('#field-test-complete .inline-block').classList.add('hidden'); 
            }
        };

        window.runPricingSim = function(btn, choice) {
            const parent = btn.parentElement;
            const feedback = document.getElementById('pricing-feedback');
            
            // Disable buttons
            parent.querySelectorAll('button').forEach(b => {
                b.disabled = true;
                b.classList.add('opacity-50');
            });
            btn.classList.remove('opacity-50');
            
            feedback.classList.remove('hidden');

            if (choice === 'low') {
                feedback.className = "mt-4 p-4 rounded bg-red-50 border border-red-200 text-red-800";
                feedback.innerHTML = `
                    <strong class="block mb-1 text-red-900">Offer Rejected.</strong>
                    The seller was insulted by the lowball offer and refused to counter. They went with another buyer who offered $425k. 
                    <br><em class="mt-2 block opacity-80">Lesson: Aggressive is good, but "insulting" kills deals.</em>
                `;
                sfx.powerOff();
            } else if (choice === 'data') {
                feedback.className = "mt-4 p-4 rounded bg-emerald-50 border border-emerald-200 text-emerald-800";
                feedback.innerHTML = `
                    <strong class="block mb-1 text-emerald-900">Offer Accepted!</strong>
                    You used the data (Comp 1) to justify the price. The seller knows the comps too. They respect the logic and sign the deal.
                    <br><em class="mt-2 block opacity-80">Lesson: Comps are your ammunition. Use them.</em>
                `;
                sfx.success();
            } else if (choice === 'high') {
                feedback.className = "mt-4 p-4 rounded bg-orange-50 border border-orange-200 text-orange-800";
                feedback.innerHTML = `
                    <strong class="block mb-1 text-orange-900">Offer Accepted (But at what cost?)</strong>
                    The seller is thrilled. You just paid $15,000 more than the house is worth based on Comp 1. You secured the house but lost equity instantly.
                    <br><em class="mt-2 block opacity-80">Lesson: List Price is just a marketing number, not the value.</em>
                `;
                sfx.nav();
            }
            lucide.createIcons();
        };

        let gauntletScore = 0;
        window.runGauntlet = function(btn, step, choice) {
            const parent = btn.closest('.bg-white'); // Use closest to ensure correct parent element
            const feedback = parent.querySelector('.feedback');
            
            if (step === 1 || step === 3) {
                btn.classList.remove('bg-green-50', 'bg-blue-50', 'hover:bg-green-100', 'hover:bg-blue-100', 'border-green-200', 'border-blue-200');
                btn.classList.add('bg-emerald-100', 'text-emerald-800', 'border-emerald-500');
                btn.innerHTML = `<i data-lucide="check" class="w-3 h-3"></i> Completed`;
                btn.disabled = true;
                
                gauntletScore++;
                unlockNextGauntlet(step);
                sfx.nav();
            } else if (step === 2) {
                const btns = btn.parentElement.querySelectorAll('button');
                btns.forEach(b => b.disabled = true);
                
                // Show feedback container if hidden
                if (feedback) feedback.classList.remove('hidden');

                if (choice === 'credit') {
                    btn.classList.add('bg-emerald-100', 'border-emerald-500', 'text-emerald-800');
                    if (feedback) feedback.innerHTML = `<span class="text-emerald-700"><strong>Smart.</strong> Credits give <em>you</em> control over the repair quality. Sellers often do the cheapest fix possible.</span>`;
                    gauntletScore++;
                    unlockNextGauntlet(step);
                    sfx.nav();
                } else {
                    btn.classList.add('bg-blue-50', 'border-blue-300', 'text-blue-800');
                    if (feedback) feedback.innerHTML = `<span class="text-blue-700"><strong>Coaching:</strong> Asking the seller to fix it is okay, but risky. They will likely choose the cheapest contractor. A credit is safer.</span>`;
                    gauntletScore++; 
                    unlockNextGauntlet(step);
                    sfx.nav();
                }
            } else if (step === 4) {
                const btns = btn.parentElement.querySelectorAll('button');
                btns.forEach(b => b.disabled = true);
                
                // Show feedback container if hidden
                if (feedback) feedback.classList.remove('hidden');

                if (choice === 'pass') {
                    btn.classList.add('bg-emerald-100', 'border-emerald-500', 'text-emerald-800');
                    if (feedback) feedback.innerHTML = `<span class="text-emerald-700"><strong>Correct.</strong> ALWAYS verify instructions via a known phone number. Email is never safe.</span>`;
                    gauntletScore++;
                    // Removed sound effect here per request 
                    document.getElementById('gauntlet-complete').classList.remove('hidden');
                } else {
                    btn.classList.add('bg-red-50', 'border-red-300', 'text-red-800');
                    if (feedback) feedback.innerHTML = `<span class="text-red-700"><strong>CRITICAL STOP.</strong> You just lost your down payment to a hacker. Never trust email wiring instructions.</span>`;
                    sfx.powerOff();
                }
            }
            
            document.querySelector('#gauntlet-score span').textContent = `${gauntletScore}/4`;
            lucide.createIcons();
        };

        function unlockNextGauntlet(currentStep) {
            const next = document.getElementById(`gauntlet-step-${currentStep + 1}`);
            if (next) {
                next.classList.remove('opacity-50', 'pointer-events-none');
                next.classList.add('animate-pop-in');
            }
        }

        // --- NEW: Live Fire Scenario Engine ---
        const scenarios = [
            {
                id: 1,
                title: "The Furniture Trap",
                icon: "armchair", 
                theme: "blue",
                situation: "It is 3 days before closing. You see a perfect sofa on sale for 50% off. It's $2,000. You have the cash, but the store offers '0% interest for 12 months' if you open a store card.",
                options: [
                    { text: "Take the 0% financing deal.", type: "fail", feedback: "Opening a new credit line triggers a 'hard inquiry' and alters your Debt-to-Income ratio. Lenders re-check credit just before closing; this new debt could cause a last-minute denial." },
                    { text: "Buy it with cash.", type: "fail", feedback: "Spending significant liquid cash right now is risky. You need those funds verified for closing costs. It is safer to keep your accounts stable until the deed is recorded." },
                    { text: "Wait until after closing.", type: "pass", feedback: "CORRECT. Do nothing. Buy the sofa *after* the deed is recorded and you have the keys. Patience saves the deal." }
                ]
            },
            {
                id: 2,
                title: "The Repair Standoff",
                icon: "wrench", 
                theme: "orange",
                situation: "Inspection reveals the AC unit is 15 years old and struggling. It works, but barely. The Seller refuses to replace it.",
                options: [
                    { text: "Walk away immediately.", type: "fail", feedback: "Walking away over an aging (but working) system might mean losing a home you love. In a competitive market, finding a middle ground is often the smarter strategic move." },
                    { text: "Demand they fix it or no deal.", type: "fail", feedback: "Forcing a seller to repair usually results in them hiring the cheapest, unlicensed labor. You risk inheriting a 'band-aid' fix that breaks again in three months." },
                    { text: "Ask for a Home Warranty.", type: "pass", feedback: "SMART MOVE. If they won't credit you, ask them to pay for a 1-year Home Warranty ($600). This protects you if the AC dies next month, without costing the seller huge cash now." }
                ]
            },
            {
                id: 3,
                title: "The Appraisal Gap",
                icon: "scale", 
                theme: "indigo",
                situation: "You offered $420k. The Appraisal came back at $410k. The Seller refuses to lower the price. You really want this house.",
                options: [
                    { text: "Pay the $10k gap in cash.", type: "pass", feedback: "CORRECT (If able). If you have the reserves and plan to stay long-term, covering the gap is the only way to save the deal without the seller budging." },
                    { text: "Ask the lender to ignore the appraisal.", type: "fail", feedback: "Lenders are federally regulated and cannot lend more than the appraised value of the collateral. This isn't a policy they can waive; it's a hard limit." },
                    { text: "Threaten to sue.", type: "fail", feedback: "Legal threats rarely save a deal. The Appraisal Contingency gives you the right to walk away, but it doesn't force the seller to lower their price. Negotiation or cash are your only real levers." }
                ]
            },
            {
                id: 4,
                title: "The Phantom Email",
                icon: "shield-alert", 
                theme: "red",
                situation: "On closing day, you get an urgent email from 'Title Company' with new wiring instructions for your down payment.",
                options: [
                    { text: "Wire the money immediately to avoid delay.", type: "fail", feedback: "This is the most common wire fraud tactic. The email is likely spoofed. Once money is wired to a fraudulent account, it is almost impossible to recover." },
                    { text: "Reply to the email to confirm.", type: "fail", feedback: "If the email account has been compromised, the hacker is the one replying to you. Digital verification isn't enough when your life savings are on the line." },
                    { text: "Call the Title Company on a known number.", type: "pass", feedback: "CORRECT. Always verify wiring instructions voice-to-voice using a phone number you Googled independently (not the one in the email)." }
                ]
            },
            {
                id: 5,
                title: "The Career Move",
                icon: "briefcase", 
                theme: "emerald",
                situation: "You are Under Contract. You get a job offer for $10k more per year! But it's a 1099 (Contractor) role, not W-2.",
                options: [
                    { text: "Take the job! More money helps.", type: "fail", feedback: "Switching from W-2 to 1099 changes your income category. Lenders typically require a 2-year history of self-employment (1099) to count that income. This would restart your clock." },
                    { text: "Take it but don't tell the lender.", type: "fail", feedback: "Lenders perform a final Verification of Employment (VOE) within days of closing. They will discover the change, and the loan will be denied for undisclosed material changes." },
                    { text: "Delay the start date until after closing.", type: "pass", feedback: "CORRECT. Secure the house first. Once the loan is funded and recorded, you can change jobs (though always verify with your loan officer first)." }
                ]
            }
        ];

        let currentScenarioIndex = 0;
        let examScore = 0;

        function buildExam() {
            loadScenario(0);
        }

        function loadScenario(index) {
            const container = document.getElementById('scenario-card');
            const data = scenarios[index];
            if (!data) return finishLiveFire();

            // Update Progress
            document.getElementById('exam-progress').textContent = `${index + 1}/${scenarios.length}`;

            // VISUAL ENHANCEMENT: Hero Icon with Pulse Effect + CLEAN TEXT
            container.innerHTML = `
                <div class="animate-pop-in flex flex-col h-full">
                    <div class="flex flex-col items-center mb-6">
                        <div class="w-20 h-20 rounded-full bg-${data.theme}-50 border-2 border-${data.theme}-100 flex items-center justify-center mb-3 relative shadow-sm">
                            <div class="absolute inset-0 rounded-full bg-${data.theme}-400 opacity-10 animate-pulse"></div>
                            <i data-lucide="${data.icon}" class="w-10 h-10 text-${data.theme}-600"></i>
                        </div>
                        <div class="text-center">
                            <span class="text-[10px] font-bold uppercase tracking-widest text-${data.theme}-600 mb-1 block">Scenario ${data.id}</span>
                            <h3 class="text-xl font-heading font-bold text-allgood-dark leading-tight">${data.title}</h3>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 border-l-4 border-${data.theme}-400 p-5 rounded-r-lg mb-6 shadow-sm">
                        <p class="text-sm text-gray-700 font-body leading-relaxed">${data.situation}</p>
                    </div>

                    <div class="space-y-3 mt-auto">
                        ${data.options.map((opt, i) => `
                            <button onclick="checkScenario(this, ${index}, '${opt.type}', '${opt.feedback.replace(/'/g, "\\'")}')" 
                                class="w-full text-left p-4 rounded-lg border border-gray-200 hover:border-${data.theme}-400 hover:bg-${data.theme}-50 transition-all text-sm font-bold text-gray-600 relative group shadow-sm bg-white">
                                <span class="block pr-6 group-hover:text-${data.theme}-800 transition-colors">${opt.text}</span>
                                <div class="absolute right-4 top-1/2 transform -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity text-${data.theme}-500">
                                    <i data-lucide="arrow-right-circle" class="w-5 h-5"></i>
                                </div>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        window.checkScenario = function(btn, index, type, feedback) {
            // Disable all buttons
            const buttons = btn.parentElement.querySelectorAll('button');
            buttons.forEach(b => b.disabled = true);

            // Style the selected button
            if (type === 'pass') {
                btn.classList.remove('border-gray-200', 'hover:border-allgood-secondary');
                btn.classList.add('bg-emerald-100', 'border-emerald-500', 'text-emerald-900');
                examScore++;
                // Removed sound effect here per request
            } else {
                // CHANGED: Use Allgood Secondary (Blue/Teal) for "Coach" feel instead of Red
                btn.classList.remove('border-gray-200', 'hover:border-allgood-secondary');
                btn.classList.add('bg-cyan-50', 'border-allgood-secondary', 'text-allgood-secondary');
                sfx.nav(); // Softer sound than powerOff
            }

            // Show Feedback Modal
            showScenarioFeedback(type === 'pass', feedback, index);
        };

        function showScenarioFeedback(isPass, text, index) {
            const modal = document.createElement('div');
            modal.className = "fixed inset-0 bg-black/50 z-[9999] flex items-end sm:items-center justify-center p-4 backdrop-blur-sm";
            
            // DYNAMIC STYLING: Green for Pass, Teal (Jonathan) for Insight
            const borderColor = isPass ? 'border-emerald-500' : 'border-allgood-secondary';
            const titleColor = isPass ? 'text-emerald-700' : 'text-allgood-secondary';
            const barColor = isPass ? 'bg-emerald-200' : 'bg-cyan-200';
            
            // BRANDING UPDATE: "Jonathan's Insight" for coaching moments
            const titleText = isPass ? 'Correct Decision' : "Jonathan's Insight";
            
            modal.innerHTML = `
                <div class="bg-white rounded-t-xl sm:rounded-xl shadow-2xl p-6 max-w-sm w-full animate-pop-in border-t-4 ${borderColor}">
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-1">
                            <h3 class="text-xl font-heading font-bold ${titleColor}">
                                ${titleText}
                            </h3>
                            ${!isPass ? `<img src="https://github.com/allgoodacademy/ImageAndAssets/blob/main/J.Hurtado_HeadShot.jpg?raw=true" class="w-8 h-8 rounded-full border border-gray-200 shadow-sm object-cover">` : ''}
                        </div>
                        <div class="h-1 w-12 ${barColor} rounded"></div>
                    </div>
                    <p class="text-gray-600 text-sm leading-relaxed font-body mb-6">${text}</p>
                    <button id="next-scenario-btn" class="w-full bg-allgood-dark hover:bg-black text-white font-bold py-3 rounded text-sm shadow-md transition-transform transform active:scale-[0.98]">
                        ${index < scenarios.length - 1 ? 'Next Scenario &rarr;' : 'Finish Exam'}
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
            
            document.getElementById('next-scenario-btn').onclick = () => {
                modal.remove();
                if (index < scenarios.length - 1) {
                    loadScenario(index + 1);
                } else {
                    finishLiveFire();
                }
                sfx.tick();
            };
        }

        function finishLiveFire() {
            const container = document.getElementById('scenario-card');
            const isPass = examScore >= 3;
            
            container.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full text-center animate-pop-in py-8">
                    <div class="w-20 h-20 rounded-full flex items-center justify-center mb-4 ${isPass ? 'bg-emerald-100 text-emerald-600' : 'bg-orange-100 text-orange-600'}">
                        <i data-lucide="${isPass ? 'trophy' : 'alert-circle'}" class="w-10 h-10"></i>
                    </div>
                    <h2 class="text-2xl font-heading font-bold text-allgood-dark mb-2">${isPass ? 'You are Ready.' : 'Review Needed'}</h2>
                    <p class="text-sm text-gray-500 font-body mb-6">You survived <strong>${examScore}/5</strong> scenarios.</p>
                    
                    ${isPass ? 
                        `<p class="text-xs text-emerald-700 bg-emerald-50 px-4 py-2 rounded-full font-bold">Certification Unlocked</p>` : 
                        `<button onclick="examScore=0; loadScenario(0);" class="text-xs text-orange-600 underline font-bold hover:text-orange-800">Retake Simulation</button>`
                    }
                </div>
            `;
            lucide.createIcons();

            if (isPass) {
                document.getElementById('finish-exam-btn').classList.remove('hidden');
                // Removed sound effect here per request
            }
        }

        // Removed old selectExam/submitFinalExam functions as they are replaced by the Scenario Engine
        /* function showCustomModal... kept for potential reuse */
        function showCustomModal(message, isSuccess) {
             // ... existing helper ...
             const modal = document.createElement('div');
             // ...
        }

        function generateBadge() {
            const container = document.getElementById('badge-container');
            if (!container) return;
            const safeName = (userName || "Learner").toUpperCase();
            const badgeSVG = `<svg viewBox="0 0 400 400" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" style="max-width: 300px;">
                <defs>
                    <linearGradient id="primaryGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#357889;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#2D6473;stop-opacity:1" />
                    </linearGradient>
                    <filter id="shadow">
                        <feDropShadow dx="2" dy="2" stdDeviation="3" flood-color="#000000" flood-opacity="0.3"/>
                    </filter>
                </defs>
                <circle cx="200" cy="200" r="180" fill="url(#primaryGradient)" filter="url(#shadow)" />
                <path d="M200,20 L270,120 L380,120 L300,200 L380,280 L270,280 L200,380 L130,280 L20,280 L100,200 L20,120 L130,120 Z" fill="#D34716" opacity="0.1"/>

                <text x="200" y="160" text-anchor="middle" fill="white" font-family="Georgia" font-size="20">CERTIFIED</text>
                <text x="200" y="210" text-anchor="middle" fill="white" font-family="Georgia" font-size="36" font-weight="bold">BUYER READY</text>
                <text x="200" y="245" text-anchor="middle" fill="#EB8D69" font-family="Verdana" font-size="18">${safeName}</text>
                <text x="200" y="350" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-family="Verdana" font-size="10">ALLGOOD ACADEMY</text>
            </svg>`;
            container.innerHTML = badgeSVG;
        }

        window.openTab = function(tabName) {
            const contents = document.querySelectorAll('#page-4 .tab-content');
            contents.forEach(content => content.classList.add('hidden'));

            const activeContent = document.getElementById(`tab-content-${tabName}`);
            if(activeContent) activeContent.classList.remove('hidden');

            const buttons = document.querySelectorAll('#page-4 .tab-btn');
            buttons.forEach(btn => {
                btn.classList.remove('bg-allgood-primary', 'text-white', 'border-gray-200', 'active'); 
                btn.classList.add('bg-gray-100', 'text-gray-500', 'border-transparent'); 
            });

            const activeBtn = document.getElementById(`tab-btn-${tabName}`);
            if(activeBtn) {
                activeBtn.classList.remove('bg-gray-100', 'text-gray-500', 'border-transparent');
                activeBtn.classList.add('bg-allgood-primary', 'text-white', 'border-gray-200', 'active');
            }
            sfx.tick();
        };

        window.handleAnchorInteraction = function(element, type) {
            const allPills = document.querySelectorAll('.anchor-pill');
            allPills.forEach(pill => {
                if (pill !== element) pill.classList.remove('active');
            });
            
            element.classList.toggle('active');
            
            const messages = {
                "Stability": "Stability: A secure base — predictable costs and long-term roots.",
                "Freedom": "Freedom: Your rules, your space — paint the walls, own a pet, renovate freely.",
                "Belonging": "Belonging: Community connection — neighbors, schools, and a place to call home.",
                "Wealth": "Wealth: Building equity — paying yourself instead of a landlord.",
                "Expression": "Expression: A canvas for your life — design and customize without limits."
            };
            
            const narratorTextEl = document.getElementById('narrator-message');
            const narratorStrip = document.getElementById('narrator-strip');
            
            if (narratorTextEl && messages[type]) {
                narratorTextEl.textContent = messages[type];
                narratorStrip.style.display = 'flex';
                narratorStrip.classList.remove('narrator-speaking');
                void narratorStrip.offsetWidth; 
                narratorStrip.classList.add('narrator-speaking');
            }
            
            sfx.tick();
        };

        let exploredLoans = new Set();

        window.toggleLoanAccordion = function(btn) {
            const container = btn.parentElement;
            const content = btn.nextElementSibling;
            const icon = btn.querySelector('.accordion-arrow');
            const type = container.getAttribute('data-type');

            document.querySelectorAll('#loan-accordion .loan-card').forEach(el => {
                if(el !== container) {
                    const otherBtn = el.querySelector('button');
                    const c = otherBtn.nextElementSibling; 
                    
                    if(c) c.classList.add('hidden');
                    const i = el.querySelector('.accordion-arrow');
                    if(i) i.classList.remove('rotate-180');
                }
            });

            content.classList.toggle('hidden');
            icon.classList.toggle('rotate-180');
            
            if (!content.classList.contains('hidden')) {
                sfx.tick();
                if(type && !exploredLoans.has(type)) {
                    exploredLoans.add(type);
                    updateLoanProgress();
                }
            }
        };

        // NEW: Contract Accordion Logic
        window.toggleContractAccordion = function(btn) {
            const content = btn.nextElementSibling;
            const icon = btn.querySelector('.accordion-arrow');
            
            // Close others
            document.querySelectorAll('#contract-accordion .contract-card').forEach(card => {
                if (card !== btn.parentElement) {
                    card.querySelector('div.hidden, div.block')?.classList.add('hidden');
                    card.querySelector('div.hidden, div.block')?.classList.remove('block');
                    card.querySelector('.accordion-arrow')?.classList.remove('rotate-180');
                }
            });

            content.classList.toggle('hidden');
            content.classList.toggle('block');
            icon.classList.toggle('rotate-180');
            sfx.tick();
        };

        function updateLoanProgress() {
            const count = exploredLoans.size;
            const bar = document.getElementById('loan-progress-bar');
            const text = document.getElementById('loan-progress-text');
            if(bar && text) {
                // Updated Math for 5 items (20% per item)
                bar.style.width = `${count * 20}%`;
                text.textContent = `${count}/5 Explored`;
                
                if(count === 5) {
                    text.textContent = "All Explored! 🔑";
                    text.classList.remove('text-allgood-primary');
                    text.classList.add('text-emerald-600');
                    bar.classList.remove('bg-allgood-primary');
                    bar.classList.add('bg-emerald-500');
                    sfx.nav();
                }
            }
        }

        let loanQuizScore = 0;
        window.checkLoanQuiz = function(btn, type, qId) {
            const correctAnswers = { 1: 'FHA', 2: 'VA', 3: 'Conv' };
            const isCorrect = correctAnswers[qId] === type;
            const parent = btn.parentElement;
            
            if (isCorrect) {
                btn.classList.remove('bg-white', 'hover:bg-gray-50');
                btn.classList.add('bg-emerald-100', 'border-emerald-500', 'text-emerald-800');
                
                sfx.nav(); 
                loanQuizScore++;
                
                const counter = document.getElementById('key-counter');
                counter.innerHTML = `<i data-lucide="key" class="w-4 h-4 text-yellow-500 fill-current animate-pulse-glow"></i> <span class="text-xs font-bold text-yellow-700">${loanQuizScore}/3</span>`;
                lucide.createIcons();

                parent.querySelectorAll('button').forEach(b => b.disabled = true);

                const nextQ = document.querySelector(`.quiz-item[data-id="${qId + 1}"]`);
                if(nextQ) {
                    nextQ.classList.remove('opacity-50', 'pointer-events-none');
                } else {
                    document.getElementById('loan-quiz-feedback').classList.remove('hidden');
                    // Removed sound effect here per request
                }
            } else {
                btn.classList.add('bg-red-50', 'border-red-300', 'text-red-800');
                sfx.powerOff(); 
                
                btn.classList.add('animate-pulse');
                setTimeout(() => btn.classList.remove('animate-pulse'), 500);
            }
        };

        /* --- CREDITS PAGE LOGIC --- */
        let currentRating = 0;
        window.setRating = function(n) {
            currentRating = n;
            for (let i = 1; i <= 5; i++) {
                const star = document.getElementById(`star-${i}`);
                if (i <= n) { star.classList.remove('text-gray-300'); star.classList.add('text-yellow-400'); } 
                else { star.classList.add('text-gray-300'); star.classList.remove('text-yellow-400'); }
            }
            sfx.tick();
        };

        window.submitFeedback = function() {
            const feedbackText = document.getElementById('feedback-text').value;
            // In a real app, we would log this data via SessionManager or API.
            // For this standalone block, we simulate the submission.
            document.getElementById('feedback-container').classList.add('hidden');
            document.getElementById('feedback-success').classList.remove('hidden');
            sfx.nav();
        };
    </script>
</body>
</html>
