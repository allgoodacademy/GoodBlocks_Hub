<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <!-- UPDATED TITLE -->
    <title>Digital Decisions Challenge GoodBlock</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons for interactions -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Font Awesome for quiz icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- Tailwind Config with Allgood Brand Colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'allgood-primary': '#D34716', // Burnt Orange (Action)
                        'allgood-secondary': '#357889', // Deep Cyan (Brand/Header)
                        'allgood-dark': '#4C4C4C', // Dark Gray (Text/BG)
                        'allgood-light': '#F7F7F7', // Light Gray (Backgrounds)
                        'allgood-hover': '#EB8D69', // Light Orange (Hover)
                        'allgood-accent': '#2D6473', // Darker Cyan (Hover)
                    },
                    fontFamily: {
                        'heading': ['Georgia', 'serif'],
                        'body': ['Verdana', 'sans-serif'],
                    },
                },
            },
        }
    </script>

    <style>
        /* Set the base font and background pattern */
        body {
            font-family: Verdana, sans-serif;
            background-color: #1a1a1a;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
            background-attachment: fixed;
            min-height: 100vh;
            position: relative;
            margin: 0;
            padding: 0;
        }

        /* Apply Georgia font to headings */
        h1, h2, h3, h4, h5, h6 {
            font-family: Georgia, serif;
        }

        /* --- TABLET FRAME STYLING --- */
        .tablet-frame {
            height: 80vh;
            width: auto;
            aspect-ratio: 16/10; 
            max-width: 1100px;
            max-height: 95vh;
            min-height: 0; 
            min-width: 0;
            background-image: 
                radial-gradient(circle at 0% 0%, rgba(211, 71, 22, 0.35) 0%, transparent 30%),
                radial-gradient(circle at 100% 100%, rgba(211, 71, 22, 0.35) 0%, transparent 30%),
                linear-gradient(135deg, #5c5c5c 0%, #d6d6d6 25%, #8a8a8a 50%, #e0e0e0 75%, #5c5c5c 100%);
            border-radius: 12px;
            padding: 12px; 
            box-shadow: 
                inset 1px 1px 2px rgba(255,255,255, 0.6), 
                inset -1px -1px 2px rgba(0,0,0, 0.8), 
                0 30px 60px -12px rgba(0, 0, 0, 0.8), 
                0 0 0 1px #111;
            border: 1px solid #333;
            position: relative;
            margin: 20px auto;
            transition: width 0.3s, height 0.3s, padding 0.3s;
        }

        /* Inner screen bezel */
        .tablet-frame::before {
            content: '';
            position: absolute;
            top: 10px; left: 10px; right: 10px; bottom: 10px;
            border-radius: 6px;
            background: #111;
            z-index: 0;
        }

        /* Main content display area */
        /* FIX 1: Ensure screen container is a flex column occupying 100% height */
        .screen-container {
            width: 100%;
            height: 100%;
            background-color: #F7F7F7;
            position: relative;
            z-index: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column; 
            border-radius: 4px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }

        /* --- CUSTOM SCROLLBAR STYLES (for page content) --- */
        .page::-webkit-scrollbar { width: 14px; }
        .page::-webkit-scrollbar-track { background: #e5e5e5; border-left: 1px solid #d1d5db; }
        .page::-webkit-scrollbar-thumb { background-color: #D34716; border-radius: 7px; border: 3px solid #e5e5e5; }
        .page::-webkit-scrollbar-thumb:hover { background-color: #EB8D69; }
        .page::-webkit-scrollbar-button:single-button { background-color: #e5e5e5; display: block; border-style: solid; height: 14px; width: 14px; }
        .page::-webkit-scrollbar-button:single-button:vertical:decrement { border-width: 0 7px 10px 7px; border-color: transparent transparent #D34716 transparent; }
        .page::-webkit-scrollbar-button:single-button:vertical:increment { border-width: 10px 7px 0 7px; border-color: #D34716 transparent transparent transparent; }

        /* --- MODAL TRANSITION CLASSES --- */
        .modal-transition { transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out; }
        .hidden-modal { opacity: 0; pointer-events: none; transform: translateY(-10px); }
        .visible-modal { opacity: 1; pointer-events: auto; transform: translateY(0); }

        /* Progress bar within the footer */
        #flex-progress-bar { height: 4px; width: 100%; background-color: #eee; position: absolute; top: 0; left: 0; }
        #flex-progress-fill { height: 100%; background-color: #D34716; width: 0%; transition: width 0.3s ease; }

        /* --- BLUEPRINT MODE (Dark Mode for App Content) --- */
        .blueprint-mode { background-color: #0f172a !important; color: #94a3b8 !important; }
        .blueprint-mode .page { background-color: #0f172a !important; }
        .blueprint-mode h1, .blueprint-mode h2, .blueprint-mode h3, .blueprint-mode strong { color: #38bdf8 !important; }
        .blueprint-mode .bg-white { background-color: #1e293b !important; border-color: #334155 !important; color: #cbd5e1 !important; }
        .blueprint-mode .text-allgood-dark { color: #e2e8f0 !important; }
        .blueprint-mode .bg-gray-100, .blueprint-mode .bg-gray-50 { background-color: #0f172a !important; border-color: #1e293b !important; }
        .blueprint-mode .accordion-content { background-color: #0f172a !important; border-color: #334155 !important; color: #94a3b8 !important; }
        .blueprint-mode .footer-content { background-color: #1e293b !important; border-top-color: #334455 !important; color: #94a3b8 !important; }
        .blueprint-mode .footer-content a { color: #38bdf8 !important; }
        .blueprint-mode .footer-content #back-button { color: #94a3b8 !important; }
        .blueprint-mode .footer-content #back-button:not(:disabled):hover { color: #38bdf8 !important; }
        .blueprint-mode .quiz-btn { background-color: #1e293b !important; border-color: #334155 !important; color: #cbd5e1 !important; }
        .blueprint-mode .quiz-btn:hover { background-color: #334155 !important; }
        .blueprint-mode .quiz-btn[data-correct="true"]:hover { background-color: #166534 !important; }
        .blueprint-mode .quiz-btn[data-correct="false"]:hover { background-color: #991b1b !important; }
        .blueprint-mode .quiz-btn[data-correct="true"][data-answered] { background-color: #16a34a !important; color: white !important; }
        .blueprint-mode .quiz-btn[data-correct="false"][data-answered] { background-color: #dc2626 !important; color: white !important; }
        
        /* Specific Styles for Digital Decisions Challenge */
        .choice-btn {
            background-color: #FFFFFF;
            border: 2px solid #E5E7EB;
            transition: all 0.2s ease;
        }
        .choice-btn:hover:not(:disabled) {
            border-color: #357889; /* Deep Cyan Hover */
            background-color: #F9FAFB;
        }

        .choice-correct {
            background-color: #D1FAE5 !important; /* Light Green */
            border-color: #10B981 !important; /* Green */
            font-weight: bold;
        }
        .choice-less-effective {
            background-color: #FFFBEB !important; /* Light Yellow */
            border-color: #FBBF24 !important; /* Yellow */
            font-weight: 600;
        }
        .choice-least-effective {
            background-color: #FEE2E2 !important; /* Light Red */
            border-color: #F87171 !important; /* Red */
            font-weight: 500;
            opacity: 0.7;
        }

        .feedback-box {
            background-color: #F9FAFB;
            border-left: 5px solid #357889;
        }
        .feedback-correct { border-left-color: #10B981 !important; }
        .feedback-less { border-left-color: #FBBF24 !important; }
        .feedback-least { border-left-color: #F87171 !important; }

        .blueprint-mode .choice-btn { background-color: #1e293b !important; border-color: #334155 !important; }
        .blueprint-mode .choice-btn:hover:not(:disabled) { background-color: #334155 !important; border-color: #357889 !important; }
        .blueprint-mode .feedback-box { background-color: #1e293b; border-color: #334155; }
        .blueprint-mode .choice-correct { background-color: #166534 !important; border-color: #10B981 !important; color: #D1FAE5 !important; }
        .blueprint-mode .choice-less-effective { background-color: #713F12 !important; border-color: #FBBF24 !important; color: #FFFBEB !important; }
        .blueprint-mode .choice-least-effective { background-color: #991b1b !important; border-color: #F87171 !important; color: #FEE2E2 !important; opacity: 0.8; }
        .blueprint-mode .feedback-least { border-left-color: #F87171 !important; }

        /* HEADER AND FOOTER BASE STYLES */
        .navbar-content { flex: 0 0 60px; z-index: 20; }
        .footer-content { flex: 0 0 60px; z-index: 20; background-color: white; border-top: 1px solid #e5e7eb; position: relative; }
        
        /* PAGE CONTENT BASE STYLES */
        .page { 
            /* Default desktop behavior: flex grow, but uses calculated height to fit within container */
            flex: 1 1 auto; 
            overflow-y: auto; 
            padding: 20px; 
            position: relative; 
            display: none; 
            width: 100%; 
            height: calc(100vh - 120px); /* Fallback for desktop/iframe mode */
        }
        .page.active { display: block; }
        
        /* FULLSCREEN MODE (Desktop) */
        .tablet-frame.focus-mode { 
            position: fixed !important; top: 0 !important; left: 0 !important; right: 0 !important; bottom: 0 !important; 
            width: 100% !important; height: 100vh !important; 
            aspect-ratio: auto !important; max-width: none !important; max-height: none !important; 
            min-height: 0 !important;
            margin: 0 !important; padding: 0 !important; 
            background: #F7F7F7 !important; border: none !important; border-radius: 0 !important; 
            box-shadow: none !important; z-index: 99999 !important; 
            background-image: none !important;
        }
        .tablet-frame.focus-mode::before { display: none; }
        .tablet-frame.focus-mode .screen-container { border-radius: 0; box-shadow: none; height: 100%; }
         .tablet-frame.focus-mode .page {
            height: calc(100vh - 120px);
        }
        .tablet-frame.focus-mode .footer-content { padding-bottom: max(env(safe-area-inset-bottom, 0), 20px); }
        
        /* --- MOBILE LAYOUT LOCK (RIGOROUS iOS FIX) --- */
        @media (max-width: 768px) {
            html, body {
                width: 100%;
                height: 100%; /* Fallback */
                margin: 0;
                padding: 0 !important;
                overflow: hidden !important; /* Stop the document itself from scrolling */
                position: fixed; /* Physically pin the document */
                inset: 0;
                overscroll-behavior: none; /* Stop rubber-banding */
            }
            
            main { 
                /* The MAIN container now acts as the viewport */
                width: 100vw; 
                height: 100dvh; /* Dynamic viewport height */
                /* Fallback for browsers not supporting dvh */
                height: -webkit-fill-available; 
                position: fixed;
                inset: 0;
                padding: 0 !important; 
                display: flex;
                flex-direction: column;
                z-index: 0;
            }
            
            .tablet-frame {
                /* Strip away the tablet appearance, become a flex container */
                position: relative !important; 
                width: 100% !important; 
                height: 100% !important;
                max-width: none !important; max-height: none !important;
                min-height: 0 !important; aspect-ratio: auto !important;
                margin: 0 !important; padding: 0 !important;
                border: none !important; border-radius: 0 !important;
                background-image: none !important; box-shadow: none !important;
                display: flex;
                flex-direction: column;
            }
            
            .tablet-frame::before { display: none; }
            
            .screen-container { 
                flex: 1; /* Grow to fill all available vertical space */
                width: 100%;
                height: 100%;
                display: flex;
                flex-direction: column;
                border-radius: 0 !important; 
                box-shadow: none !important; 
                overflow: hidden; /* Don't let this container scroll */
            }
            
            /* THE BUNS: Fixed Height Items */
            .navbar-content {
                flex: 0 0 auto; /* Do not grow or shrink */
                width: 100%;
                z-index: 50;
                padding-top: max(env(safe-area-inset-top), 5px);
            }
            
            .footer-content { 
                flex: 0 0 auto; /* Do not grow or shrink */
                width: 100%;
                z-index: 100; /* Highest Z-index to sit on top */
                padding-bottom: max(env(safe-area-inset-bottom), 15px); 
                background-color: white;
                border-top: 1px solid #e5e7eb;
                position: relative; /* Ensure stacking context */
            }

            /* THE MEAT: Scrolling Content */
            .page {
                flex: 1 1 auto; /* Grow to occupy remaining space */
                overflow-y: auto; /* Internal vertical scrollbar */
                -webkit-overflow-scrolling: touch; /* Momentum scrolling */
                height: 100%; 
                min-height: 0; /* Crucial for nested flex scrolling */
                padding-bottom: 40px; /* Extra space for scroll clearance */
            }
        }

    </style>
</head>
<body class="flex flex-col min-h-screen text-allgood-dark font-body overflow-y-auto">

    <main class="flex-grow flex items-center justify-center py-8">
        <div class="tablet-frame">
            <div class="screen-container" id="screen">

                <!-- 1. STARTUP SCREEN (UPDATED) -->
                <div id="startup-screen" class="absolute inset-0 z-[300] flex flex-col items-center justify-center cursor-pointer transition-opacity duration-700 ease-in-out bg-gradient-to-br from-allgood-secondary to-allgood-accent">
                    <div class="group flex flex-col items-center justify-center text-center h-full w-full relative">
                        <div class="flex-grow flex flex-col items-center justify-center px-4">
                            <div class="relative">
                                <div class="absolute inset-0 bg-white/10 blur-2xl rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                                <h2 class="text-xl md:text-3xl font-heading font-bold text-white mb-1 relative z-10">Allgood Academy</h2>
                                <h1 class="text-4xl md:text-6xl font-heading font-bold text-allgood-primary tracking-tighter relative z-10 drop-shadow-md">GoodBlock</h1>
                                <p class="mt-2 text-white/80 relative z-10 font-body text-sm font-semibold">Digital Decisions Challenge</p>
                            </div>
                            <p class="mt-12 text-white/80 text-xs tracking-[0.3em] uppercase font-medium group-hover:text-white transition-colors animate-pulse font-body">Click to Power Up</p>
                        </div>
                        <div class="absolute bottom-10 w-full text-center">
                            <p class="text-white/40 text-xs font-body tracking-wide">Powered by the <span class="text-white/60 font-bold">Allgood Academy</span></p>
                        </div>
                    </div>
                </div>

                <!-- 2. Header (Navigation & Controls) -->
                <header class="bg-allgood-secondary shadow-md navbar-content flex items-center">
                    <div class="w-full px-4 flex items-center justify-between h-full pt-[env(safe-area-inset-top)]">
                        <div class="flex items-center overflow-hidden">
                            <!-- UPDATED HEADER TEXT -->
                            <div id="header-welcome-text" class="flex-shrink-0 text-white font-heading font-bold text-lg tracking-tight truncate mr-4 select-none">Digital Decisions Challenge</div>
                            <div class="hidden sm:flex items-center bg-black/20 rounded-full px-3 py-1 border border-white/10 shadow-inner backdrop-blur-sm">
                                <span class="text-[10px] uppercase tracking-wider text-white/60 mr-2 font-heading font-bold">Page</span>
                                <span id="header-page-indicator" class="text-xs font-bold text-white font-body tabular-nums">1 / 34</span>
                            </div>
                        </div>
                        <div class="flex items-center space-x-1 shrink-0 relative">
                            <!-- Home / Reset Button -->
                            <button id="home-button" class="text-gray-200 hover:text-white transition-colors p-2 rounded-full hover:bg-white/10" title="Go to Cover (Long-Press to Reset)"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg></button>
                            <div class="h-6 w-px bg-white/20 mx-1"></div>
                            <!-- Blueprint Mode Toggle -->
                            <button id="blueprint-toggle" class="text-gray-200 hover:text-cyan-300 transition-colors p-2 rounded-full hover:bg-white/10" title="Blueprint Mode"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg></button>
                            <!-- Fullscreen Toggle -->
                            <button id="fullscreen-toggle" class="text-gray-200 hover:text-green-300 transition-colors p-2 rounded-full hover:bg-white/10" title="Focus Mode"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" /></svg></button>
                            <!-- Menu/TOC Toggle -->
                            <button id="menu-toggle" class="text-gray-200 hover:text-white transition-colors p-2 rounded-full hover:bg-white/10" title="Jump to Page"><svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg></button>
                        </div>
                    </div>
                </header>

                <!-- 3. Login Modal (Initial Gate) -->
                <div id="login-modal" class="absolute inset-0 z-[200] bg-allgood-dark/95 flex items-center justify-center p-6 visible-modal modal-transition">
                    <div class="bg-white rounded-lg shadow-2xl p-8 max-w-sm w-full text-center border-t-4 border-allgood-primary">
                        <div class="mb-6">
                            <h2 class="text-3xl font-heading font-bold text-allgood-dark">Allgood<span class="text-allgood-primary">Academy</span></h2>
                        </div>
                        <h2 class="text-xl font-bold text-allgood-dark mb-2 font-heading">Digital Decisions Challenge</h2>
                        <div class="flex items-center justify-center gap-2 mb-6 relative">
                            <p class="text-gray-500 text-sm font-body">Please sign in to start.</p>
                            <button id="policy-trigger" class="group relative flex items-center text-allgood-primary hover:text-allgood-hover transition-colors focus:outline-none">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                                <span class="text-xs font-bold underline decoration-dotted underline-offset-2">Why?</span>
                                <div class="absolute top-full left-1/2 transform -translate-x-1/2 mt-3 w-64 p-3 bg-gray-800 text-white text-xs text-left rounded shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible group-focus:opacity-100 group-focus:visible transition-all duration-200 z-50 font-body leading-relaxed border border-gray-700 pointer-events-none" id="policy-tooltip">
                                    <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-800"></div>
                                    <strong class="block text-allgood-primary mb-1 uppercase tracking-wide text-[10px]">Why do we ask?</strong>
                                    <p class="mb-2 text-gray-300">We use your name to personalize your badge. **Performance data is logged in real-time** to improve the GoodBlock experience. All personal data is **kept confidential** and **never sold.**</p>
                                    <div class="border-t border-gray-700 my-1 pt-1"></div>
                                    <p class="text-gray-300">**Email (Optional):** Enter to receive your final score and optional badge.</p>
                                </div>
                            </button>
                        </div>
                        <input type="text" id="user-name-input" placeholder="Your Name (Optional)" class="w-full border border-gray-300 rounded p-3 mb-3 focus:ring-2 focus:ring-allgood-primary focus:border-transparent outline-none transition-all font-body">
                        <input type="email" id="user-email-input" placeholder="Your Email (Optional)" class="w-full border border-gray-300 rounded p-3 mb-6 focus:ring-2 focus:ring-allgood-primary focus:border-transparent outline-none transition-all font-body">
                        <button id="start-session-btn" class="w-full bg-allgood-primary hover:bg-allgood-hover text-white font-bold py-3 rounded shadow-md transition-transform transform hover:scale-[1.02] active:scale-[0.98] font-body">Start Challenge</button>
                    </div>
                </div>

                <!-- 4. Image Modal (Unused, kept for structure) -->
                <div id="image-modal" class="hidden-modal absolute inset-0 z-[250] bg-black/90 flex items-center justify-center p-4 modal-transition" onclick="closeImageModal()">
                    <img id="expanded-image" src="" class="max-w-full max-h-full rounded shadow-2xl cursor-pointer" alt="Expanded View">
                    <div class="absolute bottom-4 text-white/70 text-xs font-body">Click anywhere to close</div>
                </div>

                <!-- 4b. Scenario Outcome Modal (Updated for DCC) -->
                <div id="scenario-modal" class="hidden-modal absolute inset-0 z-[260] bg-allgood-dark/90 flex items-center justify-center p-4 modal-transition" onclick="closeScenarioModal()">
                    <div class="bg-white rounded-lg shadow-2xl p-6 max-w-sm w-full text-center relative border-t-4 border-allgood-secondary" onclick="event.stopPropagation()">
                        <div id="scenario-icon" class="mx-auto w-16 h-16 rounded-full flex items-center justify-center mb-4 text-3xl transition-colors"></div>
                        <h3 id="scenario-title" class="text-xl font-heading font-bold text-allgood-dark mb-2"></h3>
                        <div id="scenario-feedback" class="text-sm text-gray-600 font-body mb-6 leading-relaxed text-left"></div>
                        <!-- FIX 1: Add data-action attribute to differentiate button click from overlay click -->
                        <button id="scenario-modal-next-btn" onclick="closeScenarioModal(true)" class="bg-allgood-dark text-white px-6 py-2 rounded-full font-bold text-xs uppercase tracking-wider hover:bg-allgood-primary transition-colors shadow-md">Next Scenario</button>
                    </div>
                </div>

                <!-- 5. Navigation Menu (TOC) -->
                <div id="menu-modal" class="hidden-modal absolute inset-0 z-[100] bg-black/60 flex justify-end modal-transition">
                    <div class="w-72 h-full bg-white shadow-xl flex flex-col border-l border-gray-200">
                        <div class="p-4 border-b border-gray-200 flex justify-between items-center bg-gray-50">
                            <span class="font-bold text-allgood-dark font-heading">Table of Contents</span>
                            <button id="close-menu" class="text-gray-500 hover:text-allgood-primary"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
                        </div>
                        <div class="p-2 overflow-y-auto flex-grow space-y-1 text-sm font-body" id="toc-list">
                            <!-- TOC populated by JavaScript -->
                            <button class="menu-link w-full text-left px-4 py-1.5 hover:bg-gray-100 text-gray-600 font-bold" data-page="0">1. Cover Page</button>
                            <button class="menu-link w-full text-left px-4 py-1.5 hover:bg-gray-100 text-gray-600 font-bold" data-page="1">2. Welcome & Rules</button>
                            <!-- Scenarios inserted here -->
                            <div class="px-4 py-1 text-xs font-bold text-gray-400 uppercase tracking-wider mt-2">The 30 Digital Decisions</div>
                            <!-- 30 Dynamic Scenario Links -->
                            <button class="menu-link w-full text-left px-4 py-1.5 hover:bg-gray-100 text-gray-600" data-page="32">33. Final Score & Badge</button>
                            <button class="menu-link w-full text-left px-4 py-1.5 hover:bg-gray-100 text-gray-600" data-page="33">34. Credits</button>
                        </div>
                    </div>
                </div>

                <!-- --- PAGES --- -->

                <!-- Page 1: Cover -->
                <div class="page active" id="page-1">
                    <div class="flex flex-col items-center justify-start h-full text-center px-2 pt-12">
                        <div class="mb-6"><h2 class="text-2xl font-heading font-bold text-allgood-dark">Allgood<span class="text-allgood-primary">Academy</span></h2></div>
                        <h1 class="text-3xl sm:text-4xl font-heading font-bold text-allgood-dark mb-8 leading-tight tracking-tight">The <span class="text-allgood-primary">Digital Decisions</span> Challenge</h1>
                        
                        <div class="w-full max-w-lg text-left mx-auto">
                            <!-- Updated Image/Icon for Digital Challenge -->
                            <div class="w-full bg-allgood-secondary/10 border-2 border-allgood-secondary p-6 rounded-xl shadow-lg mb-8 flex items-center justify-center space-x-4">
                                <i data-lucide="monitor" class="w-12 h-12 text-allgood-secondary"></i>
                                <i data-lucide="users" class="w-12 h-12 text-allgood-primary"></i>
                                <i data-lucide="lightbulb" class="w-12 h-12 text-allgood-secondary"></i>
                            </div>
                            
                            <button class="accordion-toggle w-full bg-white border border-gray-200 p-4 rounded-lg shadow-md flex justify-between items-center hover:bg-gray-50 hover:border-allgood-primary transition-all group">
                                <span class="font-bold text-allgood-dark text-base group-hover:text-allgood-primary transition-colors font-heading">How to use this GoodBlock</span>
                                <svg class="accordion-icon h-5 w-5 text-gray-400 transform transition-transform duration-300 group-hover:text-allgood-primary" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            </button>
                            <div class="accordion-content hidden bg-gray-50 border-x border-b border-gray-200 rounded-b-lg p-5 text-gray-600 shadow-inner text-xs font-body" id="accordion-content-1">
                                <p class="mb-4 text-sm text-allgood-dark">This GoodBlock is your interactive workspace. Use the **Control Cluster** in the top right to customize your environment.</p>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div class="flex items-start"><div class="p-1.5 bg-white rounded border border-gray-300 mr-3 text-allgood-primary"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg></div><div><strong class="text-allgood-dark block mb-0.5">Home & Reset</strong><span class="text-gray-500 leading-snug">Click to return to cover. **Hold for 2s** to hard reset & sign out.</span></div></div>
                                    <div class="flex items-start"><div class="p-1.5 bg-white rounded border border-gray-300 mr-3 text-cyan-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg></div><div><strong class="text-allgood-dark block mb-0.5">Blueprint Mode</strong><span class="text-gray-500 leading-snug">Toggle high-contrast Dark Mode for low-light environments.</span></div></div>
                                    <div class="flex items-start"><div class="p-1.5 bg-white rounded border border-gray-300 mr-3 text-green-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" /></svg></div><div><strong class="text-allgood-dark block mb-0.5">Focus Mode</strong><span class="text-gray-500 leading-snug">Maximize workspace. Removes the frame for mobile devices.</span></div></div>
                                    <div class="flex items-start"><div class="p-1.5 bg-white rounded border border-gray-300 mr-3 text-allgood-dark"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg></div><div><strong class="text-allgood-dark block mb-0.5">Table of Contents</strong><span class="text-gray-500 leading-snug">Jump directly to any section without losing progress.</span></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Page 2: Welcome & Rules (UPDATED) -->
                <div class="page" id="page-2">
                    <section class="mb-6 border-b border-gray-200 pb-4"><h2 class="text-2xl font-heading font-bold text-allgood-dark mb-2">Welcome & Mission Briefing</h2></section>
                    <div class="bg-white p-6 rounded border border-gray-200 shadow-sm leading-relaxed text-gray-700 text-lg" id="welcome-content">
                        <p class="mb-6">**Every click is a brick in your digital footprint.** You are about to engage in a challenge that tests your pragmatic judgment in 30 real-world, high-stakes digital scenarios.</p>
                        
                        <!-- Core Principles -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8 text-center text-sm">
                            <div class="p-3 border rounded-lg bg-gray-50 border-gray-200">
                                <i data-lucide="fingerprint" class="w-6 h-6 mx-auto text-allgood-secondary mb-2"></i>
                                <strong class="text-allgood-dark">Digital Footprint</strong>
                                <p class="text-xs text-gray-500">Every action is permanent. Manage your brand, not just your privacy.</p>
                            </div>
                            <div class="p-3 border rounded-lg bg-gray-50 border-gray-200">
                                <i data-lucide="shield-half" class="w-6 h-6 mx-auto text-allgood-primary mb-2"></i>
                                <strong class="text-allgood-dark">The Publisher Mindset</strong>
                                <p class="text-xs text-gray-500">Act as if everything you post could be on a billboard. You are the editor.</p>
                            </div>
                        </div>
                        
                        <div class="bg-gray-100 p-4 rounded border-l-4 border-allgood-primary shadow-sm mb-6">
                            <h3 class="font-bold text-allgood-dark text-lg mb-2">Challenge Rules</h3>
                            <ul class="text-sm text-gray-600 space-y-1 list-disc list-inside">
                                <li>The challenge consists of **30 Scenarios**.</li>
                                <li>You earn **3 points** for the **MOST-EFFECTIVE** choice.</li>
                                <li>You earn **1 point** for the **LESS-EFFECTIVE** choice.</li>
                                <li>You earn **0 points** for the **LEAST-EFFECTIVE** choice.</li>
                                <li>Maximum possible score is **90 points**.</li>
                                <li>**Badge Requirement:** Score **80 points or higher** to earn your Digital Decisions Badge.</li>
                            </ul>
                        </div>

                        <p class="mt-6 font-bold text-allgood-secondary">Ready to test your judgment? Let's begin.</p>
                    </div>
                </div>

                <!-- Pages 3 to 32: Scenarios 1 to 30 + Conclusion -->
                <!-- Dynamic Scenario Generation: Loop through all 30 scenarios -->
                <div class="page" id="page-3" data-scenario-index="1"></div>
                <div class="page" id="page-4" data-scenario-index="2"></div>
                <div class="page" id="page-5" data-scenario-index="3"></div>
                <div class="page" id="page-6" data-scenario-index="4"></div>
                <div class="page" id="page-7" data-scenario-index="5"></div>
                <div class="page" id="page-8" data-scenario-index="6"></div>
                <div class="page" id="page-9" data-scenario-index="7"></div>
                <div class="page" id="page-10" data-scenario-index="8"></div>
                <div class="page" id="page-11" data-scenario-index="9"></div>
                <div class="page" id="page-12" data-scenario-index="10"></div>
                <div class="page" id="page-13" data-scenario-index="11"></div>
                <div class="page" id="page-14" data-scenario-index="12"></div>
                <div class="page" id="page-15" data-scenario-index="13"></div>
                <div class="page" id="page-16" data-scenario-index="14"></div>
                <div class="page" id="page-17" data-scenario-index="15"></div>
                <div class="page" id="page-18" data-scenario-index="16"></div>
                <div class="page" id="page-19" data-scenario-index="17"></div>
                <div class="page" id="page-20" data-scenario-index="18"></div>
                <div class="page" id="page-21" data-scenario-index="19"></div>
                <div class="page" id="page-22" data-scenario-index="20"></div>
                <div class="page" id="page-23" data-scenario-index="21"></div>
                <div class="page" id="page-24" data-scenario-index="22"></div>
                <div class="page" id="page-25" data-scenario-index="23"></div>
                <div class="page" id="page-26" data-scenario-index="24"></div>
                <div class="page" id="page-27" data-scenario-index="25"></div>
                <div class="page" id="page-28" data-scenario-index="26"></div>
                <div class="page" id="page-29" data-scenario-index="27"></div>
                <div class="page" id="page-30" data-scenario-index="28"></div>
                <div class="page" id="page-31" data-scenario-index="29"></div>
                <div class="page" id="page-32" data-scenario-index="30"></div>

                <!-- Page 33: Final Score & Badge -->
                <div class="page" id="page-33">
                    <section class="mb-6 border-b border-gray-200 pb-4">
                        <h2 class="text-2xl font-heading font-bold text-allgood-dark mb-2">Final Readiness Assessment</h2>
                        <p class="text-xs font-bold text-allgood-primary uppercase tracking-widest">Your Digital Decisions Score</p>
                    </section>
                    
                    <div id="final-score-content">
                        <!-- Content inserted by updateFinalScorePage -->
                        <div class="text-center py-8">
                            <div class="w-full max-w-sm mx-auto bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200 mb-8">
                                <p class="text-sm font-semibold text-gray-500 mb-1">Total Score</p>
                                <p id="final-score-value" class="text-5xl font-extrabold text-allgood-dark font-heading">0 / 90</p>
                                <p id="final-score-percent" class="text-xs text-gray-400 mt-1">(0% Effectiveness)</p>
                            </div>
                            
                            <h3 id="final-rank-heading" class="text-xl font-heading font-bold text-allgood-dark mb-2">Digital Learner</h3>
                            <p id="final-rank-message" class="text-sm text-gray-600 max-w-md mx-auto">
                                Good start. You're aware of the challenges but your decision-making needs fine-tuning. Reread the feedback and try again to build a safer footprint.
                            </p>
                            
                            <!-- Certification Badge Section (Locked/Unlocked) -->
                            <div id="certification-section" class="w-full max-w-md mx-auto bg-gradient-to-br from-allgood-secondary to-allgood-accent p-1 rounded-lg shadow-xl mt-12 transform transition-all duration-700">
                                <div class="bg-white p-6 rounded-md text-center">
                                    <div class="mb-4 relative inline-block">
                                        <i id="badge-icon" data-lucide="award" class="relative w-16 h-16 text-allgood-primary mx-auto"></i>
                                    </div>
                                    <h3 class="font-heading font-bold text-xl text-allgood-dark mb-2">Digital Architect Certification</h3>
                                    <p id="cert-req-text" class="text-sm text-gray-600 mb-6">You need **80 points** (88.9%) to achieve this final certification.</p>
                                    
                                    <button id="download-badge-btn" onclick="downloadBadge()" disabled class="w-full bg-gray-300 text-white font-bold py-3 rounded shadow-none cursor-not-allowed flex items-center justify-center transition-all duration-300">
                                        <i id="btn-icon" data-lucide="lock" class="w-4 h-4 mr-2"></i>
                                        <span id="btn-text">Certification Locked</span>
                                    </button>
                                    
                                    <button id="retake-challenge-btn" onclick="performHardReset()" class="w-full bg-gray-100 text-allgood-dark font-bold py-2 rounded shadow-sm mt-4 hover:bg-gray-200 transition-colors">
                                        Retake Challenge
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Page 34: Credits -->
                <div class="page" id="page-34">
                    <div class="flex flex-col items-center justify-start h-full text-center px-2 pt-8">
                        <div class="mb-8"><h2 class="text-2xl font-heading font-bold text-allgood-dark">Allgood<span class="text-allgood-primary">Academy</span></h2><p class="text-xs text-gray-400 font-bold tracking-widest uppercase mt-2">Pragmatic Action</p></div>
                        
                        <div id="feedback-container" class="w-full max-w-md bg-white p-6 rounded-lg shadow-md border border-gray-200 mb-8 text-left relative">
                            <h3 class="font-bold text-allgood-dark text-sm uppercase tracking-wide mb-4 text-center">Rate this GoodBlock</h3>
                            
                            <div class="flex justify-center space-x-2 mb-4" id="star-wrapper">
                                <button onclick="setRating(1)" class="star-btn focus:outline-none transition-transform hover:scale-110" data-val="1"><i id="star-1" class="fas fa-star text-2xl text-gray-300"></i></button>
                                <button onclick="setRating(2)" class="star-btn focus:outline-none transition-transform hover:scale-110" data-val="2"><i id="star-2" class="fas fa-star text-2xl text-gray-300"></i></button>
                                <button onclick="setRating(3)" class="star-btn focus:outline-none transition-transform hover:scale-110" data-val="3"><i id="star-3" class="fas fa-star text-2xl text-gray-300"></i></button>
                                <button onclick="setRating(4)" class="star-btn focus:outline-none transition-transform hover:scale-110" data-val="4"><i id="star-4" class="fas fa-star text-2xl text-gray-300"></i></button>
                                <button onclick="setRating(5)" class="star-btn focus:outline-none transition-transform hover:scale-110" data-val="5"><i id="star-5" class="fas fa-star text-2xl text-gray-300"></i></button>
                            </div>

                            <label class="block text-xs font-bold text-gray-500 mb-2">Your feedback sharpens our tools. What worked? What didn't?</label>
                            <textarea id="feedback-text" rows="3" class="w-full border border-gray-300 rounded p-3 text-sm focus:ring-1 focus:ring-allgood-primary focus:border-allgood-primary outline-none resize-none bg-gray-50" placeholder="Optional: Share your thoughts..."></textarea>
                            
                            <button onclick="submitFeedback()" class="w-full mt-4 bg-allgood-dark hover:bg-allgood-primary text-white font-bold py-2 rounded transition-colors text-sm">Send Feedback</button>
                        </div>

                        <div id="feedback-success" class="hidden w-full max-w-md bg-green-50 p-6 rounded-lg shadow-inner border border-green-200 mb-8 text-center">
                            <i data-lucide="check-circle" class="w-12 h-12 text-green-600 mx-auto mb-2"></i>
                            <h3 class="font-bold text-green-800">Feedback Received.</h3>
                            <p class="text-xs text-green-700 mt-1">Thank you for helping us improve.</p>
                        </div>

                        <div class="w-full max-w-md text-left mx-auto mb-4">
                            <button class="accordion-toggle w-full bg-white border border-gray-200 p-4 rounded-lg shadow-sm flex justify-between items-center hover:bg-gray-50 hover:border-allgood-primary transition-all group">
                                <span class="font-heading font-bold text-allgood-dark text-base group-hover:text-allgood-primary transition-colors">About Us</span>
                                <svg class="accordion-icon h-5 w-5 text-gray-400 transform transition-transform duration-300 group-hover:text-allgood-primary" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            </button>
                            <div class="accordion-content hidden bg-white border-x border-b border-gray-200 rounded-b-lg p-6 text-gray-600 space-y-3 shadow-inner text-sm font-body leading-relaxed" id="about-us-content">
                                <p>The Allgood Academy is a learning lab focused on **Pragmatic Action**. We apply the advanced instructional design used by top tech companies to guarantee one result: a mindset shift that converts passive learning into tangible, real-world execution.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 6. Footer with Nav Buttons -->
                <footer class="footer-content flex items-center justify-between px-6">
                    <div id="flex-progress-bar"><div id="flex-progress-fill"></div></div>
                    <button id="back-button" class="text-allgood-primary hover:text-allgood-dark font-bold text-sm flex items-center transition-colors disabled:opacity-30 disabled:cursor-not-allowed font-body">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>Back
                    </button>
                    <p class="text-gray-400 text-[10px] hidden sm:block font-body">&copy; <a href="https://www.allgoodacademy.com" target="_blank" class="hover:text-allgood-primary transition-colors font-bold">Allgood Academy</a> <span id="current-year"></span></p>
                    <button id="next-button" class="bg-allgood-primary hover:bg-allgood-hover text-white px-6 py-2 rounded-full text-sm font-bold shadow-md transition-transform transform hover:scale-105 flex items-center disabled:opacity-50 disabled:cursor-not-allowed font-body"><span>Next</span><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg></button>
                </footer>

            </div>
        </div>
    </main>

    <!-- Main Application Logic (JavaScript) -->
    <script>
        // --- GLOBAL VARIABLES & DATA ---
        let currentUserName = "Anonymous";
        let currentUserEmail = "";
        let currentPageIndex = 0; 
        const TOTAL_PAGES = 34; // Cover (1) + Intro (1) + Scenarios (30) + Score (1) + Credits (1)
        const TOTAL_SCENARIOS = 30;
        const MAX_SCORE = 90; // 30 * 3
        const BADGE_THRESHOLD = 80;
        let totalChallengeScore = 0;
        let answeredScenarioScores = {}; // Key: Scenario Index (1-30), Value: Score (0, 1, or 3)
        
        const menuModal = document.getElementById('menu-modal'); // Define global reference

        // --- GOOGLE SHEETS TRACKING CONFIG ---
        // UPDATED URL
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzgyHY9qU0nubcDkVDb85cdXyLKKaHt-9zcsyIEuBegYpIbqxCiConaDvFX7UXBzd_Gdg/exec";
        let sessionId = "session_" + Date.now() + "_" + Math.floor(Math.random() * 1000);

        // --- TEXT SANITIZATION FUNCTION ---
        /**
         * Replaces Markdown bold/italic markers (**text** or *text*) with HTML tags.
         * @param {string} text 
         * @returns {string} HTML string.
         */
        function sanitizeText(text) {
            if (!text) return "";
            // 1. Replace **bold** with <strong>
            let sanitized = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            // 2. Replace *italic* with <em>
            sanitized = sanitized.replace(/\*(.*?)\*/g, '<em>$1</em>');
            return sanitized;
        }

        // --- SESSION MANAGER ---
        const SessionManager = {
            log: function(action, detail, payload = {}) {
                const data = {
                    sessionId: sessionId,
                    userName: currentUserName,
                    userEmail: currentUserEmail,
                    action: action,
                    detail: detail,
                    payload: payload
                };

                fetch(APPS_SCRIPT_URL, {
                    method: "POST",
                    mode: "no-cors", 
                    headers: { "Content-Type": "text/plain" },
                    body: JSON.stringify(data) 
                }).then(() => {
                    // console.log("Event logged:", action);
                }).catch(err => console.error("Tracking Error:", err));
            },
            start: function(name, email) {
                this.log("Session Started", "User Logged In", { startTime: new Date().toISOString() });
            },
        };

        // --- SCENARIO DATA (30 Scenarios) ---
        const SCENARIO_DATA = [
            // SCENARIO 1 (Page 3)
            { title: "Your classmate posts a picture of your group project online without getting your permission. Question: What do you do?", icon: "users",
                choices: [
                    { text: "Say nothing and ignore the post, hoping it will go away.", score: 1, effectiveness: "less-effective", feedback: "While you're respecting their privacy, this isn't the most effective choice. A more principled person would not ignore a problem. You are missing an opportunity to help your friend who might be struggling." },
                    { text: "Post a mean comment on their picture telling them to take it down immediately.", score: 0, effectiveness: "least-effective", feedback: "While you're trying to resolve the situation, this is the least-effective choice. **Reacting with aggression is not respectful or effective.** It damages your relationship and shows poor communication skills." },
                    { text: "Politely message them to ask them to take it down, explaining why you're uncomfortable.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. You handled the situation with **integrity and respect** for your own feelings. It also demonstrates great social skills by managing the conflict directly and politely. *You could say something like: 'Hey, I saw the picture of our project that you posted, and I'm a little uncomfortable with my work being online without my permission. Could you please take it down for me?'*" }
                ]
            },
            // SCENARIO 2 (Page 4)
            { title: "You get into a heated debate with a stranger in the comments section of a social media post. Question: What do you do?", icon: "message-square",
                choices: [
                    { text: "Use an 'I' statement to express your point of view calmly and then disengage from the conversation.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. You act as a **thoughtful communicator** by expressing your ideas clearly and with self-control. It shows you know when to stop and maintain your online well-being. *You could say something like: 'I can see that we have very different opinions on this topic, and I'm going to disengage from this conversation now.'*" },
                    { text: "Use personal attacks to try and win the argument.", score: 0, effectiveness: "least-effective", feedback: "Using personal attacks is a sign of a poor communicator. This is the least-effective choice because it **damages your online reputation** and shows a lack of self-management skills." },
                    { text: "Say nothing and leave the conversation.", score: 1, effectiveness: "less-effective", feedback: "While this may seem like the best option, this isn't the most effective choice. You are not being a good communicator. You should always try to **express your point of view calmly and with respect**, which is a key trait of a good communicator." }
                ]
            },
            // SCENARIO 3 (Page 5)
            { title: "You are applying for a job, and the company asks for your social media handles. Question: What do you do?", icon: "briefcase",
                choices: [
                    { text: "You curate your social media to reflect your professional goals and then share it.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **curated digital footprint** is a powerful professional asset, not a liability. You've thought about your personal brand and how it aligns with your career goals, showing great thinking skills." },
                    { text: "You delete all your social media accounts before giving them your handles.", score: 1, effectiveness: "less-effective", feedback: "Deleting accounts can sometimes look suspicious. This isn't the most effective choice. While it's a way to avoid problems, it doesn't show that you have the **thinking skills to manage your online presence responsibly**." },
                    { text: "You give them all your social media handles without reviewing them.", score: 0, effectiveness: "least-effective", feedback: "Giving a company access to all of your social media, including potentially inappropriate content, is risky. This is the least-effective choice because it shows a **lack of awareness** about how your online identity can impact your professional life." }
                ]
            },
            // SCENARIO 4 (Page 6)
            { title: "Your friend sends you a link to a 'free gift card' survey. It asks for your personal information, including your full name and address. Question: What do you do?", icon: "wallet",
                choices: [
                    { text: "Fill out the survey with your real information to get the reward.", score: 0, effectiveness: "least-effective", feedback: "You gave in to a promise of a reward without considering the risks. This is the least-effective choice because a **thinker would question the motives** behind the offer and recognize that your personal data is more valuable than a free gift card." },
                    { text: "Delete the message and warn your friend that it might be a scam.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A true **thinker analyzes information** and recognizes potential risks. You were skeptical and used your reasoning skills to protect both yourself and your friend from a potential phishing scam. *You could say something like: 'Hey, I think that gift card link is a scam. It's asking for personal information, so you should probably delete the message.'*" },
                    { text: "Ask your friend if they have used it successfully and if it's safe.", score: 1, effectiveness: "less-effective", feedback: "While you're seeking more information, this is a less-effective choice. You are trusting a single source who might not be knowledgeable. A better thinker would **verify the information from a more reliable source** before acting." }
                ]
            },
            // SCENARIO 5 (Page 7)
            { title: "You want to use a picture you found on Google for your school presentation. The picture is not labeled for reuse. Question: What do you do?", icon: "image",
                choices: [
                    { text: "Search for the original creator and ask for permission.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. Acting with **integrity means respecting intellectual property**. You showed that you value the work of others by seeking proper authorization and demonstrating good research skills. *You could say something like: 'Hello, I'm working on a school presentation and would love to use your photo. Would that be okay with you? I'll be sure to give you full credit.'*" },
                    { text: "Use the image anyway since it's on the internet and easy to find.", score: 0, effectiveness: "least-effective", feedback: "Just because something is online doesn't mean it is free to use without permission. This is the least-effective choice because it shows a **lack of respect** for the creator and their work." },
                    { text: "Use the image anyway and give credit to 'Google Images.'", score: 1, effectiveness: "less-effective", feedback: "While you are attempting to give credit, this is a less-effective choice. A more principled person would put in the effort to **find the true source** rather than using a generic phrase. It's a key part of good digital citizenship." }
                ]
            },
            // SCENARIO 6 (Page 8)
            { title: "You see a post from your classmate making fun of another student. The comments are full of hateful remarks. Question: What do you do?", icon: "users-x",
                choices: [
                    { text: "Report the post and privately message the person being bullied to offer support.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. You acted with **empathy** by not only reporting the harmful content but also reaching out to offer support. You put the well-being of your peer first and showed a commitment to a positive digital community. *You could say something like: 'Hey, I saw what happened online, and I'm really sorry. I wanted to let you know that I'm here for you if you need to talk or just get your mind off of it.'*" },
                    { text: "Like the post to fit in with your friends.", score: 0, effectiveness: "least-effective", feedback: "By liking the post, you are actively supporting bullying. This is the least-effective choice because a caring person acts with integrity and **stands up for others**, even when it is difficult." },
                    { text: "Comment on the post, telling everyone to stop being so mean.", score: 1, effectiveness: "less-effective", feedback: "While your intentions are good, this is a less-effective choice. **Engaging in the comments can sometimes make the situation worse** by giving the post more attention. A more caring response would address the situation privately or through official channels." }
                ]
            },
            // SCENARIO 7 (Page 9)
            { title: "You're taking an online class and your classmate posts something with a clear mistake. Question: What do you do?", icon: "book-open-check",
                choices: [
                    { text: "Privately message your classmate with constructive feedback and offer to help.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. By using a private message, you act as a **thoughtful communicator who is empathetic** to your peer's feelings. This shows you value their learning while protecting them from public embarrassment. *You could say something like: 'Hey, I was reading your post, and I think there might be a small mistake...'* " },
                    { text: "Post a public comment correcting their mistake so everyone can learn.", score: 1, effectiveness: "less-effective", feedback: "While you might want to help others, **publicly correcting someone can be embarrassing** and make them defensive. A better communicator would consider the social impact of their actions before posting." },
                    { text: "Say nothing and ignore the mistake.", score: 0, effectiveness: "least-effective", feedback: "By saying nothing, you miss an opportunity to collaborate and help your classmate learn. This is the least-effective choice because **effective communicators offer support** and guidance when it is needed." }
                ]
            },
            // SCENARIO 8 (Page 10)
            { title: "You receive a friend request on social media from a person you don't know. Question: What do you do?", icon: "user-plus",
                choices: [
                    { text: "Ignore the request and review your privacy settings to make sure your profile is private.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **responsible risk-taker** is not reckless. You took a proactive step to protect your digital identity by being cautious about who you connect with and checking your security settings." },
                    { text: "Accept the request and then immediately send them a message asking who they are.", score: 0, effectiveness: "least-effective", feedback: "You've already granted them access to your information, which puts you at risk. This is the least-effective choice because a risk-taker would **not rush into a situation** without understanding the risks first." },
                    { text: "Accept the request; the more friends you have, the more popular you seem.", score: 1, effectiveness: "less-effective", feedback: "You are taking a **risk with your personal information** without thinking through the consequences. A wiser risk-taker would consider the potential negative outcomes before accepting a request from a stranger." }
                ]
            },
            // SCENARIO 9 (Page 11)
            { title: "You're scrolling through social media, and a pop-up appears, claiming your phone has a virus and you need to download a special app to fix it. Question: What do you do?", icon: "alert-triangle",
                choices: [
                    { text: "Show it to your parents or a trusted adult to get their opinion.", score: 1, effectiveness: "less-effective", feedback: "While it's good to ask for help, this is a less-effective choice. You should first try to use your own **thinking and problem-solving skills**. A more effective approach would be to close the pop-up and analyze the situation on your own." },
                    { text: "Close the pop-up and run a scan with your phone's built-in security software.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **thinker is critical** of what they see online. You avoided a scam and took a logical, proactive step to ensure your device's security, showing great problem-solving skills." },
                    { text: "Immediately tap the pop-up and follow the instructions to get rid of the virus.", score: 0, effectiveness: "least-effective", feedback: "You acted **impulsively** without analyzing the situation. This is a less-effective choice because a thinker would question an unexpected and urgent pop-up and look for other solutions." }
                ]
            },
            // SCENARIO 10 (Page 12)
            { title: "Your teacher has asked you to use a specific website for research, but you've found a different website that seems to have more information. You have never heard of this new website before. Question: What do you do?", icon: "search",
                choices: [
                    { text: "Use both websites and check to see if the information is the same.", score: 1, effectiveness: "less-effective", feedback: "While you're attempting to verify the information, this is a less-effective choice. It's a risk to spend time on an unknown source. A more knowledgeable person would prioritize using **proven, reliable sources first**." },
                    { text: "Use the new website because it has more information.", score: 0, effectiveness: "least-effective", feedback: "The amount of information on a website does not guarantee its quality. This is the least-effective choice because a knowledgeable person would **not use an unknown source** that could contain false or misleading information." },
                    { text: "Stick to the website your teacher has provided because it is a reliable source.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **knowledgeable person understands that reliable sources are essential**. You showed you can identify a trustworthy resource, ensuring the accuracy and integrity of your work." }
                ]
            },
            // SCENARIO 11 (Page 13)
            { title: "You are creating a new account and are asked to create a new password. You're eager to start using the app. Question: What do you do?", icon: "key",
                choices: [
                    { text: "Use the same password you use for everything else because it's easy to remember.", score: 1, effectiveness: "less-effective", feedback: "While using the same password is easy, this is a less-effective choice. If one of your accounts is compromised, **all of your accounts could be at risk**. A more balanced person would consider the long-term risks over short-term convenience." },
                    { text: "Create a complex password with a mix of letters, numbers, and symbols that is unique to this account.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **balanced person understands the importance of protecting their personal information**. You prioritized security over convenience, which is a key part of maintaining a healthy digital life." },
                    { text: "Use your birthdate or a simple name because it is easy to remember.", score: 0, effectiveness: "least-effective", feedback: "Using easily guessable information makes you vulnerable to hackers. This is the least-effective choice because a **balanced person would never use such simple information** because it puts their security and privacy at great risk." }
                ]
            },
            // SCENARIO 12 (Page 14)
            { title: "You notice your friend is constantly online and seems to be neglecting their schoolwork and other responsibilities. Question: What do you do?", icon: "user-x",
                choices: [
                    { text: "Make a public post about how your friend needs to get off their phone.", score: 0, effectiveness: "least-effective", feedback: "You are not showing that you are a caring person. **Publicly shaming your friend** can cause them to feel embarrassed and hurt. You are also not helping them with their problem. This is the least-effective choice." },
                    { text: "Use an 'I' statement to express your concern to your friend privately.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. You are showing that you are a **caring friend** who is concerned about their well-being. By using a private message, you are not embarrassing them. This demonstrates empathy and good social skills. *You could say something like: 'Hey, I've noticed you've been on your phone a lot lately, and I'm a little worried about you. Is everything okay?'*" },
                    { text: "Do nothing because it's their life and their choices.", score: 1, effectiveness: "less-effective", feedback: "While you are respecting their privacy, this is a less-effective choice. A **caring person would not ignore the problem**. You are missing an opportunity to help your friend who might be struggling." }
                ]
            },
            // SCENARIO 13 (Page 15)
            { title: "You want to share a funny meme online. You found the meme on a popular page, but you don't know who created it. Question: What do you do?", icon: "image-up",
                choices: [
                    { text: "Share the meme without a second thought.", score: 0, effectiveness: "least-effective", feedback: "Sharing content without giving credit is not respectful to the creator's work. This is the least-effective choice because it shows a **lack of integrity and respect** for others' work. A principled person would not do this." },
                    { text: "Try to find the original creator and tag them in your post.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **principled person shows integrity** by respecting intellectual property. By trying to find the original creator, you are giving credit where it's due, which is an important part of digital citizenship." },
                    { text: "Add 'Credit to the creator' to your post.", score: 1, effectiveness: "less-effective", feedback: "While you are attempting to give credit, this is a less-effective choice. A more principled person would put in the effort to **find the true source** rather than using a generic phrase. It's a key part of good digital citizenship." }
                ]
            },
            // SCENARIO 14 (Page 16)
            { title: "You see a post online with a picture of a friend looking sad and a caption that says, 'Don't talk to me today.' Question: What do you do?", icon: "user-round-minus",
                choices: [
                    { text: "Privately message them to ask if they're okay and offer to listen.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **caring person shows empathy** and a desire to help their friends. By reaching out privately, you are respecting their feelings while showing you are there for them. *You could say something like: 'Hey, I saw your post. I'm sorry you're having a tough day. I'm here to listen if you need anything, no pressure to respond.'*" },
                    { text: "Do nothing. You don't want to bother them since they asked not to be talked to.", score: 1, effectiveness: "less-effective", feedback: "While you are respecting their privacy, this is a less-effective choice. A **caring person would recognize a cry for help** and would not ignore a friend who might be struggling. It's important to reach out and offer support." },
                    { text: "Leave a public comment asking if they're okay and what's wrong.", score: 0, effectiveness: "least-effective", feedback: "Publicly asking someone what's wrong can be embarrassing and disrespectful to their feelings. This is the least-effective choice because it shows a **lack of empathy and social awareness**. A more caring person would not do this." }
                ]
            },
            // SCENARIO 15 (Page 17)
            { title: "Two of your classmates in a group chat for a project start arguing about who should do what part of the project. Question: What do you do?", icon: "split",
                choices: [
                    { text: "Try to mediate the conflict by suggesting a compromise or a new way of dividing the work.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A thoughtful communicator can **help resolve conflicts** by suggesting a compromise or a new way of working. You used your communication skills to bring people together and find a solution. *You could say something like: 'Hey guys, let's all calm down. Why don't we try a different approach? How about we split the research first, and then we can work together on the presentation slides?'*" },
                    { text: "Say nothing and let them work it out on their own.", score: 1, effectiveness: "less-effective", feedback: "Ignoring the problem can make the situation worse and could cause the project to suffer. This is a less-effective choice because it shows a **lack of collaboration and effective communication**. A better communicator would get involved to help." },
                    { text: "Take a side and start arguing with one of them to help your friend win.", score: 0, effectiveness: "least-effective", feedback: "Taking a side and arguing with a teammate will only make the situation worse and cause more conflict. This is the least-effective choice because it shows a **lack of communicator skills** and is not helpful for your project." }
                ]
            },
            // SCENARIO 16 (Page 18)
            { title: "You're doing research for a history project and find a blog post with great information, but the author isn't a historian. Question: What do you do?", icon: "globe",
                choices: [
                    { text: "Use the information anyway because it's a good source.", score: 0, effectiveness: "least-effective", feedback: "You are not being a reflective person. You are using information **without verifying it**. This is the least-effective choice because a reflective person would always check to see if their source is reliable." },
                    { text: "Use the information but cite it as a blog post.", score: 1, effectiveness: "less-effective", feedback: "While you are attempting to give credit, you are **still using an untrustworthy source**. This is a less-effective choice because a more reflective person would try to find a better source." },
                    { text: "Cross-reference the information with at least two other, more reliable sources (like a university website or a verified encyclopedia).", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **reflective person is a great researcher** who knows how to verify their information. You are showing that you value the accuracy of your work." }
                ]
            },
            // SCENARIO 17 (Page 19)
            { title: "You are asked to review a new learning app for school and find a minor bug. Question: What do you do?", icon: "bug",
                choices: [
                    { text: "Privately message the developers with a detailed, constructive report of the bug.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. You act as a **thoughtful communicator who is empathetic** to the developers' feelings. By providing constructive feedback, you are helping them improve their app. *You could say something like: 'I'm really enjoying the new app! I noticed a small bug: when I click on the 'Assignments' tab, it sometimes freezes...'" },
                    { text: "Say nothing and hope the developers find the bug themselves.", score: 1, effectiveness: "less-effective", feedback: "By saying nothing, you miss an opportunity to collaborate and help the developers. This is a less-effective choice because an **effective communicator offers support** and guidance when it is needed." },
                    { text: "Leave a scathing review online, detailing all the bugs you found and how terrible the app is.", score: 0, effectiveness: "least-effective", feedback: "You are not being a communicator who es empathetic to the developers' feelings. **Leaving a scathing review online can damage their reputation** and is not constructive. This is the least-effective choice." }
                ]
            },
            // SCENARIO 18 (Page 20)
            { title: "You see a post from your classmate that makes a joke about a sensitive topic, and some people in the comments are hurt by it. Question: What do you do?", icon: "frown",
                choices: [
                    { text: "Privately message your classmate, explaining why the post was hurtful and suggesting they take it down.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. You are showing that you are a **caring person** by protecting your classmate and helping them to become a better digital citizen. This demonstrates empathy and good social skills. *You could say something like: 'Hey, I saw your post. I know you were just joking, but some people in the comments are hurt by it. Maybe it's better to take it down? I just wanted to give you a heads-up.'*" },
                    { text: "Do nothing because it's not your problem.", score: 1, effectiveness: "less-effective", feedback: "By saying nothing, you are not showing that you are a caring person. You are missing an opportunity to **help your classmate who might be struggling**. This is a less-effective choice." },
                    { text: "Leave a comment to tell the person who made the post that they should apologize.", score: 0, effectiveness: "least-effective", feedback: "While you're attempting to stand up for what is right, this is a less-effective choice. **Publicly confronting them can make the situation worse**. This is the least-effective choice." }
                ]
            },
            // SCENARIO 19 (Page 21)
            { title: "You are creating a profile for a new app. It asks for your real name, birthdate, and where you live. Question: What do you do?", icon: "user-lock",
                choices: [
                    { text: "Provide all the requested information because it's required to create an account.", score: 0, effectiveness: "least-effective", feedback: "This is the least-effective choice. **Providing too much personal information** can compromise your privacy and security. A thinker would be cautious with their personal data." },
                    { text: "Close the app and don't create an account.", score: 1, effectiveness: "less-effective", feedback: "While it's good to be concerned about privacy, this is a less-effective choice. A more **reflective person would analyze the situation** and decide if they should create an account." },
                    { text: "Create an account with a fake name and birthdate to protect your privacy.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **thinker recognizes that some apps ask for unnecessary information** and takes action to protect their identity. This shows you are a thoughtful and responsible person." }
                ]
            },
            // SCENARIO 20 (Page 22)
            { title: "You are working on a group project with a classmate. You notice they are not doing their part and are just copying and pasting from Wikipedia. Question: What do you do?", icon: "clipboard-copy",
                choices: [
                    { text: "Privately message your classmate with a constructive message to tell them that you are worried about their work and offer to help.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **thoughtful communicator can help resolve conflicts** by suggesting a compromise or a new way of working. You used your communication skills to bring people together and find a solution. *You could say something like: 'Hey, I noticed that we're both doing a lot of the same research. Maybe we should try to divide it differently so we can work more efficiently? I'm happy to help you with the rest of your section.'*" },
                    { text: "Call them out in the group chat for being lazy and not doing their part.", score: 0, effectiveness: "least-effective", feedback: "Publicly calling someone out can be embarrassing and disrespectful. This is the least-effective choice because it shows a **lack of empathy and social awareness**. A more effective communicator would not do this." },
                    { text: "Just do their work for them so you get a good grade.", score: 1, effectiveness: "less-effective", feedback: "While you are ensuring a good grade, this is a less-effective choice. You are not being a communicator who is empathetic to your peer's feelings. You are missing an opportunity to **collaborate and help your classmate learn**." }
                ]
            },
            // SCENARIO 21 (Page 23)
            { title: "You are asked to create a new password for a new social media account. You are asked to create a strong password, but you just want to get to the app. Question: What do you do?", icon: "lock",
                choices: [
                    { text: "Use a simple password that is easy to remember, like 'password123'.", score: 0, effectiveness: "least-effective", feedback: "Using a simple password that's easy to remember is a risk. This is the least-effective choice because it shows a **lack of self-management skills**. A more balanced person would consider the risks over convenience." },
                    { text: "Use your school email address as your password.", score: 1, effectiveness: "less-effective", feedback: "Using your school email as your password is a risk. This is a less-effective choice because it shows a **lack of thinking skills**. A more balanced person would consider the risks over convenience." },
                    { text: "Create a password that is complex and unique to this account.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **balanced person understands the importance of protecting their personal information**. You prioritized security over convenience, which is a key part of maintaining a healthy digital life." }
                ]
            },
            // SCENARIO 22 (Page 24)
            { title: "You're in a group chat for a class project, and one of your classmates posts a private message that you sent them to the group chat. Question: What do you do?", icon: "message-square-off",
                choices: [
                    { text: "Take a screenshot of the message and post it to social media to call out your classmate.", score: 0, effectiveness: "least-effective", feedback: "Publicly shaming your classmate can cause them to feel embarrassed and hurt. This is the least-effective choice because it shows a **lack of integrity**. A principled person would not do this." },
                    { text: "Ask the person to delete the message and explain to them why it was wrong.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. You acted as a thoughtful **principled person who is empathetic** to your own feelings. By taking a proactive step, you are protecting yourself and showing that you value your own privacy. *You could say something like: 'Hey, I'm not comfortable with my private messages being shared in the group chat. Could you please take that down?'*" },
                    { text: "Tell the teacher and ask them to remove the classmate from the group.", score: 1, effectiveness: "less-effective", feedback: "While it's good to seek help, a better first step would be to try to **handle the situation on your own**. This is a less-effective choice because a more principled person would try to resolve the problem directly with the person who caused it." }
                ]
            },
            // SCENARIO 23 (Page 25)
            { title: "You are scrolling through social media, and a post from a friend promotes a fake charity. Question: What do you do?", icon: "heart-off",
                choices: [
                    { text: "Leave a comment on the post saying that the charity is fake.", score: 1, effectiveness: "less-effective", feedback: "While you're attempting to stand up for what is right, this is a less-effective choice. A more caring person would **not publicly embarrass their friend**. You could have helped people privately." },
                    { text: "Do nothing and ignore the post, so you don't hurt your friend's feelings.", score: 0, effectiveness: "least-effective", feedback: "You are not showing that you are a caring person. By saying nothing, you are missing an opportunity to **help your friend who might be struggling**. This is the least-effective choice." },
                    { text: "Privately message your friend and explain to them why the charity is fake and why they should take the post down.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **caring person shows empathy** and a desire to help their friends. By reaching out privately, you are protecting your friend and the people who might donate to the fake charity. *You could say something like: 'Hey, I saw your post about the charity, and I think it might be a scam. I found a few articles online that say it's fake, so you should probably take the post down.'*" }
                ]
            },
            // SCENARIO 24 (Page 26)
            { title: "You are completing an online survey for a product you like. It asks for your parents' names, phone numbers, and income. Question: What do you do?", icon: "form-input",
                choices: [
                    { text: "Fill out the survey with your real information to get the reward.", score: 0, effectiveness: "least-effective", feedback: "You gave in to a promise of a reward without considering the risks. This is the least-effective choice because a **thinker would question the motives** behind the offer and recognize that your personal data is more valuable than a free gift card." },
                    { text: "Close the survey immediately and do not provide the information.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **thinker is critical** of what they see online. You avoided a scam and took a logical, proactive step to ensure your device's security, showing great problem-solving skills." },
                    { text: "Fill out the survey with fake information.", score: 1, effectiveness: "less-effective", feedback: "While you're attempting to be safe, this is a less-effective choice. You are **still engaging with a potentially malicious source**. A more effective thinker would simply close the survey and not engage." }
                ]
            },
            // SCENARIO 25 (Page 27)
            { title: "You're playing a multiplayer video game and another player is being very aggressive and using offensive language in the chat. Question: What do you do?", icon: "gamepad-2",
                choices: [
                    { text: "Report the player's behavior to the platform's moderators and mute/block them.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **principled person acts with integrity** by not supporting bullying. You are showing that you value a positive digital community and that you will not tolerate harassment. *You could say something like: 'I'm reporting this user for harassment.'*" },
                    { text: "Argue back with them and use your own insults to defend yourself.", score: 0, effectiveness: "least-effective", feedback: "Engaging in a flame war will only escalate the situation. This is the least-effective choice because it shows a **lack of self-control**. A principled person would not do this." },
                    { text: "Say nothing and leave the game immediately.", score: 1, effectiveness: "less-effective", feedback: "While leaving the game is an option, it **doesn't help solve the problem for other players**. This is a less-effective choice because a more principled person would try to help solve the problem." }
                ]
            },
            // SCENARIO 26 (Page 28)
            { title: "A friend posts a picture of you online that you think is unflattering. Question: What do you do?", icon: "camera-off",
                choices: [
                    { text: "Politely message your friend and ask them to remove the picture, explaining how you feel.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. You acted as a thoughtful **communicator who is empathetic** to your own feelings. By taking a proactive step, you are protecting yourself and showing that you value your own privacy. *You could say something like: 'Hey, could you please take down that picture of me? I'm just not a fan of how I look in it. Thanks!'*" },
                    { text: "Post a mean comment on their picture, telling them to take it down.", score: 0, effectiveness: "least-effective", feedback: "You let your emotions get the best of you, which is a key trait of a poor communicator. This is the least-effective choice because it shows a **lack of self-control and good social skills**." },
                    { text: "Ignore it and do nothing. You don't want to make things awkward.", score: 1, effectiveness: "less-effective", feedback: "By saying nothing, you miss an opportunity to collaborate and help your friend. This is a less-effective choice because a more **effective communicator would offer support** and guidance when it is needed." }
                ]
            },
            // SCENARIO 27 (Page 29)
            { title: "You receive a message from an unknown number. It says, 'Hey, I think I have the wrong number, but you seem cool. What's your name?' Question: What do you do?", icon: "phone-off",
                choices: [
                    { text: "Block the number and don't respond.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **responsible risk-taker** is not reckless. You took a proactive step to protect your digital identity by being cautious about who you connect with and checking your security settings." },
                    { text: "Reply and give them your name and a brief description of yourself.", score: 0, effectiveness: "least-effective", feedback: "You are taking a **risk with your personal information** without thinking through the consequences. A wiser risk-taker would consider the potential negative outcomes before giving out personal information." },
                    { text: "Reply and say, 'I think you have the wrong number.'", score: 1, effectiveness: "less-effective", feedback: "While you are respecting their privacy, this is a less-effective choice. A more **reflective person would simply block the number** and not engage." }
                ]
            },
            // SCENARIO 28 (Page 30)
            { title: "You're in a video meeting for an online class, and you see a classmate live-tweeting the lecture, making fun of the professor. Question: What do you do?", icon: "tv",
                choices: [
                    { text: "Do nothing; it's not your business.", score: 0, effectiveness: "least-effective", feedback: "By saying nothing, you miss an opportunity to help your classmate and your professor. This is the least-effective choice because a **thinker would analyze the situation** and try to find a solution." },
                    { text: "Screenshot the tweets and send them to the professor to get your classmate in trouble.", score: 1, effectiveness: "less-effective", feedback: "While you're trying to help, this is a less-effective choice. A **thinker would try to solve the problem directly** with their classmate. You are also not being a good teammate." },
                    { text: "Privately message your classmate and explain why what they are doing could be disrespectful and have serious consequences.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **thinker understands the importance of protecting their digital identity and brand**. You took a proactive step to ensure your classmate's privacy and brand. *You could say something like: 'Hey, I saw your live tweets of the lecture, and I'm worried that they could be seen by the professor or the school, and I don't want you to get in trouble.'*" }
                ]
            },
            // SCENARIO 29 (Page 31)
            { title: "You discover someone has created a fake social media profile using a friend's name and photos to post mean things about other students. Question: What do you do?", icon: "user-round-x",
                choices: [
                    { text: "Report the fake account to the social media platform and then block it.", score: 1, effectiveness: "less-effective", feedback: "While reporting the account is a good step, this is a less-effective choice. A more caring person would do more. You are missing an opportunity to **help your friend who might be struggling**." },
                    { text: "Privately message your friend and offer to help them report the account and alert others.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **caring person shows empathy** and a desire to help their friends. By reaching out privately, you are respecting their feelings while showing you are there for them. *You could say something like: 'Hey, I just saw a fake account using your name. I'm so sorry that's happening. I can help you report it and let other people know it's not you if you want.'*" },
                    { text: "Create a public post to warn everyone about the fake account and call out the person who created it.", score: 0, effectiveness: "least-effective", feedback: "You are not being a caring person. **Publicly calling out the person** who created the account can cause more conflict and make the situation worse. A more caring person would not do this." }
                ]
            },
            // SCENARIO 30 (Page 32)
            { title: "You see a post from a friend that is promoting a charity. The post looks legitimate, but you have never heard of the charity before. Question: What do you do?", icon: "search-check",
                choices: [
                    { text: "Donate to the charity and share the post, assuming it's a good cause.", score: 0, effectiveness: "least-effective", feedback: "You are not being an inquiring person. You are giving your money to a potentially malicious source. This is the least-effective choice because an **inquiring person would always question the source of information**." },
                    { text: "Do nothing and ignore the post.", score: 1, effectiveness: "less-effective", feedback: "While you are respecting their privacy, this is a less-effective choice. You are missing an opportunity to help your friend who might be struggling. A more **inquiring person would not engage with a suspicious offer**." },
                    { text: "Research the charity to see if it's legitimate before donating or sharing the post.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A true **inquirer is a great researcher** who knows how to verify their information. You are showing that you value the accuracy and integrity of your work." }
                ]
            }
        ];
        
        // --- CORE APPLICATION LIFECYCLE ---
        
        document.addEventListener('DOMContentLoaded', () => {
            
            // 1. Initial Setup & Global Variables
            const pages = document.querySelectorAll('.page');
            const nextButton = document.getElementById('next-button');
            const backButton = document.getElementById('back-button');
            const progressBar = document.getElementById('flex-progress-fill');	
            const headerPageIndicator = document.getElementById('header-page-indicator');
            const totalPages = pages.length; // 34 total pages (0-indexed)

            // 2. Event Listeners (SFX, Navigation)
            // ... (SFX, Login, Accordion, Toggle logic from template - simplified here for brevity)

            // 3. Page Control Functions
            function updateProgress() {
                // Progress is based on total content pages (34)
                const progress = ((currentPageIndex + 1) / totalPages);	
                if (progressBar) progressBar.style.width = `${progress * 100}%`;
                const indicator = document.getElementById('header-page-indicator');
                if (indicator) indicator.textContent = `${currentPageIndex + 1} / ${totalPages}`;
            }

            // --- MENU MODAL FUNCTIONS (EXPOSED GLOBALLY) ---
            window.openMenuModal = function() { 
                const menuModal = document.getElementById('menu-modal');
                menuModal.classList.remove('hidden-modal'); 
                menuModal.classList.add('visible-modal'); 
                sfx.tick();
            }

            window.closeMenuModal = function() { 
                const menuModal = document.getElementById('menu-modal');
                menuModal.classList.remove('visible-modal'); 
                menuModal.classList.add('hidden-modal'); 
                sfx.tick();
            }
            
            function showPage(index) {
                if (index < 0 || index >= totalPages) return;
                
                // Final Score Check: Cannot advance to score page (index 32) if not all questions answered
                if (index === 32 && Object.keys(answeredScenarioScores).length < TOTAL_SCENARIOS) {
                    showScenarioOutcome('challenge-incomplete'); // Custom outcome for incomplete challenge
                    return;
                }

                pages.forEach(page => { page.classList.remove('active'); });
                pages[index].classList.add('active');
                currentPageIndex = index;
                pages[index].scrollTop = 0;

                // Back Button State
                backButton.disabled = (currentPageIndex === 0);
                backButton.classList.toggle('opacity-0', currentPageIndex === 0);

                // Next Button Text / Visibility
                const nextSpan = nextButton.querySelector('span');
                const isFinalPage = currentPageIndex === totalPages - 1;

                if (currentPageIndex === 0) { // Page 1 (Cover)
                    nextSpan.textContent = 'Start Challenge';
                    nextButton.disabled = false;
                    nextButton.style.display = 'flex';
                } else if (currentPageIndex >= 1 && currentPageIndex <= 31) { // Page 2 (Intro) or Scenarios
                    
                    if (currentPageIndex === 1) { // Page 2 (Intro)
                        nextSpan.textContent = 'Next';
                        nextButton.disabled = false;
                        // FIX: Apply sanitization to static text on Page 2
                        document.getElementById('welcome-content').innerHTML = sanitizeText(document.getElementById('welcome-content').innerHTML);
                    } else { // Scenarios 3-32
                        const scenarioIndex = index - 2;
                        const isAnswered = answeredScenarioScores[scenarioIndex];

                        // FIX 1: Allow navigation regardless of answer status
                        nextSpan.textContent = (Object.keys(answeredScenarioScores).length === TOTAL_SCENARIOS) ? 'View Score' : 'Next';
                        
                        // FIX 2: Only disable the button if it says 'View Score' and the challenge is NOT complete
                        nextButton.disabled = (nextSpan.textContent === 'View Score' && Object.keys(answeredScenarioScores).length < TOTAL_SCENARIOS);
                    }
                    nextButton.style.display = 'flex';
                } else if (currentPageIndex === 32) { // Score Page
                    updateFinalScorePage();
                    nextSpan.textContent = 'Credits';
                    nextButton.disabled = false;
                    nextButton.style.display = 'flex';
                } else if (currentPageIndex === 33) { // Credits Page
                    nextSpan.textContent = 'Reset'; // Re-use next button for reset option
                    nextButton.disabled = false;
                    nextButton.style.display = 'flex';
                    // FIX: Apply sanitization to static text on Page 34
                    document.getElementById('about-us-content').innerHTML = sanitizeText(document.getElementById('about-us-content').innerHTML);
                }
                
                // FIX: Apply sanitization to the login tooltip on all page loads for consistency
                const policyTooltip = document.getElementById('policy-tooltip');
                if (policyTooltip) {
                    policyTooltip.innerHTML = sanitizeText(policyTooltip.innerHTML);
                }
                
                // FIX: Apply sanitization to the help accordion on page 1 load
                const helpAccordion = document.getElementById('accordion-content-1');
                if (helpAccordion) {
                    helpAccordion.innerHTML = sanitizeText(helpAccordion.innerHTML);
                }
                
                updateProgress();
                lucide.createIcons();
            }

            // --- SCENARIO RENDERER ---
            function renderScenarioPage(pageElement, scenarioIndex) {
                const sIndex = scenarioIndex;
                const data = SCENARIO_DATA[sIndex - 1]; // Data is 0-indexed
                const isAnswered = answeredScenarioScores[sIndex];
                const pageNum = pageElement.id.split('-')[1];

                const currentScore = answeredScenarioScores[sIndex];
                // Find the chosen index based on the stored score
                let chosenChoiceIndex = isAnswered ? data.choices.findIndex(c => c.score === currentScore) : -1;
                
                // Safety check: if multiple choices have the same score (e.g., both 1), ensure we pick the actual one chosen if possible.
                // Since we only store the score, the easiest pragmatic action is to find the first choice that matches the stored score.

                let choicesHtml = data.choices.map((choice, index) => {
                    const buttonId = `choice-${sIndex}-${index}`;
                    let buttonClass = 'choice-btn';
                    let isDisabled = '';
                    
                    const isSelected = isAnswered && (index === chosenChoiceIndex);
                    
                    if (isAnswered) {
                        const score = choice.score;
                        if (score === 3) buttonClass += ' choice-correct';
                        else if (score === 1) buttonClass += ' choice-less-effective';
                        else buttonClass += ' choice-least-effective';
                        
                        // Disable buttons that were NOT the chosen one, and dim them
                        if (!isSelected) {
                            isDisabled = 'disabled';
                            buttonClass += ' opacity-50';
                        }
                    }

                    return `
                        <button 
                            id="${buttonId}"
                            class="w-full text-left p-3 rounded-lg text-sm font-medium transition-colors shadow-sm ${buttonClass}"
                            onclick="selectScenarioChoice(${sIndex}, ${index})"
                            ${isDisabled}
                        >
                            ${String.fromCharCode(65 + index)}. ${sanitizeText(choice.text)}
                        </button>
                    `;
                }).join('');

                let feedbackHtml = '';
                let feedbackHidden = 'hidden';

                if (isAnswered) {
                    feedbackHidden = '';
                    const chosen = data.choices[chosenChoiceIndex];
                    let feedbackClass = chosen.score === 3 ? 'feedback-correct' : (chosen.score === 1 ? 'feedback-less' : 'feedback-least');
                    let effectText = chosen.effectiveness.toUpperCase().replace('-', ' ');

                    feedbackHtml = `
                        <div class="feedback-box p-4 rounded-lg shadow-inner mt-4 ${feedbackClass}">
                            <div class="flex justify-between items-center mb-2">
                                <p class="font-bold text-sm text-allgood-dark">
                                    <i data-lucide="check-circle" class="w-4 h-4 inline-block mr-2"></i> Your choice was: <span class="font-heading text-lg text-allgood-secondary">${effectText}</span>
                                </p>
                                <p class="font-bold text-xs text-gray-500">Score: <span class="${chosen.score === 3 ? 'text-green-600' : (chosen.score === 1 ? 'text-yellow-600' : 'text-red-600')}">${chosen.score} / 3</span></p>
                            </div>
                            <p class="text-sm text-gray-700 leading-relaxed">${sanitizeText(chosen.feedback)}</p>
                        </div>
                    `;
                }

                pageElement.innerHTML = `
                    <section class="mb-4 border-b border-gray-200 pb-2">
                        <h2 class="text-xl font-heading font-bold text-allgood-dark">Scenario ${sIndex} of ${TOTAL_SCENARIOS}</h2>
                        <p class="text-xs font-bold text-allgood-primary uppercase tracking-widest mt-1">Digital Citizenship Challenge</p>
                    </section>
                    
                    <div class="bg-white p-6 rounded border border-gray-200 shadow-sm mb-6">
                        <div class="flex items-start mb-4">
                            <div class="w-12 h-12 rounded-full bg-allgood-secondary/10 flex items-center justify-center text-allgood-secondary mr-3 text-xl flex-shrink-0">
                                <i data-lucide="${data.icon}" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-lg text-allgood-dark mb-1">${data.title}</h4>
                                <p class="text-sm text-gray-500">Select the <strong>MOST Effective</strong> response:</p>
                            </div>
                        </div>
                        
                        <div class="space-y-3 mb-4" id="scenario-${sIndex}">
                            ${choicesHtml}
                        </div>

                        <div id="feedback-container-${sIndex}" class="${feedbackHidden}">
                            ${feedbackHtml}
                        </div>
                    </div>
                `;
            }

            // --- SCENARIO SELECTOR LOGIC ---
            window.selectScenarioChoice = function(scenarioIndex, choiceIndex) {
                const data = SCENARIO_DATA[scenarioIndex - 1];
                const chosen = data.choices[choiceIndex];
                
                let isFirstAnswer = !answeredScenarioScores[scenarioIndex];

                // 1. Update Score and Mark as Answered (Only if it's the first time)
                if (isFirstAnswer) {
                    const score = chosen.score;
                    totalChallengeScore += score;
                    answeredScenarioScores[scenarioIndex] = score;

                    // 2. Log Action
                    SessionManager.log("Scenario Answered", `S${scenarioIndex} - ${chosen.effectiveness}`, { score: score, totalScore: totalChallengeScore, selected: chosen.text });
                }
                
                // 3. Show Feedback Modal
                let iconClass = chosen.score === 3 ? 'bg-green-100 text-green-600' : (chosen.score === 1 ? 'bg-yellow-100 text-yellow-600' : 'bg-red-100 text-red-600');
                let iconInner = chosen.score === 3 ? '<i data-lucide="check-circle" class="w-8 h-8"></i>' : (chosen.score === 1 ? '<i data-lucide="alert-triangle" class="w-8 h-8"></i>' : '<i data-lucide="x-circle" class="w-8 h-8"></i>');
                let title = `${chosen.effectiveness.toUpperCase().replace('-', ' ')} (${chosen.score} / 3 pts)`;
                
                // Re-render current page immediately to show inline feedback and lock other choices
                showPage(currentPageIndex);

                // Show modal to summarize and advance
                showScenarioOutcome('scenario-completed', {
                    title: title,
                    text: `**Feedback:** ${chosen.feedback}<br><br>**Current Score:** ${totalChallengeScore} / ${MAX_SCORE}`,
                    iconClass: iconClass,
                    iconInner: iconInner,
                    isAdvancing: true // Signal the modal closure should navigate
                });
                
                // 4. Update Next Button (handled by showPage)
                // We don't need to manually enable/disable here, as showPage handles the text/logic.
            }

            // --- MODAL LOGIC (UPDATED) ---
            // FIX 2: Added optional parameter to control navigation on dismissal
            window.closeScenarioModal = function(shouldAdvance = false) {
                const modal = document.getElementById('scenario-modal');
                modal.classList.remove('visible-modal');
                modal.classList.add('hidden-modal');
                sfx.nav();
                
                // FIX 3: Only advance if explicitly requested (i.e., button clicked)
                if (shouldAdvance && currentPageIndex >= 2 && currentPageIndex <= 31) {
                    if (Object.keys(answeredScenarioScores).length === TOTAL_SCENARIOS) {
                        showPage(32); // Go to score page
                    } else {
                        showPage(currentPageIndex + 1);
                    }
                }
            }
            
            window.showScenarioOutcome = function(type, data = {}) {
                const modal = document.getElementById('scenario-modal');
                const iconContainer = document.getElementById('scenario-icon');
                const titleEl = document.getElementById('scenario-title');
                const feedbackEl = document.getElementById('scenario-feedback');
                const button = document.getElementById('scenario-modal-next-btn'); // Use ID

                if (type === 'challenge-incomplete') {
                    titleEl.textContent = "Challenge Incomplete";
                    feedbackEl.innerHTML = sanitizeText(`You must answer all **${TOTAL_SCENARIOS} scenarios** before viewing your final score.<br><br>**Missing:** ${TOTAL_SCENARIOS - Object.keys(answeredScenarioScores).length} scenarios left.`);
                    iconContainer.className = `mx-auto w-16 h-16 rounded-full flex items-center justify-center mb-4 text-3xl bg-red-100 text-red-600`;
                    iconContainer.innerHTML = '<i data-lucide="alert-triangle" class="w-8 h-8"></i>';
                    button.textContent = "Back to Scenarios";
                    button.onclick = () => closeScenarioModal(false); // Do not auto-advance if clicking 'Back to Scenarios'
                } else if (type === 'scenario-completed') {
                    titleEl.textContent = data.title;
                    feedbackEl.innerHTML = sanitizeText(data.text);
                    iconContainer.className = `mx-auto w-16 h-16 rounded-full flex items-center justify-center mb-4 text-3xl ${data.iconClass}`;
                    iconContainer.innerHTML = data.iconInner;
                    button.textContent = (Object.keys(answeredScenarioScores).length === TOTAL_SCENARIOS) ? 'View Final Score' : 'Next Scenario';
                    button.onclick = () => closeScenarioModal(true); // Explicitly advance on click
                }

                modal.classList.remove('hidden-modal');
                modal.classList.add('visible-modal');
                sfx.tick();
                lucide.createIcons();
            }

            // --- FINAL SCORE PAGE UPDATE ---
            window.updateFinalScorePage = function() {
                const scoreValue = document.getElementById('final-score-value');
                const scorePercent = document.getElementById('final-score-percent');
                const rankHeading = document.getElementById('final-rank-heading');
                const rankMessage = document.getElementById('final-rank-message');
                const badgeBtn = document.getElementById('download-badge-btn');
                const certReqText = document.getElementById('cert-req-text'); // Get the requirement text element

                const currentScore = totalChallengeScore;
                const percentage = Math.round((currentScore / MAX_SCORE) * 100);

                let rank = "";
                let rankColor = "";
                let message = "";
                
                if (percentage >= 89) { // 80 points = 88.88%
                    rank = "Digital Architect";
                    rankColor = "text-green-600";
                    message = "Exceptional! You consistently demonstrated the Publisher Mindset and a deep understanding of pragmatic digital action. Your digital future is secure.";
                } else if (percentage >= 70) {
                    rank = "Digital Manager";
                    rankColor = "text-yellow-600";
                    message = "Solid performance. You show strong awareness but missed a few key decisions. Reviewing those 'less-effective' choices will move you to the next level.";
                } else {
                    rank = "Digital Learner";
                    rankColor = "text-red-600";
                    message = "Good start. You're aware of the challenges but your decision-making needs fine-tuning. Reread the feedback and try again to build a safer footprint.";
                }

                scoreValue.textContent = `${currentScore} / ${MAX_SCORE}`;
                scoreValue.className = `text-5xl font-extrabold font-heading ${rankColor}`;
                scorePercent.textContent = `(${percentage}% Effectiveness)`;
                
                rankHeading.textContent = rank;
                rankHeading.className = `text-xl font-heading font-bold mb-2 ${rankColor}`;
                rankMessage.textContent = message;
                
                // FIX: Sanitize the Certification Requirement Text
                certReqText.innerHTML = sanitizeText(certReqText.innerHTML);

                // Badge Logic
                if (currentScore >= BADGE_THRESHOLD) {
                    badgeBtn.disabled = false;
                    badgeBtn.classList.remove('bg-gray-300', 'cursor-not-allowed', 'shadow-none');
                    badgeBtn.classList.add('bg-allgood-primary', 'hover:bg-allgood-hover', 'shadow-lg');
                    badgeBtn.innerHTML = '<i data-lucide="download" class="w-4 h-4 mr-2"></i>Download Your Badge';
                } else {
                    badgeBtn.disabled = true;
                    badgeBtn.classList.add('bg-gray-300', 'cursor-not-allowed', 'shadow-none');
                    badgeBtn.classList.remove('bg-allgood-primary', 'hover:bg-allgood-hover', 'shadow-lg');
                    badgeBtn.innerHTML = '<i data-lucide="lock" class="w-4 h-4 mr-2"></i>Certification Locked';
                }
                
                // Log final score
                SessionManager.log("Challenge Completed", rank, { finalScore: currentScore, percentage: percentage });
                
                lucide.createIcons();
            }

            // --- DYNAMIC CONTENT INJECTION ---
            pages.forEach(page => {
                const scenarioIndex = parseInt(page.getAttribute('data-scenario-index'));
                if (scenarioIndex >= 1 && scenarioIndex <= TOTAL_SCENARIOS) {
                    renderScenarioPage(page, scenarioIndex);
                }
            });
            
            // --- TOC GENERATION ---
            function updateTOC() {
                const tocList = document.getElementById('toc-list');
                tocList.innerHTML = '';
                
                // Page 1: Cover
                tocList.insertAdjacentHTML('beforeend', `
                    <button class="menu-link w-full text-left px-4 py-1.5 hover:bg-gray-100 text-gray-600 font-bold" data-page="0">
                        1. Cover Page
                    </button>
                `);
                
                // Page 2: Welcome
                tocList.insertAdjacentHTML('beforeend', `
                    <button class="menu-link w-full text-left px-4 py-1.5 hover:bg-gray-100 text-gray-600 font-bold" data-page="1">
                        2. Welcome & Rules
                    </button>
                `);

                // Scenarios 3-32
                tocList.insertAdjacentHTML('beforeend', `<div class="px-4 py-1 text-xs font-bold text-gray-400 uppercase tracking-wider mt-2">The 30 Digital Decisions</div>`);
                for (let i = 1; i <= TOTAL_SCENARIOS; i++) {
                    const data = SCENARIO_DATA[i - 1];
                    const pageIndex = i + 1;
                    const shortTitle = data.title.split('. Question:')[0];
                    const isAnswered = answeredScenarioScores[i];
                    
                    // Use a div wrapper to force icon creation before appending
                    const iconHtml = isAnswered 
                        ? `<i data-lucide="check-circle" class="w-4 h-4 mr-2 text-green-600 inline-block"></i>` 
                        : `<i data-lucide="circle" class="w-4 h-4 mr-2 text-gray-400 inline-block"></i>`;

                    tocList.insertAdjacentHTML('beforeend', `
                        <button class="menu-link w-full text-left px-4 py-1.5 hover:bg-gray-100 text-gray-600 text-sm flex items-start" data-page="${pageIndex}">
                            <span class="flex-shrink-0">${iconHtml}</span> 
                            <span class="flex-grow text-left">${pageIndex}. ${shortTitle}</span>
                        </button>
                    `);
                }

                // Page 33: Score
                tocList.insertAdjacentHTML('beforeend', `
                    <button class="menu-link w-full text-left px-4 py-1.5 hover:bg-gray-100 text-gray-600 font-bold text-allgood-secondary" data-page="32">
                        33. Final Score & Badge
                    </button>
                `);
                
                // Page 34: Credits
                tocList.insertAdjacentHTML('beforeend', `
                    <button class="menu-link w-full text-left px-4 py-1.5 hover:bg-gray-100 text-gray-600" data-page="33">
                        34. Credits
                    </button>
                `);
                
                // Re-apply event listeners after generating dynamic content
                document.querySelectorAll('.menu-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        const pageIndex = parseInt(e.currentTarget.dataset.page);
                        showPage(pageIndex);
                        window.closeMenuModal(); // <-- FIX: Ensure modal closes after navigation
                    });
                });
                lucide.createIcons(); // Rerun Lucide to render icons inside new TOC content
            }
            
            // --- HARD RESET / INIT ---
            window.performHardReset = function() {
                totalChallengeScore = 0;
                answeredScenarioScores = {};
                currentUserName = "Anonymous";
                currentUserEmail = "";
                sessionId = "session_" + Date.now() + "_" + Math.floor(Math.random() * 1000); 

                document.getElementById('user-name-input').value = "";
                document.getElementById('user-email-input').value = "";
                document.getElementById('header-welcome-text').textContent = "Digital Decisions Challenge";
                
                // Re-render all scenario pages to reset choices
                pages.forEach(page => {
                    const scenarioIndex = parseInt(page.getAttribute('data-scenario-index'));
                    if (scenarioIndex >= 1 && scenarioIndex <= TOTAL_SCENARIOS) {
                        renderScenarioPage(page, scenarioIndex);
                    }
                });

                // Reset Feedback/Badge Page
                document.getElementById('feedback-container').classList.remove('hidden');
                document.getElementById('feedback-success').classList.add('hidden');
                setRating(0); // Reset stars

                const startup = document.getElementById('startup-screen');
                startup.style.display = 'flex';
                void startup.offsetWidth;	
                startup.style.opacity = '1';
                const loginModal = document.getElementById('login-modal');
                loginModal.classList.remove('hidden-modal');
                loginModal.classList.add('visible-modal');
                
                showPage(0);
                updateTOC();
                sfx.powerOff();
            }
            
            // --- UTILITY FUNCTIONS ---
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            let audioCtx;
            function initAudio() {
                if (!audioCtx) audioCtx = new AudioContext();
                if (audioCtx.state === 'suspended') audioCtx.resume().catch(e => console.error("Audio resume failed:", e));
            }
            function playTone(freq, type, duration, vol = 0.1, attack = 0.01, decay = 0.001) {
                initAudio();	
                const now = audioCtx.currentTime;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, now);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(vol, now + attack);	
                gain.gain.exponentialRampToValueAtTime(decay, now + duration);	
                osc.start(now);
                osc.stop(now + duration);
            }
            const sfx = {
                powerOn: () => { initAudio(); const now = audioCtx.currentTime; const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.connect(gain); gain.connect(audioCtx.destination); osc.type = 'triangle'; osc.frequency.setValueAtTime(110, now); osc.frequency.exponentialRampToValueAtTime(220, now + 0.4); gain.gain.setValueAtTime(0, now); gain.gain.linearRampToValueAtTime(0.4, now + 0.1); gain.gain.linearRampToValueAtTime(0, now + 0.4); osc.start(now); osc.stop(now + 0.4); },
                powerOff: () => { initAudio(); playTone(80, 'triangle', 0.2, 0.5, 0.01, 0.001); },
                nav: () => { initAudio(); playTone(150, 'sine', 0.1, 0.1, 0.01, 0.01); },
                tick: () => { initAudio(); playTone(1000, 'sine', 0.01, 0.01); }
            };
            window.sfx = sfx; // Expose SFX globally for onclick attributes

            // Feedback and Rating Logic
            let currentRating = 0;
            window.setRating = function(n) {
                currentRating = n;
                for (let i = 1; i <= 5; i++) {
                    const star = document.getElementById(`star-${i}`);
                    if (i <= n) { star.classList.remove('text-gray-300'); star.classList.add('text-yellow-400'); } 
                    else { star.classList.add('text-gray-300'); star.classList.remove('text-yellow-400'); }
                }
                sfx.tick();
            }
            window.submitFeedback = function() {
                const feedbackText = document.getElementById('feedback-text').value;
                const ratingDetail = currentRating > 0 ? `${currentRating}/5 Stars` : "No Rating";
                SessionManager.log("Feedback Submitted", ratingDetail, { feedbackComment: feedbackText });

                document.getElementById('feedback-container').classList.add('hidden');
                document.getElementById('feedback-success').classList.remove('hidden');
                sfx.nav(); 
                lucide.createIcons();
            }
            
            // Badge Download Logic
            window.downloadBadge = function() {
                if (totalChallengeScore < BADGE_THRESHOLD) return;

                SessionManager.log("Badge Downloaded", "Certification Earned");

                const nameText = (typeof currentUserName !== 'undefined' && currentUserName) ? currentUserName.toUpperCase() : "DIGITAL ARCHITECT";
                const dateText = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }).toUpperCase();
                const scoreText = `${totalChallengeScore} / ${MAX_SCORE}`;

                // OPTION 3: FOOTPRINT GRID / DATA INTEGRITY BADGE (Exact Match)
                const badgeSVG = `
                <svg width="1200" height="800" viewBox="0 0 1200 800" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <!-- Grid Pattern -->
                        <pattern id="smallGrid" width="40" height="40" patternUnits="userSpaceOnUse">
                            <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#E0E0E0" stroke-width="2"/>
                        </pattern>
                    </defs>

                    <!-- Background -->
                    <rect width="100%" height="100%" fill="#F7F7F7"/>
                    <rect width="100%" height="100%" fill="url(#smallGrid)"/>

                    <!-- Outer Frame (Deep Cyan) -->
                    <rect x="30" y="30" width="1140" height="740" rx="20" ry="20" fill="none" stroke="#357889" stroke-width="8"/>
                    
                    <!-- Header Section -->
                    <text x="600" y="100" font-family="Georgia, serif" font-weight="bold" font-size="42" fill="#357889" text-anchor="middle" letter-spacing="2">
                        ALLGOOD ACADEMY
                    </text>
                    <text x="600" y="140" font-family="Verdana, sans-serif" font-size="16" fill="#4C4C4C" text-anchor="middle" letter-spacing="4">
                        PRAGMATIC ACTION CERTIFICATION
                    </text>
                    <line x1="400" y1="160" x2="800" y2="160" stroke="#D34716" stroke-width="3"/>

                    <!-- Left Side: Visual Identity (Footprint Icon Container) -->
                    <g transform="translate(300, 400)">
                        <!-- Circle Container -->
                        <circle cx="0" cy="0" r="140" fill="white" stroke="#357889" stroke-width="5"/>
                        
                        <!-- Stylized Footprint Path (Burnt Orange) -->
                        <!-- This path simulates the footprint icon -->
                        <g transform="scale(5) translate(-12, -15)" fill="#D34716">
                             <path d="M9.58 14.7c-.55-1.55-1.57-2.72-2.44-3.13-.86-.4-1.91.32-2.55 1.75-.64 1.42-.71 2.85.16 3.26.87.4 2.44-.33 2.99 1.22.56 1.56-2.28 4.48-1.96 5.89.22.95 2.35 1.2 4.16-.61 1.46-1.46 1.8-4.5 1.3-6.41-.21-.82-.95-1.34-1.66-1.97zM5.07 10.18c-.28-.57.32-1.09.95-1.39.63-.3 1.24-.18 1.52.39.28.56-.32 1.09-.95 1.39-.63.3-1.24.18-1.52-.39zM7.34 8.88c-.28-.56.32-1.09.95-1.39.63-.3 1.23-.18 1.52.39.28.56-.32 1.08-.95 1.39-.64.3-1.24.18-1.52-.39zM10.18 8.36c-.28-.56.32-1.09.95-1.39.63-.3 1.23-.18 1.52.39.28.57-.32 1.09-.95 1.39-.63.3-1.23.18-1.52-.39zM12.84 8.92c-.28-.57.32-1.09.95-1.39.63-.3 1.24-.18 1.52.39.28.57-.32 1.09-.95 1.39-.63.3-1.24.18-1.52-.39z"/>
                        </g>

                        <!-- Status Nodes (Check & Lock) -->
                        <circle cx="100" cy="-100" r="25" fill="#357889" stroke="white" stroke-width="2"/>
                        <path transform="translate(90, -110) scale(1)" fill="none" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" d="M20 6L9 17l-5-5"/> <!-- Checkmark -->
                        
                        <circle cx="-100" cy="100" r="25" fill="#357889" stroke="white" stroke-width="2"/>
                         <!-- Simple Lock Icon -->
                         <rect x="-108" y="98" width="16" height="12" rx="2" fill="white"/> 
                         <path d="M-105 98 V 94 A 5 5 0 0 1 -95 94 V 98" stroke="white" stroke-width="2" fill="none"/>
                    </g>

                    <!-- Right Side: Data Block -->
                    <g transform="translate(600, 280)">
                        <text x="0" y="0" font-family="Verdana, sans-serif" font-size="14" fill="#757575" font-weight="bold">CERTIFIED AGENT:</text>
                        <text x="0" y="50" font-family="Georgia, serif" font-size="40" fill="#357889" font-weight="bold" letter-spacing="1">${nameText}</text>
                        <text x="0" y="100" font-family="Verdana, sans-serif" font-size="24" fill="#4C4C4C" font-weight="bold" letter-spacing="2">DIGITAL ARCHITECT</text>

                        <!-- Data Table Box (Light Gray Background) -->
                        <rect x="0" y="140" width="500" height="220" rx="10" fill="#F7F7F7" stroke="#E5E7EB" stroke-width="3"/>
                        
                        <!-- Data Rows (Monospace Font for Tech Feel) -->
                        <g transform="translate(30, 190)" font-family="Courier New, monospace" font-size="22" fill="#357889">
                            <!-- Row 1: Module -->
                            <text x="0" y="0" font-weight="bold">MODULE:</text>
                            <text x="160" y="0" fill="#4C4C4C" font-size="18">Digital Decisions Challenge</text>
                            
                            <!-- Row 2: Status -->
                            <text x="0" y="50" font-weight="bold">STATUS:</text>
                            <text x="160" y="50" fill="#D34716" font-weight="bold">VERIFIED</text>
                            
                            <!-- Row 3: Date -->
                            <text x="0" y="100" font-weight="bold">DATE:</text>
                            <text x="160" y="100" fill="#4C4C4C">${dateText}</text>
                            
                            <!-- Row 4: Final Score -->
                            <text x="0" y="150" font-weight="bold">FINAL SCORE:</text>
                            <text x="160" y="150" fill="#357889" font-weight="bold">${scoreText}</text>
                        </g>
                    </g>

                    <!-- Footer Quote -->
                    <text x="600" y="750" font-family="Georgia, serif" font-style="italic" font-size="18" fill="#757575" text-anchor="middle">
                        "Every click is a brick in your digital footprint."
                    </text>

                </svg>`;
                
                const blob = new Blob([badgeSVG], {type: 'image/svg+xml'});
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `Allgood-DigitalArchitect-Badge-${nameText}.svg`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                sfx.nav();

                const downloadBtn = document.getElementById('download-badge-btn');
                if(downloadBtn) {
                    downloadBtn.classList.remove('bg-allgood-primary', 'hover:bg-allgood-hover');
                    downloadBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                    downloadBtn.innerHTML = '<i data-lucide="check" class="w-4 h-4 mr-2"></i>Certificate Saved';
                }
                lucide.createIcons();
            }

            // --- INITIALIZATION ---
            document.getElementById('current-year').textContent = new Date().getFullYear();
            
            // Initial render of page content and TOC
            showPage(0);
            updateTOC(); 

            // Long Press Home Button (for Hard Reset) - Simplified Event Logic
            const homeButton = document.getElementById('home-button');
            if(homeButton) {
                let pressTimer = null;
                function startLongPress(e) {
                    e.preventDefault();	
                    if (e.button === 0 || e.type === 'touchstart') {
                        pressTimer = setTimeout(() => { 
                            performHardReset(); 
                            pressTimer = null; 
                        }, 2000);
                    }
                }
                function cancelLongPress() {	
                    if (pressTimer) {
                        clearTimeout(pressTimer);	
                        pressTimer = null; 
                    }
                }
                
                homeButton.addEventListener('mousedown', startLongPress);
                homeButton.addEventListener('mouseleave', cancelLongPress);
                homeButton.addEventListener('mouseup', (e) => {	
                    if (pressTimer !== null) { 
                        cancelLongPress();
                        if (currentPageIndex !== 0) {
                            showPage(0);
                            sfx.nav();
                        }
                    }
                });
                homeButton.addEventListener('touchstart', startLongPress, { passive: false });
                homeButton.addEventListener('touchend', cancelLongPress);
            }
            
            // Navigation Listeners
            // Menu Toggle: Prepare TOC, Open Modal
            const menuToggle = document.getElementById('menu-toggle');
            const closeMenuBtn = document.getElementById('close-menu');
            
            if(menuToggle) menuToggle.addEventListener('click', () => { 
                updateTOC(); // Prepare content
                window.openMenuModal();
            });
            if(menuToggle) menuToggle.addEventListener('click', sfx.tick);
            if(closeMenuBtn) closeMenuBtn.addEventListener('click', window.closeMenuModal);
            if(closeMenuBtn) closeMenuBtn.addEventListener('click', sfx.tick);
            
            if(document.getElementById('next-button')) document.getElementById('next-button').addEventListener('click', () => { 
                if (currentPageIndex < TOTAL_PAGES - 1) { showPage(currentPageIndex + 1); sfx.nav(); }
                else if (currentPageIndex === TOTAL_PAGES - 1) { performHardReset(); sfx.nav(); } // Reset on last page
            });
            if(document.getElementById('back-button')) document.getElementById('back-button').addEventListener('click', () => { 
                if (currentPageIndex > 0) { showPage(currentPageIndex - 1); sfx.nav(); }
            });
            
            // Startup & Login
            const startupScreen = document.getElementById('startup-screen');
            if (startupScreen) {
                const warmUp = () => initAudio();
                startupScreen.addEventListener('mousedown', warmUp, { once: true });
                startupScreen.addEventListener('touchstart', warmUp, { once: true });
                startupScreen.addEventListener('click', () => {
                    sfx.powerOn();
                    startupScreen.style.opacity = '0';
                    setTimeout(() => { startupScreen.style.display = 'none'; }, 700);	
                });
            }

            const startBtn = document.getElementById('start-session-btn');
            if(startBtn) {
                startBtn.addEventListener('click', () => {
                    let name = document.getElementById('user-name-input').value.trim();
                    let email = document.getElementById('user-email-input').value.trim();
                    if (!name) name = "Learner";
                    
                    currentUserName = name;
                    currentUserEmail = email;
                    SessionManager.start(name, email);

                    document.getElementById('header-welcome-text').textContent = `Welcome, ${name}`;
                    document.getElementById('login-modal').classList.remove('visible-modal');
                    document.getElementById('login-modal').classList.add('hidden-modal');
                    showPage(currentPageIndex);
                    sfx.nav();
                });
            }
            
            // Accordions
            document.querySelectorAll('.accordion-toggle').forEach(acc => {
                acc.addEventListener('click', function() {
                    const content = this.nextElementSibling;
                    const icon = this.querySelector('.accordion-icon');
                    const isOpen = !content.classList.contains('hidden');
                    
                    document.querySelectorAll('.accordion-content').forEach(c => { c.classList.add('hidden'); });
                    document.querySelectorAll('.accordion-icon').forEach(i => { i.classList.remove('rotate-180'); });
                    
                    if (!isOpen) {
                        content.classList.remove('hidden');
                        if(icon) icon.classList.add('rotate-180');
                        sfx.tick();
                    }
                });
            });

            // Blueprint & Fullscreen Toggles
            const blueprintToggle = document.getElementById('blueprint-toggle');
            if(blueprintToggle) {
                blueprintToggle.addEventListener('click', () => {
                    document.getElementById('screen').classList.toggle('blueprint-mode');
                    blueprintToggle.classList.toggle('text-cyan-300', document.getElementById('screen').classList.contains('blueprint-mode'));
                    blueprintToggle.classList.toggle('bg-white/10', document.getElementById('screen').classList.contains('blueprint-mode'));
                });
            }
            
            const fullscreenToggle = document.getElementById('fullscreen-toggle');
            if(fullscreenToggle) {
                fullscreenToggle.addEventListener('click', () => {
                    const frame = document.querySelector('.tablet-frame');
                    frame.classList.toggle('focus-mode');
                    const isFocus = frame.classList.contains('focus-mode');
                    
                    if (isFocus) {
                        document.body.classList.add('is-focused');
                        if (document.documentElement.requestFullscreen) { document.documentElement.requestFullscreen().catch(err => console.log("Fullscreen blocked.")); }
                        fullscreenToggle.classList.add('text-green-300', 'bg-white/10');
                    } else {
                        document.body.classList.remove('is-focused');
                        if (document.fullscreenElement) { if (document.exitFullscreen) document.exitFullscreen().catch(err => {}); }
                        fullscreenToggle.classList.remove('text-green-300', 'bg-white/10');
                    }
                });
            }

            lucide.createIcons();
        });
    </script>
</body>
</html>
