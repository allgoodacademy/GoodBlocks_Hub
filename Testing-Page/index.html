<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Allgood Academy | Digital Decisions Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- FIREBASE AND AUTHENTICATION SETUP -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken, GoogleAuthProvider, signInWithPopup, updateProfile, signOut } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, addDoc, collection, serverTimestamp, getDoc } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';
        
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "AIzaSyAf2SO8xovrApl52udUUoR1n9WBnERr_ko",
            authDomain: "allgood-academy.firebaseapp.com",
            projectId: "allgood-academy",
            storageBucket: "allgood-academy.firebasestorage.app",
            messagingSenderId: "978829044870",
            appId: "1:978829044870:web:6c780f64230a77ad0ab507",
            measurementId: "G-EN4M7T3BLQ"
        };
        
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'allgood-academy'; 
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.authSignOut = () => signOut(auth);

        window.currentUser = null;
        window.currentUserName = "Anonymous";
        window.currentUserEmail = "";
        window.isAuthReady = false;
        
        window.sessionId = "session_" + Date.now() + "_" + Math.floor(Math.random() * 1000);
        console.log("[System] Session ID generated:", window.sessionId);

        onAuthStateChanged(auth, async (user) => {
            window.isAuthReady = true;
            if (user) {
                console.log("[Auth] User detected:", user.uid);
                window.currentUser = user;
                let finalName = user.displayName || localStorage.getItem('aa_username') || "Agent Learner";
                
                if (finalName === "Agent Learner") {
                    try {
                        const userDoc = await getDoc(doc(db, 'artifacts', appId, 'users', user.uid));
                        if (userDoc.exists()) finalName = userDoc.data().displayName || finalName;
                    } catch(e) { console.log("Profile fetch skipped", e); }
                }

                window.currentUserName = finalName;
                window.currentUserEmail = user.email;
                window.updateUserDisplay(finalName);
                
                const loginModal = document.getElementById('login-modal');
                if (loginModal && !loginModal.classList.contains('hidden-modal')) {
                    loginModal.classList.add('hidden-modal');
                    loginModal.classList.remove('visible-modal');
                    if(window.logFinalScoreToFirestore) {
                        window.logFinalScoreToFirestore({ finalScore: 0, rank: "Session Started", sessionId: window.sessionId });
                    }
                }
            } else {
                console.log("[Auth] No user signed in.");
                window.currentUser = null;
                window.updateUserDisplay("Agent Learner");
            }
        });

        async function ensureUserContainer(user, name, email, isGuest) {
             const userRef = doc(db, 'artifacts', appId, 'users', user.uid);
             try {
                 await setDoc(userRef, { displayName: name, email: email || (isGuest ? null : user.email || null), isGuest: isGuest, lastLogin: serverTimestamp(), lastActiveModule: "Digital Decisions Challenge" }, { merge: true });
             } catch (e) { console.error("[Identity] Failed to create user container:", e); }
        }

        window.logScenarioAttempt = async (data) => {
            const user = auth.currentUser;
            if (!user) return;
            const attemptRef = doc(db, 'artifacts', appId, 'users', user.uid, 'game_scores', window.sessionId, 'scenario_attempts', `scenario_${data.scenarioIndex}`);
            try { await setDoc(attemptRef, { ...data, timestamp: serverTimestamp() }); } catch (e) { console.error("Attempt log failed", e); }
        };

        window.logFinalScoreToFirestore = async (scoreData) => {
            const user = auth.currentUser;
            if (!user) return;
            const sessionRef = doc(db, 'artifacts', appId, 'users', user.uid, 'game_scores', window.sessionId);
            try {
                await setDoc(sessionRef, { gameName: "Digital Decisions Challenge", ...scoreData, lastUpdated: serverTimestamp(), user: { uid: user.uid, displayName: window.currentUserName, email: window.currentUserEmail } }, { merge: true });
            } catch (e) { console.error("[DB] Session Write Failed", e); }
        }

        window.handleGuestLogin = async () => {
            const nameInput = document.getElementById('user-name-input').value.trim();
            const emailInput = document.getElementById('user-email-input').value.trim();
            const btn = document.getElementById('btn-guest-login');
            
            const originalText = btn.innerText;
            btn.innerText = "Connecting...";
            btn.disabled = true;

            try {
                let user;
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                    user = auth.currentUser;
                } else if (auth.currentUser) {
                    user = auth.currentUser;
                } else {
                    const result = await signInAnonymously(auth);
                    user = result.user;
                }
                
                const displayName = nameInput || "Agent Learner";
                await updateProfile(user, { displayName: displayName });
                await ensureUserContainer(user, displayName, emailInput, true);
                
                window.currentUserName = displayName;
                window.currentUserEmail = emailInput;

                localStorage.setItem('aa_username', displayName);
                localStorage.setItem('aa_email', emailInput);
                localStorage.setItem('aa_uid', user.uid);
                localStorage.setItem('aa_is_guest', 'true');
                
                window.updateUserDisplay(displayName);
                window.logFinalScoreToFirestore({ finalScore: 0, rank: "Session Started", sessionId: window.sessionId });

                document.getElementById('login-modal').classList.add('hidden-modal');
                document.getElementById('login-modal').classList.remove('visible-modal');
                
                window.showPage(0);
                if(window.sfx) sfx.nav();
            } catch (error) {
                console.error("Login Failed", error);
                alert("Connection failed. Please try again.");
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        };

        window.handleGoogleLogin = async () => {
            const provider = new GoogleAuthProvider();
            const btnContainer = document.getElementById('google-icon-container');
            if(btnContainer) btnContainer.classList.add('opacity-50', 'pointer-events-none');

            try {
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                const finalName = user.displayName || "Agent";
                await ensureUserContainer(user, finalName, user.email, false);
                
                window.currentUserName = finalName;
                window.currentUserEmail = user.email;

                localStorage.setItem('aa_username', finalName);
                localStorage.setItem('aa_email', user.email);
                localStorage.setItem('aa_uid', user.uid);
                localStorage.setItem('aa_is_guest', 'false');
                
                window.updateUserDisplay(finalName);
                document.getElementById('login-modal').classList.add('hidden-modal');
                document.getElementById('login-modal').classList.remove('visible-modal');
                
                window.showPage(0);
                if(window.sfx) sfx.nav();
            } catch (error) {
                console.error("Google Sign-In Error", error);
                alert("Google Sign-In failed. Please try again.");
            } finally {
                 if(btnContainer) btnContainer.classList.remove('opacity-50', 'pointer-events-none');
            }
        };
        
        window.auth = auth; window.db = db;
        (async function initAuth() {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                try { await signInWithCustomToken(auth, __initial_auth_token); } catch (e) { console.log("Auto-auth failed", e); }
            }
        })();
    </script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'allgood-primary': '#D34716',
                        'allgood-secondary': '#357889',
                        'allgood-dark': '#4C4C4C',
                        'allgood-light': '#F7F7F7',
                    },
                    fontFamily: {
                        'heading': ['Georgia', 'serif'],
                        'body': ['Verdana', 'sans-serif'],
                    },
                },
            },
        }
    </script>

    <style>
        body { 
            font-family: Verdana, sans-serif; 
            background-color: #1a1a1a; 
            background-image: url("https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=1172&auto=format&fit=crop&ixlib=rb-4.1.0");
            background-size: cover; background-position: center; background-attachment: fixed;
            min-height: 100vh; margin: 0; padding: 0;
            -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; -webkit-tap-highlight-color: transparent;
        }

        input, textarea { -webkit-user-select: text; user-select: text; }
        h1, h2, h3, h4 { font-family: Georgia, serif; }

        /* UPGRADED WORKSTATION FRAME */
        .tablet-frame {
            height: 80vh; width: auto; aspect-ratio: 16/10; max-width: 1100px; max-height: 95vh;
            background-image: radial-gradient(circle at 0% 0%, rgba(211, 71, 22, 0.35) 0%, transparent 30%), linear-gradient(135deg, #5c5c5c 0%, #d6d6d6 25%, #8a8a8a 50%, #e0e0e0 75%, #5c5c5c 100%);
            border-radius: 12px; padding: 12px; border: 1px solid #333; position: relative;
            box-shadow: inset 1px 1px 2px rgba(255,255,255,0.6), 0 30px 60px -12px rgba(0,0,0,0.8);
        }
        .tablet-frame::before { content: ''; position: absolute; top: 10px; left: 10px; right: 10px; bottom: 10px; border-radius: 6px; background: #111; z-index: 0; }
        .screen-container { width: 100%; height: 100%; background-color: #F7F7F7; position: relative; z-index: 1; overflow: hidden; display: flex; flex-direction: column; border-radius: 4px; box-shadow: inset 0 0 10px rgba(0,0,0,0.5); }

        .modal-transition { transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out; }
        .hidden-modal { opacity: 0; pointer-events: none; transform: translateY(-10px); }
        .visible-modal { opacity: 1; pointer-events: auto; transform: translateY(0); }

        .page::-webkit-scrollbar, .hud-scroll::-webkit-scrollbar { width: 8px; }
        .page::-webkit-scrollbar-track, .hud-scroll::-webkit-scrollbar-track { background: #e5e5e5; }
        .page::-webkit-scrollbar-thumb, .hud-scroll::-webkit-scrollbar-thumb { background-color: #357889; border-radius: 4px; }

        #flex-progress-bar { height: 4px; width: 100%; background-color: #eee; position: absolute; top: 0; left: 0; }
        #flex-progress-fill { height: 100%; background-color: #D34716; width: 0%; transition: width 0.3s ease; }

        .choice-btn { background-color: #FFFFFF; border: 2px solid #E5E7EB; transition: all 0.2s ease; }
        .choice-btn:hover:not(:disabled) { border-color: #357889; background-color: #F9FAFB; }
        
        .navbar-content { flex: 0 0 60px; z-index: 50; }
        .footer-content { flex: 0 0 60px; z-index: 50; background-color: white; border-top: 1px solid #e5e7eb; position: relative; }
        
        .page { flex: 1 1 auto; overflow-y: auto; padding: 20px; position: relative; display: none; width: 100%; }
        .page.active { display: block; }

        .blueprint-mode { background-color: #0f172a !important; color: #94a3b8 !important; }
        .blueprint-mode .page, .blueprint-mode .hud-panel { background-color: #0f172a !important; border-color: #334155 !important;}
        .blueprint-mode .bg-white { background-color: #1e293b !important; border-color: #334155 !important; color: #cbd5e1 !important; }
        .blueprint-mode .text-allgood-dark { color: #e2e8f0 !important; }
        
        .tablet-frame.expanded-mode { position: fixed !important; top: 0 !important; left: 0 !important; width: 100vw !important; height: 100vh !important; max-width: none !important; max-height: none !important; aspect-ratio: unset !important; margin: 0 !important; padding: 0 !important; border: none !important; border-radius: 0 !important; z-index: 9999 !important; background: #F7F7F7 !important; box-shadow: none !important; }
        .tablet-frame.expanded-mode::before { display: none !important; }
        .tablet-frame.expanded-mode .screen-container { border-radius: 0 !important; }

        @media (max-width: 768px) {
            html, body { position: fixed; width: 100%; height: 100dvh; overflow: hidden; margin: 0; padding: 0; background-color: #F7F7F7; }
            main { padding: 0 !important; height: 100dvh !important; width: 100% !important; display: block; position: fixed; top: 0; left: 0; }
            .tablet-frame { position: absolute; top: 0; left: 0; right: 0; bottom: 0; width: 100% !important; height: 100% !important; max-width: none !important; max-height: none !important; margin: 0 !important; padding: 0 !important; border: none !important; border-radius: 0 !important; box-shadow: none !important; background: #F7F7F7 !important; aspect-ratio: unset !important; transform: none !important; }
            .tablet-frame::before { display: none !important; }
            .screen-container { width: 100%; height: 100%; border-radius: 0 !important; box-shadow: none !important; display: flex; flex-direction: column; background: #F7F7F7; overflow: hidden; position: relative; }
            header.navbar-content { padding-top: max(env(safe-area-inset-top), 12px); height: auto; min-height: 60px; padding-bottom: 12px; flex-shrink: 0; z-index: 50; }
            footer.footer-content { position: absolute; bottom: 0; left: 0; width: 100%; padding-bottom: max(env(safe-area-inset-bottom), 20px); padding-top: 12px; height: auto; min-height: 80px; z-index: 100; }
            .page { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; padding-bottom: 120px !important; }
            /* Hide HUD Sidebar on mobile, we will show a compact top bar version instead */
            .hud-sidebar { display: none !important; }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen text-allgood-dark font-body overflow-y-auto">

    <main class="flex-grow flex items-center justify-center py-0 md:py-8 h-[100dvh] w-full">
        <div class="tablet-frame">
            <div class="screen-container" id="screen">

                <!-- 1. STARTUP SCREEN -->
                <div id="startup-screen" class="absolute inset-0 z-[300] flex flex-col items-center justify-center cursor-pointer transition-opacity duration-700 ease-in-out bg-gradient-to-br from-allgood-secondary to-gray-900">
                    <div class="group flex flex-col items-center justify-center text-center h-full w-full relative">
                        <div class="flex-grow flex flex-col items-center justify-center px-4">
                            <div class="relative flex flex-col items-center">
                                <div class="absolute inset-0 bg-white/10 blur-3xl rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-700"></div>
                                <div class="-translate-x-6"><i data-lucide="fingerprint" class="w-24 h-24 text-white mb-6 relative z-10 drop-shadow-[0_0_15px_rgba(255,255,255,0.5)]"></i></div>
                                <h2 class="text-xl md:text-2xl font-heading font-bold text-gray-300 mb-1 relative z-10 tracking-widest uppercase">Allgood Academy</h2>
                                <h1 class="text-4xl md:text-6xl font-heading font-bold text-transparent bg-clip-text bg-gradient-to-r from-white to-gray-400 tracking-tighter relative z-10 drop-shadow-sm leading-normal pb-4 max-w-4xl">Digital Decisions Challenge</h1>
                                <div class="mt-2 flex items-baseline justify-center gap-2 relative z-10 opacity-90">
                                    <span class="text-white/60 text-[10px] sm:text-xs tracking-[0.2em] uppercase font-bold font-body">Powered by</span>
                                    <span class="text-allgood-primary text-2xl sm:text-3xl font-heading font-bold">GoodBlock</span>
                                </div>
                            </div>
                            <p class="mt-16 text-white/60 text-xs tracking-[0.4em] uppercase font-bold group-hover:text-white transition-colors animate-pulse">CLICK TO POWER UP</p>
                        </div>
                    </div>
                </div>

                <!-- 2. LOGIN MODAL -->
                <div id="login-modal" class="absolute inset-0 z-[200] bg-allgood-dark/95 flex items-center justify-center p-6 hidden-modal modal-transition backdrop-blur-sm">
                    <div class="bg-white rounded-lg shadow-2xl p-8 max-w-sm w-full text-center border-t-4 border-allgood-primary">
                        <div class="mb-6"><h2 class="text-3xl font-heading font-bold text-allgood-dark">Allgood<span class="text-allgood-primary">Academy</span></h2></div>
                        <h2 class="text-xl font-bold text-allgood-dark mb-2 font-heading">Welcome</h2>
                        <input type="text" id="user-name-input" placeholder="Your Name (Optional)" class="w-full border border-gray-300 rounded p-3 mb-3 focus:ring-2 focus:ring-allgood-primary outline-none font-body">
                        <input type="email" id="user-email-input" placeholder="Your Email (Optional)" class="w-full border border-gray-300 rounded p-3 mb-6 focus:ring-2 focus:ring-allgood-primary outline-none font-body">
                        <button id="btn-guest-login" onclick="window.handleGuestLogin()" class="w-full bg-allgood-primary hover:bg-allgood-hover text-white font-bold py-3 rounded shadow-md transition-transform transform hover:scale-[1.02] font-body uppercase">Start Challenge</button>
                        <div class="mt-4 flex items-center justify-center space-x-2"><div class="h-px w-10 bg-gray-200"></div><p class="text-xs text-gray-500 uppercase font-bold">OR</p><div class="h-px w-10 bg-gray-200"></div></div>
                        <button id="google-icon-container" onclick="window.handleGoogleLogin()" class="mt-4 p-2 rounded-full border border-gray-300 shadow-md hover:scale-105 bg-white flex justify-center mx-auto">
                            <svg class="w-6 h-6" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                        </button>
                    </div>
                </div>

                <!-- 3. HEADER -->
                <header class="bg-allgood-secondary shadow-md navbar-content flex items-center shrink-0">
                    <div class="w-full px-4 flex items-center justify-between h-full pt-[env(safe-area-inset-top)]">
                        <div class="flex items-center overflow-hidden">
                            <div id="header-welcome-text" class="flex-shrink-0 text-white font-heading font-bold text-lg tracking-tight truncate mr-4">Digital Decisions Challenge</div>
                        </div>
                        <div class="flex items-center space-x-1 shrink-0 relative">
                            <button id="home-button" class="text-gray-200 hover:text-white transition-colors p-2 rounded-full hover:bg-white/10" title="Reset"><i data-lucide="home" class="w-6 h-6"></i></button>
                            <div class="h-6 w-px bg-white/20 mx-1"></div>
                            <button id="blueprint-toggle" class="text-gray-200 hover:text-cyan-300 transition-colors p-2 rounded-full hover:bg-white/10"><i data-lucide="moon" class="w-5 h-5"></i></button>
                            <button id="fullscreen-toggle" class="hidden sm:block text-gray-200 hover:text-green-300 transition-colors p-2 rounded-full hover:bg-white/10"><i data-lucide="maximize" class="w-5 h-5"></i></button>
                            <button id="menu-toggle" class="text-gray-200 hover:text-white transition-colors p-2 rounded-full hover:bg-white/10"><i data-lucide="menu" class="w-7 h-7"></i></button>
                        </div>
                    </div>
                </header>

                <!-- WORKSTATION SPLIT LAYOUT -->
                <div class="flex-1 flex overflow-hidden w-full relative">
                    
                    <!-- HUD SIDEBAR (Mission Control) - Desktop Only -->
                    <aside class="hud-sidebar w-72 bg-white border-r border-gray-200 hidden md:flex flex-col z-20 shadow-[2px_0_10px_rgba(0,0,0,0.05)] hud-panel shrink-0">
                        <div class="p-5 border-b border-gray-100 bg-slate-50">
                            <h3 class="font-heading font-bold text-allgood-dark text-lg">Mission Control</h3>
                            <p class="text-xs font-bold text-allgood-secondary tracking-wider uppercase mt-1" id="hud-name">Agent Learner</p>
                        </div>
                        
                        <div class="p-5 border-b border-gray-100">
                            <p class="text-[10px] uppercase font-bold text-gray-400 tracking-widest mb-1">Global Score</p>
                            <div class="flex items-baseline gap-2">
                                <span class="text-4xl font-heading font-bold text-allgood-primary" id="hud-score">0</span>
                                <span class="text-sm font-bold text-gray-400">/ 90</span>
                            </div>
                        </div>

                        <div class="p-5 border-b border-gray-100">
                            <p class="text-[10px] uppercase font-bold text-gray-400 tracking-widest mb-4">Reputation Analytics</p>
                            
                            <div class="mb-4">
                                <div class="flex justify-between text-[10px] font-bold text-allgood-dark mb-1">
                                    <span class="flex items-center gap-1"><i data-lucide="shield-check" class="w-3 h-3 text-cyan-600"></i> Critical Thinking</span>
                                    <span id="metric-critical">0%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2"><div class="bg-cyan-600 h-2 rounded-full transition-all duration-500" id="bar-critical" style="width: 0%"></div></div>
                            </div>
                            
                            <div class="mb-4">
                                <div class="flex justify-between text-[10px] font-bold text-allgood-dark mb-1">
                                    <span class="flex items-center gap-1"><i data-lucide="heart" class="w-3 h-3 text-orange-500"></i> Empathy</span>
                                    <span id="metric-empathy">0%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2"><div class="bg-orange-500 h-2 rounded-full transition-all duration-500" id="bar-empathy" style="width: 0%"></div></div>
                            </div>
                            
                            <div class="mb-2">
                                <div class="flex justify-between text-[10px] font-bold text-allgood-dark mb-1">
                                    <span class="flex items-center gap-1"><i data-lucide="award" class="w-3 h-3 text-green-600"></i> Integrity</span>
                                    <span id="metric-integrity">0%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2"><div class="bg-green-600 h-2 rounded-full transition-all duration-500" id="bar-integrity" style="width: 0%"></div></div>
                            </div>
                        </div>

                        <div class="p-5 flex-1 overflow-y-auto hud-scroll bg-gray-50/50">
                            <p class="text-[10px] uppercase font-bold text-gray-400 tracking-widest mb-2">Active Mission</p>
                            <div id="hud-active-mission" class="text-sm font-bold text-allgood-dark border-l-4 border-allgood-secondary pl-3 py-1 mb-2">Awaiting Selection</div>
                            <div id="hud-mission-progress" class="text-xs font-bold text-gray-500 pl-4">--</div>
                        </div>
                    </aside>

                    <!-- MAIN PAGES AREA -->
                    <main class="flex-1 relative flex flex-col overflow-hidden bg-gray-50">
                        <!-- Mobile HUD Strip -->
                        <div class="md:hidden bg-white border-b border-gray-200 px-4 py-2 flex justify-between items-center shadow-sm z-10 shrink-0">
                            <div class="flex items-center gap-2">
                                <i data-lucide="target" class="w-4 h-4 text-allgood-primary"></i>
                                <span id="mobile-hud-mission" class="text-xs font-bold text-allgood-dark truncate max-w-[120px]">Select Mission</span>
                            </div>
                            <div class="text-xs font-bold text-allgood-secondary bg-gray-100 px-2 py-1 rounded">Score: <span id="mobile-hud-score">0</span></div>
                        </div>

                        <div class="flex-1 relative overflow-y-auto page-container">
                            <!-- Page 1: Intro -->
                            <div class="page active bg-white h-full" id="page-1">
                                <div class="flex flex-col items-center justify-center h-full text-center px-4 py-8 max-w-2xl mx-auto">
                                    <i data-lucide="cpu" class="w-16 h-16 text-allgood-secondary mb-6"></i>
                                    <h1 class="text-3xl sm:text-4xl font-heading font-bold text-allgood-dark mb-4 leading-tight">The <span class="text-allgood-primary">Digital Decisions</span> Challenge</h1>
                                    <p class="text-gray-600 mb-8 leading-relaxed">Welcome to the Workstation. Every click is a brick in your digital footprint. You are about to engage in a simulation that tests your pragmatic judgment in real-world scenarios.</p>
                                    
                                    <div class="w-full bg-gray-50 border border-gray-200 p-6 rounded-xl shadow-sm mb-8 text-left">
                                        <h3 class="font-bold text-allgood-dark mb-3 flex items-center gap-2"><i data-lucide="alert-circle" class="w-5 h-5 text-allgood-primary"></i> Simulation Rules</h3>
                                        <ul class="text-sm text-gray-600 space-y-2 list-none">
                                            <li class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-green-600 mt-0.5"></i> You earn <strong>3 points</strong> for the Most Effective pragmatic choice.</li>
                                            <li class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-green-600 mt-0.5"></i> Scenarios are grouped into targeted rapid-fire missions.</li>
                                            <li class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-green-600 mt-0.5"></i> <strong>Goal:</strong> Score 80+ points to earn your Digital Architect certification.</li>
                                        </ul>
                                    </div>
                                    <button onclick="window.showPage(1)" class="bg-allgood-primary hover:bg-allgood-hover text-white px-8 py-3 rounded-full font-bold shadow-md transition-transform hover:scale-105 flex items-center gap-2 uppercase tracking-wide text-sm">Access Launchpad <i data-lucide="arrow-right" class="w-4 h-4"></i></button>
                                </div>
                            </div>

                            <!-- Page 2: Mission Launchpad -->
                            <div class="page bg-gray-50 h-full" id="page-2">
                                <div class="max-w-4xl mx-auto py-6">
                                    <section class="mb-6 border-b border-gray-200 pb-4">
                                        <h2 class="text-2xl font-heading font-bold text-allgood-dark mb-1">Mission Launchpad</h2>
                                        <p class="text-sm text-gray-500">Select a priority area to begin your rapid-fire scenario sequence.</p>
                                    </section>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="category-grid">
                                        <!-- Rendered dynamically via JS -->
                                    </div>
                                    
                                    <div class="mt-8 text-center" id="final-evaluation-container" style="display: none;">
                                        <div class="inline-block bg-white p-6 rounded-xl shadow-md border-t-4 border-allgood-primary max-w-md w-full">
                                            <i data-lucide="shield-check" class="w-12 h-12 text-allgood-primary mx-auto mb-3"></i>
                                            <h3 class="font-heading font-bold text-xl mb-2">All Missions Complete</h3>
                                            <p class="text-sm text-gray-600 mb-6">You have responded to all 30 scenarios. Proceed to the final evaluation to receive your certification status.</p>
                                            <button onclick="window.showPage(32)" class="w-full bg-allgood-dark hover:bg-allgood-primary text-white font-bold py-3 rounded shadow-md transition-colors uppercase tracking-wide text-xs">Initialize Evaluation</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Dynamic Scenario Workspace (Pages 3-32 physical containers, managed by JS) -->
                            <div id="scenario-containers">
                                <!-- 30 divs generated in JS to hold standard layouts -->
                            </div>

                            <!-- Page 33: Final Score -->
                            <div class="page bg-white h-full" id="page-33">
                                <div class="max-w-3xl mx-auto py-8">
                                    <section class="mb-6 border-b border-gray-200 pb-4 text-center">
                                        <h2 class="text-3xl font-heading font-bold text-allgood-dark mb-2">Final Readiness Assessment</h2>
                                        <p class="text-xs font-bold text-allgood-primary uppercase tracking-widest">Simulation Complete</p>
                                    </section>
                                    
                                    <div class="text-center">
                                        <div class="w-full max-w-sm mx-auto bg-gray-50 p-6 rounded-lg shadow-inner border border-gray-200 mb-8">
                                            <p class="text-sm font-semibold text-gray-500 mb-1">Total Score</p>
                                            <p id="final-score-value" class="text-5xl font-extrabold text-allgood-dark font-heading">0 / 90</p>
                                            <p id="final-score-percent" class="text-xs text-gray-400 mt-1">(0% Effectiveness)</p>
                                        </div>
                                        <h3 id="final-rank-heading" class="text-xl font-heading font-bold text-allgood-dark mb-2">Digital Learner</h3>
                                        <p id="final-rank-message" class="text-sm text-gray-600 max-w-md mx-auto mb-10">Good start. Reread the feedback and try again.</p>

                                        <!-- Feedback Module -->
                                        <div id="feedback-container" class="w-full max-w-md mx-auto bg-white p-6 rounded-lg shadow-md border border-gray-200 mb-10 text-left relative">
                                            <h3 class="font-bold text-allgood-dark text-sm uppercase tracking-wide mb-4 text-center">Rate this Simulation</h3>
                                            <div class="flex justify-center space-x-2 mb-4" id="star-wrapper">
                                                <button onclick="window.setRating(1)" class="star-btn focus:outline-none transition-transform hover:scale-110"><i id="star-1" class="fas fa-star text-2xl text-gray-300"></i></button>
                                                <button onclick="window.setRating(2)" class="star-btn focus:outline-none transition-transform hover:scale-110"><i id="star-2" class="fas fa-star text-2xl text-gray-300"></i></button>
                                                <button onclick="window.setRating(3)" class="star-btn focus:outline-none transition-transform hover:scale-110"><i id="star-3" class="fas fa-star text-2xl text-gray-300"></i></button>
                                                <button onclick="window.setRating(4)" class="star-btn focus:outline-none transition-transform hover:scale-110"><i id="star-4" class="fas fa-star text-2xl text-gray-300"></i></button>
                                                <button onclick="window.setRating(5)" class="star-btn focus:outline-none transition-transform hover:scale-110"><i id="star-5" class="fas fa-star text-2xl text-gray-300"></i></button>
                                            </div>
                                            <label class="block text-xs font-bold text-gray-500 mb-2">Your feedback sharpens our tools. What worked? What didn't?</label>
                                            <textarea id="feedback-text" rows="3" class="w-full border border-gray-300 rounded p-3 text-sm focus:ring-1 focus:ring-allgood-primary outline-none resize-none bg-gray-50" placeholder="Optional: Share your thoughts..."></textarea>
                                            <button onclick="window.submitFeedback()" class="w-full mt-4 bg-allgood-dark hover:bg-allgood-primary text-white font-bold py-2 rounded transition-colors text-sm">Send Feedback</button>
                                        </div>
                                        <div id="feedback-success" class="hidden w-full max-w-md mx-auto bg-green-50 p-6 rounded-lg border border-green-200 mb-10 text-center">
                                            <i data-lucide="check-circle" class="w-12 h-12 text-green-600 mx-auto mb-2"></i><h3 class="font-bold text-green-800">Feedback Received.</h3><p class="text-xs text-green-700 mt-1">Thank you for helping us improve.</p>
                                        </div>

                                        <div id="certification-section" class="w-full max-w-md mx-auto bg-gradient-to-br from-allgood-secondary to-gray-800 p-1 rounded-lg shadow-xl">
                                            <div class="bg-white p-6 rounded-md text-center">
                                                <i id="badge-icon" data-lucide="award" class="w-16 h-16 text-allgood-primary mx-auto mb-4"></i>
                                                <h3 class="font-heading font-bold text-xl text-allgood-dark mb-2">Digital Architect Certification</h3>
                                                <p id="cert-req-text" class="text-sm text-gray-600 mb-6">You need 80 points to achieve this certification.</p>
                                                <button id="download-badge-btn" onclick="window.downloadBadge()" disabled class="w-full bg-gray-300 text-white font-bold py-3 rounded cursor-not-allowed flex items-center justify-center transition-all duration-300">
                                                    <i data-lucide="lock" class="w-4 h-4 mr-2"></i> Certification Locked
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Footer Control Bar -->
                        <footer class="footer-content flex items-center justify-between px-4 sm:px-6 shrink-0 bg-white shadow-[0_-2px_10px_rgba(0,0,0,0.05)]">
                            <div id="flex-progress-bar"><div id="flex-progress-fill"></div></div>
                            <button id="back-button" class="text-allgood-primary hover:text-allgood-dark font-bold text-sm flex items-center transition-colors disabled:opacity-30 p-2 font-body"><i data-lucide="chevron-left" class="w-5 h-5 mr-1"></i><span class="hidden sm:inline">Back</span></button>
                            <p class="text-gray-400 text-[10px] hidden sm:block font-body font-bold">&copy; Allgood Academy <span id="current-year"></span></p>
                            <button id="next-button" class="bg-allgood-primary hover:bg-allgood-hover text-white px-6 py-2 rounded-full text-sm font-bold shadow-md transition-transform transform hover:scale-105 flex items-center disabled:opacity-50 font-body uppercase tracking-wide">
                                <span id="next-btn-text">Proceed</span> <i data-lucide="chevron-right" class="w-4 h-4 ml-1"></i>
                            </button>
                        </footer>
                    </main>
                </div>

                <!-- MODALS -->
                <div id="scenario-modal" class="hidden-modal absolute inset-0 z-[260] bg-allgood-dark/90 flex items-center justify-center p-4 modal-transition" onclick="window.closeScenarioModal()">
                    <div class="bg-white rounded-lg shadow-2xl p-6 max-w-md w-full text-center relative border-t-4 border-allgood-secondary" onclick="event.stopPropagation()">
                        <div id="scenario-icon" class="mx-auto w-16 h-16 rounded-full flex items-center justify-center mb-4 text-3xl"></div>
                        <h3 id="scenario-title" class="text-xl font-heading font-bold text-allgood-dark mb-2"></h3>
                        <div id="scenario-feedback" class="text-sm text-gray-600 font-body mb-6 leading-relaxed text-left border-l-4 border-gray-200 pl-4 bg-gray-50 py-2 rounded-r"></div>
                        <button id="scenario-modal-next-btn" class="bg-allgood-dark text-white px-8 py-3 rounded-full font-bold text-xs uppercase tracking-wider hover:bg-allgood-primary transition-colors shadow-md w-full flex justify-center items-center gap-2">Continue <i data-lucide="arrow-right" class="w-4 h-4"></i></button>
                    </div>
                </div>

                <div id="menu-modal" class="hidden-modal absolute inset-0 z-[100] bg-black/60 flex justify-end modal-transition">
                    <div class="w-72 h-full bg-white shadow-xl flex flex-col border-l border-gray-200">
                        <div class="p-4 border-b border-gray-200 flex justify-between items-center bg-gray-50"><span class="font-bold text-allgood-dark font-heading">System Menu</span><button onclick="window.closeMenuModal()" class="text-gray-500 hover:text-allgood-primary"><i data-lucide="x" class="w-6 h-6"></i></button></div>
                        <div class="p-4 space-y-3">
                            <button onclick="window.handleLogOut()" class="w-full bg-red-50 text-red-600 font-bold py-3 rounded border border-red-200 flex items-center justify-center"><i data-lucide="log-out" class="w-4 h-4 mr-2"></i> Log Out / Reset</button>
                            <button onclick="window.location.href='https://www.allgoodacademy.com'" class="w-full bg-gray-100 text-allgood-dark font-bold py-3 rounded border border-gray-300 flex items-center justify-center"><i data-lucide="external-link" class="w-4 h-4 mr-2"></i> Exit Dashboard</button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <!-- Main Logic -->
    <script>
        // AUDIO ENGINE
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;
        function initAudio() { if (!audioCtx) audioCtx = new AudioContext(); if (audioCtx.state === 'suspended') audioCtx.resume(); }
        function playTone(freq, type, duration, vol=0.1) { initAudio(); const now = audioCtx.currentTime; const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.type = type; osc.frequency.setValueAtTime(freq, now); osc.connect(gain); gain.connect(audioCtx.destination); gain.gain.setValueAtTime(0, now); gain.gain.linearRampToValueAtTime(vol, now + 0.01); gain.gain.exponentialRampToValueAtTime(0.001, now + duration); osc.start(now); osc.stop(now + duration); }
        const sfx = { 
            nav: () => playTone(150, 'sine', 0.1, 0.1), 
            tick: () => playTone(1000, 'sine', 0.01, 0.01), 
            success: () => playTone(400, 'sine', 0.2, 0.1),
            powerOn: () => { playTone(200, 'sine', 0.1, 0.1); setTimeout(() => playTone(400, 'sine', 0.3, 0.1), 100); }
        };
        window.sfx = sfx;

        // GLOBAL STATE
        const TOTAL_SCENARIOS = 30;
        const MAX_SCORE = 90; 
        const BADGE_THRESHOLD = 80;
        let totalChallengeScore = 0;
        let answeredScenarioScores = {};
        let feedbackSubmitted = false;
        let currentStarRating = 0;

        // RAPID FIRE STATE
        let activeCategory = null;
        let categoryQueue = [];
        let currentQueueIndex = 0;
        let currentVisualPage = 0; // 0=Intro, 1=Launchpad, 2=Scenario, 32=Final

        const CATEGORIES = {
            privacy_security: { title: "Privacy & Security", icon: "shield-alert", desc: "Data protection & scam evasion.", color: "bg-cyan-600" },
            social_intelligence: { title: "Social Intelligence", icon: "users", desc: "Conflict resolution & empathy.", color: "bg-orange-500" },
            professional_brand: { title: "Professional Brand", icon: "briefcase", desc: "Managing online reputation.", color: "bg-indigo-600" },
            digital_citizenship: { title: "Digital Citizenship", icon: "globe", desc: "Information verification & ethics.", color: "bg-green-600" }
        };

        const SCENARIO_DATA = [
            { cat: 'social_intelligence', title: "Your classmate posts a picture of your group project online without getting your permission. Question: What do you do?", icon: "users", choices: [ { text: "Say nothing and ignore the post, hoping it will go away.", score: 1, effectiveness: "less-effective", feedback: "While you're respecting their privacy, this isn't the most effective choice. A more principled person would not ignore a problem. You are missing an opportunity to help your friend who might be struggling." }, { text: "Post a mean comment on their picture telling them to take it down immediately.", score: 0, effectiveness: "least-effective", feedback: "While you're trying to resolve the situation, this is the least-effective choice. **Reacting with aggression is not respectful or effective.** It damages your relationship and shows poor communication skills." }, { text: "Politely message them to ask them to take it down, explaining why you're uncomfortable.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. You handled the situation with **integrity and respect** for your own feelings. It also demonstrates great social skills by managing the conflict directly and politely. *You could say something like: 'Hey, I saw the picture of our project that you posted, and I'm a little uncomfortable with my work being online without my permission. Could you please take it down for me?'*" } ] },
            { cat: 'social_intelligence', title: "You get into a heated debate with a stranger in the comments section of a social media post. Question: What do you do?", icon: "message-square", choices: [ { text: "Use an 'I' statement to express your point of view calmly and then disengage from the conversation.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. You act as a **thoughtful communicator** by expressing your ideas clearly and with self-control. It shows you know when to stop and maintain your online well-being. *You could say something like: 'I can see that we have very different opinions on this topic, and I'm going to disengage from this conversation now.'*" }, { text: "Use personal attacks to try and win the argument.", score: 0, effectiveness: "least-effective", feedback: "Using personal attacks is a sign of a poor communicator. This is the least-effective choice because it **damages your online reputation** and shows a lack of self-management skills." }, { text: "Say nothing and leave the conversation.", score: 1, effectiveness: "less-effective", feedback: "While this may seem like the best option, this isn't the most effective choice. You are not being a good communicator. You should always try to **express your point of view calmly and with respect**, which is a key trait of a good communicator." } ] },
            { cat: 'professional_brand', title: "You are applying for a job, and the company asks for your social media handles. Question: What do you do?", icon: "briefcase", choices: [ { text: "You curate your social media to reflect your professional goals and then share it.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **curated digital footprint** is a powerful professional asset, not a liability. You've thought about your personal brand and how it aligns with your career goals, showing great thinking skills." }, { text: "You delete all your social media accounts before giving them your handles.", score: 1, effectiveness: "less-effective", feedback: "Deleting accounts can sometimes look suspicious. This isn't the most effective choice. While it's a way to avoid problems, it doesn't show that you have the **thinking skills to manage your online presence responsibly**." }, { text: "You give them all your social media handles without reviewing them.", score: 0, effectiveness: "least-effective", feedback: "Giving a company access to all of your social media, including potentially inappropriate content, is risky. This is the least-effective choice because it shows a **lack of awareness** about how your online identity can impact your professional life." } ] },
            { cat: 'privacy_security', title: "Your friend sends you a link to a 'free gift card' survey. It asks for your personal information, including your full name and address. Question: What do you do?", icon: "wallet", choices: [ { text: "Fill out the survey with your real information to get the reward.", score: 0, effectiveness: "least-effective", feedback: "You gave in to a promise of a reward without considering the risks. This is the least-effective choice because a **thinker would question the motives** behind the offer and recognize that your personal data is more valuable than a free gift card." }, { text: "Delete the message and warn your friend that it might be a scam.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A true **thinker analyzes information** and recognizes potential risks. You were skeptical and used your reasoning skills to protect both yourself and your friend from a potential phishing scam. *You could say something like: 'Hey, I think that gift card link is a scam. It's asking for personal information, so you should probably delete the message.'*" }, { text: "Ask your friend if they have used it successfully and if it's safe.", score: 1, effectiveness: "less-effective", feedback: "While you're seeking more information, this is a less-effective choice. You are trusting a single source who might not be knowledgeable. A better thinker would **verify the information from a more reliable source** before acting." } ] },
            { cat: 'digital_citizenship', title: "You want to use a picture you found on Google for your school presentation. The picture is not labeled for reuse. Question: What do you do?", icon: "image", choices: [ { text: "Search for the original creator and ask for permission.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. Acting with **integrity means respecting intellectual property**. You showed that you value the work of others by seeking proper authorization and demonstrating good research skills. *You could say something like: 'Hello, I'm working on a school presentation and would love to use your photo. Would that be okay with you? I'll be sure to give you full credit.'*" }, { text: "Use the image anyway since it's on the internet and easy to find.", score: 0, effectiveness: "least-effective", feedback: "Just because something is online doesn't mean it is free to use without permission. This is the least-effective choice because it shows a **lack of respect** for the creator and their work." }, { text: "Use the image anyway and give credit to 'Google Images.'", score: 1, effectiveness: "less-effective", feedback: "While you are attempting to give credit, this is a less-effective choice. A more principled person would put in the effort to **find the true source** rather than using a generic phrase. It's a key part of good digital citizenship." } ] },
            { cat: 'social_intelligence', title: "You see a post from your classmate making fun of another student. The comments are full of hateful remarks. Question: What do you do?", icon: "users-x", choices: [ { text: "Report the post and privately message the person being bullied to offer support.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. You acted with **empathy** by not only reporting the harmful content but also reaching out to offer support. You put the well-being of your peer first and showed a commitment to a positive digital community. *You could say something like: 'Hey, I saw what happened online, and I'm really sorry. I wanted to let you know that I'm here for you if you need to talk or just get your mind off of it.'*" }, { text: "Like the post to fit in with your friends.", score: 0, effectiveness: "least-effective", feedback: "By liking the post, you are actively supporting bullying. This is the least-effective choice because a caring person acts with integrity and **stands up for others**, even when it is difficult." }, { text: "Comment on the post, telling everyone to stop being so mean.", score: 1, effectiveness: "less-effective", feedback: "While your intentions are good, this is a less-effective choice. **Engaging in the comments can sometimes make the situation worse** by giving the post more attention. A more caring response would address the situation privately or through official channels." } ] },
            { cat: 'social_intelligence', title: "You're taking an online class and your classmate posts something with a clear mistake. Question: What do you do?", icon: "book-open-check", choices: [ { text: "Privately message your classmate with constructive feedback and offer to help.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. By using a private message, you act as a **thoughtful communicator who is empathetic** to your peer's feelings. This shows you value their learning while protecting them from public embarrassment. *You could say something like: 'Hey, I was reading your post, and I think there might be a small mistake...'* " }, { text: "Post a public comment correcting their mistake so everyone can learn.", score: 1, effectiveness: "less-effective", feedback: "While you might want to help others, **publicly correcting someone can be embarrassing** and make them defensive. A better communicator would consider the social impact of their actions before posting." }, { text: "Say nothing and ignore the mistake.", score: 0, effectiveness: "least-effective", feedback: "By saying nothing, you miss an opportunity to collaborate and help your classmate learn. This is the least-effective choice because **effective communicators offer support** and guidance when it is needed." } ] },
            { cat: 'privacy_security', title: "You receive a friend request on social media from a person you don't know. Question: What do you do?", icon: "user-plus", choices: [ { text: "Ignore the request and review your privacy settings to make sure your profile is private.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **responsible risk-taker** is not reckless. You took a proactive step to protect your digital identity by being cautious about who you connect with and checking your security settings." }, { text: "Accept the request and then immediately send them a message asking who they are.", score: 0, effectiveness: "least-effective", feedback: "You've already granted them access to your information, which puts you at risk. This is the least-effective choice because a risk-taker would **not rush into a situation** without understanding the risks first." }, { text: "Accept the request; the more friends you have, the more popular you seem.", score: 1, effectiveness: "less-effective", feedback: "You are taking a **risk with your personal information** without thinking through the consequences. A wiser risk-taker would consider the potential negative outcomes before accepting a request from a stranger." } ] },
            { cat: 'privacy_security', title: "You're scrolling through social media, and a pop-up appears, claiming your phone has a virus and you need to download a special app to fix it. Question: What do you do?", icon: "alert-triangle", choices: [ { text: "Show it to your parents or a trusted adult to get their opinion.", score: 1, effectiveness: "less-effective", feedback: "While it's good to ask for help, this is a less-effective choice. You should first try to use your own **thinking and problem-solving skills**. A more effective approach would be to close the pop-up and analyze the situation on your own." }, { text: "Close the pop-up and run a scan with your phone's built-in security software.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **thinker is critical** of what they see online. You avoided a scam and took a logical, proactive step to ensure your device's security, showing great problem-solving skills." }, { text: "Immediately tap the pop-up and follow the instructions to get rid of the virus.", score: 0, effectiveness: "least-effective", feedback: "You acted **impulsively** without analyzing the situation. This is a less-effective choice because a thinker would question an unexpected and urgent pop-up and look for other solutions." } ] },
            { cat: 'digital_citizenship', title: "Your teacher has asked you to use a specific website for research, but you've found a different website that seems to have more information. You have never heard of this new website before. Question: What do you do?", icon: "search", choices: [ { text: "Use both websites and check to see if the information is the same.", score: 1, effectiveness: "less-effective", feedback: "While you're attempting to verify the information, this is a less-effective choice. It's a risk to spend time on an unknown source. A more knowledgeable person would prioritize using **proven, reliable sources first**." }, { text: "Use the new website because it has more information.", score: 0, effectiveness: "least-effective", feedback: "The amount of information on a website does not guarantee its quality. This is the least-effective choice because a knowledgeable person would **not use an unknown source** that could contain false or misleading information." }, { text: "Stick to the website your teacher has provided because it is a reliable source.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **knowledgeable person understands that reliable sources are essential**. You showed you can identify a trustworthy resource, ensuring the accuracy and integrity of your work." } ] },
            { cat: 'privacy_security', title: "You are creating a new account and are asked to create a new password. You're eager to start using the app. Question: What do you do?", icon: "key", choices: [ { text: "Use the same password you use for everything else because it's easy to remember.", score: 1, effectiveness: "less-effective", feedback: "While using the same password is easy, this is a less-effective choice. If one of your accounts is compromised, **all of your accounts could be at risk**. A more balanced person would consider the long-term risks over short-term convenience." }, { text: "Create a complex password with a mix of letters, numbers, and symbols that is unique to this account.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **balanced person understands the importance of protecting their personal information**. You prioritized security over convenience, which is a key part of maintaining a healthy digital life." }, { text: "Use your birthdate or a simple name because it is easy to remember.", score: 0, effectiveness: "least-effective", feedback: "Using easily guessable information makes you vulnerable to hackers. This is the least-effective choice because a **balanced person would never use such simple information** because it puts their security and privacy at great risk." } ] },
            { cat: 'social_intelligence', title: "You notice your friend is constantly online and seems to be neglecting their schoolwork and other responsibilities. Question: What do you do?", icon: "user-x", choices: [ { text: "Make a public post about how your friend needs to get off their phone.", score: 0, effectiveness: "least-effective", feedback: "You are not showing that you are a caring person. **Publicly shaming your friend** can cause them to feel embarrassed and hurt. You are also not helping them with their problem. This is the least-effective choice." }, { text: "Use an 'I' statement to express your concern to your friend privately.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. You are showing that you are a **caring friend** who is concerned about their well-being. By using a private message, you are not embarrassing them. This demonstrates empathy and good social skills. *You could say something like: 'Hey, I've noticed you've been on your phone a lot lately, and I'm a little worried about you. Is everything okay?'*" }, { text: "Do nothing because it's their life and their choices.", score: 1, effectiveness: "less-effective", feedback: "While you are respecting their privacy, this is a less-effective choice. A **caring person would not ignore the problem**. You are missing an opportunity to help your friend who might be struggling." } ] },
            { cat: 'digital_citizenship', title: "You want to share a funny meme online. You found the meme on a popular page, but you don't know who created it. Question: What do you do?", icon: "image-up", choices: [ { text: "Share the meme without a second thought.", score: 0, effectiveness: "least-effective", feedback: "Sharing content without giving credit is not respectful to the creator's work. This is the least-effective choice because it shows a **lack of integrity and respect** for others' work. A principled person would not do this." }, { text: "Try to find the original creator and tag them in your post.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **principled person shows integrity** by respecting intellectual property. By trying to find the original creator, you are giving credit where it's due, which is an important part of digital citizenship." }, { text: "Add 'Credit to the creator' to your post.", score: 1, effectiveness: "less-effective", feedback: "While you are attempting to give credit, this is a less-effective choice. A more principled person would put in the effort to **find the true source** rather than using a generic phrase. It's a key part of good digital citizenship." } ] },
            { cat: 'social_intelligence', title: "You see a post online with a picture of a friend looking sad and a caption that says, 'Don't talk to me today.' Question: What do you do?", icon: "user-round-minus", choices: [ { text: "Privately message them to ask if they're okay and offer to listen.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **caring person shows empathy** and a desire to help their friends. By reaching out privately, you are respecting their feelings while showing you are there for them. *You could say something like: 'Hey, I saw your post. I'm sorry you're having a tough day. I'm here to listen if you need anything, no pressure to respond.'*" }, { text: "Do nothing. You don't want to bother them since they asked not to be talked to.", score: 1, effectiveness: "less-effective", feedback: "While you are respecting their privacy, this is a less-effective choice. A **caring person would recognize a cry for help** and would not ignore a friend who might be struggling. It's important to reach out and offer support." }, { text: "Leave a public comment asking if they're okay and what's wrong.", score: 0, effectiveness: "least-effective", feedback: "Publicly asking someone what's wrong can be embarrassing and disrespectful to their feelings. This is the least-effective choice because it shows a **lack of empathy and social awareness**. A more caring person would not do this." } ] },
            { cat: 'social_intelligence', title: "Two of your classmates in a group chat for a project start arguing about who should do what part of the project. Question: What do you do?", icon: "split", choices: [ { text: "Try to mediate the conflict by suggesting a compromise or a new way of dividing the work.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A thoughtful communicator can **help resolve conflicts** by suggesting a compromise or a new way of working. You used your communication skills to bring people together and find a solution. *You could say something like: 'Hey guys, let's all calm down. Why don't we try a different approach? How about we split the research first, and then we can work together on the presentation slides?'*" }, { text: "Say nothing and let them work it out on their own.", score: 1, effectiveness: "less-effective", feedback: "Ignoring the problem can make the situation worse and could cause the project to suffer. This is a less-effective choice because it shows a **lack of collaboration and effective communication**. A better communicator would get involved to help." }, { text: "Take a side and start arguing with one of them to help your friend win.", score: 0, effectiveness: "least-effective", feedback: "Taking a side and arguing with a teammate will only make the situation worse and cause more conflict. This is the least-effective choice because it shows a **lack of communicator skills** and is not helpful for your project." } ] },
            { cat: 'digital_citizenship', title: "You're doing research for a history project and find a blog post with great information, but the author isn't a historian. Question: What do you do?", icon: "globe", choices: [ { text: "Use the information anyway because it's a good source.", score: 0, effectiveness: "least-effective", feedback: "You are not being a reflective person. You are using information **without verifying it**. This is the least-effective choice because a reflective person would always check to see if their source is reliable." }, { text: "Use the information but cite it as a blog post.", score: 1, effectiveness: "less-effective", feedback: "While you are attempting to give credit, you are **still using an untrustworthy source**. This is a less-effective choice because a more reflective person would try to find a better source." }, { text: "Cross-reference the information with at least two other, more reliable sources (like a university website or a verified encyclopedia).", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **reflective person is a great researcher** who knows how to verify their information. You are showing that you value the accuracy of your work." } ] },
            { cat: 'professional_brand', title: "You are asked to review a new learning app for school and find a minor bug. Question: What do you do?", icon: "bug", choices: [ { text: "Privately message the developers with a detailed, constructive report of the bug.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. You act as a **thoughtful communicator who is empathetic** to the developers' feelings. By providing constructive feedback, you are helping them improve their app. *You could say something like: 'I'm really enjoying the new app! I noticed a small bug: when I click on the 'Assignments' tab, it sometimes freezes...'" }, { text: "Say nothing and hope the developers find the bug themselves.", score: 1, effectiveness: "less-effective", feedback: "By saying nothing, you miss an opportunity to collaborate and help the developers. This is a less-effective choice because an **effective communicator offers support** and guidance when it is needed." }, { text: "Leave a scathing review online, detailing all the bugs you found and how terrible the app is.", score: 0, effectiveness: "least-effective", feedback: "You are not being a communicator who es empathetic to the developers' feelings. **Leaving a scathing review online can damage their reputation** and is not constructive. This is the least-effective choice." } ] },
            { cat: 'social_intelligence', title: "You see a post from your classmate that makes a joke about a sensitive topic, and some people in the comments are hurt by it. Question: What do you do?", icon: "frown", choices: [ { text: "Privately message your classmate, explaining why the post was hurtful and suggesting they take it down.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. You are showing that you are a **caring person** by protecting your classmate and helping them to become a better digital citizen. This demonstrates empathy and good social skills. *You could say something like: 'Hey, I saw your post. I know you were just joking, but some people in the comments are hurt by it. Maybe it's better to take it down? I just wanted to give you a heads-up.'*" }, { text: "Do nothing because it's not your problem.", score: 1, effectiveness: "less-effective", feedback: "By saying nothing, you are not showing that you are a caring person. You are missing an opportunity to **help your classmate who might be struggling**. This is a less-effective choice." }, { text: "Leave a comment to tell the person who made the post that they should apologize.", score: 0, effectiveness: "least-effective", feedback: "While you're attempting to stand up for what is right, this is a less-effective choice. **Publicly confronting them can make the situation worse**. This is the least-effective choice." } ] },
            { cat: 'privacy_security', title: "You are creating a profile for a new app. It asks for your real name, birthdate, and where you live. Question: What do you do?", icon: "user-lock", choices: [ { text: "Provide all the requested information because it's required to create an account.", score: 0, effectiveness: "least-effective", feedback: "This is the least-effective choice. **Providing too much personal information** can compromise your privacy and security. A thinker would be cautious with their personal data." }, { text: "Close the app and don't create an account.", score: 1, effectiveness: "less-effective", feedback: "While it's good to be concerned about privacy, this is a less-effective choice. A more **reflective person would analyze the situation** and decide if they should create an account." }, { text: "Create an account with a fake name and birthdate to protect your privacy.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **thinker recognizes that some apps ask for unnecessary information** and takes action to protect their identity. This shows you are a thoughtful and responsible person." } ] },
            { cat: 'professional_brand', title: "You are working on a group project with a classmate. You notice they are not doing their part and are just copying and pasting from Wikipedia. Question: What do you do?", icon: "clipboard-copy", choices: [ { text: "Privately message your classmate with a constructive message to tell them that you are worried about their work and offer to help.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **thoughtful communicator can help resolve conflicts** by suggesting a compromise or a new way of working. You used your communication skills to bring people together and find a solution. *You could say something like: 'Hey, I noticed that we're both doing a lot of the same research. Maybe we should try to divide it differently so we can work more efficiently? I'm happy to help you with the rest of your section.'*" }, { text: "Call them out in the group chat for being lazy and not doing their part.", score: 0, effectiveness: "least-effective", feedback: "Publicly calling someone out can be embarrassing and disrespectful. This is the least-effective choice because it shows a **lack of empathy and social awareness**. A more effective communicator would not do this." }, { text: "Just do their work for them so you get a good grade.", score: 1, effectiveness: "less-effective", feedback: "While you are ensuring a good grade, this is a less-effective choice. You are not being a communicator who is empathetic to your peer's feelings. You are missing an opportunity to **collaborate and help your classmate learn**." } ] },
            { cat: 'privacy_security', title: "You are asked to create a new password for a new social media account. You are asked to create a strong password, but you just want to get to the app. Question: What do you do?", icon: "lock", choices: [ { text: "Use a simple password that is easy to remember, like 'password123'.", score: 0, effectiveness: "least-effective", feedback: "Using a simple password that's easy to remember is a risk. This is the least-effective choice because it shows a **lack of self-management skills**. A more balanced person would consider the risks over convenience." }, { text: "Use your school email address as your password.", score: 1, effectiveness: "less-effective", feedback: "Using your school email as your password is a risk. This is a less-effective choice because it shows a **lack of thinking skills**. A more balanced person would consider the risks over convenience." }, { text: "Create a password that is complex and unique to this account.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **balanced person understands the importance of protecting their personal information**. You prioritized security over convenience, which is a key part of maintaining a healthy digital life." } ] },
            { cat: 'social_intelligence', title: "You're in a group chat for a class project, and one of your classmates posts a private message that you sent them to the group chat. Question: What do you do?", icon: "message-square-off", choices: [ { text: "Take a screenshot of the message and post it to social media to call out your classmate.", score: 0, effectiveness: "least-effective", feedback: "Publicly shaming your classmate can cause them to feel embarrassed and hurt. This is the least-effective choice because it shows a **lack of integrity**. A principled person would not do this." }, { text: "Ask the person to delete the message and explain to them why it was wrong.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. You acted as a thoughtful **principled person who is empathetic** to your own feelings. By taking a proactive step, you are protecting yourself and showing that you value your own privacy. *You could say something like: 'Hey, I'm not comfortable with my private messages being shared in the group chat. Could you please take that down?'*" }, { text: "Tell the teacher and ask them to remove the classmate from the group.", score: 1, effectiveness: "less-effective", feedback: "While it's good to seek help, a better first step would be to try to **handle the situation on your own**. This is a less-effective choice because a more principled person would try to resolve the problem directly with the person who caused it." } ] },
            { cat: 'digital_citizenship', title: "You are scrolling through social media, and you see a post from a friend that is promoting a fake charity. Question: What do you do?", icon: "heart-off", choices: [ { text: "Leave a comment on the post saying that the charity is fake.", score: 1, effectiveness: "less-effective", feedback: "While you're attempting to stand up for what is right, this is a less-effective choice. A more caring person would **not publicly embarrass their friend**. You could have helped people privately." }, { text: "Do nothing and ignore the post, so you don't hurt your friend's feelings.", score: 0, effectiveness: "least-effective", feedback: "You are not showing that you are a caring person. By saying nothing, you are missing an opportunity to **help your friend who might be struggling**. This is the least-effective choice." }, { text: "Privately message your friend and explain to them why the charity is fake and why they should take the post down.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **caring person shows empathy** and a desire to help their friends. By reaching out privately, you are protecting your friend and the people who might donate to the fake charity. *You could say something like: 'Hey, I saw your post about the charity, and I think it might be a scam. I found a few articles online that say it's fake, so you should probably take the post down.'*" } ] },
            { cat: 'privacy_security', title: "You are completing an online survey for a product you like. It asks for your parents' names, phone numbers, and income. Question: What do you do?", icon: "form-input", choices: [ { text: "Fill out the survey with your real information to get the reward.", score: 0, effectiveness: "least-effective", feedback: "You gave in to a promise of a reward without considering the risks. This is the least-effective choice because a **thinker would question the motives** behind the offer and recognize that your personal data is more valuable than a free gift card." }, { text: "Close the survey immediately and do not provide the information.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **thinker is critical** of what they see online. You avoided a scam and took a logical, proactive step to ensure your device's security, showing great problem-solving skills." }, { text: "Fill out the survey with fake information.", score: 1, effectiveness: "less-effective", feedback: "While you're attempting to be safe, this is a less-effective choice. You are **still engaging with a potentially malicious source**. A more effective thinker would simply close the survey and not engage." } ] },
            { cat: 'digital_citizenship', title: "You're playing a multiplayer video game and another player is being very aggressive and using offensive language in the chat. Question: What do you do?", icon: "gamepad-2", choices: [ { text: "Report the player's behavior to the platform's moderators and mute/block them.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **principled person acts with integrity** by not supporting bullying. You are showing that you value a positive digital community and that you will not tolerate harassment. *You could say something like: 'I'm reporting this user for harassment.'*" }, { text: "Argue back with them and use your own insults to defend yourself.", score: 0, effectiveness: "least-effective", feedback: "Engaging in a flame war will only escalate the situation. This is the least-effective choice because it shows a **lack of self-control**. A principled person would not do this." }, { text: "Say nothing and leave the game immediately.", score: 1, effectiveness: "less-effective", feedback: "While leaving the game is an option, it **doesn't help solve the problem for other players**. This is a less-effective choice because a more principled person would try to help solve the problem." } ] },
            { cat: 'social_intelligence', title: "A friend posts a picture of you online that you think is unflattering. Question: What do you do?", icon: "camera-off", choices: [ { text: "Politely message your friend and ask them to remove the picture, explaining how you feel.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. You acted as a thoughtful **communicator who is empathetic** to your own feelings. By taking a proactive step, you are protecting yourself and showing that you value your own privacy. *You could say something like: 'Hey, could you please take down that picture of me? I'm just not a fan of how I look in it. Thanks!'*" }, { text: "Post a mean comment on their picture, telling them to take it down.", score: 0, effectiveness: "least-effective", feedback: "You let your emotions get the best of you, which is a key trait of a poor communicator. This is the least-effective choice because it shows a **lack of self-control and good social skills**." }, { text: "Ignore it and do nothing. You don't want to make things awkward.", score: 1, effectiveness: "less-effective", feedback: "By saying nothing, you miss an opportunity to collaborate and help your friend. This is a less-effective choice because a more **effective communicator would offer support** and guidance when it is needed." } ] },
            { cat: 'privacy_security', title: "You receive a message from an unknown number. It says, 'Hey, I think I have the wrong number, but you seem cool. What's your name?' Question: What do you do?", icon: "phone-off", choices: [ { text: "Block the number and don't respond.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **responsible risk-taker** is not reckless. You took a proactive step to protect your digital identity by being cautious about who you connect with and checking your security settings." }, { text: "Reply and give them your name and a brief description of yourself.", score: 0, effectiveness: "least-effective", feedback: "You are taking a **risk with your personal information** without thinking through the consequences. A wiser risk-taker would consider the potential negative outcomes before giving out personal information." }, { text: "Reply and say, 'I think you have the wrong number.'", score: 1, effectiveness: "less-effective", feedback: "While you are respecting their privacy, this is a less-effective choice. A more **reflective person would simply block the number** and not engage." } ] },
            { cat: 'professional_brand', title: "You're in a video meeting for an online class, and you see a classmate live-tweeting the lecture, making fun of the professor. Question: What do you do?", icon: "tv", choices: [ { text: "Do nothing; it's not your business.", score: 0, effectiveness: "least-effective", feedback: "By saying nothing, you miss an opportunity to help your classmate and your professor. This is the least-effective choice because a **thinker would analyze the situation** and try to find a solution." }, { text: "Screenshot the tweets and send them to the professor to get your classmate in trouble.", score: 1, effectiveness: "less-effective", feedback: "While you're trying to help, this is a less-effective choice. A **thinker would try to solve the problem directly** with their classmate. You are also not being a good teammate." }, { text: "Privately message your classmate and explain why what they are doing could be disrespectful and have serious consequences.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **thinker understands the importance of protecting their digital identity and brand**. You took a proactive step to ensure your classmate's privacy and brand. *You could say something like: 'Hey, I saw your live tweets of the lecture, and I'm worried that they could be seen by the professor or the school, and I don't want you to get in trouble.'*" } ] },
            { cat: 'social_intelligence', title: "You discover someone has created a fake social media profile using a friend's name and photos to post mean things about other students. Question: What do you do?", icon: "user-round-x", choices: [ { text: "Report the fake account to the social media platform and then block it.", score: 1, effectiveness: "less-effective", feedback: "While reporting the account is a good step, this is a less-effective choice. A more caring person would do more. You are missing an opportunity to **help your friend who might be struggling**." }, { text: "Privately message your friend and offer to help them report the account and alert others.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A **caring person shows empathy** and a desire to help their friends. By reaching out privately, you are respecting their feelings while showing you are there for them. *You could say something like: 'Hey, I just saw a fake account using your name. I'm so sorry that's happening. I can help you report it and let other people know it's not you if you want.'*" }, { text: "Create a public post to warn everyone about the fake account and call out the person who created it.", score: 0, effectiveness: "least-effective", feedback: "You are not being a caring person. **Publicly calling out the person** who created the account can cause more conflict and make the situation worse. A more caring person would not do this." } ] },
            { cat: 'digital_citizenship', title: "You see a post from a friend that is promoting a charity. The post looks legitimate, but you have never heard of the charity before. Question: What do you do?", icon: "search-check", choices: [ { text: "Donate to the charity and share the post, assuming it's a good cause.", score: 0, effectiveness: "least-effective", feedback: "You are not being an inquiring person. You are giving your money to a potentially malicious source. This is the least-effective choice because an **inquiring person would always question the source of information**." }, { text: "Do nothing and ignore the post.", score: 1, effectiveness: "less-effective", feedback: "While you are respecting their privacy, this is a less-effective choice. You are missing an opportunity to help your friend who might be struggling. A more **inquiring person would not engage with a suspicious offer**." }, { text: "Research the charity to see if it's legitimate before donating or sharing the post.", score: 3, effectiveness: "most-effective", feedback: "This is the most effective choice. A true **inquirer is a great researcher** who knows how to verify their information. You are showing that you value the accuracy and integrity of your work." } ] }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('scenario-containers');
            // Gen physical containers for logic
            for (let i = 1; i <= TOTAL_SCENARIOS; i++) {
                const div = document.createElement('div');
                div.className = 'page h-full hidden';
                div.id = `scenario-page-${i}`;
                div.setAttribute('data-scenario-index', i);
                container.appendChild(div);
                renderScenarioPage(div, i);
            }

            renderLaunchpad();
            window.showPage(0); // Show intro

            // Startup Screen Flow
            const startupScreen = document.getElementById('startup-screen');
            if(startupScreen) {
                const warmUp = () => { if(window.initAudio) window.initAudio(); };
                startupScreen.addEventListener('mousedown', warmUp, { once: true });
                startupScreen.addEventListener('touchstart', warmUp, { once: true });
                
                startupScreen.addEventListener('click', () => {
                    if(window.sfx) window.sfx.powerOn();
                    
                    if (window.currentUser) {
                        window.logFinalScoreToFirestore({ finalScore: 0, rank: "Session Started", sessionId: window.sessionId });
                        window.showPage(0);
                        startupScreen.style.opacity = '0';
                        setTimeout(() => { startupScreen.style.display = 'none'; }, 700);
                    } else {
                        const loginModal = document.getElementById('login-modal');
                        loginModal.classList.remove('hidden-modal');
                        loginModal.classList.add('visible-modal');
                        startupScreen.style.opacity = '0';
                        setTimeout(() => { startupScreen.style.display = 'none'; }, 700);
                    }
                });
            }

            // Controls
            document.getElementById('back-button').addEventListener('click', () => {
                if (currentVisualPage === 2 && currentQueueIndex > 0) {
                    currentQueueIndex--;
                    window.showScenario(categoryQueue[currentQueueIndex]);
                } else if (currentVisualPage === 2 && currentQueueIndex === 0) {
                    window.showPage(1); // Back to Launchpad
                } else if (currentVisualPage === 1) {
                    window.showPage(0);
                }
            });

            document.getElementById('next-button').addEventListener('click', handleNextClick);
            document.getElementById('menu-toggle').addEventListener('click', () => {
                document.getElementById('menu-modal').classList.remove('hidden-modal');
                document.getElementById('menu-modal').classList.add('visible-modal');
            });

            document.getElementById('blueprint-toggle').addEventListener('click', () => {
                document.getElementById('screen').classList.toggle('blueprint-mode');
                document.getElementById('blueprint-toggle').classList.toggle('text-cyan-300');
            });
            
            document.getElementById('fullscreen-toggle').addEventListener('click', () => {
                const frame = document.querySelector('.tablet-frame');
                frame.classList.toggle('expanded-mode');
                document.getElementById('fullscreen-toggle').classList.toggle('text-green-300');
            });
            document.getElementById('current-year').textContent = new Date().getFullYear();
        });

        // --- CORE LOGIC ---

        function handleNextClick() {
            if (currentVisualPage === 0) {
                window.showPage(1); // Launchpad
            } else if (currentVisualPage === 2) { // In Scenario
                if (currentQueueIndex < categoryQueue.length - 1) {
                    currentQueueIndex++;
                    window.showScenario(categoryQueue[currentQueueIndex]);
                } else {
                    window.showPage(1); // Return to Launchpad
                }
            } else if (currentVisualPage === 32) {
                window.location.href = 'https://allgoodacademy.com/jsh/finding-yourself'; // Example exit
            }
        }

        window.showPage = function(viewIndex) {
            currentVisualPage = viewIndex;
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active', 'block'));
            
            const btn = document.getElementById('next-button');
            const btnText = document.getElementById('next-btn-text');
            const backBtn = document.getElementById('back-button');
            backBtn.disabled = false;
            backBtn.classList.remove('opacity-30');
            btn.style.display = 'flex';

            if (viewIndex === 0) {
                document.getElementById('page-1').classList.add('active');
                backBtn.disabled = true; backBtn.classList.add('opacity-30');
                btnText.textContent = "Access Launchpad";
                updateHUDDisplay();
            } else if (viewIndex === 1) {
                document.getElementById('page-2').classList.add('active');
                btn.style.display = 'none'; // Hide next on launchpad
                renderLaunchpad();
                updateHUDDisplay();
            } else if (viewIndex === 32) {
                document.getElementById('page-33').classList.add('active');
                btnText.textContent = "Exit Mission";
                backBtn.style.display = 'none';
                updateFinalScorePage();
                updateHUDDisplay();
            }
            sfx.nav();
        }

        window.startCategory = function(catKey) {
            activeCategory = catKey;
            categoryQueue = [];
            SCENARIO_DATA.forEach((s, idx) => { if (s.cat === catKey) categoryQueue.push(idx + 1); });
            
            // Find first unanswered, or start at 0
            currentQueueIndex = categoryQueue.findIndex(sIdx => answeredScenarioScores[sIdx] === undefined);
            if(currentQueueIndex === -1) currentQueueIndex = 0; // All answered, review mode

            window.showScenario(categoryQueue[currentQueueIndex]);
            sfx.nav();
        }

        window.showScenario = function(sIdx) {
            currentVisualPage = 2; // Scenario view
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active', 'block'));
            const target = document.getElementById(`scenario-page-${sIdx}`);
            if(target) target.classList.add('active');
            
            // Update HUD text
            const hudCatName = CATEGORIES[activeCategory].title;
            document.getElementById('hud-active-mission').textContent = hudCatName;
            document.getElementById('mobile-hud-mission').textContent = hudCatName;
            
            const progressStr = `Scenario ${currentQueueIndex + 1} of ${categoryQueue.length}`;
            document.getElementById('hud-mission-progress').textContent = progressStr;
            
            const isAnswered = answeredScenarioScores[sIdx] !== undefined;
            const btn = document.getElementById('next-button');
            const btnText = document.getElementById('next-btn-text');
            
            btn.style.display = 'flex';
            if (!isAnswered) {
                btn.disabled = true; btn.classList.add('opacity-50');
                btnText.textContent = "Awaiting Action";
            } else {
                btn.disabled = false; btn.classList.remove('opacity-50');
                if (currentQueueIndex === categoryQueue.length - 1) {
                    btnText.textContent = "Complete Mission";
                    btn.classList.add('bg-green-600'); btn.classList.remove('bg-allgood-primary');
                } else {
                    btnText.textContent = "Next Scenario";
                    btn.classList.add('bg-allgood-primary'); btn.classList.remove('bg-green-600');
                }
            }
            
            // Update Global Prog Bar
            const totalAnswered = Object.keys(answeredScenarioScores).length;
            document.getElementById('flex-progress-fill').style.width = `${(totalAnswered / TOTAL_SCENARIOS) * 100}%`;
            
            updateHUDDisplay();
        }

        function updateHUDDisplay() {
            document.getElementById('hud-score').textContent = totalChallengeScore;
            document.getElementById('mobile-hud-score').textContent = totalChallengeScore;
            
            // Calculate Metrics
            let catPoints = { privacy_security: {s:0, max:0}, social_intelligence: {s:0, max:0}, professional_brand: {s:0, max:0}, digital_citizenship: {s:0, max:0} };
            Object.keys(answeredScenarioScores).forEach(sIdx => {
                const s = SCENARIO_DATA[sIdx - 1];
                catPoints[s.cat].s += answeredScenarioScores[sIdx];
                catPoints[s.cat].max += 3;
            });
            
            // Critical Thinking = Privacy, Empathy = Social, Integrity = Brand + Citizenship
            const getPct = (earned, max) => max === 0 ? 0 : Math.round((earned/max)*100);
            
            const ctPct = getPct(catPoints.privacy_security.s, catPoints.privacy_security.max);
            const emPct = getPct(catPoints.social_intelligence.s, catPoints.social_intelligence.max);
            const inPct = getPct(catPoints.professional_brand.s + catPoints.digital_citizenship.s, catPoints.professional_brand.max + catPoints.digital_citizenship.max);

            document.getElementById('metric-critical').textContent = `${ctPct}%`;
            document.getElementById('bar-critical').style.width = `${ctPct}%`;
            document.getElementById('metric-empathy').textContent = `${emPct}%`;
            document.getElementById('bar-empathy').style.width = `${emPct}%`;
            document.getElementById('metric-integrity').textContent = `${inPct}%`;
            document.getElementById('bar-integrity').style.width = `${inPct}%`;
            
            if (currentVisualPage !== 2) {
                document.getElementById('hud-active-mission').textContent = "Standing By";
                document.getElementById('hud-mission-progress').textContent = "Select a mission to begin.";
                document.getElementById('mobile-hud-mission').textContent = "Standing By";
            }
        }

        function renderLaunchpad() {
            const grid = document.getElementById('category-grid');
            grid.innerHTML = '';
            let totalAnsweredAll = 0;

            Object.keys(CATEGORIES).forEach(key => {
                const cat = CATEGORIES[key];
                let total = 0, answered = 0;
                SCENARIO_DATA.forEach((s, idx) => {
                    if (s.cat === key) {
                        total++;
                        if (answeredScenarioScores[idx + 1] !== undefined) answered++;
                    }
                });
                totalAnsweredAll += answered;
                
                const isComplete = answered === total;
                const statusHtml = isComplete 
                    ? `<span class="bg-green-100 text-green-700 text-[10px] font-bold px-2 py-1 rounded"><i data-lucide="check" class="w-3 h-3 inline"></i> CLEARED</span>` 
                    : `<span class="bg-gray-100 text-gray-500 text-[10px] font-bold px-2 py-1 rounded">${answered} / ${total} DONE</span>`;

                const btn = document.createElement('button');
                btn.className = `w-full bg-white border-2 border-gray-200 hover:border-allgood-primary p-5 rounded-xl shadow-sm hover:shadow-md transition-all text-left flex flex-col gap-3 group relative overflow-hidden ${isComplete ? 'opacity-80' : ''}`;
                btn.onclick = () => window.startCategory(key);
                btn.innerHTML = `
                    <div class="absolute right-0 top-0 w-2 h-full ${cat.color} opacity-80"></div>
                    <div class="flex items-center justify-between w-full">
                        <div class="p-3 bg-gray-50 rounded-lg group-hover:bg-orange-50 transition-colors"><i data-lucide="${cat.icon}" class="w-6 h-6 text-allgood-dark group-hover:text-allgood-primary"></i></div>
                        ${statusHtml}
                    </div>
                    <div><h3 class="font-heading font-bold text-lg text-allgood-dark group-hover:text-allgood-primary transition-colors">${cat.title}</h3><p class="text-xs text-gray-500 mt-1">${cat.desc}</p></div>
                `;
                grid.appendChild(btn);
            });

            if (totalAnsweredAll === TOTAL_SCENARIOS) {
                document.getElementById('final-evaluation-container').style.display = 'block';
            }
            lucide.createIcons();
        }

        // --- RENDER ENGINE ---
        function sanitizeText(text) { return text ? text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\*(.*?)\*/g, '<em>$1</em>') : ""; }

        function renderScenarioPage(pageElement, sIdx) {
            const data = SCENARIO_DATA[sIdx - 1];
            const isAnswered = answeredScenarioScores[sIdx] !== undefined;
            
            let uiType = 'system'; 
            const icon = data.icon;
            if (['briefcase'].includes(icon)) uiType = 'email';
            else if (['tv'].includes(icon)) uiType = 'video';
            else if (['gamepad-2'].includes(icon)) uiType = 'game';
            else if (['key', 'lock', 'user-lock', 'form-input', 'wallet', 'bug', 'shield-alert'].includes(icon)) uiType = 'form';
            else if (['message-square', 'message-square-off', 'phone-off', 'split'].includes(icon)) uiType = 'chat';
            else if (['users', 'users-x', 'user-plus', 'heart-off', 'camera-off', 'user-round-minus', 'user-round-x', 'thumbs-down', 'image-up', 'frown'].includes(icon)) uiType = 'social';
            else if (['search', 'globe', 'search-check', 'book-open-check', 'image'].includes(icon)) uiType = 'browser';
            
            let choicesHtml = data.choices.map((choice, index) => {
                let btnClass = 'w-full text-left p-3 rounded-lg text-xs font-medium transition-all shadow-sm mb-2 border';
                if (isAnswered) {
                    if (choice.score === 3) btnClass += ' bg-emerald-50 border-emerald-200 text-emerald-800 ring-1 ring-emerald-300 font-bold';
                    else if (answeredScenarioScores[sIdx] === choice.score) btnClass += choice.score === 1 ? ' bg-amber-50 border-amber-200 text-amber-800 ring-1 ring-amber-300' : ' bg-rose-50 border-rose-200 text-rose-800 ring-1 ring-rose-300';
                    else btnClass += ' bg-gray-50 border-gray-100 text-gray-400 opacity-60';
                } else {
                    btnClass += ' bg-white border-gray-200 text-gray-700 hover:border-allgood-primary hover:bg-orange-50 hover:text-allgood-primary cursor-pointer active:scale-[0.98]';
                }
                const disabledAttr = isAnswered ? 'disabled' : '';
                return `<button class="${btnClass}" onclick="window.selectScenarioChoice(${sIdx}, ${index})" ${disabledAttr}><div class="flex items-start"><span class="font-bold mr-2 opacity-50 text-[10px] uppercase mt-0.5">${String.fromCharCode(65 + index)}</span><span class="leading-snug">${sanitizeText(choice.text)}</span></div></button>`;
            }).join('');

            let feedbackHtml = '';
            if (isAnswered) {
                const chosen = data.choices.find(c => c.score === answeredScenarioScores[sIdx]);
                let bgClass = chosen.score === 3 ? 'bg-emerald-100 border-emerald-200' : (chosen.score === 1 ? 'bg-amber-100 border-amber-200' : 'bg-rose-100 border-rose-200');
                let textClass = chosen.score === 3 ? 'text-emerald-800' : (chosen.score === 1 ? 'text-amber-800' : 'text-rose-800');
                let iconName = chosen.score === 3 ? 'check-circle' : 'alert-circle';
                feedbackHtml = `<div class="${bgClass} border rounded-lg p-4 flex items-start gap-3 shadow-sm mt-3 animate-fade-in"><i data-lucide="${iconName}" class="w-5 h-5 ${textClass} flex-shrink-0 mt-0.5"></i><div><p class="text-[10px] font-bold uppercase tracking-wider ${textClass} mb-1">${chosen.effectiveness.replace('-', ' ')}</p><p class="text-xs ${textClass} leading-relaxed">${sanitizeText(chosen.feedback)}</p></div></div>`;
            }

            const cleanText = data.title;
            const deskDesktop = `background-image: linear-gradient(135deg, #e2e8f0 25%, #cbd5e1 25%, #cbd5e1 50%, #e2e8f0 50%, #e2e8f0 75%, #cbd5e1 75%, #cbd5e1 100%); background-size: 40px 40px;`;
            const choicesWrapper = `<div class="mt-4 pt-4 border-t border-slate-100"><p class="text-[9px] uppercase tracking-widest text-slate-400 font-bold mb-2">Select Response:</p><div class="space-y-1">${choicesHtml}</div></div>`;
            
            // Expanded UI Wrappers
            let visualHtml = '';
            if (uiType === 'chat' || uiType === 'social' || uiType === 'form') {
                // Phone-style interfaces (Keep max-w-md but give them room)
                visualHtml = `
                <div class="relative w-full py-6 md:py-10 px-4 rounded-xl overflow-hidden shadow-inner border border-stone-200 mb-2 transition-all duration-500 bg-slate-100">
                    <div class="hidden md:block absolute inset-0 z-0" style="${deskDesktop}"></div>
                    <div class="relative z-10 mx-auto bg-gray-800 border-[6px] border-gray-800 rounded-[2rem] h-auto min-h-[500px] w-full max-w-md shadow-2xl flex flex-col transform transition-transform md:hover:scale-[1.01] duration-300">
                        <div class="rounded-[1.5rem] overflow-hidden w-full h-full bg-white relative flex flex-col font-sans">
                            <div class="bg-gray-100 h-6 w-full flex justify-between items-center px-4 text-[9px] font-bold text-gray-500 shrink-0"><span>9:41 AM</span><i class="fas fa-battery-full"></i></div>
                            <div class="flex-1 p-4 md:p-6 overflow-y-auto pb-8">
                                <div class="mb-4"><div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 mb-2"><i data-lucide="${icon}" class="w-5 h-5"></i></div><p class="text-sm text-gray-800 leading-snug">${cleanText}</p></div>
                                ${choicesWrapper} ${feedbackHtml}
                            </div>
                        </div>
                    </div>
                </div>`;
            } else {
                // Desktop/Browser style interfaces (Expand to max-w-2xl)
                visualHtml = `
                <div class="relative w-full py-6 md:py-10 px-4 rounded-xl overflow-hidden shadow-inner border border-slate-300 mb-2 transition-all duration-500 bg-slate-200">
                    <div class="hidden md:block absolute inset-0 z-0" style="${deskDesktop}"></div>
                    <div class="relative z-10 bg-gray-800 rounded-t-xl p-2 pb-0 max-w-2xl mx-auto shadow-2xl transform transition-transform md:hover:scale-[1.01] duration-500">
                         <div class="bg-white rounded-t-lg overflow-hidden border-2 border-gray-800 border-b-0 min-h-[400px] font-sans relative flex flex-col">
                            <div class="bg-gray-100 px-3 py-2 flex items-center space-x-2 border-b border-gray-200 shrink-0">
                                <div class="flex space-x-1.5"><div class="w-2.5 h-2.5 rounded-full bg-red-400"></div><div class="w-2.5 h-2.5 rounded-full bg-yellow-400"></div><div class="w-2.5 h-2.5 rounded-full bg-green-400"></div></div>
                                <div class="flex-grow bg-white rounded h-6 mx-2 flex items-center px-2 shadow-inner"><i data-lucide="lock" class="w-3 h-3 text-gray-400 mr-2"></i><span class="text-[10px] text-gray-400 font-mono truncate">app.simulation.env/${uiType}</span></div>
                            </div>
                            <div class="p-6 md:p-8 bg-white flex-1 overflow-y-auto">
                                <div class="flex items-start gap-4 mb-6"><div class="p-3 bg-blue-50 text-blue-600 rounded-lg shrink-0"><i data-lucide="${icon}" class="w-6 h-6"></i></div><p class="text-sm md:text-base text-gray-700 leading-relaxed font-serif">${cleanText}</p></div>
                                <div class="bg-gray-50 p-4 md:p-6 rounded-xl border border-gray-100">${choicesWrapper} ${feedbackHtml}</div>
                            </div>
                         </div>
                    </div>
                </div>`;
            }

            pageElement.innerHTML = `
                <div class="max-w-4xl mx-auto h-full flex flex-col pt-4 md:pt-8 pb-12">
                    <section class="mb-4 border-b border-gray-200 pb-2 flex justify-between items-end shrink-0 px-2">
                        <div><span class="text-[10px] font-bold text-allgood-primary uppercase tracking-widest mb-1 block">${CATEGORIES[data.cat].title}</span><h2 class="text-xl md:text-2xl font-heading font-bold text-allgood-dark">Scenario ${sIdx}</h2></div>
                    </section>
                    <div class="flex-1 w-full">${visualHtml}</div>
                </div>`;
        }

        window.selectScenarioChoice = function(sIdx, cIdx) {
            const data = SCENARIO_DATA[sIdx - 1];
            const chosen = data.choices[cIdx];
            
            if (answeredScenarioScores[sIdx] === undefined) {
                totalChallengeScore += chosen.score;
                answeredScenarioScores[sIdx] = chosen.score;
                window.logScenarioAttempt({ scenarioIndex: sIdx, category: data.cat, choiceIndex: cIdx, score: chosen.score, effectiveness: chosen.effectiveness, question: data.title });
                window.logFinalScoreToFirestore({ finalScore: totalChallengeScore, sessionId: window.sessionId });
            }
            
            renderScenarioPage(document.getElementById(`scenario-page-${sIdx}`), sIdx);
            window.showScenario(sIdx); // Re-run state logic
            
            let iconClass = chosen.score === 3 ? 'bg-green-100 text-green-600' : (chosen.score === 1 ? 'bg-yellow-100 text-yellow-600' : 'bg-red-100 text-red-600');
            let iconInner = chosen.score === 3 ? '<i data-lucide="check-circle" class="w-8 h-8"></i>' : (chosen.score === 1 ? '<i data-lucide="alert-triangle" class="w-8 h-8"></i>' : '<i data-lucide="x-circle" class="w-8 h-8"></i>');
            
            document.getElementById('scenario-title').textContent = `${chosen.effectiveness.toUpperCase().replace('-', ' ')} (${chosen.score} / 3 pts)`;
            document.getElementById('scenario-feedback').innerHTML = sanitizeText(chosen.feedback);
            document.getElementById('scenario-icon').className = `mx-auto w-16 h-16 rounded-full flex items-center justify-center mb-4 text-3xl ${iconClass}`;
            document.getElementById('scenario-icon').innerHTML = iconInner;
            
            document.getElementById('scenario-modal').classList.remove('hidden-modal');
            document.getElementById('scenario-modal').classList.add('visible-modal');
            sfx.tick();
            lucide.createIcons();
        }

        window.closeScenarioModal = () => {
            document.getElementById('scenario-modal').classList.remove('visible-modal');
            document.getElementById('scenario-modal').classList.add('hidden-modal');
            sfx.nav();
        }
        
        window.closeMenuModal = () => {
            document.getElementById('menu-modal').classList.remove('visible-modal');
            document.getElementById('menu-modal').classList.add('hidden-modal');
        }

        window.updateUserDisplay = (name) => { document.getElementById('hud-name').textContent = name; }

        window.handleLogOut = async () => {
            if (window.authSignOut) await window.authSignOut();
            localStorage.clear();
            totalChallengeScore = 0; answeredScenarioScores = {}; window.currentUser = null;
            window.closeMenuModal();
            const startup = document.getElementById('startup-screen');
            startup.style.display = 'flex'; setTimeout(() => startup.style.opacity = '1', 10);
            window.showPage(0);
        };

        window.updateFinalScorePage = function() {
            let currentScore = 0;
            try { const scores = Object.values(answeredScenarioScores); if (scores.length > 0) currentScore = scores.reduce((acc, val) => acc + (Number(val) || 0), 0); } catch(e) {}
            if (currentScore === 0 && totalChallengeScore > 0) currentScore = totalChallengeScore;

            const percentage = Math.round((currentScore / MAX_SCORE) * 100);
            let rank = "Digital Learner", rankColor = "text-red-600", message = "Good start. Reread the feedback and try again.";
            
            if (percentage >= 89) { rank = "Digital Architect"; rankColor = "text-green-600"; message = "Exceptional! You consistently demonstrated the Publisher Mindset."; }
            else if (percentage >= 70) { rank = "Digital Manager"; rankColor = "text-yellow-600"; message = "Solid performance. Review your 'less-effective' choices."; }

            document.getElementById('final-score-value').textContent = `${currentScore} / ${MAX_SCORE}`;
            document.getElementById('final-score-value').className = `text-5xl font-extrabold font-heading ${rankColor}`;
            document.getElementById('final-score-percent').textContent = `(${percentage}% Effectiveness)`;
            document.getElementById('final-rank-heading').textContent = rank;
            document.getElementById('final-rank-heading').className = `text-xl font-heading font-bold mb-2 ${rankColor}`;
            document.getElementById('final-rank-message').textContent = message;

            const badgeBtn = document.getElementById('download-badge-btn');
            const isComplete = Object.keys(answeredScenarioScores).length === TOTAL_SCENARIOS;
            const isPassing = currentScore >= BADGE_THRESHOLD;

            badgeBtn.disabled = true;
            badgeBtn.className = "w-full bg-gray-300 text-white font-bold py-3 rounded shadow-none cursor-not-allowed flex items-center justify-center transition-all duration-300";
            
            if (!isComplete) { badgeBtn.innerHTML = '<i data-lucide="lock" class="w-4 h-4 mr-2"></i>Finish Simulation to Unlock'; } 
            else if (!isPassing) { badgeBtn.innerHTML = '<i data-lucide="lock" class="w-4 h-4 mr-2"></i>Certification Locked (Score < 80)'; } 
            else if (!feedbackSubmitted) { badgeBtn.innerHTML = '<i data-lucide="lock" class="w-4 h-4 mr-2"></i>Submit Feedback to Unlock'; } 
            else { badgeBtn.disabled = false; badgeBtn.className = "w-full bg-allgood-primary hover:bg-allgood-hover text-white font-bold py-3 rounded shadow-lg flex items-center justify-center transition-all duration-300 animate-pulse"; badgeBtn.innerHTML = '<i data-lucide="download" class="w-4 h-4 mr-2"></i>Download Certification'; }
            
            window.logFinalScoreToFirestore({ finalScore: currentScore, maxScore: MAX_SCORE, percentage: percentage, rank: rank, completed: isComplete, isCertified: (isComplete && isPassing), sessionId: window.sessionId });
            lucide.createIcons();
        }

        window.setRating = function(n) { currentStarRating = n; for (let i = 1; i <= 5; i++) { const star = document.getElementById(`star-${i}`); if (i <= n) { star.classList.remove('text-gray-300'); star.classList.add('text-yellow-400'); } else { star.classList.add('text-gray-300'); star.classList.remove('text-yellow-400'); } } sfx.tick(); }
        window.submitFeedback = function() {
            window.logFinalScoreToFirestore({ feedback: document.getElementById('feedback-text').value, rating: currentStarRating, rank: "Feedback", sessionId: window.sessionId });
            document.getElementById('feedback-container').classList.add('hidden');
            document.getElementById('feedback-success').classList.remove('hidden');
            feedbackSubmitted = true;
            window.updateFinalScorePage();
            sfx.success(); 
        }

        window.downloadBadge = function() {
            if (totalChallengeScore < BADGE_THRESHOLD) return;
            const nameText = (window.currentUserName) ? window.currentUserName.toUpperCase() : "DIGITAL ARCHITECT";
            const dateText = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }).toUpperCase();
            const badgeSVG = `<svg width="1200" height="800" viewBox="0 0 1200 800" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="g" width="40" height="40" patternUnits="userSpaceOnUse"><path d="M 40 0 L 0 0 0 40" fill="none" stroke="#E0E0E0" stroke-width="2"/></pattern></defs><rect width="100%" height="100%" fill="#F7F7F7"/><rect width="100%" height="100%" fill="url(#g)"/><rect x="30" y="30" width="1140" height="740" rx="20" fill="none" stroke="#357889" stroke-width="8"/><text x="600" y="100" font-family="Georgia, serif" font-weight="bold" font-size="42" fill="#357889" text-anchor="middle" letter-spacing="2">ALLGOOD ACADEMY</text><text x="600" y="140" font-family="Verdana, sans-serif" font-size="16" fill="#4C4C4C" text-anchor="middle" letter-spacing="4">PRAGMATIC ACTION CERTIFICATION</text><line x1="400" y1="160" x2="800" y2="160" stroke="#D34716" stroke-width="3"/><g transform="translate(300, 400)"><circle cx="0" cy="0" r="140" fill="white" stroke="#357889" stroke-width="5"/><circle cx="100" cy="-100" r="25" fill="#357889"/><circle cx="-100" cy="100" r="25" fill="#357889"/></g><g transform="translate(600, 280)"><text x="0" y="0" font-family="Verdana, sans-serif" font-size="14" fill="#757575" font-weight="bold">CERTIFIED AGENT:</text><text x="0" y="50" font-family="Georgia, serif" font-size="28" fill="#357889" font-weight="bold">${nameText}</text><rect x="0" y="140" width="500" height="220" rx="10" fill="#F7F7F7" stroke="#E5E7EB" stroke-width="3"/><g transform="translate(30, 190)" font-family="Courier New, monospace" font-size="22" fill="#357889"><text x="0" y="0" font-weight="bold">MODULE:</text><text x="160" y="0" fill="#4C4C4C" font-size="18">Digital Decisions</text><text x="0" y="50" font-weight="bold">STATUS:</text><text x="160" y="50" fill="#D34716" font-weight="bold">VERIFIED</text><text x="0" y="100" font-weight="bold">DATE:</text><text x="160" y="100" fill="#4C4C4C">${dateText}</text><text x="0" y="150" font-weight="bold">SCORE:</text><text x="160" y="150" fill="#357889" font-weight="bold">${totalChallengeScore} / ${MAX_SCORE}</text></g></g></svg>`;
            const blob = new Blob([badgeSVG], {type: 'image/svg+xml'});
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a'); link.href = url; link.download = `Allgood-Badge-${nameText}.svg`;
            document.body.appendChild(link); link.click(); document.body.removeChild(link); URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
