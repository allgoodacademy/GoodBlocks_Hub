<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AI Co-Pilot GoodBlock</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons for interactions -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Font Awesome for stars/icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- FIREBASE AND AUTHENTICATION SETUP -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken, GoogleAuthProvider, signInWithPopup, updateProfile, signOut } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, addDoc, collection, serverTimestamp, getDoc } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';
        
        // 1. CONFIGURATION
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "AIzaSyAf2SO8xovrApl52udUUoR1n9WBnERr_ko",
            authDomain: "allgood-academy.firebaseapp.com",
            projectId: "allgood-academy",
            storageBucket: "allgood-academy.firebasestorage.app",
            messagingSenderId: "978829044870",
            appId: "1:978829044870:web:6c780f64230a77ad0ab507",
            measurementId: "G-EN4M7T3BLQ"
        };
        
        const appId = 'allgood-academy'; 
        
        // 2. INITIALIZE SERVICES
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Expose signOut for Hard Reset
        window.authSignOut = () => signOut(auth);

        // 3. GLOBAL STATE
        window.currentUser = null;
        window.currentUserName = "Agent Learner";
        window.currentUserEmail = "";
        window.isAuthReady = false;
        
        // Define Session ID here
        window.sessionId = "session_" + Date.now() + "_" + Math.floor(Math.random() * 1000);
        console.log("[System] Session ID generated:", window.sessionId);

        // 4. AUTH HANDLER
        onAuthStateChanged(auth, async (user) => {
            window.isAuthReady = true;
            if (user) {
                console.log("[Auth] User detected:", user.uid);
                window.currentUser = user;
                
                // FORCE AGENT LEARNER DEFAULT if no display name is explicitly set
                let finalName = user.displayName || "Agent Learner";
                
                // Double check DB if local name is missing
                if (finalName === "Agent Learner" || !user.displayName) {
                    try {
                        const userDoc = await getDoc(doc(db, 'artifacts', appId, 'users', user.uid));
                        if (userDoc.exists() && userDoc.data().displayName) {
                            finalName = userDoc.data().displayName;
                        }
                    } catch(e) { console.log("Profile fetch skipped", e); }
                }

                window.currentUserName = finalName;
                window.currentUserEmail = user.email;
                
                // Note: We do NOT auto-hide the login modal here anymore. 
                // We let the startup screen logic decide when to show/hide based on user intent.
                if(window.SessionManager) window.SessionManager.start(finalName, user.email);
                
            } else {
                console.log("[Auth] No user signed in.");
                window.currentUser = null;
                window.currentUserName = "Agent Learner";
            }
        });

        // 5. IDENTITY ENGINE
        async function ensureUserContainer(user, name, email, isGuest) {
             const userRef = doc(db, 'artifacts', appId, 'users', user.uid);
             try {
                 await setDoc(userRef, {
                     displayName: name,
                     email: email || (isGuest ? null : user.email || null),
                     isGuest: isGuest,
                     lastLogin: serverTimestamp(),
                     lastActiveModule: "AI Co-Pilot"
                 }, { merge: true });
                 console.log("[Identity] User container verified/created.");
             } catch (e) {
                 console.error("[Identity] Failed to create user container:", e);
             }
        }

        // 6. DATABASE LOGGING ENGINE
        window.logToFirestore = async (action, detail, payload = {}) => {
            const user = auth.currentUser;
            if (!user) {
                console.warn("[DB] Skipping write - No User");
                return;
            }
            
            console.log(`[DB] Writing event: ${action} - ${detail}`);

            const sessionRef = doc(db, 'artifacts', appId, 'users', user.uid, 'game_scores', window.sessionId);
            
            const sessionData = {
                gameName: "AI Co-Pilot", 
                lastUpdated: serverTimestamp(),
                user: {
                    uid: user.uid,
                    displayName: window.currentUserName,
                    email: window.currentUserEmail
                }
            };

            if (payload.score) sessionData.finalScore = payload.score; 
            if (payload.rating) sessionData.rating = payload.rating;

            try {
                await setDoc(sessionRef, sessionData, { merge: true });
                
                const logsRef = collection(db, 'artifacts', appId, 'users', user.uid, 'game_scores', window.sessionId, 'logs');
                await addDoc(logsRef, {
                    action: action,
                    detail: detail,
                    payload: payload,
                    timestamp: serverTimestamp()
                });
                console.log("[DB] Write Success.");
            } catch (e) {
                console.error("[DB] Write FAILED:", e);
            }
        };

        window.logModuleCompletion = async (badgeSVGString) => {
            const user = auth.currentUser;
            if (!user) return;
            
            console.log("[DB] Writing Completion Status & Artifact...");
            const sessionRef = doc(db, 'artifacts', appId, 'users', user.uid, 'game_scores', window.sessionId);
            
            try {
                await setDoc(sessionRef, {
                    gameName: "AI Co-Pilot",
                    completed: true,
                    finalScore: 100,
                    rank: "AI Co-Pilot Certified",
                    lastUpdated: serverTimestamp(),
                    badgeArtifact: badgeSVGString,
                    user: {
                        uid: user.uid,
                        displayName: window.currentUserName
                    }
                }, { merge: true });
                console.log("[DB] Completion Status & Badge Artifact Write Success.");
            } catch (e) { console.error("[DB] Completion Status Write FAILED:", e); }
        };

        // 7. LOGIN FUNCTIONS
        window.handleGuestLogin = async () => {
            const nameInput = document.getElementById('user-name-input').value.trim();
            const emailInput = document.getElementById('user-email-input').value.trim();
            const btn = document.getElementById('btn-guest-login');
            
            const originalText = btn.innerText;
            btn.innerText = "Connecting...";
            btn.disabled = true;

            try {
                let user;
                if (auth.currentUser && auth.currentUser.isAnonymous) {
                    user = auth.currentUser;
                } else {
                    const result = await signInAnonymously(auth);
                    user = result.user;
                }
                
                const displayName = nameInput || "Agent Learner";
                await updateProfile(user, { displayName: displayName });
                
                await ensureUserContainer(user, displayName, emailInput, true);

                window.currentUserName = displayName;
                window.currentUserEmail = emailInput;
                
                localStorage.setItem('aa_username', displayName);
                localStorage.setItem('aa_uid', user.uid);
                localStorage.setItem('aa_is_guest', 'true');
                
                console.log("[Auth] Guest login successful. UID:", user.uid);
                if(window.SessionManager) window.SessionManager.start(displayName, emailInput);
                
                document.getElementById('header-welcome-text').textContent = `Welcome, ${displayName}`;
                document.getElementById('login-modal').classList.add('hidden-modal');
                document.getElementById('login-modal').classList.remove('visible-modal');
                
                if(window.showPage) window.showPage(0);
                if(window.sfx) window.sfx.nav();

            } catch (error) {
                console.error("Login Failed", error);
                alert("Connection failed. Please try again.");
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        };

        window.handleGoogleLogin = async () => {
            const provider = new GoogleAuthProvider();
            const btnContainer = document.getElementById('google-icon-container');
            if(btnContainer) btnContainer.classList.add('opacity-50', 'pointer-events-none');
            
            try {
                const result = await signInWithPopup(auth, provider);
                const user = result.user; 
                
                const finalName = user.displayName || "Agent";
                await ensureUserContainer(user, finalName, user.email, false);

                window.currentUserName = finalName;
                window.currentUserEmail = user.email;
                
                localStorage.setItem('aa_username', finalName);
                localStorage.setItem('aa_email', user.email);
                localStorage.setItem('aa_uid', user.uid);
                localStorage.setItem('aa_is_guest', 'false');

                console.log("[Auth] Google login successful. UID:", user.uid);
                if(window.SessionManager) window.SessionManager.start(finalName, user.email);

                document.getElementById('header-welcome-text').textContent = `Welcome, ${finalName}`;
                document.getElementById('login-modal').classList.add('hidden-modal');
                document.getElementById('login-modal').classList.remove('visible-modal');
                
                if(window.showPage) window.showPage(0);
                if(window.sfx) window.sfx.nav();
            } catch (error) {
                console.error("Google Sign-In Error", error);
                alert("Google Sign-In failed. Please try again.");
            } finally {
                 if(btnContainer) btnContainer.classList.remove('opacity-50', 'pointer-events-none');
            }
        };
        
        // Handle initial custom token
        (async function initAuth() {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                try {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } catch (e) {
                    console.warn("Auth token failed, falling back", e);
                }
            }
        })();
    </script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'allgood-primary': '#D34716', // Burnt Orange
                        'allgood-secondary': '#357889', // Deep Cyan
                        'allgood-dark': '#4C4C4C', // Dark Gray
                        'allgood-light': '#F7F7F7', // Light Gray
                        'allgood-hover': '#EB8D69', 
                        'allgood-accent': '#2D6473',
                    },
                    fontFamily: {
                        'heading': ['Georgia', 'serif'],
                        'body': ['Verdana', 'sans-serif'],
                    },
                },
            },
        }
    </script>

    <style>
        /* Base styles from Template */
        body {
            font-family: Verdana, sans-serif;
            background-color: #1a1a1a;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
            background-attachment: fixed;
            min-height: 100vh;
            position: relative;
        }

        h1, h2, h3, h4, h5, h6 { font-family: Georgia, serif; }

        .tablet-frame {
            height: 80vh;
            width: auto;
            aspect-ratio: 16/10; 
            max-width: 1100px;
            max-height: 95vh;
            min-height: 0; min-width: 0;
            background-image: 
                radial-gradient(circle at 0% 0%, rgba(211, 71, 22, 0.35) 0%, transparent 30%),
                radial-gradient(circle at 100% 100%, rgba(211, 71, 22, 0.35) 0%, transparent 30%),
                linear-gradient(135deg, #5c5c5c 0%, #d6d6d6 25%, #8a8a8a 50%, #e0e0e0 75%, #5c5c5c 100%);
            border-radius: 12px;
            padding: 12px; 
            box-shadow: inset 1px 1px 2px rgba(255,255,255, 0.6), inset -1px -1px 2px rgba(0,0,0, 0.8), 0 30px 60px -12px rgba(0, 0, 0, 0.8), 0 0 0 1px #111;
            border: 1px solid #333;
            position: relative;
            margin: 20px auto;
            transition: width 0.3s, height 0.3s, padding 0.3s;
        }

        .tablet-frame::before {
            content: '';
            position: absolute;
            top: 10px; left: 10px; right: 10px; bottom: 10px;
            border-radius: 6px;
            background: #111;
            z-index: 0;
        }

        .screen-container {
            width: 100%;
            height: 100%;
            background-color: #F7F7F7;
            position: relative;
            z-index: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column; 
            border-radius: 4px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }

        /* Scrollbar */
        .page::-webkit-scrollbar { width: 14px; }
        .page::-webkit-scrollbar-track { background: #e5e5e5; border-left: 1px solid #d1d5db; }
        .page::-webkit-scrollbar-thumb { background-color: #D34716; border-radius: 7px; border: 3px solid #e5e5e5; }
        .page::-webkit-scrollbar-thumb:hover { background-color: #EB8D69; }

        /* Modal Styles */
        .modal-transition { transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out; }
        .hidden-modal { opacity: 0; pointer-events: none; transform: translateY(-10px); }
        .visible-modal { opacity: 1; pointer-events: auto; transform: translateY(0); }

        /* Layout Structure */
        .navbar-content { flex: 0 0 60px; z-index: 20; }
        .page { flex: 1 1 auto; overflow-y: auto; padding: 20px; position: relative; display: none; width: 100%; }
        .page.active { display: block; }
        .footer-content { flex: 0 0 60px; z-index: 20; background-color: white; border-top: 1px solid #e5e7eb; position: relative; }
        
        #flex-progress-bar { height: 4px; width: 100%; background-color: #eee; position: absolute; top: 0; left: 0; }
        #flex-progress-fill { height: 100%; background-color: #D34716; width: 0%; transition: width 0.3s ease; }

        /* Blueprint Mode */
        .blueprint-mode { background-color: #0f172a !important; color: #94a3b8 !important; }
        .blueprint-mode .page { background-color: #0f172a !important; }
        .blueprint-mode h1, .blueprint-mode h2, .blueprint-mode h3, .blueprint-mode strong { color: #38bdf8 !important; }
        .blueprint-mode .bg-white { background-color: #1e293b !important; border-color: #334155 !important; color: #cbd5e1 !important; }
        .blueprint-mode .text-allgood-dark { color: #e2e8f0 !important; }
        .blueprint-mode .bg-gray-100, .blueprint-mode .bg-gray-50 { background-color: #0f172a !important; border-color: #1e293b !important; }
        .blueprint-mode .accordion-content { background-color: #0f172a !important; border-color: #334155 !important; color: #94a3b8 !important; }
        .blueprint-mode .footer-content { background-color: #1e293b !important; border-top-color: #334155 !important; color: #94a3b8 !important; }
        .blueprint-mode .footer-content a { color: #38bdf8 !important; }
        .blueprint-mode .footer-content #back-button { color: #94a3b8 !important; }

        /* Focus Mode */
        .tablet-frame.focus-mode { 
            position: absolute !important; top: 0 !important; left: 0 !important; right: 0 !important; bottom: 0 !important; 
            width: 100% !important; height: 100% !important;
            aspect-ratio: auto !important; max-width: none !important; max-height: none !important; 
            min-height: 0 !important;
            margin: 0 !important; padding: 0 !important; 
            background: #F7F7F7 !important; border: none !important; border-radius: 0 !important; 
            box-shadow: none !important; z-index: 99999 !important; 
            background-image: none !important;
        }
        .tablet-frame.focus-mode::before { display: none; }
        .tablet-frame.focus-mode .screen-container { border-radius: 0; box-shadow: none; height: 100%; }
        .tablet-frame.focus-mode .footer-content { padding-bottom: 0; }
        body.is-focused main { padding: 0 !important; }

        /* Mobile Layout */
        @media (max-width: 768px) {
            html, body { width: 100%; height: 100%; margin: 0; padding: 0 !important; overflow: hidden !important; position: fixed; inset: 0; overscroll-behavior: none; }
            main { width: 100vw; height: 100dvh; position: fixed; inset: 0; padding: 0 !important; display: flex; flex-direction: column; z-index: 0; }
            .tablet-frame { position: relative !important; width: 100% !important; height: 100% !important; max-width: none !important; max-height: none !important; min-height: 0 !important; aspect-ratio: auto !important; margin: 0 !important; padding: 0 !important; border: none !important; border-radius: 0 !important; background-image: none !important; box-shadow: none !important; display: flex; flex-direction: column; }
            .tablet-frame::before { display: none; }
            .screen-container { flex: 1; width: 100%; height: 100%; display: flex; flex-direction: column; border-radius: 0 !important; box-shadow: none !important; overflow: hidden; }
            .navbar-content { padding-top: max(env(safe-area-inset-top), 5px); }
            .footer-content { z-index: 100; padding-bottom: max(env(safe-area-inset-bottom), 15px); height: auto; }
        }

        /* --- INTERACTIVE ELEMENTS --- */
        /* Flip Card */
        .flip-card { background-color: transparent; width: 100%; height: 240px; perspective: 1000px; cursor: pointer; }
        .flip-card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; }
        .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
        .flip-card-front, .flip-card-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 1.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .flip-card-front { background-color: white; border: 1px solid #e5e7eb; }
        .flip-card-back { background-color: #357889; color: white; transform: rotateY(180deg); }

        /* Drag and Drop (ACT Sort) */
        .draggable-item { cursor: grab; transition: all 0.2s ease; user-select: none; }
        .draggable-item.dragging { opacity: 0.5; transform: scale(1.05); cursor: grabbing; }
        .drop-zone { transition: all 0.2s; }
        .drop-zone.drag-over { background-color: #eff6ff; border-color: #357889; transform: scale(1.02); }
        .drop-zone.correct-flash { animation: flashGreen 0.5s ease; }
        .drop-zone.error-flash { animation: flashRed 0.5s ease; }
        
        @keyframes flashGreen { 0% { background-color: #d1fae5; border-color: #10b981; } 100% { background-color: #f9fafb; border-color: #e5e7eb; } }
        @keyframes flashRed { 0% { background-color: #fee2e2; border-color: #ef4444; } 100% { background-color: #f9fafb; border-color: #e5e7eb; } }

        /* Tone Dial */
        .dial-container { width: 200px; height: 200px; position: relative; margin: 0 auto; transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .dial-knob { width: 100%; height: 100%; border-radius: 50%; background: radial-gradient(circle at 30% 30%, #4C4C4C, #1a1a1a); box-shadow: 0 10px 20px rgba(0,0,0,0.3); position: relative; border: 4px solid #333; }
        .dial-marker { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); width: 4px; height: 15px; background-color: #D34716; border-radius: 2px; }

        /* Commitment Card */
        .commit-card { transition: transform 0.3s; }
        .commit-card.active { transform: scale(0.98); }
        .commit-card.signed { border-color: #10b981; background-color: #ecfdf5; }
    </style>
</head>
<body class="flex flex-col min-h-screen text-allgood-dark font-body overflow-y-auto">

    <main class="flex-grow flex items-center justify-center py-8">
        <div class="tablet-frame">
            <div class="screen-container" id="screen">

                <!-- 1. STARTUP SCREEN (Matches OS Template) -->
                <div id="startup-screen" class="absolute inset-0 z-[300] flex flex-col items-center justify-center cursor-pointer transition-opacity duration-700 ease-in-out bg-gradient-to-br from-allgood-secondary to-allgood-accent">
                    <div class="group flex flex-col items-center justify-center text-center h-full w-full relative">
                        <div class="flex-grow flex flex-col items-center justify-center px-4">
                            <div class="relative">
                                <div class="absolute inset-0 bg-white/10 blur-2xl rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                                <h2 class="text-xl md:text-3xl font-heading font-bold text-white mb-1 relative z-10">Allgood Academy</h2>
                                <h1 class="text-4xl md:text-6xl font-heading font-bold text-allgood-primary tracking-tighter relative z-10 drop-shadow-md">GoodBlock</h1>
                                <p class="mt-2 text-white/80 relative z-10 font-body text-sm font-semibold">AI Co-Pilot</p>
                            </div>
                            <p class="mt-12 text-white/80 text-xs tracking-[0.3em] uppercase font-medium group-hover:text-white transition-colors animate-pulse font-body">Click to Power Up</p>
                        </div>
                        <div class="absolute bottom-10 w-full text-center">
                            <p class="text-white/40 text-xs font-body tracking-wide">Powered by the <span class="text-white/60 font-bold">Allgood Academy</span></p>
                        </div>
                    </div>
                </div>

                <!-- 2. Header (Navigation & Controls) -->
                <header class="bg-allgood-secondary shadow-md navbar-content flex items-center">
                    <div class="w-full px-4 flex items-center justify-between h-full">
                        <div class="flex items-center overflow-hidden">
                            <!-- HARDCODED DEFAULT: Agent Learner (Will update if auth loads different name) -->
                            <div id="header-welcome-text" class="text-white font-heading font-bold text-lg tracking-tight truncate mr-4 select-none">Welcome, Agent Learner</div>
                            <div class="flex shrink-0 items-center bg-black/20 rounded-full px-3 py-1 border border-white/10 shadow-inner backdrop-blur-sm">
                                <span class="text-[10px] uppercase tracking-wider text-white/60 mr-2 font-heading font-bold">Page</span>
                                <span id="header-page-indicator" class="text-xs font-bold text-white font-body tabular-nums">1 / 14</span>
                            </div>
                        </div>
                        <div class="flex items-center space-x-1 shrink-0 relative">
                            <!-- Control Cluster -->
                            <button id="home-button" class="text-gray-200 hover:text-white transition-colors p-2 rounded-full hover:bg-white/10 mr-2" title="Go to Cover (Long-Press to System Menu)"><i data-lucide="home" class="w-6 h-6"></i></button>
                            <div class="h-6 w-px bg-white/20 mx-1"></div>
                            <!-- FIX: Blueprint toggle is now MOON -->
                            <button id="blueprint-toggle" class="text-gray-200 hover:text-cyan-300 transition-colors p-2 rounded-full hover:bg-white/10" title="Blueprint Mode"><i data-lucide="moon" class="w-5 h-5"></i></button>
                            <button id="fullscreen-toggle" class="text-gray-200 hover:text-green-300 transition-colors p-2 rounded-full hover:bg-white/10" title="Focus Mode"><i data-lucide="maximize" class="w-5 h-5"></i></button>
                            <button id="menu-toggle" class="text-gray-200 hover:text-white transition-colors p-2 rounded-full hover:bg-white/10" title="Jump to Page"><i data-lucide="menu" class="w-7 h-7"></i></button>
                        </div>
                    </div>
                </header>

                <!-- 3. Login Modal (Standardized from Airport Navigator) -->
                <div id="login-modal" class="absolute inset-0 z-[200] bg-allgood-dark/95 flex items-center justify-center p-6 visible-modal modal-transition">
                    <div class="bg-white rounded-lg shadow-2xl p-8 max-w-sm w-full text-center border-t-4 border-allgood-primary">
                        <div class="mb-6"><h2 class="text-3xl font-heading font-bold text-allgood-dark">Allgood<span class="text-allgood-primary">Academy</span></h2></div>
                        <h2 class="text-xl font-bold text-allgood-dark mb-2 font-heading">Welcome</h2>
                        <div class="flex items-center justify-center gap-2 mb-6 relative">
                            <p class="text-gray-500 text-sm font-body">Please sign in to start.</p>
                            <button id="policy-trigger" class="group relative flex items-center text-allgood-primary hover:text-allgood-hover transition-colors focus:outline-none">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                                <span class="text-xs font-bold underline decoration-dotted underline-offset-2">Why?</span>
                                <div class="absolute top-full left-1/2 transform -translate-x-1/2 mt-3 w-64 p-3 bg-gray-800 text-white text-xs text-left rounded shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible group-focus:opacity-100 group-focus:visible transition-all duration-200 z-50 font-body leading-relaxed border border-gray-700 pointer-events-none">
                                    <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-b-gray-800"></div>
                                    <strong class="block text-allgood-primary mb-1 uppercase tracking-wide text-[10px]">Why do we ask?</strong>
                                    <p class="mb-2 text-gray-300">We use your name to personalize your badge. <strong>Performance data is logged in real-time</strong> to improve the GoodBlock experience. All personal data is <strong>kept confidential</strong> and <strong>never sold.</strong></p>
                                    <div class="border-t border-gray-700 my-1 pt-1"></div>
                                    <p class="text-gray-300"><strong>Email (Optional):</strong> Enter to join the Allgood Academy community.</p>
                                </div>
                            </button>
                        </div>
                        <input type="text" id="user-name-input" placeholder="Your Name (Optional)" class="w-full border border-gray-300 rounded p-3 mb-3 focus:ring-2 focus:ring-allgood-primary focus:border-transparent outline-none transition-all font-body">
                        <input type="email" id="user-email-input" placeholder="Your Email (Optional)" class="w-full border border-gray-300 rounded p-3 mb-6 focus:ring-2 focus:ring-allgood-primary focus:border-transparent outline-none transition-all font-body">
                        <button id="btn-guest-login" onclick="window.handleGuestLogin()" class="w-full bg-allgood-primary hover:bg-allgood-hover text-white font-bold py-3 rounded shadow-md transition-transform transform hover:scale-[1.02] active:scale-[0.98] font-body uppercase">Start Mission</button>
                        <div class="mt-4 flex items-center justify-center space-x-2"><div class="h-px w-10 bg-gray-200"></div><p class="text-xs text-gray-500 uppercase font-bold">OR</p><div class="h-px w-10 bg-gray-200"></div></div>
                        <button id="google-icon-container" onclick="window.handleGoogleLogin()" class="mt-4 p-2 rounded-full border border-gray-300 shadow-md hover:shadow-lg transition-all duration-200 hover:scale-105 active:scale-95 bg-white flex items-center justify-center mx-auto">
                            <svg class="w-6 h-6" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                        </button>
                    </div>
                </div>

                <!-- 4. Menu Modal -->
                <div id="menu-modal" class="hidden-modal absolute inset-0 z-[100] bg-black/60 flex justify-end modal-transition">
                    <div class="w-72 h-full bg-white shadow-xl flex flex-col border-l border-gray-200">
                        <div class="p-4 border-b border-gray-200 flex justify-between items-center bg-gray-50">
                            <span class="font-bold text-allgood-dark font-heading">Mission Log</span>
                            <button id="close-menu" class="text-gray-500"><i data-lucide="x" class="w-6 h-6"></i></button>
                        </div>
                        <div class="p-2 overflow-y-auto flex-grow space-y-1 text-sm font-body">
                            <button class="menu-link w-full text-left px-4 py-2 hover:bg-gray-100 text-gray-600 font-bold" data-page="0">1. Cover</button>
                            <button class="menu-link w-full text-left px-4 py-2 hover:bg-gray-100 text-gray-600" data-page="1">2. The Myth</button>
                            <button class="menu-link w-full text-left px-4 py-2 hover:bg-gray-100 text-gray-600" data-page="2">3. The Paradigm</button>
                            <div class="px-4 py-1 text-xs font-bold text-gray-400 uppercase tracking-wider mt-2">The ACT Framework</div>
                            <button class="menu-link w-full text-left px-4 py-2 hover:bg-gray-100 text-gray-600" data-page="3">4. Overview</button>
                            <button class="menu-link w-full text-left px-4 py-2 hover:bg-gray-100 text-gray-600" data-page="4">5. Action</button>
                            <button class="menu-link w-full text-left px-4 py-2 hover:bg-gray-100 text-gray-600" data-page="5">6. Context</button>
                            <button class="menu-link w-full text-left px-4 py-2 hover:bg-gray-100 text-gray-600" data-page="6">7. Tone</button>
                            <button class="menu-link w-full text-left px-4 py-2 hover:bg-gray-100 text-gray-600 font-bold text-allgood-primary" data-page="7">8. ACT Sort Drill</button>
                            <div class="px-4 py-1 text-xs font-bold text-gray-400 uppercase tracking-wider mt-2">Application</div>
                            <button class="menu-link w-full text-left px-4 py-2 hover:bg-gray-100 text-gray-600" data-page="8">9. Daily Habits</button>
                            <button class="menu-link w-full text-left px-4 py-2 hover:bg-gray-100 text-gray-600" data-page="9">10. Crisis Scenario</button>
                            <button class="menu-link w-full text-left px-4 py-2 hover:bg-gray-100 text-gray-600" data-page="10">11. The Decision</button>
                            <button class="menu-link w-full text-left px-4 py-2 hover:bg-gray-100 text-gray-600" data-page="11">12. Outcome</button>
                            <button class="menu-link w-full text-left px-4 py-2 hover:bg-gray-100 text-gray-600" data-page="12">13. The Challenge</button>
                            <button class="menu-link w-full text-left px-4 py-2 hover:bg-gray-100 text-gray-600 font-bold text-allgood-secondary" data-page="13">14. Certification</button>
                        </div>
                    </div>
                </div>

                <!-- 5. System Menu Modal -->
                <div id="system-menu-modal" class="hidden-modal absolute inset-0 z-[250] bg-black/80 flex items-center justify-center p-6 modal-transition backdrop-blur-sm">
                    <div class="bg-white rounded-lg shadow-2xl p-8 max-w-sm w-full text-center border-t-4 border-gray-500">
                        <div class="mb-4">
                            <i data-lucide="settings" class="w-12 h-12 mx-auto text-gray-400"></i>
                        </div>
                        <h2 class="text-xl font-heading font-bold text-allgood-dark mb-2">System Menu</h2>
                        <p class="text-sm text-gray-500 mb-6 font-body">Select an option to proceed.</p>
                        
                        <div class="space-y-3">
                            <button onclick="handleSystemReset()" class="w-full bg-red-50 hover:bg-red-100 text-red-600 font-bold py-3 rounded border border-red-200 shadow-sm transition-colors flex items-center justify-center">
                                <i data-lucide="power" class="w-4 h-4 mr-2"></i> Reset Mission
                            </button>
                            <button onclick="handleSystemExit()" class="w-full bg-gray-100 hover:bg-gray-200 text-allgood-dark font-bold py-3 rounded border border-gray-300 shadow-sm transition-colors flex items-center justify-center">
                                <i data-lucide="log-out" class="w-4 h-4 mr-2"></i> Exit to Dashboard
                            </button>
                            <button onclick="closeSystemMenu()" class="w-full text-gray-400 hover:text-gray-600 font-bold py-2 text-sm mt-2">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>

                <!-- --- PAGES --- -->

                <!-- Page 1: Cover -->
                <div class="page active" id="page-1">
                    <div class="flex flex-col items-center justify-start h-full text-center px-2 pt-12">
                        <div class="mb-6"><h2 class="text-2xl font-heading font-bold text-allgood-dark">Allgood<span class="text-allgood-primary">Academy</span></h2></div>
                        <h1 class="text-3xl sm:text-4xl font-heading font-bold text-allgood-dark mb-8 leading-tight tracking-tight">The AI Co-Pilot:<br><span class="text-allgood-primary">GoodBlock</span></h1>
                        
                        <div class="w-full max-w-lg text-left mx-auto space-y-4">
                            <!-- Accordion 1: About this module -->
                            <div class="border border-gray-200 rounded-lg overflow-hidden shadow-md">
                                <button class="accordion-toggle w-full bg-white p-4 flex justify-between items-center hover:bg-gray-50 hover:border-allgood-primary transition-all group">
                                    <span class="font-bold text-allgood-dark text-base group-hover:text-allgood-primary transition-colors font-heading">About this module</span>
                                    <svg class="accordion-icon h-5 w-5 text-gray-400 transform transition-transform duration-300 group-hover:text-allgood-primary" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                                </button>
                                <div class="hidden accordion-content bg-gray-50 border-t border-gray-200 p-5 text-gray-600 shadow-inner text-sm font-body">
                                    <p class="mb-4 leading-relaxed">The world of work is changing. You don't need more tools; you need a new mindset. In this session, you will learn the <strong>one skill</strong> that matters most.</p>
                                    <div class="flex items-center text-xs font-bold text-allgood-primary uppercase tracking-wide">
                                        <i data-lucide="clock" class="w-4 h-4 mr-2"></i> 15 Minute Mission
                                    </div>
                                </div>
                            </div>

                            <!-- Accordion 2: How to use this GoodBlock -->
                            <div class="border border-gray-200 rounded-lg overflow-hidden shadow-md">
                                <button class="accordion-toggle w-full bg-white p-4 flex justify-between items-center hover:bg-gray-50 hover:border-allgood-primary transition-all group">
                                    <span class="font-bold text-allgood-dark text-base group-hover:text-allgood-primary transition-colors font-heading">How to use this GoodBlock</span>
                                    <svg class="accordion-icon h-5 w-5 text-gray-400 transform transition-transform duration-300 group-hover:text-allgood-primary" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                                </button>
                                <div class="hidden accordion-content bg-gray-50 border-t border-gray-200 p-5 text-gray-600 shadow-inner text-xs font-body">
                                    <p class="mb-4 text-sm text-allgood-dark">This GoodBlock is your interactive workspace. Use the <strong>Control Cluster</strong> in the top right to customize your environment.</p>
                                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                        <div class="flex items-start"><div class="p-1.5 bg-white rounded border border-gray-300 mr-3 text-allgood-primary"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg></div><div><strong class="text-allgood-dark block mb-0.5">Home & Reset</strong><span class="text-gray-500 leading-snug">Click to return to cover. <strong>Hold for 2s</strong> to hard reset & sign out.</span></div></div>
                                        <div class="flex items-start"><div class="p-1.5 bg-white rounded border border-gray-300 mr-3 text-cyan-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg></div><div><strong class="text-allgood-dark block mb-0.5">Blueprint Mode</strong><span class="text-gray-500 leading-snug">Toggle high-contrast Dark Mode for low-light environments.</span></div></div>
                                        <div class="flex items-start"><div class="p-1.5 bg-white rounded border border-gray-300 mr-3 text-green-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m5 5v-4m0 4h-4" /></svg></div><div><strong class="text-allgood-dark block mb-0.5">Focus Mode</strong><span class="text-gray-500 leading-snug">Maximize workspace. Removes the frame for mobile devices.</span></div></div>
                                        <div class="flex items-start"><div class="p-1.5 bg-white rounded border border-gray-300 mr-3 text-allgood-dark"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg></div><div><strong class="text-allgood-dark block mb-0.5">Table of Contents</strong><span class="text-gray-500 leading-snug">Jump directly to any section without losing progress.</span></div></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Page 2: The Myth -->
                <div class="page" id="page-2">
                    <section class="mb-6 border-b border-gray-200 pb-4"><h2 class="text-2xl font-heading font-bold text-allgood-dark">The Headlines</h2></section>
                    <div class="bg-gray-100 p-8 rounded-lg text-center mb-8 border border-gray-300">
                        <h3 id="myth-text" class="text-3xl font-heading font-bold text-gray-800 transition-all">"AI IS A JOB KILLER"</h3>
                        <p id="myth-sub" class="text-sm text-gray-500 mt-2">Click the switch to see the reality.</p>
                    </div>
                    
                    <div class="flex justify-center">
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="myth-toggle" class="sr-only peer" onchange="toggleMyth()">
                            <div class="w-14 h-7 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-allgood-primary"></div>
                            <span class="ml-3 text-sm font-medium text-gray-900">Reveal Truth</span>
                        </label>
                    </div>
                    
                    <div id="myth-reveal" class="hidden mt-8 p-6 bg-white border-l-4 border-allgood-primary shadow-sm">
                        <p class="text-lg text-gray-700 leading-relaxed"><strong>Reality:</strong> AI is a <em>Task</em> Killer.</p>
                        <p class="text-sm text-gray-600 mt-2">It automates the repetitive drudgery so you can focus on the creative, human work only you can do.</p>
                    </div>
                </div>

                <!-- Page 3: The Paradigm -->
                <div class="page" id="page-3">
                    <section class="mb-6 border-b border-gray-200 pb-4"><h2 class="text-2xl font-heading font-bold text-allgood-dark">The Paradigm Shift</h2></section>
                    <p class="text-sm text-gray-600 mb-6">Stop trying to fly the plane alone. <strong>Tap the card</strong> to see your new role.</p>
                    
                    <div class="flip-card" onclick="this.classList.toggle('flipped'); sfx.tick()">
                        <div class="flip-card-inner">
                            <div class="flip-card-front">
                                <i data-lucide="user" class="w-16 h-16 text-gray-300 mb-4"></i>
                                <h3 class="text-xl font-bold text-gray-700">The Solo Pilot</h3>
                                <p class="text-xs text-gray-500 mt-2">Overwhelmed. Flying blindly. Doing everything manually.</p>
                                <p class="text-xs text-allgood-secondary font-bold mt-4 uppercase">Old Way</p>
                            </div>
                            <div class="flip-card-back">
                                <i data-lucide="plane" class="w-16 h-16 text-white mb-4"></i>
                                <h3 class="text-xl font-bold text-white">The Co-Pilot Commander</h3>
                                <p class="text-sm text-white/90 mt-2">You set the destination. AI handles the turbulence.</p>
                                <p class="text-xs text-white/70 font-bold mt-4 uppercase">New Way</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Page 4: ACT Framework -->
                <div class="page" id="page-4">
                    <section class="mb-6 border-b border-gray-200 pb-4">
                        <h2 class="text-2xl font-heading font-bold text-allgood-dark">The ACT Framework</h2>
                        <p class="text-xs font-bold text-allgood-primary uppercase tracking-widest mt-1">Pragmatic Skill #1</p>
                    </section>
                    <p class="text-sm text-gray-600 mb-6">The difference between a clumsy intern and a brilliant assistant is how you talk to them. Use <strong>ACT</strong> for every prompt.</p>

                    <div class="space-y-3">
                        <div class="border border-gray-200 rounded-lg overflow-hidden">
                            <button class="w-full p-4 text-left bg-gray-50 hover:bg-gray-100 flex justify-between items-center accordion-toggle">
                                <span class="font-bold text-allgood-dark text-lg"><span class="text-allgood-primary">A</span>CTION</span>
                                <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400"></i>
                            </button>
                            <div class="hidden p-4 bg-white text-sm text-gray-600 border-t border-gray-200 accordion-content">
                                <strong>Tell it exactly what to do.</strong> Use strong verbs. "Draft", "Summarize", "Analyze", "Translate". Don't just say "Write".
                            </div>
                        </div>
                        <div class="border border-gray-200 rounded-lg overflow-hidden">
                            <button class="w-full p-4 text-left bg-gray-50 hover:bg-gray-100 flex justify-between items-center accordion-toggle">
                                <span class="font-bold text-allgood-dark text-lg"><span class="text-allgood-primary">C</span>ONTEXT</span>
                                <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400"></i>
                            </button>
                            <div class="hidden p-4 bg-white text-sm text-gray-600 border-t border-gray-200 accordion-content">
                                <strong>Garbage in, garbage out.</strong> Who is the audience? What is the background? Feed the AI the details it needs to succeed.
                            </div>
                        </div>
                        <div class="border border-gray-200 rounded-lg overflow-hidden">
                            <button class="w-full p-4 text-left bg-gray-50 hover:bg-gray-100 flex justify-between items-center accordion-toggle">
                                <span class="font-bold text-allgood-dark text-lg"><span class="text-allgood-primary">T</span>ONE</span>
                                <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400"></i>
                            </button>
                            <div class="hidden p-4 bg-white text-sm text-gray-600 border-t border-gray-200 accordion-content">
                                <strong>You are the conductor.</strong> Professional? Empathetic? Concise? Authoritative? Set the mood explicitly.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Page 5: Action Drill -->
                <div class="page" id="page-5">
                    <section class="mb-6 border-b border-gray-200 pb-4"><h2 class="text-2xl font-heading font-bold text-allgood-dark">Deep Dive: Action</h2></section>
                    <div class="bg-white p-6 rounded shadow-sm border border-gray-200 text-center">
                        <p class="text-gray-500 text-xs uppercase font-bold mb-4">Weak Prompt</p>
                        <h3 id="action-prompt" class="text-2xl font-serif text-gray-400 mb-8 transition-colors">"Write an email about the meeting."</h3>
                        
                        <button onclick="upgradeAction()" class="bg-allgood-dark hover:bg-black text-white px-6 py-3 rounded-full font-bold shadow-lg transition-transform transform active:scale-95">
                            <i data-lucide="zap" class="w-4 h-4 inline mr-2"></i>Upgrade to ACT
                        </button>

                        <div id="action-result" class="hidden mt-8">
                            <p class="text-allgood-primary text-xs uppercase font-bold mb-2">Strong Prompt</p>
                            <h3 class="text-xl font-bold text-allgood-dark">"<u>Draft</u> a follow-up email to the engineering team summarizing the key decisions."</h3>
                            <p class="text-xs text-gray-500 mt-2">Specificity drives results.</p>
                        </div>
                    </div>
                </div>

                <!-- Page 6: Context Stack -->
                <div class="page" id="page-6">
                    <section class="mb-6 border-b border-gray-200 pb-4"><h2 class="text-2xl font-heading font-bold text-allgood-dark">Deep Dive: Context</h2></section>
                    <p class="text-sm text-gray-600 mb-8">The AI doesn't know your boss, your product, or your deadline. You have to stack the context.</p>
                    
                    <div class="space-y-2 relative">
                        <div class="p-4 bg-gray-100 rounded border border-gray-300 z-10 relative">
                            <span class="font-bold text-gray-500">1. The Task:</span> "Summarize this report."
                        </div>
                        <div class="p-4 bg-gray-200 rounded border border-gray-400 -mt-2 mx-2 z-20 relative shadow-sm">
                            <span class="font-bold text-gray-600">2. The Audience:</span> "...for the CEO..."
                        </div>
                        <div class="p-4 bg-allgood-secondary text-white rounded border border-allgood-accent -mt-2 mx-4 z-30 relative shadow-md">
                            <span class="font-bold text-cyan-200">3. The Goal:</span> "...highlighting only the risks and budget overruns."
                        </div>
                    </div>
                </div>

                <!-- Page 7: Tone Dial -->
                <div class="page" id="page-7">
                    <section class="mb-6 border-b border-gray-200 pb-4"><h2 class="text-2xl font-heading font-bold text-allgood-dark">Deep Dive: Tone</h2></section>
                    <p class="text-sm text-gray-600 mb-8 text-center">Rotate the dial to see how tone changes the output.</p>
                    
                    <div class="dial-container mb-8" id="tone-dial">
                        <div class="dial-knob" style="transform: rotate(0deg);">
                            <div class="dial-marker"></div>
                        </div>
                    </div>
                    
                    <div class="flex justify-center space-x-4 mb-8">
                        <button onclick="rotateDial(-45, 'Professional')" class="px-3 py-1 bg-gray-200 rounded text-xs font-bold hover:bg-gray-300">Corporate</button>
                        <button onclick="rotateDial(0, 'Neutral')" class="px-3 py-1 bg-gray-200 rounded text-xs font-bold hover:bg-gray-300">Neutral</button>
                        <button onclick="rotateDial(45, 'Empathetic')" class="px-3 py-1 bg-gray-200 rounded text-xs font-bold hover:bg-gray-300">Empathetic</button>
                    </div>

                    <div class="bg-white p-4 rounded border border-gray-200 shadow-sm text-center min-h-[100px] flex items-center justify-center">
                        <p id="tone-output" class="text-lg font-serif italic text-gray-700">"We received your complaint."</p>
                    </div>
                </div>

                <!-- Page 8: ACT Sort Drill -->
                <div class="page" id="page-8">
                    <section class="mb-4 border-b border-gray-200 pb-2"><h2 class="text-xl font-heading font-bold text-allgood-dark">Drill: The ACT Sort</h2></section>
                    <p class="text-xs text-gray-500 mb-4">Drag the prompt fragments into the correct ACT bucket.</p>
                    
                    <div class="grid grid-cols-3 gap-2 mb-4">
                        <div class="drop-zone p-2 bg-gray-50 border-2 border-dashed border-gray-300 rounded min-h-[100px] flex flex-col items-center justify-center" data-cat="A"><span class="font-bold text-allgood-primary">ACTION</span></div>
                        <div class="drop-zone p-2 bg-gray-50 border-2 border-dashed border-gray-300 rounded min-h-[100px] flex flex-col items-center justify-center" data-cat="C"><span class="font-bold text-gray-600">CONTEXT</span></div>
                        <div class="drop-zone p-2 bg-gray-50 border-2 border-dashed border-gray-300 rounded min-h-[100px] flex flex-col items-center justify-center" data-cat="T"><span class="font-bold text-allgood-secondary">TONE</span></div>
                    </div>

                    <div id="act-draggables" class="flex flex-wrap gap-2 justify-center">
                        <div class="draggable-item bg-white border border-gray-300 px-3 py-2 rounded text-xs shadow-sm" draggable="true" data-target="A">Summarize</div>
                        <div class="draggable-item bg-white border border-gray-300 px-3 py-2 rounded text-xs shadow-sm" draggable="true" data-target="C">For the sales team</div>
                        <div class="draggable-item bg-white border border-gray-300 px-3 py-2 rounded text-xs shadow-sm" draggable="true" data-target="T">Playful & Witty</div>
                        <div class="draggable-item bg-white border border-gray-300 px-3 py-2 rounded text-xs shadow-sm" draggable="true" data-target="A">Draft an email</div>
                        <div class="draggable-item bg-white border border-gray-300 px-3 py-2 rounded text-xs shadow-sm" draggable="true" data-target="C">Based on this PDF</div>
                        <div class="draggable-item bg-white border border-gray-300 px-3 py-2 rounded text-xs shadow-sm" draggable="true" data-target="T">Authoritative</div>
                    </div>
                    
                    <p id="sort-feedback" class="text-center text-sm font-bold mt-4 text-green-600 hidden">All Systems Go.</p>
                </div>

                <!-- Page 9: Daily Habits -->
                <div class="page" id="page-9">
                    <section class="mb-6 border-b border-gray-200 pb-4"><h2 class="text-2xl font-heading font-bold text-allgood-dark">Daily Habits</h2></section>
                    <p class="text-sm text-gray-600 mb-6">Pragmatic action starts with routine. Click to verify you understand these 3 use cases.</p>
                    
                    <div class="space-y-4">
                        <button class="habit-btn w-full p-4 bg-white border border-gray-200 rounded flex items-center hover:bg-gray-50 transition-colors" onclick="toggleHabit(this)">
                            <div class="w-6 h-6 border-2 border-gray-300 rounded-full mr-4 flex items-center justify-center check-circle"><i data-lucide="check" class="w-4 h-4 text-white opacity-0"></i></div>
                            <div class="text-left">
                                <strong class="block text-allgood-dark">Summarize</strong>
                                <span class="text-xs text-gray-500">Paste long reports. Ask for "Key Risks".</span>
                            </div>
                        </button>
                        <button class="habit-btn w-full p-4 bg-white border border-gray-200 rounded flex items-center hover:bg-gray-50 transition-colors" onclick="toggleHabit(this)">
                            <div class="w-6 h-6 border-2 border-gray-300 rounded-full mr-4 flex items-center justify-center check-circle"><i data-lucide="check" class="w-4 h-4 text-white opacity-0"></i></div>
                            <div class="text-left">
                                <strong class="block text-allgood-dark">Draft</strong>
                                <span class="text-xs text-gray-500">First drafts of tough emails. Never start from blank.</span>
                            </div>
                        </button>
                        <button class="habit-btn w-full p-4 bg-white border border-gray-200 rounded flex items-center hover:bg-gray-50 transition-colors" onclick="toggleHabit(this)">
                            <div class="w-6 h-6 border-2 border-gray-300 rounded-full mr-4 flex items-center justify-center check-circle"><i data-lucide="check" class="w-4 h-4 text-white opacity-0"></i></div>
                            <div class="text-left">
                                <strong class="block text-allgood-dark">Ideate</strong>
                                <span class="text-xs text-gray-500">"Give me 10 ideas for..." Break writer's block.</span>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Page 10: Scenario Setup -->
                <div class="page" id="page-10">
                    <div class="flex flex-col items-center justify-center h-full text-center bg-red-50 rounded -m-5 p-8 border border-red-100">
                        <i data-lucide="alert-octagon" class="w-16 h-16 text-red-500 mb-6 animate-pulse"></i>
                        <h2 class="text-3xl font-heading font-bold text-red-900 mb-2">CRISIS DETECTED</h2>
                        <div class="w-16 h-1 bg-red-200 rounded mb-6"></div>
                        <p class="text-lg text-red-800 mb-2"><strong>Time:</strong> 4:45 PM</p>
                        <p class="text-sm text-red-700 max-w-sm mx-auto">A colleague dumps a dense, 10-page technical report on your desk. You have a board meeting at 5:00 PM. You need to brief the VP.</p>
                    </div>
                </div>

                <!-- Page 11: The Decision -->
                <div class="page" id="page-11">
                    <section class="mb-6 border-b border-gray-200 pb-4"><h2 class="text-2xl font-heading font-bold text-allgood-dark">What is your move?</h2></section>
                    
                    <div class="space-y-4">
                        <button onclick="checkScenario('A')" class="w-full text-left p-4 bg-white border border-gray-200 rounded hover:bg-gray-50 shadow-sm group">
                            <span class="font-bold text-gray-500 mr-2 group-hover:text-allgood-primary">A.</span> Read it fast. (Speed Read)
                        </button>
                        <button onclick="checkScenario('B')" class="w-full text-left p-4 bg-white border border-gray-200 rounded hover:bg-gray-50 shadow-sm group">
                            <span class="font-bold text-gray-500 mr-2 group-hover:text-allgood-primary">B.</span> Decline the task. (Not enough time)
                        </button>
                        <button onclick="checkScenario('C')" class="w-full text-left p-4 bg-white border-2 border-allgood-secondary rounded hover:bg-blue-50 shadow-md group">
                            <span class="font-bold text-allgood-secondary mr-2">C.</span> <strong>ACT Prompt:</strong> "Summarize (A) this report (C) for key risks (T)."
                        </button>
                    </div>
                    
                    <div id="scenario-feedback" class="mt-6 p-4 rounded hidden"></div>
                </div>

                <!-- Page 12: Outcome -->
                <div class="page" id="page-12">
                    <div class="flex flex-col items-center justify-center h-full text-center">
                        <i data-lucide="check-circle" class="w-20 h-20 text-green-500 mb-6"></i>
                        <h2 class="text-3xl font-heading font-bold text-allgood-dark mb-4">Mission Success</h2>
                        <p class="text-gray-600 max-w-md mx-auto mb-8">You walked into that meeting prepared. You didn't just read the report; you extracted the intelligence needed to make a decision.</p>
                        <div class="bg-gray-100 p-4 rounded border border-gray-200 text-sm italic text-gray-500">
                            "AI didn't replace you. It just made you look like a genius."
                        </div>
                    </div>
                </div>

                <!-- Page 13: Challenge -->
                <div class="page" id="page-13">
                    <section class="mb-6 border-b border-gray-200 pb-4"><h2 class="text-2xl font-heading font-bold text-allgood-dark">The Challenge</h2></section>
                    <p class="text-sm text-gray-600 mb-8 text-center">Don't just learn. Do. Tap the card to accept your mission.</p>
                    
                    <div class="commit-card bg-allgood-secondary text-white p-8 rounded-xl shadow-lg text-center cursor-pointer border-4 border-transparent" onclick="acceptChallenge(this)">
                        <i data-lucide="target" class="w-12 h-12 mx-auto mb-4 text-white/80"></i>
                        <h3 class="text-2xl font-bold mb-2">I DARE YOU</h3>
                        <p class="text-sm text-white/80">Pick ONE task tomorrow. Hand it off to your AI Co-Pilot.</p>
                        <div id="challenge-status" class="mt-6 text-xs font-bold uppercase tracking-widest bg-white/20 py-2 rounded hidden">ACCEPTED</div>
                    </div>
                </div>

                <!-- Page 14: Certification -->
                <div class="page" id="page-14">
                    <div class="flex flex-col items-center justify-center h-full text-center">
                        <i data-lucide="award" class="w-20 h-20 text-allgood-primary mb-4"></i>
                        <h2 class="text-3xl font-heading font-bold text-allgood-dark mb-2">Certification Ready</h2>
                        <p class="text-sm text-gray-600 mb-8">You have mastered the ACT Framework.</p>
                        
                        <button onclick="downloadBadge()" class="bg-allgood-primary hover:bg-allgood-hover text-white px-8 py-4 rounded-full font-bold shadow-lg flex items-center transition-transform hover:scale-105">
                            <i data-lucide="download" class="w-5 h-5 mr-2"></i> Download Badge
                        </button>
                    </div>
                </div>

                <!-- Footer -->
                <footer class="footer-content flex items-center justify-between px-6 border-t border-gray-200 bg-white z-20 relative">
                    <div id="flex-progress-bar" class="absolute top-0 left-0 h-1 bg-gray-200 w-full"><div id="flex-progress-fill" class="h-full bg-allgood-primary w-0 transition-all duration-300"></div></div>
                    <button id="back-button" class="text-allgood-primary hover:text-allgood-dark font-bold text-sm flex items-center transition-colors disabled:opacity-30 disabled:cursor-not-allowed font-body">
                        <i data-lucide="chevron-left" class="w-4 h-4 mr-1"></i>Back
                    </button>
                    <p class="text-gray-400 text-[10px] hidden sm:block font-body">&copy; <a href="https://www.allgoodacademy.com" target="_blank" class="hover:text-allgood-primary transition-colors font-bold">Allgood Academy</a> <span id="current-year"></span></p>
                    <button id="next-button" class="bg-allgood-primary hover:bg-allgood-hover text-white px-6 py-2 rounded-full text-sm font-bold shadow-md transition-transform transform hover:scale-105 flex items-center disabled:opacity-50 disabled:cursor-not-allowed font-body">
                        <span>Next</span><i data-lucide="chevron-right" class="w-4 h-4 ml-1"></i>
                    </button>
                </footer>

            </div>
        </div>
    </main>

    <script>
        // --- LOGIC ENGINE ---
        
        let currentPageIndex = 0;
        const totalPages = 14;

        // Session Manager
        const SessionManager = {
            start: (name, email) => window.logToFirestore("Session Start", `User: ${name}`),
            log: (action, detail) => window.logToFirestore(action, detail)
        };
        window.SessionManager = SessionManager;

        // Audio Engine (Upgraded to OS Standard)
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;

        function initAudio() {
            if (!audioCtx) audioCtx = new AudioContext();
            if (audioCtx.state === 'suspended') audioCtx.resume().catch(e => console.error("Audio resume failed:", e));
        }

        function playTone(freq, type, duration, vol = 0.1, attack = 0.01, decay = 0.001) {
            initAudio();	
            const now = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, now);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            gain.gain.setValueAtTime(0, now);
            gain.gain.linearRampToValueAtTime(vol, now + attack);	
            gain.gain.exponentialRampToValueAtTime(decay, now + duration);	
            osc.start(now);
            osc.stop(now + duration);
        }

        const sfx = {
            powerOn: () => {
                initAudio();
                const now = audioCtx.currentTime;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(110, now);
                osc.frequency.exponentialRampToValueAtTime(220, now + 0.4);
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(0.4, now + 0.1);
                gain.gain.linearRampToValueAtTime(0, now + 0.4);
                osc.start(now); osc.stop(now + 0.4);
            },
            powerOff: () => { initAudio(); playTone(80, 'triangle', 0.2, 0.5, 0.01, 0.001); },
            nav: () => { initAudio(); playTone(150, 'sine', 0.1, 0.1, 0.01, 0.01); },
            tick: () => { initAudio(); playTone(1000, 'sine', 0.01, 0.01); },
            success: () => { playTone(400, 'sine', 0.1); setTimeout(() => playTone(600, 'sine', 0.2), 100); },
            error: () => playTone(150, 'sawtooth', 0.3)
        };
        window.sfx = sfx;
        window.initAudio = initAudio; // Expose for startup event

        // Navigation
        function showPage(index) {
            if (index < 0 || index >= totalPages) return;
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(`page-${index + 1}`).classList.add('active');
            currentPageIndex = index;
            
            // Progress Bar
            document.getElementById('flex-progress-fill').style.width = `${((index + 1) / totalPages) * 100}%`;
            document.getElementById('header-page-indicator').textContent = `${index + 1} / ${totalPages}`;
            
            // Button States
            const backBtn = document.getElementById('back-button');
            const nextBtn = document.getElementById('next-button');
            
            backBtn.disabled = (index === 0);
            backBtn.classList.toggle('opacity-0', index === 0);

            if (index === totalPages - 1) nextBtn.style.display = 'none';
            else { nextBtn.style.display = 'flex'; nextBtn.querySelector('span').textContent = 'Next'; }

            document.getElementById('menu-modal').classList.remove('visible-modal');
            document.getElementById('menu-modal').classList.add('hidden-modal');
            lucide.createIcons();
        }
        window.showPage = showPage;

        // --- PAGE SPECIFIC INTERACTION LOGIC ---

        // Page 2: Myth Toggle
        function toggleMyth() {
            const el = document.getElementById('myth-reveal');
            const check = document.getElementById('myth-toggle');
            if (check.checked) {
                el.classList.remove('hidden');
                document.getElementById('myth-text').textContent = "AI IS A TASK KILLER";
                document.getElementById('myth-text').classList.add('text-allgood-primary');
                sfx.success();
            } else {
                el.classList.add('hidden');
                document.getElementById('myth-text').textContent = "AI IS A JOB KILLER";
                document.getElementById('myth-text').classList.remove('text-allgood-primary');
            }
        }

        // Page 4: Accordion
        document.querySelectorAll('.accordion-toggle').forEach(btn => {
            btn.addEventListener('click', function() {
                const content = this.nextElementSibling;
                const wasOpen = !content.classList.contains('hidden');
                document.querySelectorAll('.accordion-content').forEach(c => c.classList.add('hidden'));
                if (!wasOpen) { content.classList.remove('hidden'); sfx.tick(); }
            });
        });

        // Page 5: Action Upgrade
        function upgradeAction() {
            const prompt = document.getElementById('action-prompt');
            prompt.style.textDecoration = "line-through";
            prompt.style.opacity = "0.5";
            document.getElementById('action-result').classList.remove('hidden');
            sfx.success();
        }

        // Page 7: Tone Dial
        function rotateDial(deg, tone) {
            document.querySelector('.dial-knob').style.transform = `rotate(${deg}deg)`;
            const out = document.getElementById('tone-output');
            if(tone === 'Professional') out.textContent = `"We acknowledge receipt of your complaint and will review it shortly."`;
            if(tone === 'Neutral') out.textContent = `"We received your complaint."`;
            if(tone === 'Empathetic') out.textContent = `"I am so sorry to hear about your experience. I want to make this right."`;
            sfx.tick();
        }

        // Page 8: ACT Sort
        let sortedCount = 0;
        document.querySelectorAll('.draggable-item').forEach(item => {
            item.addEventListener('dragstart', e => {
                e.dataTransfer.setData('text/plain', e.target.dataset.target);
                e.target.classList.add('dragging');
                sfx.tick();
            });
            item.addEventListener('dragend', e => e.target.classList.remove('dragging'));
        });

        document.querySelectorAll('.drop-zone').forEach(zone => {
            zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('drag-over'); });
            zone.addEventListener('dragleave', e => zone.classList.remove('drag-over'));
            zone.addEventListener('drop', e => {
                e.preventDefault();
                zone.classList.remove('drag-over');
                const type = e.dataTransfer.getData('text/plain');
                if (type === zone.dataset.cat) {
                    zone.classList.add('correct-flash');
                    setTimeout(() => zone.classList.remove('correct-flash'), 500);
                    sortedCount++;
                    sfx.success();
                    // Remove from source (simplification: hide it)
                    document.querySelector(`.draggable-item.dragging`).style.display = 'none';
                    if (sortedCount >= 6) document.getElementById('sort-feedback').classList.remove('hidden');
                } else {
                    zone.classList.add('error-flash');
                    setTimeout(() => zone.classList.remove('error-flash'), 500);
                    sfx.error();
                }
            });
        });

        // Page 9: Habits
        function toggleHabit(btn) {
            const icon = btn.querySelector('.check-circle i');
            const circle = btn.querySelector('.check-circle');
            if (icon.classList.contains('opacity-0')) {
                icon.classList.remove('opacity-0');
                circle.classList.add('bg-allgood-primary', 'border-transparent');
                circle.classList.remove('border-gray-300');
                sfx.tick();
            }
        }

        // Page 11: Scenario Quiz
        function checkScenario(option) {
            const feedback = document.getElementById('scenario-feedback');
            feedback.classList.remove('hidden', 'bg-red-50', 'text-red-700', 'bg-green-50', 'text-green-700');
            
            if (option === 'C') {
                feedback.classList.add('bg-green-50', 'text-green-700');
                feedback.innerHTML = "<strong>CORRECT.</strong> You applied the ACT framework to extract value quickly. You are ready.";
                sfx.success();
            } else {
                feedback.classList.add('bg-red-50', 'text-red-700');
                feedback.innerHTML = "<strong>INCORRECT.</strong> That approach either fails to deliver or misses the deadline. Use the AI.";
                sfx.error();
            }
        }

        // Page 13: Challenge
        function acceptChallenge(card) {
            document.getElementById('challenge-status').classList.remove('hidden');
            card.classList.add('signed');
            sfx.success();
            window.SessionManager.log("Challenge", "Accepted");
        }

        // Page 14: Badge
        window.downloadBadge = function() {
            const name = window.currentUserName.toUpperCase();
            const date = new Date().toLocaleDateString();
            
            const svg = `
            <svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
                <rect width="800" height="600" fill="#F7F7F7"/>
                <rect x="50" y="50" width="700" height="500" rx="20" fill="white" stroke="#357889" stroke-width="10"/>
                <text x="400" y="150" font-family="Georgia, serif" font-size="40" text-anchor="middle" fill="#357889">ALLGOOD ACADEMY</text>
                <text x="400" y="220" font-family="Verdana, sans-serif" font-size="24" text-anchor="middle" fill="#4C4C4C">AI CO-PILOT CERTIFIED</text>
                <line x1="200" y1="300" x2="600" y2="300" stroke="#D34716" stroke-width="4"/>
                <text x="400" y="380" font-family="Verdana, sans-serif" font-weight="bold" font-size="32" text-anchor="middle" fill="#D34716">${name}</text>
                <text x="400" y="450" font-family="Verdana, sans-serif" font-size="16" text-anchor="middle" fill="#757575">ISSUED: ${date}</text>
                <text x="400" y="500" font-family="Verdana, sans-serif" font-size="14" text-anchor="middle" fill="#757575">SKILLS: ACT FRAMEWORK | PROMPT ENGINEERING</text>
            </svg>`;
            
            window.logModuleCompletion(svg);
            
            const blob = new Blob([svg], {type: 'image/svg+xml'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Allgood-AI-CoPilot-${name}.svg`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            sfx.success();
        }

        // Global Listeners (For UI Consistency)
        document.getElementById('next-button').addEventListener('click', () => { showPage(currentPageIndex + 1); sfx.nav(); });
        document.getElementById('back-button').addEventListener('click', () => { showPage(currentPageIndex - 1); sfx.nav(); });
        document.getElementById('menu-toggle').addEventListener('click', () => document.getElementById('menu-modal').classList.remove('hidden-modal'));
        document.getElementById('close-menu').addEventListener('click', () => document.getElementById('menu-modal').classList.add('hidden-modal'));
        
        // Control Cluster Listeners
        document.getElementById('blueprint-toggle').addEventListener('click', () => {
            document.getElementById('screen').classList.toggle('blueprint-mode');
            const btn = document.getElementById('blueprint-toggle');
            if (document.getElementById('screen').classList.contains('blueprint-mode')) {
                btn.classList.add('text-cyan-300', 'bg-white/10');
            } else {
                btn.classList.remove('text-cyan-300', 'bg-white/10');
            }
            sfx.tick();
        });

        document.getElementById('fullscreen-toggle').addEventListener('click', () => {
            const frame = document.querySelector('.tablet-frame');
            frame.classList.toggle('focus-mode');
            const isFocus = frame.classList.contains('focus-mode');
            
            if (isFocus) {
                document.body.classList.add('is-focused');
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen().catch(err => console.log("Fullscreen blocked."));
                }
                document.getElementById('fullscreen-toggle').classList.add('text-green-300', 'bg-white/10');
            } else {
                document.body.classList.remove('is-focused');
                if (document.fullscreenElement) {
                    if (document.exitFullscreen) document.exitFullscreen().catch(err => {});
                }
                document.getElementById('fullscreen-toggle').classList.remove('text-green-300', 'bg-white/10');
            }
            sfx.tick();
        });

        // SYSTEM MENU LOGIC
        window.openSystemMenu = function() {
            document.getElementById('system-menu-modal').classList.remove('hidden-modal');
            document.getElementById('system-menu-modal').classList.add('visible-modal');
            sfx.tick();
        };

        window.closeSystemMenu = function() {
            document.getElementById('system-menu-modal').classList.remove('visible-modal');
            document.getElementById('system-menu-modal').classList.add('hidden-modal');
            sfx.tick();
        };

        window.handleSystemReset = async function() {
            closeSystemMenu();
            // 1. Sign out from Firebase
            if (window.authSignOut) {
                try { await window.authSignOut(); } catch(e) { console.log(e); }
            }
            // 2. Clear Local State
            localStorage.removeItem('aa_username');
            localStorage.removeItem('aa_uid');
            localStorage.removeItem('aa_is_guest');
            window.currentUser = null;
            window.currentUserName = "Agent Learner";
            
            // 3. Reset UI Elements
            document.getElementById('user-name-input').value = "";
            document.getElementById('user-email-input').value = "";
            document.getElementById('header-welcome-text').textContent = "Welcome, Agent Learner";
            
            // 4. Force reload or manual reset
            // A hard reload is cleanest to reset all JS state variables
            location.reload(); 
        };

        window.handleSystemExit = function() {
            window.location.href = "https://www.allgoodacademy.com";
        };

        // Long Press Home to Open System Menu
        const homeButton = document.getElementById('home-button');
        let pressTimer = null;
        if(homeButton) {
            const startLongPress = (e) => {
                e.preventDefault();	
                if (e.button === 0 || e.type === 'touchstart') {
                    pressTimer = setTimeout(() => { 
                        window.openSystemMenu();
                        pressTimer = null; 
                    }, 2000);
                }
            }
            const cancelLongPress = () => { if (pressTimer) { clearTimeout(pressTimer); pressTimer = null; } }
            
            homeButton.addEventListener('mousedown', startLongPress);
            homeButton.addEventListener('mouseleave', cancelLongPress);
            homeButton.addEventListener('mouseup', (e) => {	
                if (pressTimer !== null) { 
                    cancelLongPress();
                    if (currentPageIndex !== 0) { showPage(0); sfx.nav(); }
                }
            });
            homeButton.addEventListener('touchstart', startLongPress, { passive: false });
            homeButton.addEventListener('touchend', cancelLongPress);
        }

        document.querySelectorAll('.menu-link').forEach(btn => {
            btn.addEventListener('click', (e) => {
                showPage(parseInt(e.target.dataset.page));
                sfx.nav();
            });
        });
        
        // Startup Logic (Modified to FORCE Sign In)
        const startupScreen = document.getElementById('startup-screen');
        if (startupScreen) {
            const warmUp = () => initAudio();
            startupScreen.addEventListener('mousedown', warmUp, { once: true });
            startupScreen.addEventListener('touchstart', warmUp, { once: true });

            startupScreen.addEventListener('click', () => {
                sfx.powerOn();
                // FIX: Force Modal Appearance for default anonymous users
                // This ensures the "Sign In" modal appears even if a session persists
                document.getElementById('login-modal').classList.remove('hidden-modal');
                startupScreen.style.opacity = '0';
                setTimeout(() => { startupScreen.style.display = 'none'; }, 700);
            });
        }

        // Initialize Icons & Date
        document.getElementById('current-year').textContent = new Date().getFullYear();
        lucide.createIcons();
    </script>
</body>
</html>
